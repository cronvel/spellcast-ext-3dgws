(function(){function c(o,r,a){function l(i,e){if(!r[i]){if(!o[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(h)return h(i,!0);var n=new Error("Cannot find module '"+i+"'");throw n.code="MODULE_NOT_FOUND",n}var s=r[i]={exports:{}};o[i][0].call(s.exports,function(e){var t=o[i][1][e];return l(t||e)},s,s.exports,c,o,r,a)}return r[i].exports}for(var h="function"==typeof require&&require,e=0;e<a.length;e++)l(a[e]);return l}return c})()({1:[function(e,t,i){"use strict";const s=e("./GTransition.js");const a=e("./vectorUtils.js");const o=e("seventh");function n(e){this.gScene=e;this.mode=null;this.position={x:0,y:0,z:10};this.target={x:0,y:0,z:0};this.rotation={x:0,y:0,z:0,w:1};this.yaw=0;this.pitch=0;this.roll=0;this.distance=10;this.fov=Math.PI/4;this.perspective=1;this.free=false;this.trackingMode=null;this.babylon={type:null,camera:null};this.setMode("firstPerson")}t.exports=n;n.prototype.update=function(e,t=false){console.warn("3D Camera.update()",e);var i=this.babylon.camera,n=this.gScene.babylon.scene;if(e.mode){this.setMode(e.mode)}if(e.transition){e.transition=new s(e.transition)}if(e.free!==undefined){if(this.updateFree(e.free)){if(!e.position){e.position=this.position}if(!e.rotation){e.rotation=this.rotation}if(!e.target){e.target=this.target}if(e.yaw===undefined){e.yaw=this.yaw}if(e.pitch===undefined){e.pitch=this.pitch}if(e.roll===undefined){e.roll=this.roll}if(e.distance===undefined){e.distance=this.distance}}}switch(this.mode){case"positions":if(e.position||e.target||e.roll!==undefined){this.updateFirstPerson(e,false,true)}break;case"firstPerson":if(e.position||e.yaw!==undefined||e.pitch!==undefined||e.roll!==undefined){this.updateFirstPerson(e)}break;case"firstPersonQuaternion":if(e.position||e.rotation){this.updateFirstPerson(e,true)}break;case"orbital":if(e.target||e.yaw!==undefined||e.pitch!==undefined||e.roll!==undefined||e.distance!==undefined){this.updateOrbital(e)}break}if(e.fov!==undefined){this.fov=e.fov||Math.PI/4;if(e.transition){e.transition.createAnimation(n,i,"fov",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.fov/2)}else{i.fov=this.fov/2}}if(e.trackingMode!==undefined){this.trackingMode=e.trackingMode||null}return t&&e.transition&&e.transition.promise||o.resolved};n.prototype.setMode=function(e){var t,i;console.warn("##### Camera.setMode()",e,this.mode);if(e===this.mode){return}this.mode=e;switch(this.mode){case"positions":case"firstPerson":case"firstPersonQuaternion":if(this.babylon.type==="FreeCamera"){this.babylon.camera.position=new BABYLON.Vector3(this.position.x,this.position.y,this.position.z)}else{this.babylon.type="FreeCamera";if(this.babylon.camera){this.babylon.camera.dispose()}this.babylon.camera=new BABYLON.FreeCamera("Camera",new BABYLON.Vector3(this.position.x,this.position.y,this.position.z),this.gScene.babylon.scene);this.babylon.camera.onViewMatrixChangedObservable.add(()=>{this.gScene.changes.camera=true})}if(this.mode==="positions"){this.babylon.camera.rotationQuaternion=BABYLON.Quaternion.FromEulerVector(a.cameraRotationFromOriginAndTarget(this.position,this.target,this.roll))}else if(this.mode==="firstPersonQuaternion"){this.babylon.camera.rotationQuaternion=new BABYLON.Quaternion(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w)}else{this.babylon.camera.rotationQuaternion=BABYLON.Quaternion.FromEulerAngles(this.pitch,this.yaw,this.roll)}break;case"orbital":t=a.toCameraAlpha(this.yaw);i=a.toCameraBeta(this.pitch);if(this.babylon.type==="ArcRotateCamera"){this.babylon.camera.target=new BABYLON.Vector3(this.target.x,this.target.y,this.target.z);this.babylon.camera.alpha=t;this.babylon.camera.beta=i;this.babylon.camera.radius=this.distance}else{this.babylon.type="ArcRotateCamera";if(this.babylon.camera){this.babylon.camera.dispose()}this.babylon.camera=new BABYLON.ArcRotateCamera("Camera",t,i,this.distance,new BABYLON.Vector3(this.target.x,this.target.y,this.target.z),this.gScene.babylon.scene);this.babylon.camera.onViewMatrixChangedObservable.add(()=>{this.gScene.changes.camera=true})}break;default:return}this.babylon.camera.wheelPrecision=100;console.warn("~~~~~~ Camera.setMode() done")};n.prototype.updateFree=function(e){e=!!e;if(e===this.free){return}this.free=e;if(!this.free){this.babylon.camera.detachControl();return true}this.babylon.camera.attachControl();return false};n.prototype.updateFirstPerson=function(e,t,i){var n,s,o=this.babylon.camera,r=this.gScene.babylon.scene;if(e.position){this.position=e.position}if(e.target){this.target=e.target}if(e.rotation){this.rotation=e.rotation}if(e.yaw!==undefined){this.yaw=e.yaw}if(e.pitch!==undefined){this.pitch=e.pitch}if(e.roll!==undefined){this.roll=e.roll}if(i){s=BABYLON.Quaternion.FromEulerVector(a.cameraRotationFromOriginAndTarget(this.position,this.target,this.roll))}else if(t){if(e.rotation){s=new BABYLON.Quaternion(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w)}}else if(e.yaw!==undefined||e.pitch!==undefined||e.roll!==undefined){s=BABYLON.Quaternion.FromEulerAngles(this.pitch,this.yaw,this.roll)}if(e.transition){n=o.rotationQuaternion?o.rotationQuaternion:BABYLON.Quaternion.FromEulerVector(o.rotation);console.warn("[!] camera transition:",o,n,s);if(e.position){e.transition.createAnimation(r,o,"position",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(this.position.x,this.position.y,this.position.z))}if(s){e.transition.createAnimation(r,o,"rotationQuaternion",BABYLON.Animation.ANIMATIONTYPE_QUATERNION,s,n)}}else{console.warn("[!] camera direct:",o,s);if(e.position){o.position=new BABYLON.Vector3(this.position.x,this.position.y,this.position.z)}if(s){o.rotationQuaternion=s}}};n.prototype.updateOrbital=function(e){var t,i,n=this.babylon.camera,s=this.gScene.babylon.scene;if(e.target){this.target=e.target}if(e.yaw){this.yaw=e.yaw;t=a.toCameraAlpha(this.yaw)}if(e.pitch){this.pitch=e.pitch;i=a.toCameraBeta(this.pitch)}if(e.distance){this.distance=e.distance}if(e.transition){console.warn("[!] camera transition:",n);if(e.target){e.transition.createAnimation(s,n,"target",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(this.target.x,this.target.y,this.target.z))}if(e.yaw){e.transition.createAnimation(s,n,"alpha",BABYLON.Animation.ANIMATIONTYPE_FLOAT,t)}if(e.pitch){e.transition.createAnimation(s,n,"beta",BABYLON.Animation.ANIMATIONTYPE_FLOAT,i)}if(e.distance){e.transition.createAnimation(s,n,"radius",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.distance)}}else{console.warn("[!] camera direct:",n);if(e.target){n.target=new BABYLON.Vector3(this.target.x,this.target.y,this.target.z)}if(e.yaw){n.alpha=t}if(e.pitch){n.beta=i}if(e.distance){n.radius=this.distance}}}},{"./GTransition.js":18,"./vectorUtils.js":24,seventh:49}],2:[function(e,t,i){"use strict";const c=e("seventh");const n=e("./meshUtils.js");function s(e,t){this.gScene=e;this.dieCount=t.dice;this.faceValues=t.values;this.dieDiffuseUrl=t.skinUrl||null;this.dieSize=.2;this.dieFaceReindex=[0,5,1,4,2,3];this.diceRollTimeLimit=3e3;this.maxPowerDuration=1e3;this.minThrowingPower=5;this.maxThrowingPower=20;this.arrowLength=.4;this.physicsTimeStep=10;this.gravity=20;this.friction=.9;this.restitution=.6;this.cameraHeight=3.8;this.wallVisibility=false;this.wallSize=3;this.wallThickness=.5;this.stillnessVelocitySumLimit=.01;this.destroyed=false;this.babylon={scene:null,physicsEngine:null,camera:null,light:null,diceMaterial:null,arrowMaterial:null,dice:[],arrow:null,ui:null}}t.exports=s;s.prototype.destroy=function(){if(this.destroyed){return}this.babylon.dice.forEach(e=>e.dispose());this.babylon.dice.length=0;if(this.babylon.arrow){this.babylon.arrow.dispose();this.babylon.arrow=null}if(this.babylon.diceMaterial){this.babylon.diceMaterial.dispose();this.babylon.diceMaterial=null}if(this.babylon.arrowMaterial){this.babylon.arrowMaterial.dispose();this.babylon.arrowMaterial=null}if(this.babylon.physicsEngine){this.babylon.physicsEngine.dispose();this.babylon.physicsEngine=null}if(this.babylon.light){this.babylon.light.dispose();this.babylon.light=null}if(this.babylon.ui){this.babylon.ui.dispose();this.babylon.ui=null}if(this.babylon.camera){this.babylon.camera.dispose();this.babylon.camera=null}if(this.babylon.scene){this.babylon.scene.dispose();this.babylon.scene=this.gScene.babylon.diceRollerScene=null}this.destroyed=true};s.prototype.init=function(){if(this.gScene.babylon.diceRollerScene){throw new Error("DiceRoller: there is already a diceRollerScene for these GScene")}var e=this.gScene.babylon.engine,s=this.babylon.scene=this.gScene.babylon.diceRollerScene=new BABYLON.Scene(e),t=e.getRenderWidth()/e.getRenderHeight();s.autoClear=false;s.enablePhysics(new BABYLON.Vector3(0,-this.gravity,0),new BABYLON.CannonJSPlugin);this.babylon.physicsEngine=s.getPhysicsEngine();this.babylon.physicsEngine.setSubTimeStep(this.physicsTimeStep);var i,n=0,o=0;i=this.babylon.camera=new BABYLON.ArcRotateCamera("camera",-Math.PI/2,0,this.cameraHeight,new BABYLON.Vector3(n,0,o),s);i.wheelPrecision=1e3;i.minZ=.05;this.babylon.light=new BABYLON.HemisphericLight("light",new BABYLON.Vector3(-.3,1,-.3),s);this.babylon.light.intensity=.7;var r=this.babylon.diceMaterial=new BABYLON.StandardMaterial("diceMaterial",s);r.diffuseTexture=new BABYLON.Texture(this.dieDiffuseUrl?this.gScene.dom.cleanUrl(this.dieDiffuseUrl):"/textures/die.png",s);r.specularColor=new BABYLON.Color3(.3,.3,.3);var a=this.babylon.arrowMaterial=new BABYLON.StandardMaterial("arrowMaterial",s);a.diffuseTexture=new BABYLON.Texture("/textures/arrow.png",s);a.diffuseTexture.hasAlpha=true;a.backFaceCulling=false;var l=6;var h=new Array(6);for(let t=0;t<6;t++){let e=this.dieFaceReindex[t];h[t]=new BABYLON.Vector4(e/l,0,(e+1)/l,1)}var c=this.babylon.arrow=BABYLON.MeshBuilder.CreatePlane("arrow",{height:.5,width:this.arrowLength},s);c.material=a;c.rotation.x=Math.PI/2;c.rotation.y=0;c.position.y=1;c.position.x=-.8-this.arrowLength/2;c.bakeTransformIntoVertices(BABYLON.Matrix.Translation(this.arrowLength/2,0,0));var u=BABYLON.MeshBuilder.CreateBox("north",{width:this.wallSize,height:this.wallSize,depth:this.wallThickness},s);u.position.y=this.wallSize/2;u.position.z=this.wallSize/2;u.physicsImpostor=new BABYLON.PhysicsImpostor(u,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:this.restitution,friction:this.friction},s);var p=BABYLON.MeshBuilder.CreateBox("south",{width:this.wallSize,height:this.wallSize,depth:this.wallThickness},s);p.position.y=this.wallSize/2;p.position.z=-this.wallSize/2;p.physicsImpostor=new BABYLON.PhysicsImpostor(p,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:this.restitution,friction:this.friction},s);var f=BABYLON.MeshBuilder.CreateBox("east",{width:this.wallThickness,height:this.wallSize,depth:this.wallSize},s);f.position.y=this.wallSize/2;f.position.x=this.wallSize/2;f.physicsImpostor=new BABYLON.PhysicsImpostor(f,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:this.restitution,friction:this.friction},s);var d=BABYLON.MeshBuilder.CreateBox("west",{width:this.wallThickness,height:this.wallSize,depth:this.wallSize},s);d.position.y=this.wallSize/2;d.position.x=-this.wallSize/2;d.physicsImpostor=new BABYLON.PhysicsImpostor(d,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:this.restitution,friction:this.friction},s);var y=BABYLON.MeshBuilder.CreateBox("top",{width:this.wallSize,height:this.wallThickness,depth:this.wallSize},s);y.position.y=this.wallSize;y.physicsImpostor=new BABYLON.PhysicsImpostor(y,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:this.restitution,friction:this.friction},s);var m=BABYLON.MeshBuilder.CreateBox("bottom",{width:this.wallSize,height:this.wallThickness,depth:this.wallSize},s);m.physicsImpostor=new BABYLON.PhysicsImpostor(m,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:this.restitution,friction:this.friction},s);if(!this.wallVisibility){u.setEnabled(false);p.setEnabled(false);f.setEnabled(false);d.setEnabled(false);y.setEnabled(false);m.setEnabled(false)}for(let n=0;n<this.dieCount;n++){let e=BABYLON.MeshBuilder.CreateBox("die",{size:this.dieSize,faceUV:h,wrap:true},s);e.material=r;let t=Math.round(n/6);let i=n%6;e.position.x=-this.wallSize/2*.75;e.position.y=this.wallThickness/2+.4+t*this.dieSize*1.2;e.position.z=-this.wallSize/2+2*this.wallThickness+i*this.dieSize*1.5;e.rotation.x=2*Math.PI*Math.random();e.rotation.y=2*Math.PI*Math.random();e.rotation.z=2*Math.PI*Math.random();this.babylon.dice.push(e)}console.warn("DirceRoller init done!")};s.prototype.roll=function(){console.warn("DirceRoller roll");var t,i,n,s=this.babylon.scene,o=this.babylon.arrow,e=10,r=new BABYLON.Vector3(10,0,0),a=new c;this.gScene.globalCamera.babylon.camera.detachControl();a.then(()=>{if(this.gScene.globalCamera.free){this.gScene.globalCamera.babylon.camera.attachControl()}});var l=async()=>{s.onPointerDown=s.onPointerMove=s.onPointerUp=null;if(n){clearInterval(n)}o.setEnabled(false);var e=Math.min(1,(Date.now()-i)/this.maxPowerDuration);r.z=-r.y;r.y=0;r.normalize();r.y=.6;r.normalize();try{t=await this.throwDice(e,r);await this.displayDiceRollResult(t)}catch(e){this.destroy();a.reject(e);return}this.destroy();a.resolve(t)};var h=()=>{if(i){return}s.onPointerDown=null;i=Date.now();var t=4*e/this.maxPowerDuration;n=setInterval(()=>{o.scaling.x+=t;var e=r.normalizeToNew();o.rotation.y=Math.atan2(e.y,e.x);if(Date.now()-i>this.maxPowerDuration){l()}},e);s.onPointerMove=e=>{r.x+=e.movementX;r.y+=e.movementY};s.onPointerUp=l};s.onPointerDown=h;setTimeout(h,2e3);return a};s.prototype.throwDice=async function(i,n){var s={},o=this.babylon.scene;i=this.maxThrowingPower*i+this.minThrowingPower*(1-i);for(let t=0;t<this.dieCount;t++){let e=this.babylon.dice[t];e.physicsImpostor=new BABYLON.PhysicsImpostor(e,BABYLON.PhysicsImpostor.BoxImpostor,{mass:1,restitution:this.restitution,friction:this.friction},o);e.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(i*n.x,i*n.y,i*n.z))}var e=Date.now();do{if(this.babylon.dice.every(e=>this.isStill(e))){break}await c.resolveTimeout(100)}while(Date.now()-e<this.diceRollTimeLimit);s.dice=this.babylon.dice.map(e=>this.getDieFace(e));s.sum=0;if(this.faceValues){s.values=s.dice.map(e=>{var t=this.faceValues[e];if(typeof t==="number"){s.sum+=t||0}else if(typeof t!=="string"){t=null}return t})}console.warn("Dice roll: ",s);return s};s.prototype.isStill=function(e){var t=e.physicsImpostor.physicsBody;var i=Math.abs(t.velocity.x)+Math.abs(t.velocity.y)+Math.abs(t.velocity.z)+Math.abs(t.angularVelocity.x)+Math.abs(t.angularVelocity.y)+Math.abs(t.angularVelocity.z);console.warn("velocity sum:",i);return i<this.stillnessVelocitySumLimit};s.prototype.getDieFace=function(e){var t=n.getUpmostBoxMeshFace(e);return this.dieFaceReindex[t]};s.prototype.displayDiceRollResult=function(e){var t=this.babylon.ui=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");var i=new BABYLON.GUI.Rectangle;i.width=.2;i.height="40px";i.cornerRadius=20;i.color="orange";i.thickness=4;i.background="green";t.addControl(i);var n=new BABYLON.GUI.TextBlock;n.text=e.values.join("+")+" = "+e.sum;n.color="white";n.fontSize=24;i.addControl(n);return c.resolveTimeout(2e3)}},{"./meshUtils.js":22,seventh:49}],3:[function(e,t,i){"use strict";const n=e("./GTransition.js");const s=e("./Parametric.js");const o=e("nextgen-events/lib/LeanEvents.js");const r=e("seventh");function a(e,t,i){this.id=i.id||null;this.gScene=t;this.gScene.registerGEntity(this.id,this);this.dom=e;this.usage=i.usage||"sprite";this.parent=undefined;this.parentMode=undefined;this.parentTransformNode=undefined;this.transient=i.transient||undefined;this.destroyed=false;this.show=false;this.persistent=true;this.button=null;this.theme=null;this.texturePack=null;this.variant="default";this.frame=0;this.location=null;this.origin={x:0,y:0,z:0};this.position={x:0,y:0,z:0};this.positionMode="default";this.size={x:1,y:1,z:1};this.sizeMode="default";this.rotation={x:0,y:0,z:0};this.rotationMode="default";this.direction={x:1,y:0,z:0};this.facing=0;this.billboard=null;this.opacity=1;this.special={};this.meta={};this.engine={};this.parametric=null;this.clientMods={variant:null,xFlipVariant:null,xFlip:false,origin:null,position:null,size:null};this.firstUpdate=true;this.updateMeshNeeded=true;this.updateMaterialNeeded=true;this.createLightNeeded=false;this.texturePackObject=null;this.variantObject=null;this.frameObject=null;this.lightEmitting=false;this.textureCache={};this.textureAnimationTimer=null;this.children=new Set;this.transformNodes={};this.perPropertyTransformNodes={};if(i.parent){this.setParent(i.parent,i.parentMode)}this.babylon={material:null,mesh:null,light:null,texture:null,particleSystem:null};this.nextTextureFrame=this.nextTextureFrame.bind(this);this.defineStates("loaded","loading");if(this.noLocalLighting){this.gScene.noLocalLightingGEntities.add(this);this.gScene.once("render",()=>this.gScene.updateLightExcludedMeshes(),{unique:true,id:"updateLightExcludedMeshes"})}}a.prototype=Object.create(o.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.localBBoxSize=1;a.prototype.noLocalLighting=false;a.prototype.isLocalLight=true;a.prototype.noParentScaling=false;a.prototype.forceZScalingToX=false;a.prototype.destroy=function(){if(this.destroyed){return}if(this.noLocalLighting){this.gScene.noLocalLightingGEntities.remove(this);this.gScene.once("render",()=>this.gScene.updateLightExcludedMeshes(),{unique:true,id:"updateLightExcludedMeshes"})}if(this.children.size){for(let e of this.children){e.destroy()}}for(let e in this.transformNodes){e.dispose()}if(this.babylon.mesh){this.babylon.mesh.parent=null;this.babylon.mesh.dispose();this.babylon.mesh=null}if(this.babylon.material){this.babylon.material.dispose(false,false,true);this.babylon.material=null}if(this.babylon.texture){this.babylon.texture.dispose();this.babylon.texture=null}if(this.babylon.particleSystem){this.babylon.particleSystem.dispose();this.babylon.particleSystem=null}this.gScene.unregisterGEntity(this.id);this.destroyed=true};const l={default:{mesh:true}};a.prototype.setParent=function(e,t){var i=this.gScene.gEntities[e];if(!i){return}this.parent=i;if(typeof t==="string"){t=l[t]||l.default}if(!t||typeof t!=="object"){t=l.default}this.parentMode={mesh:!!t.mesh,position:{all:false,x:false,y:false,z:false}};if(t.position){if(typeof t.position==="object"){this.parentMode.position.x=!!t.position.x;this.parentMode.position.y=!!t.position.y;this.parentMode.position.z=!!t.position.z;this.parentMode.position.all=this.parentMode.position.x&&this.parentMode.position.y&&this.parentMode.position.z}else{this.parentMode.position.all=this.parentMode.position.x=this.parentMode.position.y=this.parentMode.position.z=true}}i.addChild(this);this.parentTransformNode=i.ensureTransformNode(this.parentMode)};a.prototype.addChild=function(e){this.children.add(e)};a.prototype.update=async function(e,t=false,i=false){console.warn("3D GEntity.update()",e);if(e.delay){await r.resolveTimeout(e.delay*1e3)}if(this.firstUpdate){if(typeof this.transient==="number"){setTimeout(()=>this.destroy(),this.transient*1e3)}this.firstUpdate=false}if(e.transition){if(i){delete e.transition}else{e.transition=new n(e.transition)}}if(e.engine!==undefined){await this.updateEngine(e.engine)}if(e.special!==undefined){await this.updateSpecialStage1(e)}if(e.texturePack!==undefined||e.variant!==undefined||e.theme!==undefined){await this.updateTexture(e.texturePack,e.variant,e.theme)}if(this.updateMeshNeeded){await this.updateMesh()}if(this.updateMaterialNeeded){await this.updateMaterial()}if(this.createLightNeeded){this.createLightNeeded=false;this.lightEmitting=true;await this.createLight()}if(e.special!==undefined){await this.updateSpecialStage2(e)}if(typeof e.opacity==="number"){this.updateOpacity(e.opacity)}if(e.origin!==undefined){this.updateOrigin(e.origin)}if(e.direction!==undefined){this.updateDirection(e.direction)}if(e.facing!==undefined){this.updateFacing(e.facing)}if(e.billboard!==undefined){this.updateBillboard(e.billboard)}if(e.position!==undefined||e.positionMode!==undefined){this.updatePosition(e)}if(e.rotation!==undefined||e.rotationMode!==undefined){this.updateRotation(e)}if(e.size!==undefined||e.sizeMode!==undefined){this.updateSize(e.size)}if(e.parametric!==undefined){if(!e.parametric){if(this.parametric){this.parametric=null;this.gScene.parametricGEntities.delete(this)}}else if(typeof e.parametric==="object"){if(!this.parametric){this.gScene.parametricGEntities.add(this);this.parametric=new s(e.parametric)}else{this.parametric.update(e.parametric)}}console.warn("@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 3D GEntity.update() parametric",e)}return t&&e.transition&&e.transition.promise||r.resolved};a.prototype.parametricUpdate=function(e){var t=this.parametric.compute(e,this);if(!t){this.parametric=null;this.gScene.parametricGEntities.delete(this);return}if(typeof t.opacity==="number"){this.updateOpacity(t.opacity,true)}if(t.position!==undefined||t.positionMode!==undefined){this.updatePosition(t,true)}if(t.rotation!==undefined||t.rotationMode!==undefined){this.updateRotation(t,true)}if(t.size!==undefined||t.sizeMode!==undefined){this.updateSize(t.size,true)}};a.prototype.updateEngine=function(e){};a.prototype.updateSpecialStage1=function(e){};a.prototype.updateSpecialStage2=function(e){if(e.special.light!==undefined){this.updateLight(e)}if(e.special&&e.special.material){this.updateMaterialParams(e.special.material)}};a.prototype.updateDirection=function(e){this.direction=e};a.prototype.updateFacing=function(e){this.facing=e};a.prototype.updateMesh=function(){this.updateMeshNeeded=false};const h=BABYLON.AbstractMesh.BILLBOARDMODE_X,c=BABYLON.AbstractMesh.BILLBOARDMODE_Y,u=BABYLON.AbstractMesh.BILLBOARDMODE_Z;const p={none:0,all:h|c|u,xyz:h|c|u,xy:h|c,xz:h|u,yz:c|u,x:h,y:c,z:u};a.BILLBOARD_MODES=p;a.prototype.updateBillboard=function(e){var t=this.babylon.mesh;this.billboard=e;if(t){t.billboardMode=p[this.billboard]||0}};a.prototype.updateMeshParent=function(){if(!this.parent||!this.babylon.mesh){return}var e,t=this.babylon.mesh;if(this.parentMode.mesh){e=this.parent.babylon.mesh;if(e){t.parent=e;if(this.noParentScaling){this.updateSize(this.size)}}}else if(this.parentTransformNode){t.parent=this.parentTransformNode}};a.prototype.refreshMaterial=async function(){this.updateTexture();if(this.updateMaterialNeeded){await this.updateMaterial()}};a.prototype.updateMaterial=function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;console.warn("3D GEntity.updateMaterial()",this.texturePackObject,this.variantObject);this.babylon.material=e=new BABYLON.StandardMaterial("basicMaterial",i);e.ambientColor=new BABYLON.Color3(1,1,1);e.diffuseColor=new BABYLON.Color3(0,0,0);e.specularColor=new BABYLON.Color3(0,0,0);e.emissiveColor=new BABYLON.Color3(0,0,0);e.backFaceCulling=true;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};a.prototype.updateMaterialParams=function(e,t=false){var i,n,s,o=this.babylon.material;console.warn("@@@@@@@@@@@@@@@@@@ updateMaterialParams()",e);if(e.ambient&&typeof e.ambient==="object"){if(!this.special.ambient){this.special.ambient={r:1,g:1,b:1}}i=e.ambient.r!==undefined?e.ambient.r:this.special.ambient.r,n=e.ambient.g!==undefined?e.ambient.g:this.special.ambient.g,s=e.ambient.b!==undefined?e.ambient.b:this.special.ambient.b;if(!t){this.special.ambient.r=i;this.special.ambient.g=n;this.special.ambient.b=s}o.ambientColor.set(i,n,s)}var r=e.diffuse||e.albedo;if(r&&typeof r==="object"){if(!this.special.diffuse){this.special.diffuse={r:0,g:0,b:0}}i=r.r!==undefined?r.r:this.special.diffuse.r,n=r.g!==undefined?r.g:this.special.diffuse.g,s=r.b!==undefined?r.b:this.special.diffuse.b;if(!t){this.special.diffuse.r=i;this.special.diffuse.g=n;this.special.diffuse.b=s}o.diffuseColor.set(i,n,s)}if(e.specular&&typeof e.specular==="object"){if(!this.special.specular){this.special.specular={r:0,g:0,b:0}}i=e.specular.r!==undefined?e.specular.r:this.special.specular.r,n=e.specular.g!==undefined?e.specular.g:this.special.specular.g,s=e.specular.b!==undefined?e.specular.b:this.special.specular.b;if(!t){this.special.specular.r=i;this.special.specular.g=n;this.special.specular.b=s}o.specularColor.set(i,n,s)}if(e.emissive&&typeof e.emissive==="object"){console.warn("@@@@@@@@@@@@@@@@@@ updateMaterialParams() emissive",e.emissive);if(!this.special.emissive){this.special.emissive={r:0,g:0,b:0}}i=e.emissive.r!==undefined?e.emissive.r:this.special.emissive.r,n=e.emissive.g!==undefined?e.emissive.g:this.special.emissive.g,s=e.emissive.b!==undefined?e.emissive.b:this.special.emissive.b;if(!t){this.special.emissive.r=i;this.special.emissive.g=n;this.special.emissive.b=s}o.emissiveColor.set(i,n,s)}};a.prototype.updateOpacity=function(e,t=false){var i=this.babylon.material;if(!i){return}if(e<0){e=0}else if(e>1){e=1}if(!t){this.opacity=e}i.alpha=e};a.prototype.updateTexture=function(e,t,i,n,s=false){var o,r,a;if(e!==undefined){this.texturePack=e||null}if(t!==undefined){this.variant=t||null}if(i!==undefined){this.theme=i||null}console.warn("3D GEntity.updateTexture()",e,t,i);o=this.gScene.texturePacks[this.texturePack+"/"+(this.theme||this.gScene.theme)];if(!o){console.warn("3D Texture pack",this.texturePack+"/"+(this.theme||this.gScene.theme),"not found");o=this.gScene.texturePacks[this.texturePack+"/default"];if(!o){console.warn("3D Texture pack fallback",this.texturePack+"/default","not found");return}}var l=this.clientMods.xFlip;this.clientMods.xFlip=false;if(this.clientMods.variant){r=o.variants[this.variant+"@"+this.clientMods.variant];if(!r){r=o.variants[this.variant+"@"+this.clientMods.xFlipVariant];if(r){this.clientMods.xFlip=true}else{r=o.variants[this.variant]||o.variants.default}}}else{r=o.variants[this.variant]||o.variants.default}if(!r){console.warn("3D Texture pack variant",this.variant,"not found, and default variant missing too");return}if(r===this.variantObject){if(n!==undefined){this.frame=r.frames[n]?+n:0}}else{this.frame=n!==undefined&&r.frames[n]?+n:0}a=r.frames[this.frame]||r.frames[0];if(o!==this.texturePackObject){this.whenTextureCacheReady().then(()=>{if(o===this.texturePackObject){this.preloadTexturePack()}})}if(o===this.texturePackObject&&r===this.variantObject&&a===this.frameObject&&l===this.clientMods.xFlip){return}this.texturePackObject=o;this.variantObject=r;this.frameObject=a;if(this.variantObject.animation){this.startTextureAnimation(!s)}else{this.stopTextureAnimation()}this.updateMaterialNeeded=true};a.prototype.startTextureAnimation=function(e=false){if(!this.variantObject.animation){if(this.textureAnimationTimer){clearTimeout(this.textureAnimationTimer);this.textureAnimationTimer=null}return}if(this.textureAnimationTimer){if(!e){return}clearTimeout(this.textureAnimationTimer);this.textureAnimationTimer=null}this.textureAnimationTimer=setTimeout(this.nextTextureFrame,1e3*this.frameObject.duration)};a.prototype.stopTextureAnimation=function(){if(this.textureAnimationTimer){clearTimeout(this.textureAnimationTimer);this.textureAnimationTimer=null}};a.prototype.nextTextureFrame=function(){if(this.frame>=this.variantObject.frames.length-1){if(this.variantObject.animation==="loop"){this.frame=0}else{this.stopTextureAnimation();return}}else{this.frame++}this.frameObject=this.variantObject.frames[this.frame];this.textureAnimationTimer=setTimeout(this.nextTextureFrame,1e3*this.frameObject.duration);this.updateMaterial()};a.prototype.updateOrigin=function(e,t=false){if(this.clientMods.origin&&!t){this.origin=e;return}var i=this.clientMods.origin||this.origin;if(i.x===e.x&&i.y===e.y&&i.z===e.z){return}var n=this.babylon.mesh,s=this.localBBoxSize/2;n.bakeTransformIntoVertices(BABYLON.Matrix.Translation((i.x-e.x)*s,(i.y-e.y)*s,(i.z-e.z)*s));if(t){this.clientMods.origin=e}else{this.origin=e}};a.prototype.updatePosition=function(e,t=false,i=false){var n,s,o,r,a,l,h=this.clientMods.position,c=e.position,u=this.babylon.mesh,p=this.gScene.babylon.scene;if(i){if(h){if(c.x===h.x&&c.y===h.y&&c.z===h.z){return}n=u.position.x-h.x;s=u.position.y-h.y;o=u.position.z-h.z}else{if(!c.x&&!c.y&&!c.z){return}n=u.position.x;s=u.position.y;o=u.position.z}this.clientMods.position=c}else if(t){n=c.x!==undefined?c.x:this.position.x;s=c.y!==undefined?c.y:this.position.y;o=c.z!==undefined?c.z:this.position.z}else{n=this.position.x=c.x!==undefined?c.x:this.position.x;s=this.position.y=c.y!==undefined?c.y:this.position.y;o=this.position.z=c.z!==undefined?c.z:this.position.z}if(!u){return}r=n;a=s;l=o;if(this.clientMods.position){n+=this.clientMods.position.x;s+=this.clientMods.position.y;o+=this.clientMods.position.z}if(e.transition){e.transition.createAnimation(p,u,"position",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(n,s,o));if(this.perPropertyTransformNodes.position?.length){this.updatePositionOfTransformNodesWithTransition(e.transition,r,a,l)}}else{u.position.set(n,s,o);if(this.perPropertyTransformNodes.position?.length){this.updatePositionOfTransformNodes(r,a,l)}}};a.prototype.ensureTransformNode=function(e){var t="";if(e.position.all){t+="Pall"}else{if(e.position.x){t+="Px"}if(e.position.y){t+="Py"}if(e.position.z){t+="Pz"}}if(this.transformNodes[t]){return this.transformNodes[t]}var i=this.transformNodes[t]=new BABYLON.TransformNode(t,this.scene);i.__key=t;i.__px=i.__py=i.__pz=0;if(e.position.all){i.position.set(this.position.x,this.position.y,this.position.z);i.__px=i.__py=i.__pz=1;if(!this.perPropertyTransformNodes.position){this.perPropertyTransformNodes.position=[]}this.perPropertyTransformNodes.position.push(i)}else if(e.position.x||e.position.y||e.position.z){if(e.position.x){i.position.x=this.position.x;i.__px=1}if(e.position.y){i.position.y=this.position.y;i.__py=1}if(e.position.z){i.position.z=this.position.z;i.__pz=1}if(!this.perPropertyTransformNodes.position){this.perPropertyTransformNodes.position=[]}this.perPropertyTransformNodes.position.push(i)}return i};a.prototype.updatePositionOfTransformNodes=function(t,i,n){for(let e of this.perPropertyTransformNodes.position){e.position.set(e.__px*t,e.__py*i,e.__pz*n)}};a.prototype.updatePositionOfTransformNodesWithTransition=function(t,i,n,s){for(let e of this.perPropertyTransformNodes.position){t.createAnimation(this.scene,e,"position",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(e.__px*i,e.__py*n,e.__pz*s))}};a.prototype.updateRotation=function(e,t=false){console.warn("3D GEntity.updateRotation()",e);var i=this.babylon.mesh,n=this.gScene.babylon.scene;if(!i){return}var s=e.rotation.x!==undefined?e.rotation.x:this.rotation.x,o=e.rotation.y!==undefined?e.rotation.y:this.rotation.y,r=e.rotation.z!==undefined?e.rotation.z:this.rotation.z;if(!t){this.rotation.x=s;this.rotation.y=o;this.rotation.z=r}if(e.transition){e.transition.createAnimation(n,i,"rotation",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(s,o,r))}else{i.rotation.set(s,o,r)}};a.prototype.updateSize=function(e,t=false,i=false){console.warn("3D GEntity.updateSize()",e);var n,s,o,r=this.babylon.mesh,a=this.gScene.babylon.scene;if(i){this.clientMods.size={x:e.x!==undefined?e.x:1,y:e.y!==undefined?e.y:1,z:e.z!==undefined?e.z:1};n=this.size.x;s=this.size.y;o=this.size.z}else if(t){n=e.x!==undefined?e.x:this.size.x;s=e.y!==undefined?e.y:this.size.y;o=e.z!==undefined?e.z:this.size.z}else{n=this.size.x=e.x!==undefined?e.x:this.size.x;s=this.size.y=e.y!==undefined?e.y:this.size.y;o=this.size.z=e.z!==undefined?e.z:this.size.z}if(!r){return}if(this.clientMods.size){n*=this.clientMods.size.x;s*=this.clientMods.size.y;o*=this.clientMods.size.z}if(this.parent&&this.noParentScaling){let e=this.parent.babylon.mesh;n/=e.scaling.x;s/=e.scaling.y;o/=e.scaling.z}r.scaling.x=n;r.scaling.y=s;r.scaling.z=this.forceZScalingToX?n:o};a.prototype.updateLight=function(e,t=false){console.warn("3D GEntity.updateLight()",e);if(e.special.light===undefined){return}if(!e.special.light!==!this.lightEmitting){this.lightEmitting=!!e.special.light;if(!this.lightEmitting){this.destroyLight();return}this.createLight()}if(!e.special.light||typeof e.special.light!=="object"){return}var i=this.gScene.babylon.scene,n=this.babylon.light;if(e.special.light.diffuse&&typeof e.special.light.diffuse==="object"){this.special.light.diffuse=e.special.light.diffuse;if(e.transition){e.transition.createAnimation(i,n,"diffuse",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(this.special.light.diffuse.r,this.special.light.diffuse.g,this.special.light.diffuse.b))}else{n.diffuse.set(this.special.light.diffuse.r,this.special.light.diffuse.g,this.special.light.diffuse.b)}}if(e.special.light.specular&&typeof e.special.light.specular==="object"){this.special.light.specular=e.special.light.specular;if(e.transition){e.transition.createAnimation(i,n,"specular",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(this.special.light.specular.r,this.special.light.specular.g,this.special.light.specular.b))}else{n.specular.set(this.special.light.specular.r,this.special.light.specular.g,this.special.light.specular.b)}}if(e.special.light.intensity!==undefined){this.special.light.intensity=e.special.light.intensity;if(e.transition){e.transition.createAnimation(i,n,"intensity",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.light.intensity)}else{n.intensity=this.special.light.intensity}}};a.prototype.createLight=function(){console.warn("@@@@@@@@@@@@@@@@@@@@@@@@@ GEntity.createLight()");if(!this.babylon.mesh){throw new Error("Non pure light GEntity needs a mesh to be light-emitting")}var e=this.gScene.babylon.scene;if(!this.special.light){this.special.light={diffuse:new BABYLON.Color3(1,1,1),specular:new BABYLON.Color3(.5,.5,.5),intensity:1}}this.babylon.light=new BABYLON.PointLight("pointLight",new BABYLON.Vector3(0,0,0),e);this.babylon.light.parent=this.babylon.mesh;this.babylon.light.diffuse=this.special.light.diffuse;this.babylon.light.specular=this.special.light.specular;this.babylon.light.intensity=this.special.light.intensity;if(this.isLocalLight){this.registerLocalLight()}};a.prototype.destroyLight=function(){if(this.isLocalLight){this.unregisterLocalLight()}if(this.babylon.light){this.babylon.light.dispose()}this.special.light=null};a.prototype.registerLocalLight=function(){this.gScene.localLightGEntities.add(this);this.babylon.light.excludedMeshes=[...this.gScene.noLocalLightingGEntities].map(e=>e.babylon.mesh)};a.prototype.unregisterLocalLight=function(){this.gScene.localLightGEntities.delete(this)};a.prototype.getTexture=function(e){var t,i=this.gScene.babylon.scene;e=this.dom.cleanUrl(e);if(this.textureCache[e]){return this.textureCache[e]}t=this.textureCache[e]=new BABYLON.Texture(e,i);return t};a.prototype.preloadTexturePack=function(){var e,t,i,n,s=[];for(e in this.texturePackObject.variants){t=this.texturePackObject.variants[e];for(i of t.frames){if(i.url){s.push(this.getTexture(i.url))}if(i.maps){for(n in i.maps){s.push(this.getTexture(i.maps[n]))}}}}return new r(e=>BABYLON.Texture.WhenAllReady(s,()=>e()))};a.prototype.whenTextureCacheReady=function(){return new r(e=>BABYLON.Texture.WhenAllReady([...Object.values(this.textureCache)],()=>e()))};a.prototype.flipTexture=function(e,t,i){if(t){e.uScale=-1;e.uOffset=1}else{e.uScale=1;e.uOffset=0}if(i){e.vScale=-1;e.vOffset=1}else{e.vScale=1;e.vOffset=0}};a.prototype.updateSizeFromPixelDensity=function(e,t){var i;if(e.isReady()){i=e.getBaseSize();this.updateSize({x:i.width/t,y:i.height/t},false,true)}else{BABYLON.Texture.WhenAllReady([e],()=>{i=e.getBaseSize();this.updateSize({x:i.width/t,y:i.height/t},false,true)})}}},{"./GTransition.js":18,"./Parametric.js":19,"nextgen-events/lib/LeanEvents.js":37,seventh:49}],4:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const o=e("seventh");function r(e,t,i){n.call(this,e,t,i)}r.prototype=Object.create(n.prototype);r.prototype.constructor=r;t.exports=r;r.prototype.localBBoxSize=1e3;r.prototype.noLocalLighting=true;r.prototype.updateMaterial=function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;console.warn("3D GEntityBackground.updateMaterial()",this.texturePackObject,this.variantObject);var s=this.variantObject.frames[0].url;this.babylon.material=e=new BABYLON.StandardMaterial("simpleMaterial",i);e.backFaceCulling=true;e.diffuseTexture=new BABYLON.Texture(this.dom.cleanUrl(s),i);e.specularColor=new BABYLON.Color3(0,0,0);e.ambientColor=new BABYLON.Color3(1,1,1);e.backFaceCulling=false;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};r.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.MeshBuilder.CreateCylinder("background",{height:this.localBBoxSize,diameter:this.localBBoxSize,tessellation:24,cap:BABYLON.Mesh.NO_CAP,sideOrientation:BABYLON.Mesh.BACKSIDE},t);this.updateMeshNeeded=false;return e}},{"./GEntity.js":3,"./GTransition.js":18,seventh:49}],5:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const o=e("./vectorUtils.js");const r=e("seventh");const a={sphere:"CreateSphere"};function l(e,t,i){n.call(this,e,t,i);this.shapeClass=null;this.shapeParams={}}l.prototype=Object.create(n.prototype);l.prototype.constructor=l;t.exports=l;l.prototype.updateSpecialStage1=function(e){n.prototype.updateSpecialStage1.call(this,e);if(e.special.shape&&typeof e.special.shape==="object"){if(e.special.shape&&a[e.special.shape.type]){this.shapeClass=a[e.special.shape.type]}Object.assign(this.shapeParams,e.special.shape);this.updateMeshNeeded=true}};l.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;console.warn("@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ GEntityBasicShape.updateMesh()",this.shapeClass);if(!this.shapeClass){return}if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.MeshBuilder[this.shapeClass]("basic-shape",this.shapeParams,t);e.scaling.x=this.size.x;e.scaling.y=this.size.y;e.scaling.z=this.size.z;console.warn("@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Mesh:",e);this.updateMeshNeeded=false;return e}},{"./GEntity.js":3,"./GTransition.js":18,"./vectorUtils.js":24,seventh:49}],6:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const o=e("./vectorUtils.js");const r=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.updateMeshNeeded=this.updateMaterialNeeded=false}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.isLocalLight=false;a.prototype.updateLight=function(e){console.warn("3D GEntityDirectionalLight.updateLight()",e);n.prototype.updateLight.call(this,e);if(!e.special.light||typeof e.special.light!=="object"){return}var t=this.gScene.babylon.scene,i=this.babylon.light;if(e.special.light.direction&&typeof e.special.light.direction==="object"){this.special.light.direction=e.special.light.direction;if(e.transition){e.transition.createAnimation(t,i,"direction",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(this.special.light.direction.x,this.special.light.direction.y,this.special.light.direction.z))}else{i.direction.set(this.special.light.direction.x,this.special.light.direction.y,this.special.light.direction.z)}}};a.prototype.createLight=function(){var e=this.gScene.babylon.scene;if(this.babylon.light){console.warn("GEntityDirectionalLight.createLight(): light is already existing");return}if(!this.special.light){this.special.light={direction:new BABYLON.Vector3(0,-1,0),diffuse:new BABYLON.Color3(1,1,1),specular:new BABYLON.Color3(0,0,0),intensity:.2}}this.babylon.light=new BABYLON.DirectionalLight("directionalLight",this.special.light.direction,e);this.babylon.light.diffuse=this.special.light.diffuse;this.babylon.light.specular=this.special.light.specular;this.babylon.light.intensity=this.special.light.intensity;if(this.isLocalLight){this.registerLocalLight()}}},{"./GEntity.js":3,"./GTransition.js":18,"./vectorUtils.js":24,seventh:49}],7:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const o=e("./vectorUtils.js");const r=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.special.content={text:"",textColor:"white"}}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.noParentScaling=true;a.prototype.destroy=function(){if(this.babylon.advancedTexture){this.babylon.advancedTexture.parent=null;this.babylon.advancedTexture.dispose()}n.prototype.destroy.call(this)};a.prototype.updateTexture=function(){};a.prototype.updateMaterial=function(){var e,t,i,n=this.gScene.babylon.scene,s=this.babylon.mesh;console.warn("3D GEntityFloatingText.updateMaterial()");if(this.babylon.advancedTexture){e=this.babylon.advancedTexture}else{if(!s){s=this.updateMesh()}this.babylon.advancedTexture=e=BABYLON.GUI.AdvancedDynamicTexture.CreateForMesh(s,1024,64)}if(this.babylon.textBlock){t=this.babylon.textBlock}else{this.babylon.textBlock=t=new BABYLON.GUI.TextBlock;t.fontSizeInPixels=46;t.text=this.special.content.text;t.color=this.special.content.textColor;t.alpha=this.opacity;t.resizeToFit=true;e.addControl(t)}this.updateMaterialNeeded=false};const l=.7;a.prototype.updateContent=function(e){var t,i=this.babylon.advancedTexture,n=this.babylon.textBlock;if(!n){return}if(e.text!==undefined){n.text=this.special.content.text=""+e.text}if(typeof e.textColor==="string"){n.color=this.special.content.textColor=e.textColor}if(typeof e.outlineColor==="string"){n.outlineColor=this.special.content.outlineColor=e.outlineColor}if(typeof e.outlineWidth==="number"){n.outlineWidth=this.special.content.outlineWidth=e.outlineWidth}if(typeof e.shadowColor==="string"){n.shadowColor=this.special.content.shadowColor=e.shadowColor}if(typeof e.shadowBlur==="number"){n.shadowBlur=this.special.content.shadowBlur=e.shadowBlur}if(e.icon){if(this.babylon.icon){t=this.babylon.icon;t.source=this.dom.cleanUrl(e.icon);t.width=l*.0625;t.height=l}else{this.babylon.icon=t=new BABYLON.GUI.Image("icon",this.dom.cleanUrl(e.icon));t.width=l*.0625;t.height=l;i.addControl(t)}this.fixIcon()}};a.prototype.fixIcon=function(){if(this.babylon.textBlock._width.isPixel){this.babylon.icon.left=-32-this.babylon.textBlock.widthInPixels/2}else{setTimeout(()=>this.fixIcon(),10)}};a.prototype.updateMaterialParams=function(e,t=false){};a.prototype.updateOpacity=function(e,t=false){if(e<0){e=0}else if(e>1){e=1}if(!t){this.opacity=e}if(this.babylon.textBlock){this.babylon.textBlock.alpha=e}if(this.babylon.icon){this.babylon.icon.alpha=e}};a.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.PlaneBuilder.CreatePlane("floating-text",{width:80,height:5},t);e.billboardMode=BABYLON.AbstractMesh.BILLBOARDMODE_ALL;if(this.parent){this.updateMeshParent()}console.warn("GEntityFloatingText .updateMesh() Mesh:",e);this.updateMeshNeeded=false;return e};a.prototype.updateSpecialStage2=function(e){if(e.special&&e.special.content){this.updateContent(e.special.content)}}},{"./GEntity.js":3,"./GTransition.js":18,"./vectorUtils.js":24,seventh:49}],8:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const o=e("./vectorUtils.js");const r=e("seventh");function a(e,t,i){n.call(this,e,t,i)}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.updateMaterial=async function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;console.warn("3D GEntityFx.updateMaterial()",this.texturePackObject,this.variantObject);this.babylon.material=e=new BABYLON.StandardMaterial("fxMaterial",i);e.backFaceCulling=false;e.transparencyMode=BABYLON.Material.MATERIAL_ALPHABLEND;e.useAlphaFromDiffuseTexture=true;e.alpha=t?t.alpha:this.opacity;e.ambientColor=new BABYLON.Color3(1,1,1);var s=this.frameObject.maps&&(this.frameObject.maps.diffuse||this.frameObject.maps.albedo)||this.frameObject.url;e.diffuseTexture=this.getTexture(s);e.diffuseTexture.hasAlpha=true;e.diffuseTexture.wrapU=e.diffuseTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;e.specularColor=new BABYLON.Color3(0,0,0);var o=this.frameObject.xFlip,r=this.frameObject.yFlip;this.flipTexture(e.diffuseTexture,o,r);if(this.frameObject.origin){let e;if(!o&&!r){e=this.frameObject.origin}else{e={x:(o?-this.frameObject.origin.x:this.frameObject.origin.x)||0,y:(r?-this.frameObject.origin.y:this.frameObject.origin.y)||0,z:this.frameObject.origin.z||0}}this.updateOrigin(e,true)}if(this.texturePackObject.pixelDensity){this.updateSizeFromPixelDensity(e.diffuseTexture,this.texturePackObject.pixelDensity)}else if(this.frameObject.relSize){this.updateSize(this.frameObject.relSize,false,true)}if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};a.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.Mesh.CreatePlane("fx",undefined,t);if(this.parent){this.updateMeshParent()}console.warn("FX Mesh:",e);this.updateMeshNeeded=false;return e}},{"./GEntity.js":3,"./GTransition.js":18,"./vectorUtils.js":24,seventh:49}],9:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const o=e("seventh");function r(e,t,i){n.call(this,e,t,i)}r.prototype=Object.create(n.prototype);r.prototype.constructor=r;t.exports=r;r.prototype.updateMaterial=function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;console.warn("3D GEntityGround.updateMaterial()",this.texturePackObject,this.variantObject);var s=this.variantObject.frames[0].url;this.babylon.material=e=new BABYLON.StandardMaterial("simpleMaterial",i);e.backFaceCulling=true;e.diffuseTexture=new BABYLON.Texture(this.dom.cleanUrl(s),i);e.diffuseTexture.uScale=20;e.diffuseTexture.vScale=20;e.specularColor=new BABYLON.Color3(0,0,0);e.ambientColor=new BABYLON.Color3(1,1,1);e.backFaceCulling=false;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};r.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.MeshBuilder.CreateGround("ground",{height:1e3,width:1e3,subdivisions:4},t);this.updateMeshNeeded=false;return e}},{"./GEntity.js":3,"./GTransition.js":18,seventh:49}],10:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const o=e("./vectorUtils.js");const r=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.updateMeshNeeded=this.updateMaterialNeeded=false;this.createLightNeeded=true}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.isLocalLight=false;a.prototype.updateLight=function(e){console.warn("3D GEntityHemisphericLight.updateLight()",e);n.prototype.updateLight.call(this,e);if(!e.special.light||typeof e.special.light!=="object"){return}var t=this.gScene.babylon.scene,i=this.babylon.light;if(e.special.light.ground&&typeof e.special.light.ground==="object"){this.special.light.ground=e.special.light.ground;if(e.transition){e.transition.createAnimation(t,i,"groundColor",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(this.special.light.ground.r,this.special.light.ground.g,this.special.light.ground.b))}else{i.groundColor.set(this.special.light.ground.r,this.special.light.ground.g,this.special.light.ground.b)}}if(e.special.light.up&&typeof e.special.light.up==="object"){this.special.light.up=e.special.light.up;if(e.transition){e.transition.createAnimation(t,i,"direction",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(this.special.light.up.x,this.special.light.up.y,this.special.light.up.z))}else{i.direction.set(this.special.light.up.x,this.special.light.up.y,this.special.light.up.z)}}};a.prototype.createLight=function(){var e=this.gScene.babylon.scene;if(this.babylon.light){console.warn("GEntityHemisphericLight.createLight(): light is already existing");return}if(!this.special.light){this.special.light={up:new BABYLON.Vector3(0,1,0),diffuse:new BABYLON.Color3(1,1,1),specular:new BABYLON.Color3(0,0,0),ground:new BABYLON.Color3(.2,.2,.2),intensity:.2}}this.babylon.light=new BABYLON.HemisphericLight("hemisphericLight",this.special.light.up,e);this.babylon.light.diffuse=this.special.light.diffuse;this.babylon.light.specular=this.special.light.specular;this.babylon.light.groundColor=this.special.light.ground;this.babylon.light.intensity=this.special.light.intensity;if(this.isLocalLight){this.registerLocalLight()}}},{"./GEntity.js":3,"./GTransition.js":18,"./vectorUtils.js":24,seventh:49}],11:[function(e,t,i){"use strict";const o=e("./GEntity.js");const n=e("./GTransition.js");const s=e("./vectorUtils.js");const r=e("seventh");function a(e,t,i){o.call(this,e,t,i);this.special.particleSystem={capacity:100,updateRate:1,attachToCamera:false,shape:{type:"box",xmin:0,xmax:0,ymin:0,ymax:0,zmin:0,zmax:0,minRadius:0,maxRadius:0,height:0,angle:0},emitRate:100,duration:{min:10,max:10},blendMode:l.default,speed:{x:0,y:0,z:0,xyzmin:1,xyzmax:1},altSpeed:null,speedFactorGradient:null,rotation:{min:0,max:0},rotationSpeed:{min:0,max:0},rotationSpeedGradient:null,acceleration:{x:0,y:0,z:0},size:{xmin:1,xmax:1,ymin:1,ymax:1,xymin:1,xymax:1},sizeGradient:null,color:{r:1,g:1,b:1,a:1},altColor:null,endColor:null,colorGradient:null,billboard:"all"};this.emitterShape="box"}a.prototype=Object.create(o.prototype);a.prototype.constructor=a;t.exports=a;const l={add:BABYLON.ParticleSystem.BLENDMODE_ADD,multiply:BABYLON.ParticleSystem.BLENDMODE_MULTIPLY,multiplyAdd:BABYLON.ParticleSystem.BLENDMODE_MULTIPLYADD,oneOne:BABYLON.ParticleSystem.BLENDMODE_ONEONE,standard:BABYLON.ParticleSystem.BLENDMODE_STANDARD};l.default=l.standard;const h={box:"box",sphere:"sphere",hemisphere:"hemisphere",hemispheric:"hemisphere",cylinder:"cylinder",cone:"cone"};const c={none:"none",all:"all","all-axis":"all",y:"y","y-axis":"y"};a.prototype.updateSpecialStage2=function(e){var t,i,n,s;o.prototype.updateSpecialStage2.call(this,e);if(e.special.particleSystem&&typeof e.special.particleSystem==="object"){i=e.special.particleSystem;t=this.special.particleSystem;if(Number.isFinite(i.capacity)){t.capacity=i.capacity}if(Number.isFinite(i.updateRate)){t.updateRate=i.updateRate}if(typeof i.attachToCamera==="boolean"){t.attachToCamera=i.attachToCamera}if(i.shape&&typeof i.shape==="object"){if(i.shape.type&&h[i.shape.type]){t.shape.type=h[i.shape.type]}if(Number.isFinite(i.shape.xmin)){t.shape.xmin=i.shape.xmin}if(Number.isFinite(i.shape.ymin)){t.shape.ymin=i.shape.ymin}if(Number.isFinite(i.shape.zmin)){t.shape.zmin=i.shape.zmin}if(Number.isFinite(i.shape.xmax)){t.shape.xmax=i.shape.xmax}if(Number.isFinite(i.shape.ymax)){t.shape.ymax=i.shape.ymax}if(Number.isFinite(i.shape.zmax)){t.shape.zmax=i.shape.zmax}if(Number.isFinite(i.shape.minRadius)){t.shape.minRadius=i.shape.minRadius}if(Number.isFinite(i.shape.maxRadius)){t.shape.maxRadius=i.shape.maxRadius}else if(Number.isFinite(i.shape.radius)){t.shape.maxRadius=i.shape.radius}if(Number.isFinite(i.shape.height)){t.shape.height=i.shape.height}if(Number.isFinite(i.shape.angle)){t.shape.angle=i.shape.angle}}if(Number.isFinite(i.emitRate)){t.emitRate=i.emitRate}if(i.duration!==undefined){if(typeof i.duration==="object"){if(Number.isFinite(i.duration.min)){t.duration.min=i.duration.min}if(Number.isFinite(i.duration.max)){t.duration.max=i.duration.max}}else if(Number.isFinite(i.duration)){t.duration.min=t.duration.max=i.duration}}if(i.blendMode&&l[i.blendMode]){t.blendMode=l[i.blendMode]}if(i.speed&&typeof i.speed==="object"){if(Number.isFinite(i.speed.x)){t.speed.x=i.speed.x}if(Number.isFinite(i.speed.y)){t.speed.y=i.speed.y}if(Number.isFinite(i.speed.z)){t.speed.z=i.speed.z}if(Number.isFinite(i.speed.xyzmin)){t.speed.xyzmin=i.speed.xyzmin}if(Number.isFinite(i.speed.xyzmax)){t.speed.xyzmax=i.speed.xyzmax}}if(i.altSpeed===null){t.altSpeed=null}else if(i.altSpeed&&typeof i.altSpeed==="object"){if(!t.altSpeed){t.altSpeed={x:0,y:0,z:0}}if(Number.isFinite(i.altSpeed.x)){t.altSpeed.x=i.altSpeed.x}if(Number.isFinite(i.altSpeed.y)){t.altSpeed.y=i.altSpeed.y}if(Number.isFinite(i.altSpeed.z)){t.altSpeed.z=i.altSpeed.z}}if(i.speedFactorGradient===null){t.speedFactorGradient=null}else if(Array.isArray(i.speedFactorGradient)&&i.speedFactorGradient.length>=2){if(t.speedFactorGradient){t.speedFactorGradient.length=0}else{t.speedFactorGradient=[]}for(s of i.speedFactorGradient){n={t:0,min:1,max:1};t.speedFactorGradient.push(n);if(Number.isFinite(s.t)){n.t=s.t}if(Number.isFinite(s.v)){n.min=n.max=s.v}else{if(Number.isFinite(s.min)){n.min=s.min}if(Number.isFinite(s.max)){n.max=s.max}}}}if(i.acceleration&&typeof i.acceleration==="object"){if(Number.isFinite(i.acceleration.x)){t.acceleration.x=i.acceleration.x}if(Number.isFinite(i.acceleration.y)){t.acceleration.y=i.acceleration.y}if(Number.isFinite(i.acceleration.z)){t.acceleration.z=i.acceleration.z}}if(i.rotation!==undefined){if(typeof i.rotation==="object"){if(Number.isFinite(i.rotation.min)){t.rotation.min=i.rotation.min}if(Number.isFinite(i.rotation.max)){t.rotation.max=i.rotation.max}}else if(Number.isFinite(i.rotation)){t.rotation.min=t.rotation.max=i.rotation}}if(i.rotationSpeed!==undefined){if(typeof i.rotationSpeed==="object"){if(Number.isFinite(i.rotationSpeed.min)){t.rotationSpeed.min=i.rotationSpeed.min}if(Number.isFinite(i.rotationSpeed.max)){t.rotationSpeed.max=i.rotationSpeed.max}}else if(Number.isFinite(i.rotationSpeed)){t.rotationSpeed.min=t.rotationSpeed.max=i.rotationSpeed}}if(i.rotationSpeedGradient===null){t.rotationSpeedGradient=null}else if(Array.isArray(i.rotationSpeedGradient)&&i.rotationSpeedGradient.length>=2){if(t.rotationSpeedGradient){t.rotationSpeedGradient.length=0}else{t.rotationSpeedGradient=[]}for(s of i.rotationSpeedGradient){n={t:0,min:1,max:1};t.rotationSpeedGradient.push(n);if(Number.isFinite(s.t)){n.t=s.t}if(Number.isFinite(s.v)){n.min=n.max=s.v}else{if(Number.isFinite(s.min)){n.min=s.min}if(Number.isFinite(s.max)){n.max=s.max}}}}if(i.size&&typeof i.size==="object"){if(Number.isFinite(i.size.x)){t.size.xmin=t.size.xmax=i.size.x}else{if(Number.isFinite(i.size.xmin)){t.size.xmin=i.size.xmin}if(Number.isFinite(i.size.xmax)){t.size.xmax=i.size.xmax}}if(Number.isFinite(i.size.y)){t.size.ymin=t.size.ymax=i.size.y}else{if(Number.isFinite(i.size.ymin)){t.size.ymin=i.size.ymin}if(Number.isFinite(i.size.ymax)){t.size.ymax=i.size.ymax}}if(Number.isFinite(i.size.xy)){t.size.xymin=t.size.xymax=i.size.xy}else{if(Number.isFinite(i.size.xymin)){t.size.xymin=i.size.xymin}if(Number.isFinite(i.size.xymax)){t.size.xymax=i.size.xymax}}}if(i.sizeGradient===null){t.sizeGradient=null}else if(Array.isArray(i.sizeGradient)&&i.sizeGradient.length>=2){if(t.sizeGradient){t.sizeGradient.length=0}else{t.sizeGradient=[]}for(s of i.sizeGradient){n={t:0,min:1,max:1};t.sizeGradient.push(n);if(Number.isFinite(s.t)){n.t=s.t}if(Number.isFinite(s.v)){n.min=n.max=s.v}else{if(Number.isFinite(s.min)){n.min=s.min}if(Number.isFinite(s.max)){n.max=s.max}}}}if(i.color===null){t.color=null}else if(i.color&&typeof i.color==="object"){if(!t.color){t.color={r:1,g:1,b:1,a:1}}if(Number.isFinite(i.color.r)){t.color.r=i.color.r}if(Number.isFinite(i.color.g)){t.color.g=i.color.g}if(Number.isFinite(i.color.b)){t.color.b=i.color.b}if(Number.isFinite(i.color.a)){t.color.a=i.color.a}}if(i.altColor===null){t.altColor=null}else if(i.altColor&&typeof i.altColor==="object"){if(!t.altColor){t.altColor={r:1,g:1,b:1,a:1}}if(Number.isFinite(i.altColor.r)){t.altColor.r=i.altColor.r}if(Number.isFinite(i.altColor.g)){t.altColor.g=i.altColor.g}if(Number.isFinite(i.altColor.b)){t.altColor.b=i.altColor.b}if(Number.isFinite(i.altColor.a)){t.altColor.a=i.altColor.a}}if(i.endColor===null){t.endColor=null}else if(i.endColor&&typeof i.endColor==="object"){if(!t.endColor){t.endColor={r:1,g:1,b:1,a:1}}if(Number.isFinite(i.endColor.r)){t.endColor.r=i.endColor.r}if(Number.isFinite(i.endColor.g)){t.endColor.g=i.endColor.g}if(Number.isFinite(i.endColor.b)){t.endColor.b=i.endColor.b}if(Number.isFinite(i.endColor.a)){t.endColor.a=i.endColor.a}}if(i.colorGradient===null){t.colorGradient=null}else if(Array.isArray(i.colorGradient)&&i.colorGradient.length>=2){if(t.colorGradient){t.colorGradient.length=0}else{t.colorGradient=[]}for(s of i.colorGradient){n={t:0,color:{r:1,g:1,b:1,a:1},altColor:null};t.colorGradient.push(n);if(Number.isFinite(s.t)){n.t=s.t}if(s.color){if(Number.isFinite(s.color.r)){n.color.r=s.color.r}if(Number.isFinite(s.color.g)){n.color.g=s.color.g}if(Number.isFinite(s.color.b)){n.color.b=s.color.b}if(Number.isFinite(s.color.a)){n.color.a=s.color.a}if(s.altColor){n.altColor={r:1,g:1,b:1,a:1};if(Number.isFinite(s.altColor.r)){n.altColor.r=s.altColor.r}if(Number.isFinite(s.altColor.g)){n.altColor.g=s.altColor.g}if(Number.isFinite(s.altColor.b)){n.altColor.b=s.altColor.b}if(Number.isFinite(s.altColor.a)){n.altColor.a=s.altColor.a}}}else{if(Number.isFinite(s.r)){n.color.r=s.r}if(Number.isFinite(s.g)){n.color.g=s.g}if(Number.isFinite(s.b)){n.color.b=s.b}if(Number.isFinite(s.a)){n.color.a=s.a}}}}if(i.billboard!==undefined){if(i.billboard&&c[i.billboard]){t.billboard=c[i.billboard]}else if(i.billboard){t.billboard="all"}else{t.billboard="none"}}console.warn("$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$ data.special.particleSystem",this.special.particleSystem);this.updateParticleSystem()}};a.prototype.updateParticleSystem=function(){var e,t,i,n,s=false,o=this.special.particleSystem,r=this.gScene.babylon.scene;console.warn("3D GEntityParticleSystem.updateParticleSystem()",this.texturePackObject,this.variantObject);if(this.babylon.texture){this.babylon.texture.dispose()}if(this.babylon.particleSystem){this.babylon.particleSystem.dispose()}var a=this.variantObject.frames[0].url;this.babylon.texture=e=new BABYLON.Texture(this.dom.cleanUrl(a),r);this.babylon.particleSystem=t=new BABYLON.ParticleSystem("particles",o.capacity,r);t.updateSpeed=o.updateRate*.01;t.particleTexture=e;if(o.attachToCamera){t.emitter=this.gScene.globalCamera.babylon.camera}else{t.emitter=new BABYLON.Vector3(0,0,0)}this.emitterShape=o.shape.type;switch(this.emitterShape){case"box":t.minEmitBox=new BABYLON.Vector3(o.shape.xmin,o.shape.ymin,o.shape.zmin);t.maxEmitBox=new BABYLON.Vector3(o.shape.xmax,o.shape.ymax,o.shape.zmax);break;case"sphere":s=true;i=t.createSphereEmitter();i.radius=o.shape.maxRadius;i.radiusRange=1-o.shape.minRadius/o.shape.maxRadius;break;case"hemisphere":s=true;i=t.createHemisphericEmitter();i.radius=o.shape.maxRadius;i.radiusRange=1-o.shape.minRadius/o.shape.maxRadius;break;case"cylinder":s=true;i=t.createCylinderEmitter();i.radius=o.shape.maxRadius;i.radiusRange=1-o.shape.minRadius/o.shape.maxRadius;i.height=o.shape.height;break;case"cone":s=true;i=t.createConeEmitter();i.radius=o.shape.maxRadius;i.radiusRange=1-o.shape.minRadius/o.shape.maxRadius;i.angle=o.shape.angle;break}t.emitRate=o.emitRate;t.minLifeTime=o.duration.min;t.maxLifeTime=o.duration.max;t.blendMode=o.blendMode;if(!s){t.direction1=new BABYLON.Vector3(o.speed.x,+o.speed.y,+o.speed.z);t.direction2=o.altSpeed?new BABYLON.Vector3(o.altSpeed.x,o.altSpeed.y,o.altSpeed.z):new BABYLON.Vector3(o.speed.x,+o.speed.y,+o.speed.z)}t.minEmitPower=o.speed.xyzmin;t.maxEmitPower=o.speed.xyzmax;if(o.speedFactorGradient){for(n of o.speedFactorGradient){t.addVelocityGradient(n.t,n.min,n.max)}}t.minInitialRotation=o.rotation.min;t.maxInitialRotation=o.rotation.max;t.minAngularSpeed=o.rotationSpeed.min;t.maxAngularSpeed=o.rotationSpeed.max;if(o.rotationSpeedGradient){for(n of o.rotationSpeedGradient){t.addAngularSpeedGradient(n.t,n.min,n.max)}}t.gravity=new BABYLON.Vector3(o.acceleration.x,o.acceleration.y,o.acceleration.z);t.minScaleX=o.size.xmin;t.maxScaleX=o.size.xmax;t.minScaleY=o.size.ymin;t.maxScaleY=o.size.ymax;t.minSize=o.size.xymin;t.maxSize=o.size.xymax;if(o.sizeGradient){for(n of o.sizeGradient){t.addSizeGradient(n.t,n.min,n.max)}}t.color1=new BABYLON.Color4(o.color.r,o.color.g,o.color.b,o.color.a);t.color2=o.altColor?new BABYLON.Color4(o.altColor.r,o.altColor.g,o.altColor.b,o.altColor.a):new BABYLON.Color4(o.color.r,o.color.g,o.color.b,o.color.a);t.colorDead=o.endColor?new BABYLON.Color4(o.endColor.r,o.endColor.g,o.endColor.b,o.endColor.a):new BABYLON.Color4(o.color.r,o.color.g,o.color.b,o.color.a);if(o.colorGradient){for(n of o.colorGradient){t.addColorGradient(n.t,new BABYLON.Color4(n.color.r,n.color.g,n.color.b,n.color.a),n.altColor?new BABYLON.Color4(n.altColor.r,n.altColor.g,n.altColor.b,n.altColor.a):undefined)}}switch(o.billboard){case"none":t.isBillboardBased=false;break;case"y":t.isBillboardBased=true;t.billboardMode=BABYLON.ParticleSystem.BILLBOARDMODE_Y;break;case"all":default:t.isBillboardBased=true;t.billboardMode=BABYLON.ParticleSystem.BILLBOARDMODE_ALL;break}t.renderingGroupId=1;t.start()};a.prototype.updateMaterial=function(){this.updateMaterialNeeded=false;return};a.prototype.updateMesh=function(){this.updateMeshNeeded=false;return};a.prototype.updateOrigin=function(e,t=false){};a.prototype.updatePosition=function(e,t=false){var i=this.babylon.particleSystem,n=this.gScene.babylon.scene;if(!i||this.special.particleSystem.attachToCamera){return}var s=e.position.x!==undefined?e.position.x:this.position.x,o=e.position.y!==undefined?e.position.y:this.position.y,r=e.position.z!==undefined?e.position.z:this.position.z;if(!t){this.position.x=s;this.position.y=o;this.position.z=r}if(e.transition){e.transition.createAnimation(n,i,"emitter",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(s,o,r))}else{i.emitter.set(s,o,r)}};a.prototype.updateRotation=function(e,t=false){};a.prototype.updateSize=function(e,t=false,i=false){}},{"./GEntity.js":3,"./GTransition.js":18,"./vectorUtils.js":24,seventh:49}],12:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const o=e("./vectorUtils.js");const r=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.updateMeshNeeded=this.updateMaterialNeeded=false}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.isLocalLight=true;a.prototype.updatePosition=function(e,t=false){var i=this.babylon.light,n=this.gScene.babylon.scene;if(!i){return}var s=e.position.x!==undefined?e.position.x:this.position.x,o=e.position.y!==undefined?e.position.y:this.position.y,r=e.position.z!==undefined?e.position.z:this.position.z;if(!t){this.position.x=s;this.position.y=o;this.position.z=r}if(e.transition){e.transition.createAnimation(n,i,"position",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(s,o,r))}else{i.position.set(s,o,r)}};a.prototype.updateMaterialParams=function(){};a.prototype.createLight=function(){var e=this.gScene.babylon.scene;if(this.babylon.light){console.warn("GEntityPointLight.createLight(): light is already existing");return}if(!this.special.light){this.special.light={diffuse:new BABYLON.Color3(1,1,1),specular:new BABYLON.Color3(.5,.5,.5),intensity:1}}this.babylon.light=new BABYLON.PointLight("pointLight",new BABYLON.Vector3(this.position.x,this.position.y,this.position.z),e);this.babylon.light.diffuse=this.special.light.diffuse;this.babylon.light.specular=this.special.light.specular;this.babylon.light.intensity=this.special.light.intensity;if(this.isLocalLight){this.registerLocalLight()}}},{"./GEntity.js":3,"./GTransition.js":18,"./vectorUtils.js":24,seventh:49}],13:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const o=e("./vectorUtils.js");const r=e("seventh");function a(e,t,i){n.call(this,e,t,i)}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.updateMaterial=function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;this.babylon.material=e=new BABYLON.StandardMaterial("spriteMaterial",i);e.backFaceCulling=true;e.diffuseTexture=new BABYLON.Texture("/textures/shadow.png",i);e.diffuseTexture.wrapU=e.diffuseTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;e.diffuseTexture.hasAlpha=true;e.useAlphaFromDiffuseTexture=true;e.transparencyMode=BABYLON.Material.MATERIAL_ALPHABLEND;e.disableLighting=true;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};a.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.Mesh.CreatePlane("shadow",undefined,t);e.rotation.x=Math.PI/2;e.bakeCurrentTransformIntoVertices();if(this.parent){this.updateMeshParent()}console.warn("Mesh:",e);this.updateMeshNeeded=false;return e}},{"./GEntity.js":3,"./GTransition.js":18,"./vectorUtils.js":24,seventh:49}],14:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const o=e("./vectorUtils.js");const r=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.updateMeshNeeded=this.updateMaterialNeeded=false;console.error("Not supported ATM!")}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a},{"./GEntity.js":3,"./GTransition.js":18,"./vectorUtils.js":24,seventh:49}],15:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const a=e("./vectorUtils.js");const o=e("seventh");function r(e,t,i){n.call(this,e,t,i);this.autoFacing=this.autoFacing.bind(this)}r.prototype=Object.create(n.prototype);r.prototype.constructor=r;t.exports=r;r.prototype.forceZScalingToX=true;r.prototype.updateSpecialStage1=function(e){n.prototype.updateSpecialStage1.call(this,e);if(e.special.spriteAutoFacing!==undefined&&(e.special.spriteAutoFacing===false||a.radToSector[e.special.spriteAutoFacing])&&e.special.spriteAutoFacing!==this.special.spriteAutoFacing){this.special.spriteAutoFacing=e.special.spriteAutoFacing;if(this.special.spriteAutoFacing){this.gScene.on("render",this.autoFacing)}else{this.gScene.off("render",this.autoFacing)}}};r.prototype.updateFacing=function(e){this.facing=e;if(this.special.spriteAutoFacing){this.autoFacing()}};r.prototype.updateMaterial=async function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;console.warn("3D GEntitySprite.updateMaterial()",this.texturePackObject,this.variantObject);this.babylon.material=e=new BABYLON.StandardMaterial("spriteMaterial",i);e.backFaceCulling=true;e.ambientColor=new BABYLON.Color3(1,1,1);var s=this.frameObject.maps&&(this.frameObject.maps.diffuse||this.frameObject.maps.albedo)||this.frameObject.url;e.diffuseTexture=this.getTexture(s);e.diffuseTexture.hasAlpha=true;e.diffuseTexture.wrapU=e.diffuseTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;var o=this.frameObject.maps&&(this.frameObject.maps.normal||this.frameObject.maps.bump);if(o){e.bumpTexture=this.getTexture(o);e.bumpTexture.wrapU=e.bumpTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;e.invertNormalMapX=true;e.invertNormalMapY=true}var r=this.frameObject.maps&&this.frameObject.maps.specular;if(r){e.specularTexture=this.getTexture(r);e.specularTexture.wrapU=e.specularTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;e.useGlossinessFromSpecularMapAlpha=true}else{e.specularColor=new BABYLON.Color3(0,0,0)}var a=!this.frameObject.xFlip!==!this.clientMods.xFlip,l=this.frameObject.yFlip;this.flipTexture(e.diffuseTexture,a,l);if(e.bumpTexture){this.flipTexture(e.bumpTexture,a,l)}if(e.specularTexture){this.flipTexture(e.specularTexture,a,l)}if(this.frameObject.origin){let e;if(!a&&!l){e=this.frameObject.origin}else{e={x:(a?-this.frameObject.origin.x:this.frameObject.origin.x)||0,y:(l?-this.frameObject.origin.y:this.frameObject.origin.y)||0,z:this.frameObject.origin.z||0}}this.updateOrigin(e,true)}if(this.texturePackObject.pixelDensity){this.updateSizeFromPixelDensity(e.diffuseTexture,this.texturePackObject.pixelDensity)}else if(this.frameObject.relSize){this.updateSize(this.frameObject.relSize,false,true)}e.backFaceCulling=false;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};r.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.Mesh.CreatePlane("sprite",undefined,t);e.billboardMode=BABYLON.AbstractMesh.BILLBOARDMODE_X|BABYLON.AbstractMesh.BILLBOARDMODE_Y;if(this.parent){this.updateMeshParent()}console.warn("Sprite Mesh:",e);this.updateMeshNeeded=false;return e};r.prototype.updateBillboard=function(){};r.prototype.autoFacing=function(e=null){if(e){if(!e.camera&&!this.parametric){return}}var t,i=this.babylon.mesh,n=i.position,s=this.gScene.globalCamera.babylon.camera.position,o=a.facingAngleRad(s,n,this.facing),r=a.radToSector[this.special.spriteAutoFacing](o);if(this.frameObject.zOffset!==null){t=s.subtract(n);t.y=0;t.normalize().scaleInPlace(this.frameObject.zOffset*this.size.y);this.updatePosition({position:t},false,true)}if(this.clientMods.variant!==r){this.clientMods.variant=r;this.clientMods.xFlipVariant=a.xFlipSector[r];this.refreshMaterial()}}},{"./GEntity.js":3,"./GTransition.js":18,"./vectorUtils.js":24,seventh:49}],16:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GEntityFloatingText.js");function o(e,t,i){s.call(this,e,t,i);this.special.content.textSize=.05;this.iconOffset=0;this.safeIconOffset=false;this.blinkSafe=false}o.prototype=Object.create(s.prototype);o.prototype.constructor=o;t.exports=o;o.prototype.destroy=function(){if(this.babylon.textBlock){this.babylon.textBlock.dispose()}if(this.babylon.icon){this.babylon.icon.dispose()}n.prototype.destroy.call(this)};o.prototype.updateMaterial=function(){var e,t=this.gScene.getUi();console.warn("3D GEntityUiFloatingText.updateMaterial()");if(this.babylon.textBlock){e=this.babylon.textBlock}else{this.babylon.textBlock=e=new BABYLON.GUI.TextBlock;e.text=this.special.content.text;e.color=this.special.content.textColor;e.alpha=this.opacity;e.resizeToFit=true;t.addControl(e);if(this.parent){e.linkWithMesh(this.parent.babylon.mesh);if(!this.blinkSafe){e.alpha=0;setTimeout(()=>{this.blinkSafe=true;e.alpha=this.opacity},20)}}}this.updateMaterialNeeded=false};o.prototype.updateOpacity=function(e,t=false){if(!this.blinkSafe){setTimeout(()=>{this.blinkSafe=true;this.updateOpacity(e,t)},20);return}s.prototype.updateOpacity.call(this,e,t)};const r=.8;o.prototype.updateContent=function(e){var t=this.gScene.getUi(),i=t.getSize(),n=this.babylon.textBlock;if(!n){return}if(e.text!==undefined){this.safeIconOffset=false;n.text=this.special.content.text=""+e.text}if(typeof e.textSize==="number"){this.safeIconOffset=false;this.special.content.textSize=e.textSize;n.fontSizeInPixels=Math.round(e.textSize*i.height)}if(typeof e.textColor==="string"){n.color=this.special.content.textColor=e.textColor}if(typeof e.outlineColor==="string"){n.outlineColor=this.special.content.outlineColor=e.outlineColor}if(typeof e.outlineWidth==="number"){this.special.content.outlineWidth=e.outlineWidth;n.outlineWidth=Math.round(e.outlineWidth*i.height)}if(typeof e.shadowColor==="string"){n.shadowColor=this.special.content.shadowColor=e.shadowColor}if(typeof e.shadowBlur==="number"){this.special.content.shadowBlur=e.shadowBlur;n.shadowBlur=Math.round(e.shadowBlur*i.height)}if(e.icon){this.updateContentIcon(e)}};o.prototype.updateContentIcon=function(e){var t,i=this.gScene.getUi(),n=this.babylon.textBlock;if(this.babylon.icon){t=this.babylon.icon;t.source=this.dom.cleanUrl(e.icon);t.width=n.fontSizeInPixels*r;t.height=n.fontSizeInPixels*r}else{this.babylon.icon=t=new BABYLON.GUI.Image("icon",this.dom.cleanUrl(e.icon));t.widthInPixels=n.fontSizeInPixels*r;t.heightInPixels=n.fontSizeInPixels*r;i.addControl(t);if(this.parent){t.linkWithMesh(this.parent.babylon.mesh);if(!this.blinkSafe){t.alpha=0;setTimeout(()=>{this.blinkSafe=true;t.alpha=this.opacity},20)}}}this.updateContentIconOffset(()=>{if(this.parent){t.linkOffsetXInPixels=n.linkOffsetXInPixels-this.iconOffset}else{t.leftInPixels=n.leftInPixels-this.iconOffset}})};o.prototype.updateContentIconOffset=function(e=null,t=false){var i=this.babylon.icon,n=this.babylon.textBlock;if(t){this.safeIconOffset=true}if(!this.safeIconOffset||!n._width.isPixel&&!t){setTimeout(()=>this.updateContentIconOffset(e,true),20);return}this.iconOffset=Math.round(i.widthInPixels/2+n.fontSizeInPixels/4+(n._width.isPixel?n.widthInPixels/2:n.fontSizeInPixels));if(e){e()}};o.prototype.updateMesh=function(){this.updateMeshNeeded=false;return};o.prototype.updateSpecialStage2=function(e){if(e.special&&e.special.content){this.updateContent(e.special.content)}};o.prototype.updatePosition=function(e,t=false){var i=this.babylon.textBlock,n=this.babylon.icon;if(n&&!this.safeIconOffset){this.updateContentIconOffset(()=>this.updatePosition(e,t));return}var s=this.gScene.getUi(),o=s.getSize(),r=this.gScene.babylon.scene;var a,l=e.position.x!==undefined?e.position.x:this.position.x,h=e.position.y!==undefined?e.position.y:this.position.y;if(!t){this.position.x=l;this.position.y=h}l=-l*o.width/2;h=-h*o.height/2;a=l-this.iconOffset;if(this.parent){if(e.transition){e.transition.createAnimation(r,i,"linkOffsetXInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,l);e.transition.createAnimation(r,i,"linkOffsetYInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,h);if(n){e.transition.createAnimation(r,n,"linkOffsetXInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,a);e.transition.createAnimation(r,n,"linkOffsetYInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,h)}}else{i.linkOffsetXInPixels=l;i.linkOffsetYInPixels=h;if(n){n.linkOffsetXInPixels=a;n.linkOffsetYInPixels=h}}}else if(e.transition){e.transition.createAnimation(r,i,"leftInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,l);e.transition.createAnimation(r,i,"topInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,h);if(n){e.transition.createAnimation(r,n,"leftInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,a);e.transition.createAnimation(r,n,"topInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,h)}}else{i.leftInPixels=l;i.topInPixels=h;if(n){n.leftInPixels=a;n.topInPixels=h}}}},{"./GEntity.js":3,"./GEntityFloatingText.js":7}],17:[function(e,t,i){"use strict";const s=e("./Camera.js");const n=e("./widgets/Message.js");const o=e("./widgets/Choices.js");const r=e("./GTransition.js");const a=e("nextgen-events/lib/LeanEvents.js");const l=e("seventh");function h(e,t){this.dom=e;this.engineId=t.engineId;this.active=false;this.paused=false;this.persistent=false;this.theme="default";this.special={};this.engine={};this.texturePacks={};this.gEntityLocations={};this.gEntities={};this.parametricGEntities=new Set;this.noLocalLightingGEntities=new Set;this.localLightGEntities=new Set;this.animationFunctions=new Set;this.mainChoices=null;this.textInput=null;this.globalCamera=null;this.roleCamera=null;this.$gscene=document.createElement("canvas");this.$gscene.classList.add("gscene");this.$gscene.style.visibility="hidden";this.dom.$gfx.append(this.$gscene);this.resizeObserver=null;this.changes={camera:false};this.babylon={engine:null,scene:null,diceRollerScene:null,ui:null};this.initScene()}h.prototype=Object.create(a.prototype);h.prototype.constructor=h;t.exports=h;h.prototype.childrenWidthInPixelsRequired=false;h.prototype.childrenHeightInPixelsRequired=false;h.prototype.initScene=function(){var e=this.babylon.engine=new BABYLON.Engine(this.$gscene,true);var n=this.babylon.scene=new BABYLON.Scene(e);n.autoClear=false;n.autoClearDepthAndStencil=false;n.setRenderingAutoClearDepthStencil(1,false);this.globalCamera=new s(this);e.runRenderLoop(()=>{var e,t,i=Date.now()/1e3;if(this.parametricGEntities.size){for(e of this.parametricGEntities){e.parametricUpdate(i)}}if(this.animationFunctions.size){for(t of this.animationFunctions){t(i)}}this.emit("render",this.changes);this.changes.camera=false;n.render();if(this.babylon.diceRollerScene){this.babylon.diceRollerScene.render()}});this.resizeObserver=new ResizeObserver(()=>e.resize());this.resizeObserver.observe(this.$gscene)};h.prototype.update=function(e,t=false,i=false){console.warn("3D GScene.update()",e);var n;if(e.transition){if(i){delete e.transition}else{e.transition=new r(e.transition)}}if(e.active!==undefined){this.active=!!e.active;this.$gscene.style.visibility=this.active?"visible":"hidden"}if(e.paused!==undefined){this.paused=!!e.paused}if(e.persistent!==undefined){this.persistent=!!e.persistent}if(e.theme!==undefined){this.theme=e.theme||"default"}if(e.special&&typeof e.special==="object"){if(e.special.ambient){this.updateAmbient(e)}if(typeof e.special.contrast==="number"){this.updateContrast(e)}if(typeof e.special.exposure==="number"){this.updateExposure(e)}if(e.special.colorGrading){this.updateColorGrading(e)}if(e.special.colorCurves){this.updateColorCurves(e)}if(e.special.vignette){this.updateVignette(e)}}if(e.engine&&typeof e.engine==="object"){Object.assign(this.engine,e.engine)}if(e.globalCamera!==undefined){this.globalCamera.update(e.globalCamera)}return t&&e.transition&&e.transition.promise||l.resolved};h.prototype.updateAmbient=function(e){console.warn(".updateAmbient()",this.special.ambient);var t=this.babylon.scene;if(!e.special.ambient||typeof e.special.ambient!=="object"){return}if(!this.special.ambient){this.special.ambient=new BABYLON.Color3(0,0,0)}Object.assign(this.special.ambient,e.special.ambient);if(e.transition){e.transition.createAnimation(t,t,"ambientColor",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(this.special.ambient.r,this.special.ambient.g,this.special.ambient.b))}else{t.ambientColor.set(this.special.ambient.r,this.special.ambient.g,this.special.ambient.b)}};h.prototype.updateContrast=function(e){console.warn(".updateContrast()",this.special.contrast);var t=this.babylon.scene;this.special.contrast=e.special.contrast;if(e.transition){e.transition.createAnimationFn(this,t.imageProcessingConfiguration,"contrast",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.contrast)}else{t.imageProcessingConfiguration.contrast=this.special.contrast}};h.prototype.updateExposure=function(e){console.warn(".updateExposure()",this.special.exposure);var t=this.babylon.scene;this.special.exposure=e.special.exposure;if(e.transition){e.transition.createAnimationFn(this,t.imageProcessingConfiguration,"exposure",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.exposure)}else{t.imageProcessingConfiguration.exposure=this.special.exposure}};const c=new Set(["globalHue","globalDensity","globalSaturation","highlightsHue","highlightsDensity","highlightsSaturation","shadowsHue","shadowsDensity","shadowsSaturation"]);h.prototype.updateColorCurves=function(e){console.warn(".updateColorCurves()",this.special.colorCurves);var t,i=e.special.colorCurves,n=this.babylon.scene;if(!i){if(this.special.colorCurves){this.special.colorCurves=null}n.imageProcessingConfiguration.colorCurvesEnabled=false;return}if(typeof i!=="object"){return}n.imageProcessingConfiguration.colorCurvesEnabled=true;if(!this.special.colorCurves){this.special.colorCurves={}}if(!n.imageProcessingConfiguration.colorCurves){n.imageProcessingConfiguration.colorCurves={globalHue:0,globalDensity:0,globalSaturation:0,highlightsHue:0,highlightsDensity:0,highlightsSaturation:0,shadowsHue:0,shadowsDensity:0,shadowsSaturation:0}}for(t in i){if(!c.has(t)&&typeof i[t]!=="number"){continue}this.special.colorCurves[t]=i[t];if(e.transition){e.transition.createAnimationFn(this,n.imageProcessingConfiguration.colorCurves,t,BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.colorCurves[t])}else{n.imageProcessingConfiguration.colorCurves[t]=this.special.colorCurves[t]}}};const u={stretch:"vignetteStretch",centerX:"vignetteCentreX",centerY:"vignetteCentreY",weight:"vignetteWeight"};h.prototype.updateVignette=function(e){console.warn(".updateVignette()",this.special.vignette);var t,i,n=e.special.vignette,s=this.babylon.scene;if(!n){if(this.special.vignette){this.special.vignette=null}s.imageProcessingConfiguration.vignetteEnabled=false;return}if(typeof n!=="object"){return}s.imageProcessingConfiguration.vignetteEnabled=true;if(!this.special.vignette){this.special.vignette={}}if(!s.imageProcessingConfiguration.vignette){}for(t in n){i=u[t];if(!i){continue}this.special.vignette[t]=n[t];if(e.transition){e.transition.createAnimationFn(this,s.imageProcessingConfiguration,i,BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.vignette[t])}else{s.imageProcessingConfiguration[i]=this.special.vignette[t]}}if(n.color){this.special.vignette.color=n.color;if(e.transition){e.transition.createAnimationFn(this,s.imageProcessingConfiguration,"vignetteColor",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(n.color.r,n.color.g,n.color.b))}else{s.imageProcessingConfiguration.vignetteColor.set(n.color.r,n.color.g,n.color.b)}}if(n.blendMode){switch(n.blendMode){case"multiply":this.special.vignette.blendMode=0;break;case"opaque":default:this.special.vignette.blendMode=1;break}s.imageProcessingConfiguration.vignetteBlendMode=this.special.vignette.blendMode}};h.prototype.updateColorGrading=function(e){console.warn(".updateColorGrading()",this.special.colorGrading);var t=this.babylon.scene,i=e.special.colorGrading,n,s,o=false,r;if(!i){if(this.special.colorGrading){this.special.colorGrading=null}t.imageProcessingConfiguration.colorGradingEnabled=false;if(t.imageProcessingConfiguration.colorGradingTexture){t.imageProcessingConfiguration.colorGradingTexture.dispose()}return}if(typeof i!=="object"){return}if(i.url&&typeof i.url==="string"){n=this.dom.cleanUrl(i.url)}if(!this.special.colorGrading){if(!n){return}this.special.colorGrading={url:n,level:typeof i.level==="number"?i.level:1};r=new BABYLON.Texture(this.special.colorGrading.url,t,true,false);r.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE;r.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;t.imageProcessingConfiguration.colorGradingEnabled=true;t.imageProcessingConfiguration.colorGradingTexture=r;t.imageProcessingConfiguration.colorGradingWithGreenDepth=false;s=0;o=true}else{if(n&&n!==this.special.colorGrading.url){this.special.colorGrading.url=n;r=new BABYLON.Texture(this.special.colorGrading.url,t,true,false);r.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE;r.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;t.imageProcessingConfiguration.colorGradingTexture=r}else{r=t.imageProcessingConfiguration.colorGradingTexture}if(typeof i.level==="number"){s=this.special.colorGrading.level;o=true;this.special.colorGrading.level=i.level}}if(o){console.warn("level",s,this.special.colorGrading.level,e.transition);if(e.transition){e.transition.createAnimation(t,r,"level",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.colorGrading.level,s)}else{r.level=this.special.colorGrading.level}}};h.prototype.updateLightExcludedMeshes=function(){var e,t=[...this.noLocalLightingGEntities].map(e=>e.babylon.mesh);for(e of this.localLightGEntities){e.babylon.light.excludedMeshes=t}};h.prototype.hasGEntity=function(e){return e in this.gEntities};h.prototype.getGEntity=function(e){return this.gEntities[e]};h.prototype.registerGEntity=function(e,t){if(this.gEntities[e]){throw new Error("Entity '"+e+"' already exists for this gScene")}this.gEntities[e]=t};h.prototype.unregisterGEntity=function(e){delete this.gEntities[e]};h.prototype.removeGEntity=function(e){var t=this.gEntities[e];if(!t){return false}t.destroy();return true};h.prototype.getUi=function(){if(this.babylon.ui){return this.babylon.ui}this.babylon.ui=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("ui");return this.babylon.ui};h.prototype.addMessage=function(e,t){var i=new n(this.dom,this,e,t);return i.run()};h.prototype.addChoices=function(e,t,i,n){console.warn("3DGWS .addChoices()",e,t,i,n);if(this.mainChoices){this.clearChoices()}this.mainChoices=new o(this.dom,this,e,t,i,n);this.mainChoices.run()};h.prototype.clearChoices=function(){console.warn("3DGWS .clearChoices()");if(this.mainChoices){this.mainChoices.destroy()}};h.prototype.textInput=function(){console.warn("3DGWS .textInput()");if(this.textInput){this.textInput.destroy()}};h.prototype.textInputDisabled=function(){console.warn("3DGWS .textInputDisabled()");if(this.textInput){this.textInput.destroy()}}},{"./Camera.js":1,"./GTransition.js":18,"./widgets/Choices.js":27,"./widgets/Message.js":28,"nextgen-events/lib/LeanEvents.js":37,seventh:49}],18:[function(e,t,i){"use strict";const u=e("seventh");const p=e("array-kit");function n(e){this.duration=.2;this.easing="linear";this.running=0;this.promise=null;if(e){this.update(e)}}t.exports=n;n.prototype.update=function(e){if(!e||typeof e!=="object"){return}if(e.duration!==undefined){this.duration=+e.duration||0}if(e.easing!==undefined){this.easing=e.easing||"linear"}return this};n.prototype.toString=function(e){return e+" "+this.duration+"s"+(" "+this.easing||"")};const f={circle:BABYLON.CircleEase,back:BABYLON.BackEase,bounce:BABYLON.BounceEase,cubic:BABYLON.CubicEase,elastic:BABYLON.ElasticEase,exponential:BABYLON.ExponentialEase,power:BABYLON.PowerEase,quadratic:BABYLON.QuadraticEase,quartic:BABYLON.QuarticEase,quintic:BABYLON.QuinticEase,sine:BABYLON.SineEase,bezier:BABYLON.BezierCurveEase};n.prototype.createAnimation=function(e,t,i,n,s,o=null){var r,a,l,h=30,c=Math.round(this.duration*h);a=new BABYLON.Animation("transition",i,h,n,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT,false);if(o===null){o=t[i];if(o&&typeof o==="object"&&o.clone){o=o.clone()}}l=[{frame:0,value:o},{frame:c,value:s}];a.setKeys(l);if(this.easing&&f[this.easing]){r=new f[this.easing];r.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT);a.setEasingFunction(r)}t.animations.push(a);if(!this.promise){this.promise=new u;this.promise.resolveTimeout(1e3*this.duration+20)}this.running++;e.beginAnimation(t,0,c,false,1,()=>{this.running--;e.removeAnimation(a);p.deleteValue(t.animations,a);if(this.running<=0){this.promise.resolve()}},undefined,false)};const d=[];d[BABYLON.Animation.ANIMATIONTYPE_COLOR3]=BABYLON.Animation.prototype.color3InterpolateFunction;d[BABYLON.Animation.ANIMATIONTYPE_COLOR4]=BABYLON.Animation.prototype.color4InterpolateFunction;d[BABYLON.Animation.ANIMATIONTYPE_FLOAT]=(e,t,i)=>e+i*(t-e);d[BABYLON.Animation.ANIMATIONTYPE_MATRIX]=BABYLON.Animation.prototype.matrixInterpolateFunction;d[BABYLON.Animation.ANIMATIONTYPE_QUATERNION]=BABYLON.Animation.prototype.quaternionInterpolateFunction;d[BABYLON.Animation.ANIMATIONTYPE_SIZE]=BABYLON.Animation.prototype.sizeInterpolateFunction;d[BABYLON.Animation.ANIMATIONTYPE_VECTOR2]=BABYLON.Animation.prototype.vector2InterpolateFunction;d[BABYLON.Animation.ANIMATIONTYPE_VECTOR3]=BABYLON.Animation.prototype.vector3InterpolateFunction;n.prototype.createAnimationFn=function(n,s,o,r,a,l=null){if(l===null){l=s[o];if(l&&typeof l==="object"&&l.clone){l=l.clone()}}var h=Date.now()/1e3;if(!this.promise){this.promise=new u;this.promise.resolveTimeout(1e3*this.duration+20)}this.running++;var c=e=>{var t,i=e-h;if(i>=this.duration){t=1;this.running--;n.animationFunctions.delete(c);if(this.running<=0){this.promise.resolve()}}else{t=i/this.duration}s[o]=d[r](l,a,t)};n.animationFunctions.add(c);return c}},{"array-kit":30,seventh:49}],19:[function(e,t,i){"use strict";const n=e("./browser-extension.js");const r=n.host.exports.op;const a=n.host.exports.xop;function s(e){this.var={};this.formula={};this.ctx={t:0,rt:0,tOffset:-Date.now()/1e3};this.computed={};this.stopAt=Infinity;this.cleanStop=false;this.update(e)}t.exports=s;function o(e){var t;for(t in e){delete e[t]}}s.prototype.update=function(e){if(e.reset){o(this.var);o(this.formula);o(this.ctx);o(this.computed);this.ctx.t=this.ctx.rt=0;this.ctx.tOffset=-Date.now()/1e3}else if(e.resetT){this.ctx.tOffset=-Date.now()/1e3}if(typeof e.stopAt==="number"){this.stopAt=e.stopAt}if(e.var){this.recursiveUpdate(this.var,e.var)}if(e.formula){this.recursiveUpdate(this.formula,e.formula,this.computed)}};s.prototype.recursiveUpdate=function(e,t,i){var n,s;for(n in t){s=t[n];if(s===null){delete e[n];if(i&&typeof i[n]==="object"){delete i[n]}}else if(typeof s==="boolean"||typeof s==="number"){e[n]=s}else if(typeof s==="string"){e[n]=new Function("op","xop","ctx","return ( "+s+" ) ;")}else if(typeof s==="object"){e[n]={};this.recursiveUpdate(e[n],s,i&&typeof i[n]==="object"?i[n]:null)}console.warn("########## k/v/V",n,s,e[n])}};s.prototype.compute=function(e,t){this.ctx.t=e+this.ctx.tOffset;if(this.ctx.t>this.stopAt){if(this.cleanStop){return null}this.ctx.t=this.stopAt;this.cleanStop=true}else if(this.ctx.t===this.stopAt){this.cleanStop=true}this.ctx.rt=this.ctx.t/this.stopAt;this.recursiveCompute(this.var,this.ctx);this.recursiveCompute(this.formula,this.computed,t);return this.computed};s.prototype.recursiveCompute=function(e,t,i){var n,s,o;for(n in e){s=e[n];o=i&&typeof i==="object"?i[n]:undefined;if(typeof s==="boolean"||typeof s==="number"){t[n]=s}else if(typeof s==="function"){this.ctx.base=o;t[n]=s(r,a,this.ctx)}else if(s&&typeof s==="object"){t[n]={};this.recursiveCompute(s,t[n],o)}}}},{"./browser-extension.js":20}],20:[function(e,t,i){"use strict";const n=e("exm/lib/BrowserExm.js");const s=e("path");const o=n.registerExtension({module:t,ns:"spellcast.web-client",id:"3dgws",exports:{},hooks:{init:async()=>{console.warn("Extension 3DGWS: starting init");await import(o.dirPath+"/babylonjs.js");await import(o.dirPath+"/babylonjs.gui.js");await import(o.dirPath+"/cannon.js");o.host.api.addEngine("3dgws",e("./engine.js"));console.warn("Extension 3DGWS fully loaded")}}});t.exports=o},{"./engine.js":21,"exm/lib/BrowserExm.js":36,path:39}],21:[function(e,t,i){"use strict";const n={};t.exports=n;n.GScene=e("./GScene.js");n.Camera=e("./Camera.js");n.GEntity=e("./GEntity.js");n.perUsageGEntity={hemisphericLight:e("./GEntityHemisphericLight.js"),directionalLight:e("./GEntityDirectionalLight.js"),pointLight:e("./GEntityPointLight.js"),spotLight:e("./GEntitySpotLight.js"),background:e("./GEntityBackground.js"),sprite:e("./GEntitySprite.js"),shadow:e("./GEntityShadow.js"),fx:e("./GEntityFx.js"),particleSystem:e("./GEntityParticleSystem.js"),floatingText:e("./GEntityFloatingText.js"),uiFloatingText:e("./GEntityUiFloatingText.js"),basicShape:e("./GEntityBasicShape.js"),ground:e("./GEntityGround.js")};n.DiceRoller=e("./DiceRoller.js")},{"./Camera.js":1,"./DiceRoller.js":2,"./GEntity.js":3,"./GEntityBackground.js":4,"./GEntityBasicShape.js":5,"./GEntityDirectionalLight.js":6,"./GEntityFloatingText.js":7,"./GEntityFx.js":8,"./GEntityGround.js":9,"./GEntityHemisphericLight.js":10,"./GEntityParticleSystem.js":11,"./GEntityPointLight.js":12,"./GEntityShadow.js":13,"./GEntitySpotLight.js":14,"./GEntitySprite.js":15,"./GEntityUiFloatingText.js":16,"./GScene.js":17}],22:[function(e,t,i){"use strict";i.getUpmostBoxMeshFace=e=>{var t=e.rotationQuaternion;var i=new BABYLON.Vector3(0,0,0);BABYLON.Vector3.Right().rotateByQuaternionToRef(t,i);if(i.y>=Math.SQRT1_2){return 2}else if(i.y<=-Math.SQRT1_2){return 3}BABYLON.Vector3.Up().rotateByQuaternionToRef(t,i);if(i.y>=Math.SQRT1_2){return 4}else if(i.y<=-Math.SQRT1_2){return 5}BABYLON.Vector3.Forward().rotateByQuaternionToRef(t,i);if(i.y>=Math.SQRT1_2){return 0}else if(i.y<=-Math.SQRT1_2){return 1}return 0}},{}],23:[function(e,t,i){"use strict";const n=e("./browser-extension.js");const s={};t.exports=s;s.getContrastColorCode=(e,t=.5)=>{var i=n.host.exports.toolkit.hexToRgb(e);if(i.r+i.g+i.b>=192){i.r=Math.round(i.r*t);i.g=Math.round(i.g*t);i.b=Math.round(i.b*t)}else{i.r=Math.round(255-(255-i.r)*t);i.g=Math.round(255-(255-i.g)*t);i.b=Math.round(255-(255-i.b)*t)}return n.host.exports.toolkit.rgbToHex(i)}},{"./browser-extension.js":20}],24:[function(e,t,i){"use strict";const l={};t.exports=l;const n=0,s=Math.PI/8,o=Math.PI/4,r=Math.PI/2,a=Math.PI*3/4,h=Math.PI,c=Math.PI*5/4,u=Math.PI*3/2,p=Math.PI*7/4,f=2*Math.PI;l.flatVectorsAngleRad=(e,t)=>l.normalizeAngleRad(Math.atan2(-t.x,t.z)-Math.atan2(-e.x,e.z));l.facingAngleRad=(e,t,i)=>l.normalizeAngleRad(i-Math.atan2(-(t.x-e.x),t.z-e.z));l.radToSector={};l.radToSector["ns"]=e=>e<=r||e>=u?"n":"s";l.radToSector["we"]=e=>e<=h?"w":"e";const d=["n","nw","w","sw","s","se","e","ne","n"];l.radToSector["8"]=e=>d[Math.floor((e+s)/o)];const y=["n","w","s","e","n"];l.radToSector["4"]=e=>y[Math.floor((e+o)/r)];const m=["nw","sw","se","ne"];l.radToSector["4-diag"]=e=>m[Math.floor(e/r)];l.xFlipSector={n:"n",ne:"nw",e:"w",se:"sw",s:"s",sw:"se",w:"e",nw:"ne"};l.cameraRotationFromOriginAndTarget=(e,t,i=0)=>{var n=t.x-e.x,s=t.y-e.y,o=t.z-e.z,r=Math.atan2(n,o),a=-l.epsilonAsin(s/Math.hypot(n,s,o));console.warn("[!] .rotationFromOriginAndTarget()",e,t,n,s,o,r);return new BABYLON.Vector3(a,r,i)};l.toCameraAlpha=e=>-l.PI_2-e;l.toCameraBeta=e=>l.PI_2-e;l.RAD_TO_DEG=180/Math.PI;l.DEG_TO_RAD=Math.PI/180;l.PI_2=Math.PI/2;l.normalizeAngleRad=e=>e>=n?e%f:f+e%f;var b=1e-10;var g=Math.round(1/b);l.setEpsilon=e=>{b=e;g=Math.round(1/e)};l.getEpsilon=()=>b;l.epsilonAcos=l.eacos=e=>{if(e>=-1&&e<=1){return Math.acos(e)}if(e>0){if(e<1+b){return 0}}else if(e>-1-b){return Math.PI}return NaN};l.epsilonAsin=l.easin=e=>{if(e>=-1&&e<=1){return Math.asin(e)}if(e>0){if(e<1+b){return Math.PI/2}}else if(e>-1-b){return Math.PI/2}return NaN}},{}],25:[function(e,t,i){"use strict";const n=e("../misc.js");const s=e("../browser-extension.js");const o=e("seventh");function r(e,t,i,n={},s=null){this.dom=e;this.gScene=t;this.parent=s??this.gScene;this.ninePatchImageUrl=null;this.containerRectStyle={};this.guiCreated=false;this.babylon={containerRect:null,boxImage:null}}t.exports=r;r.prototype.childrenWidthInPixelsRequired=false;r.prototype.childrenHeightInPixelsRequired=false;r.prototype.childrenMaxWidth=0;r.prototype.childrenMaxHeight=0;r.prototype.destroy=function(){if(this.babylon.containerRect){this.babylon.containerRect.dispose()}if(this.babylon.boxImage){this.babylon.boxImage.dispose()}};r.prototype.getUi=function(){return this.babylon.containerRect};r.prototype.run=function(){if(!this.guiCreated){this.createGUI()}this.destroy()};const u=r.THEME={default:{position:"center",panel:{width:.5,height:.2,opacity:1,backgroundColor:"green",borderColor:"orange",borderWidth:4,cornerRadius:20,padding:{left:"10px",top:"10px",right:"10px",bottom:"10px"}}}};r.prototype.createGUI=function(e,t=u.default){if(this.guiCreated){return}var i,n,s,o,r,a,l,h,c;o=e?.panel?.width??t?.panel?.width??.5;r=e?.panel?.height??t?.panel?.height??.2;console.warn(".childrenHeightInPixelsRequired:",this.parent.childrenHeightInPixelsRequired,r);if(this.parent.childrenHeightInPixelsRequired&&typeof r==="number"){r=r*this.parent.childrenMaxHeight+"px";console.warn("Set height to:",r)}i=this.babylon.containerRect=new BABYLON.GUI.Rectangle("containerRect");i.width=this.containerRectStyle.width=o;i.height=this.containerRectStyle.height=r;i.thickness=0;this.setControlAlignment(i,e?.position??t?.position);this.parent.getUi().addControl(i);console.warn("THEME: ",e,e?.panel?.ninePatchImage?.url??t?.panel?.ninePatchImage?.url);this.ninePatchImageUrl=e?.panel?.ninePatchImage?.url??t?.panel?.ninePatchImage?.url;if(this.ninePatchImageUrl){n=this.babylon.boxImage=new BABYLON.GUI.Image("boxImage",this.ninePatchImageUrl);n.stretch=BABYLON.GUI.Image.STRETCH_NINE_PATCH;n.sliceLeft=a=e?.panel?.ninePatchImage?.sliceLeft??t?.panel?.ninePatchImage?.sliceLeft??0;n.sliceTop=l=e?.panel?.ninePatchImage?.sliceTop??t?.panel?.ninePatchImage?.sliceTop??0;n.sliceRight=e?.panel?.ninePatchImage?.sliceRight??t?.panel?.ninePatchImage?.sliceRight??n.width;n.sliceBottom=e?.panel?.ninePatchImage?.sliceBottom??t?.panel?.ninePatchImage?.sliceBottom??n.height;h=a;c=l;i.addControl(n)}else{this.containerRectStyle.opacity=e?.panel?.opacity??t?.panel?.opacity;this.containerRectStyle.backgroundColor=e?.panel?.backgroundColor??t?.panel?.backgroundColor;this.containerRectStyle.borderColor=e?.panel?.borderColor??t?.panel?.borderColor;this.containerRectStyle.borderWidth=e?.panel?.borderWidth??t?.panel?.borderWidth;this.containerRectStyle.cornerRadius=e?.panel?.cornerRadius??t?.panel?.cornerRadius;this.applyRectangleStyle(i,this.containerRectStyle)}s=this.babylon.structuredTextBlock=new BABYLON.GUI.StructuredTextBlock("structuredTextBlock");s.paddingLeft=e?.panel?.padding?.left??a??t?.panel?.padding?.left??0;s.paddingTop=e?.panel?.padding?.top??l??t?.panel?.padding?.top??0;s.paddingRight=e?.panel?.padding?.right??h??t?.panel?.padding?.right??0;s.paddingBottom=e?.panel?.padding?.bottom??c??t?.panel?.padding?.bottom??0;console.warn("+++++++++++++++ PADDING:",s.paddingLeft,s.paddingTop,s.paddingRight,s.paddingBottom);s.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;s.fontSize=e?.text?.fontSize??t?.text?.fontSize??"14px";s.color=e?.text?.color??t?.text?.color;s.outlineWidth=e?.text?.outlineWidth??t?.text?.outlineWidth??0;s.outlineColor=e?.text?.outlineColor??t?.text?.outlineColor??null;s.structuredText=this.parseText(this.text);s.textWrapping=BABYLON.GUI.TextWrapping.WordWrap;i.addControl(s);this.babylon.containerRect.isPointerBlocker=true;this.guiCreated=true};r.prototype.setControlAlignment=function(e,t){switch(t){case"top":e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;break;case"bottom":e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;break;case"left":e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER;break;case"right":e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER;break;case"top-left":e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;break;case"top-right":e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;break;case"bottom-left":e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;break;case"bottom-right":e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;break;case"center":default:e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER;break}};r.prototype.applyRectangleStyle=function(e,t){console.warn("******** APPLY STYLE",t);if(t.width!==undefined){e.width=t.width}if(t.height!==undefined){e.height=t.height}if(t.opacity!==undefined){e.alpha=t.opacity}if(t.backgroundColor!==undefined){e.background=t.backgroundColor}if(t.borderColor!==undefined){e.color=t.borderColor}if(t.borderWidth!==undefined){e.thickness=t.borderWidth}if(t.cornerRadius!==undefined){e.cornerRadius=t.cornerRadius}}},{"../browser-extension.js":20,"../misc.js":23,seventh:49}],26:[function(e,t,i){"use strict";const o=e("./TextBox.js");const n=e("../browser-extension.js");const s=e("tree-kit/lib/extend.js").bind(null,{deep:true});const r=e("seventh");function a(e,t,i,n={},s=null){o.call(this,e,t,i,n,s);this.containerRectHoverStyle={};this.containerRectPressedDownStyle={};this.hoverNinePatchImageUrl=null;this.pressedDownNinePatchImageUrl=null;this.onPress=null}a.prototype=Object.create(o.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.run=function(e){if(!this.guiCreated){this.createGUI()}this.onPress=e};const l=a.THEME=s({},o.THEME,{default:{panel:{width:.25,height:.2,opacity:1,backgroundColor:"#496ad4",borderColor:"#ddd",borderWidth:2,cornerRadius:4,padding:{left:"10px",right:"10px",top:"4px",bottom:"4px"},hover:{opacity:1,backgroundColor:"#748dde",borderColor:"#eee",borderWidth:2},pressedDown:{size:.95,opacity:1,backgroundColor:"#748dde",borderColor:"#eee",borderWidth:2}},text:{color:"white"}}});function h(e,t){if(typeof e==="number"){return e*t}if(typeof e!=="string"){throw new TypeError("scaleSizeString: bad type: "+typeof e)}if(e.endsWith("px")){return Math.round(parseInt(e,10)*t)+"px"}return parseInt(e,10)*t}a.prototype.createGUI=function(e=this.dom.themeConfig?.button?.default,t=l.default){if(this.guiCreated){return}o.prototype.createGUI.call(this,e,t);if(t?.panel?.hover){s(this.containerRectHoverStyle,t.panel.hover)}if(e?.panel?.hover){s(this.containerRectHoverStyle,e.panel.hover)}if(t?.panel?.pressedDown){s(this.containerRectPressedDownStyle,t.panel.pressedDown)}if(e?.panel?.pressedDown){s(this.containerRectPressedDownStyle,e.panel.pressedDown)}if(this.containerRectHoverStyle.size){this.containerRectHoverStyle.width=h(this.containerRectStyle.width,this.containerRectHoverStyle.size);this.containerRectHoverStyle.height=h(this.containerRectStyle.height,this.containerRectHoverStyle.size)}if(this.containerRectPressedDownStyle.size){this.containerRectPressedDownStyle.width=h(this.containerRectStyle.width,this.containerRectPressedDownStyle.size);this.containerRectPressedDownStyle.height=h(this.containerRectStyle.height,this.containerRectPressedDownStyle.size)}this.babylon.containerRect.hoverCursor="pointer";this.babylon.containerRect.onPointerEnterObservable.add(()=>this.hover());this.babylon.containerRect.onPointerOutObservable.add(()=>this.initialState());this.babylon.containerRect.onPointerDownObservable.add(()=>this.pressDown());this.babylon.containerRect.onPointerUpObservable.add(()=>this.pressUp())};a.prototype.initialState=function(){console.warn("!!!!! ENTERING .initialState()");if(this.babylon.containerRect){this.applyRectangleStyle(this.babylon.containerRect,this.containerRectStyle)}};a.prototype.hover=function(){console.warn("!!!!! ENTERING .hover()");if(this.babylon.containerRect){this.applyRectangleStyle(this.babylon.containerRect,this.containerRectHoverStyle)}};a.prototype.pressDown=function(){if(this.babylon.containerRect){this.applyRectangleStyle(this.babylon.containerRect,this.containerRectPressedDownStyle)}};a.prototype.pressUp=function(){this.initialState();if(this.onPress){this.onPress()}}},{"../browser-extension.js":20,"./TextBox.js":29,seventh:49,"tree-kit/lib/extend.js":52}],27:[function(e,t,i){"use strict";const a=e("./Button.js");const n=e("../browser-extension.js");const s=e("tree-kit/lib/extend.js").bind(null,{deep:true});const o=e("seventh");function r(e,t,i,n,s,o={},r=null){this.dom=e;this.gScene=t;this.parent=r??this.gScene;this.choices=i;this.undecidedNames=n;this.onSelect=s;this.buttons=this.choices.map(e=>new a(this.dom,this.gScene,e.label,{},this));this.guiCreates=false;this.babylon={containerStack:null}}t.exports=r;r.prototype.destroy=function(){this.buttons.forEach(e=>e.destroy());if(this.babylon.containerStack){this.babylon.containerStack.dispose()}};r.prototype.getUi=function(){return this.babylon.containerStack};r.prototype.run=async function(){if(!this.guiCreated){this.createGUI()}var i=e=>{console.warn("Choice index:",e);this.onSelect(e)};this.buttons.forEach((e,t)=>{e.run(()=>i(t))})};const l=r.THEME=s({},a.THEME,{default:{group:{spacing:.01},panel:{width:.2,height:"38px"},text:{color:"black",fontSize:"22px",outlineWidth:2,outlineColor:"white"}}});r.prototype.createGUI=function(t=this.dom.themeConfig?.choices?.default,i=l.default){if(this.guiCreated){return}var e,n,s=this.parent.getUi(),o=s.getSize();e=this.babylon.containerStack=new BABYLON.GUI.StackPanel;n=t?.group?.spacing??i?.group?.spacing??0;e.isVertical=true;this.childrenWidthInPixelsRequired=false;this.childrenHeightInPixelsRequired=true;this.childrenMaxHeight=o.height;if(typeof n==="number"){n=Math.ceil(n*o.height)}e.spacing=n;s.addControl(e);this.buttons.forEach(e=>{e.createGUI(t,i)});this.guiCreated=true}},{"../browser-extension.js":20,"./Button.js":26,seventh:49,"tree-kit/lib/extend.js":52}],28:[function(e,t,i){"use strict";const o=e("./TextBox.js");const n=e("../browser-extension.js");const s=e("tree-kit/lib/extend.js").bind(null,{deep:true});const l=e("seventh");function r(e,t,i,n={},s=null){o.call(this,e,t,i,n,s);this.wait=n.wait||0;this.slowTyping=!!n.slowTyping;this.next=!!n.next;this.babylon.nextImage=null}r.prototype=Object.create(o.prototype);r.prototype.constructor=r;t.exports=r;r.prototype.destroy=function(){o.prototype.destroy.call(this);if(this.babylon.nextImage){this.babylon.nextImage.dispose()}};r.prototype.run=async function(){if(!this.guiCreated){this.createGUI()}if(this.slowTyping){await this.slowType()}if(this.next){await this.confirm()}if(this.wait){await l.resolveTimeout(this.wait*1e3)}this.destroy()};const a=r.THEME=s({},o.THEME,{default:{panel:{width:.5,height:.2,backgroundColor:"green",borderColor:"orange",borderWidth:4,cornerRadius:20,padding:{left:"10px",top:"10px",right:"10px",bottom:"10px"}},text:{color:"white"}}});r.prototype.createGUI=function(e=this.dom.themeConfig?.message?.default,t=a.default){if(this.guiCreated){return}o.prototype.createGUI.call(this,e,t);if(this.next){let e=this.babylon.nextImage=new BABYLON.GUI.Image("message-next","/icons/dialog-next.png");e.width="30px";e.height="15px";e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;e.isVisible=false;this.babylon.containerRect.addControl(e)}if(this.slowTyping){this.babylon.structuredTextBlock.characterLimit=0}};const h=.5;const c={" ":.3,",":1,":":1,";":1.5,".":2,"!":2,"?":2.5,"…":4,"\n":4};const u={normal:{base:30,special:180,increment:1},fast:{base:20,special:150,increment:1},faster:{base:20,special:80,increment:2}};r.prototype.slowType=async function(){var t,i,e=false,n="faster",s=u[n].base,o=u[n].special,r=u[n].increment,a=this.babylon.structuredTextBlock;this.babylon.containerRect.onPointerClickObservable.addOnce(()=>e=true);await l.resolveTimeout(s);for(t=1;t<=a.characterCount;t++){if(e){a.characterLimit=a.characterCount;return}i=this.getNthCharacter(t-1);if(c[i]!==undefined){a.characterLimit=t;let e=c[i];if(i===this.getNthCharacter(t)){e*=h}await l.resolveTimeout(o*e)}else if(t>=a.characterCount){a.characterLimit=Infinity;await l.resolveTimeout(s)}else if(t%r===0){a.characterLimit=t;await l.resolveTimeout(s)}}};r.prototype.confirm=function(){var e=new l;var t,i=this.dom.themeConfig?.message?.default,n=a.default,s=this.babylon.nextImage,o=Date.now();s.isVisible=true;s.topInPixels=t=s.topInPixels-Math.round((i?.panel?.padding?.top??n?.panel?.padding?.top??0)/2);s.leftInPixels=s.leftInPixels-(i?.panel?.padding?.left??n?.panel?.padding?.left??0);var r=setInterval(()=>{var e=(Date.now()-o)/1e3;s.topInPixels=t-Math.abs(Math.sin(3*e)*10)},20);this.babylon.containerRect.onPointerClickObservable.addOnce(()=>{clearInterval(r);e.resolve()});return e}},{"../browser-extension.js":20,"./TextBox.js":29,seventh:49,"tree-kit/lib/extend.js":52}],29:[function(e,t,i){"use strict";const o=e("./Box.js");const n=e("../misc.js");const s=e("../browser-extension.js");const r=e("tree-kit/lib/extend.js").bind(null,{deep:true});const a=e("seventh");function l(e,t,i,n={},s=null){o.call(this,e,t,n,s);this.text=i;this.babylon.structuredTextBlock=null}l.prototype=Object.create(o.prototype);l.prototype.constructor=l;t.exports=l;l.prototype.destroy=function(){o.prototype.destroy.call(this);if(this.babylon.structuredTextBlock){this.babylon.structuredTextBlock.dispose()}};l.prototype.run=function(){if(!this.guiCreated){this.createGUI()}this.destroy()};const u=l.THEME=r({},o.THEME,{default:{position:"center",panel:{width:.5,height:.2,opacity:1,backgroundColor:"green",borderColor:"orange",borderWidth:4,cornerRadius:20,padding:{left:"10px",top:"10px",right:"10px",bottom:"10px"}},text:{color:"white"}}});l.prototype.createGUI=function(e,t=u.default){if(this.guiCreated){return}var i,n,s,o,r,a,l,h,c;o=e?.panel?.width??t?.panel?.width??.5;r=e?.panel?.height??t?.panel?.height??.2;console.warn(".childrenHeightInPixelsRequired:",this.parent.childrenHeightInPixelsRequired,r);if(this.parent.childrenHeightInPixelsRequired&&typeof r==="number"){r=r*this.parent.childrenMaxHeight+"px";console.warn("Set height to:",r)}i=this.babylon.containerRect=new BABYLON.GUI.Rectangle("containerRect");i.width=this.containerRectStyle.width=o;i.height=this.containerRectStyle.height=r;i.thickness=0;this.setControlAlignment(i,e?.position??t?.position);this.parent.getUi().addControl(i);console.warn("THEME: ",e,e?.panel?.ninePatchImage?.url??t?.panel?.ninePatchImage?.url);this.ninePatchImageUrl=e?.panel?.ninePatchImage?.url??t?.panel?.ninePatchImage?.url;if(this.ninePatchImageUrl){n=this.babylon.boxImage=new BABYLON.GUI.Image("boxImage",this.ninePatchImageUrl);n.stretch=BABYLON.GUI.Image.STRETCH_NINE_PATCH;n.sliceLeft=a=e?.panel?.ninePatchImage?.sliceLeft??t?.panel?.ninePatchImage?.sliceLeft??0;n.sliceTop=l=e?.panel?.ninePatchImage?.sliceTop??t?.panel?.ninePatchImage?.sliceTop??0;n.sliceRight=e?.panel?.ninePatchImage?.sliceRight??t?.panel?.ninePatchImage?.sliceRight??n.width;n.sliceBottom=e?.panel?.ninePatchImage?.sliceBottom??t?.panel?.ninePatchImage?.sliceBottom??n.height;h=a;c=l;i.addControl(n)}else{this.containerRectStyle.opacity=e?.panel?.opacity??t?.panel?.opacity;this.containerRectStyle.backgroundColor=e?.panel?.backgroundColor??t?.panel?.backgroundColor;this.containerRectStyle.borderColor=e?.panel?.borderColor??t?.panel?.borderColor;this.containerRectStyle.borderWidth=e?.panel?.borderWidth??t?.panel?.borderWidth;this.containerRectStyle.cornerRadius=e?.panel?.cornerRadius??t?.panel?.cornerRadius;this.applyRectangleStyle(i,this.containerRectStyle)}s=this.babylon.structuredTextBlock=new BABYLON.GUI.StructuredTextBlock("structuredTextBlock");s.paddingLeft=e?.panel?.padding?.left??a??t?.panel?.padding?.left??0;s.paddingTop=e?.panel?.padding?.top??l??t?.panel?.padding?.top??0;s.paddingRight=e?.panel?.padding?.right??h??t?.panel?.padding?.right??0;s.paddingBottom=e?.panel?.padding?.bottom??c??t?.panel?.padding?.bottom??0;console.warn("+++++++++++++++ PADDING:",s.paddingLeft,s.paddingTop,s.paddingRight,s.paddingBottom);s.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;s.fontSize=e?.text?.fontSize??t?.text?.fontSize??"14px";s.color=e?.text?.color??t?.text?.color;s.outlineWidth=e?.text?.outlineWidth??t?.text?.outlineWidth??0;s.outlineColor=e?.text?.outlineColor??t?.text?.outlineColor??null;s.structuredText=this.parseText(this.text);s.textWrapping=BABYLON.GUI.TextWrapping.WordWrap;i.addControl(s);this.babylon.containerRect.isPointerBlocker=true;this.guiCreated=true};const h={black:"#000000",brightBlack:"#555753",red:"#cc0000",brightRed:"#ef2929",green:"#4e9a06",brightGreen:"#8ae234",yellow:"#c4a000",brightYellow:"#fce94f",blue:"#3465a4",brightBlue:"#729fcf",magenta:"#75507b",brightMagenta:"#ad7fa8",cyan:"#06989a",brightCyan:"#34e2e2",white:"#d3d7cf",brightWhite:"#eeeeec"};h.grey=h.gray=h.brightBlack;l.prototype.parseText=function(e){return s.host.exports.toolkit.parseMarkup(e).map(e=>{var t={text:e.text};if(e.color){t.color=e.color[0]==="#"?e.color:h[e.color]}if(e.italic){t.fontStyle="italic"}if(e.bold){t.fontWeight="bold"}if(e.underline){t.underline=true}if(e.strike){t.lineThrough=true}if(e.bgColor){t.frame=true;t.frameColor=e.bgColor;t.frameOutlineWidth=2;t.frameOutlineColor=n.getContrastColorCode(t.frameColor,.7);t.frameCornerRadius=5}return t})};l.prototype.getNthCharacter=function(e){var t,i,n=this.babylon.structuredTextBlock,s=n.lines,o=n.characterCount;if(e>o){return""}for(i of s){for(t of i.parts){if(e<t.text.length){return t.text[e]}e-=t.text.length}}return""}},{"../browser-extension.js":20,"../misc.js":23,"./Box.js":25,seventh:49,"tree-kit/lib/extend.js":52}],30:[function(e,t,i){"use strict";const n={range:e("./range.js"),sample:e("./sample.js"),inPlaceFilter:e("./inPlaceFilter.js"),delete:e("./delete.js"),deleteValue:e("./deleteValue.js")};t.exports=n;n.shuffle=e=>n.sample(e,e.length,true)},{"./delete.js":31,"./deleteValue.js":32,"./inPlaceFilter.js":33,"./range.js":34,"./sample.js":35}],31:[function(e,t,i){"use strict";t.exports=(e,t)=>{if(t>=e.length){return}var i=e.length-2;while(t<=i){e[t]=e[t+1];t++}e.length--}},{}],32:[function(e,t,i){"use strict";t.exports=(e,t)=>{var i,n,s=0,o=0;while(s<e.length){i=e[s];if(t!==i&&(t||!Number.isNaN(t)||!Number.isNaN(i))){e[o]=i;o++}s++}n=e.length-o;e.length=o;return n}},{}],33:[function(e,t,i){"use strict";t.exports=(e,t,i,n)=>{var s=arguments.length>=4,o,r=0,a=0;while(r<e.length){o=e[r];if(t.call(i,o,s?n:r,e)){e[a]=o;a++}r++}e.length=a;return e}},{}],34:[function(e,t,i){"use strict";t.exports=function(e,t,i){if(!arguments.length){return[]}if(arguments.length===1){t=e;e=0}if(!i){i=e<=t?1:-1}if(i>0&&e>=t||i<0&&e<=t){return[]}var n=0,s=e,o=[];if(i>0){for(;s<t;n++,s+=i){o[n]=s}}else{for(;s>t;n++,s+=i){o[n]=s}}return o}},{}],35:[function(e,t,i){"use strict";t.exports=(e,t=Infinity,i=false)=>{var n,s,o,r=i?e:[...e];t=Math.max(Math.min(t,e.length),0);for(n=0;n<t;n++){s=n+Math.floor((r.length-n)*Math.random());o=r[n];r[n]=r[s];r[s]=o}r.length=t;return r}},{}],36:[function(e,t,i){(function(o){(function(){"use strict";function i(e={}){if(!e.ns){throw new Error("EXM: namespace ('ns') is required!")}this.ns=e.ns;this.extensionPath=e.extensionPath||"/ext";this.suffix=e.suffix||"/extension.js";this.api=e.api||{};this.exports=e.exports||{};this.extensions=new Map}t.exports=i;i.prototype.__prototypeUID__="exm/browser/Exm";i.prototype.__prototypeVersion__="0.5";i.registerNs=function(e={}){if(!e.ns||typeof e.ns!=="string"){throw new Error("EXM: namespace ('ns' property) is required!")}if(o.EXM.ns[e.ns]){throw new Error("EXM: namespace '"+e.ns+"' is already registered!")}var t=new i(e);o.EXM.ns[e.ns]=t;return t};i.prototype.requireExtension=async function(i){if(this.extensions.has(i)){return this.extensions.get(i)}var e,t=this.ns+"."+i,n=this.extensionPath+"/"+t,s=n+this.suffix;try{console.warn("Trying EXM extension: ",s);e=await import(s)}catch(e){throw new Error("Required extension '"+i+"' not found.")}if(!e||typeof e!=="object"){throw new Error("EXM: this is not an EXM Extension (not an object)")}if(e.extension){e=e.extension}else{e=o.EXM.extensions[t];if(!e||typeof e!=="object"){throw new Error("EXM: this is not an EXM Extension (not an ES6 module extension and not registered)")}}if(e.__prototypeUID__!=="exm/Extension"&&e.__prototypeUID__!=="exm/browser/Extension"){throw new Error("EXM: this is not an EXM Extension (no prototype UID found)")}if(e.id!==i){throw new Error("EXM: Extension ID mismatch (wanted '"+i+"' but got "+e.id+"'.")}try{await e.init(this,s,n);console.log("Extension '"+e.id+"'"+(e.version?" (v"+e.version+") ":"")+"is loaded.")}catch(e){let t=new Error("EXM: Failed to init extension '"+i+"': "+e);t.from=e;throw e}this.extensions.set(i,e);return e};i.Extension=function(e={}){this.isInit=false;this.id=e.id;this.ns=e.ns;this.uid=e.ns+"."+e.id;this.version=e.version||null;this.host=null;this.path=null;this.dirPath=null;this.fromModule=e.module;this.hooks=e.hooks||{};this.api=e.api||{};this.exports=e.exports||{}};i.Extension.prototype.__prototypeUID__="exm/browser/Extension";i.Extension.prototype.__prototypeVersion__=i.prototype.__prototypeVersion__;i.registerExtension=i.Extension.register=function(e={}){if(!e.id||typeof e.id!=="string"){throw new Error("EXM Extension: ID ('id' property) is required!")}if(!e.ns||typeof e.ns!=="string"){throw new Error("EXM Extension: namespace ('ns' property) is required!")}var t=new i.Extension(e);if(o.EXM.extensions[t.uid]){throw new Error("EXM Extension: ID '"+t.id+"' is already registered for namespace '"+t.ns+"'!")}o.EXM.extensions[t.uid]=t;return t};i.Extension.prototype.init=async function(e,t,i){if(this.isInit){return}if(e.ns!==this.ns){throw new Error("EXM Extension's namespace mismatches the Host!")}if(t){this.path=t}if(i){this.dirPath=i}this.host=e;if(typeof this.hooks.init==="function"){await this.hooks.init()}this.isInit=true};if(!o.EXM){o.EXM={master:null,ns:{},extensions:{}}}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],37:[function(e,t,i){"use strict";function n(){}t.exports=n;n.prototype.__prototypeUID__="nextgen-events/LeanEvents";n.prototype.__prototypeVersion__=e("../package.json").version;n.prototype.on=n.prototype.addListener=function(e,t,i,n){if(!this.__listeners){this.__listeners={}}if(!this.__listeners[e]){this.__listeners[e]=[]}var s=this.__states&&this.__states[e];if(s&&n){t(...s);return}var o={id:i??t,fn:t,once:!!n};var r=this.__listeners[e];r[r.length]=o;if(s){t(...s)}};n.prototype.once=function(e,t,i){return this.addListener(e,t,i,true)};n.prototype.waitFor=function(e){return new Promise(t=>{this.addListener(e,e=>t(e),undefined,true)})};n.prototype.waitForAll=function(e){return new Promise(t=>{this.addListener(e,(...e)=>t(e),undefined,true)})};n.prototype.off=n.prototype.removeListener=function(e,t){if(!this.__listeners||!this.__listeners[e]||!this.__listeners[e].length){return}this.__listeners[e]=this.__listeners[e].filter(e=>e.id!==t);return this};n.prototype.removeAllListeners=function(e){if(!this.__listeners){return}if(e){delete this.__listeners[e]}else{this.__listeners={}}return this};n.prototype.emit=function(e,...t){var i,n,s,o,r,a;if(this.__states&&(r=this.__states[e])!==undefined){if(r&&t.length===r.length&&(!t.length||t.every((e,t)=>e===r[t]))){return}a=this.__stateGroups[e];for(i=0,n=a.length;i<n;i++){this.__states[a[i]]=null}this.__states[e]=t}if(!this.__listeners){return}s=this.__listeners[e];if(!s||!s.length){return}for(i=0,n=s.length;i<n;i++){o=s[i];if(o.once){this.removeListener(e,o.id)}o.fn(...t)}return this};n.prototype.listeners=function(e){if(!this.__listeners||!this.__listeners[e]){return[]}return this.__listeners[e].slice()};n.prototype.listenerCount=function(e){if(!this.__listeners||!this.__listeners[e]){return 0}return this.__listeners[e].length};n.prototype.defineStates=function(...t){if(!this.__states){this.__states={};this.__stateGroups={}}t.forEach(e=>{this.__states[e]=null;this.__stateGroups[e]=t})};n.prototype.hasState=function(e){if(!this.__states){return false}return!!this.__states[e]};n.prototype.getAllStates=function(){if(!this.__states){return[]}return Object.keys(this.__states).filter(e=>this.__states[e])}},{"../package.json":38}],38:[function(e,t,i){t.exports={name:"nextgen-events",version:"1.5.2",description:"The next generation of events handling for javascript! New: abstract away the network!",main:"lib/NextGenEvents.js",engines:{node:">=6.0.0"},directories:{test:"test",bench:"bench"},dependencies:{},devDependencies:{browserify:"^17.0.0","uglify-js-es6":"^2.8.9",ws:"^7.4.6"},scripts:{test:"tea-time -R dot"},repository:{type:"git",url:"https://github.com/cronvel/nextgen-events.git"},keywords:["events","async","emit","listener","context","series","serialize","namespace","proxy","network"],author:"Cédric Ronvel",license:"MIT",bugs:{url:"https://github.com/cronvel/nextgen-events/issues"},config:{"tea-time":{coverDir:["lib"]}},copyright:{title:"Next-Gen Events",years:[2015,2021],owner:"Cédric Ronvel"}}},{}],39:[function(e,t,i){(function(a){(function(){"use strict";function y(e){if(typeof e!=="string"){throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}}function r(e,t){var i="";var n=0;var s=-1;var o=0;var r;for(var a=0;a<=e.length;++a){if(a<e.length)r=e.charCodeAt(a);else if(r===47)break;else r=47;if(r===47){if(s===a-1||o===1){}else if(s!==a-1&&o===2){if(i.length<2||n!==2||i.charCodeAt(i.length-1)!==46||i.charCodeAt(i.length-2)!==46){if(i.length>2){var l=i.lastIndexOf("/");if(l!==i.length-1){if(l===-1){i="";n=0}else{i=i.slice(0,l);n=i.length-1-i.lastIndexOf("/")}s=a;o=0;continue}}else if(i.length===2||i.length===1){i="";n=0;s=a;o=0;continue}}if(t){if(i.length>0)i+="/..";else i="..";n=2}}else{if(i.length>0)i+="/"+e.slice(s+1,a);else i=e.slice(s+1,a);n=a-s-1}s=a;o=0}else if(r===46&&o!==-1){++o}else{o=-1}}return i}function i(e,t){var i=t.dir||t.root;var n=t.base||(t.name||"")+(t.ext||"");if(!i){return n}if(i===t.root){return i+n}return i+e+n}var m={resolve:function e(){var t="";var i=false;var n;for(var s=arguments.length-1;s>=-1&&!i;s--){var o;if(s>=0)o=arguments[s];else{if(n===undefined)n=a.cwd();o=n}y(o);if(o.length===0){continue}t=o+"/"+t;i=o.charCodeAt(0)===47}t=r(t,!i);if(i){if(t.length>0)return"/"+t;else return"/"}else if(t.length>0){return t}else{return"."}},normalize:function e(t){y(t);if(t.length===0)return".";var i=t.charCodeAt(0)===47;var n=t.charCodeAt(t.length-1)===47;t=r(t,!i);if(t.length===0&&!i)t=".";if(t.length>0&&n)t+="/";if(i)return"/"+t;return t},isAbsolute:function e(t){y(t);return t.length>0&&t.charCodeAt(0)===47},join:function e(){if(arguments.length===0)return".";var t;for(var i=0;i<arguments.length;++i){var n=arguments[i];y(n);if(n.length>0){if(t===undefined)t=n;else t+="/"+n}}if(t===undefined)return".";return m.normalize(t)},relative:function e(t,i){y(t);y(i);if(t===i)return"";t=m.resolve(t);i=m.resolve(i);if(t===i)return"";var n=1;for(;n<t.length;++n){if(t.charCodeAt(n)!==47)break}var s=t.length;var o=s-n;var r=1;for(;r<i.length;++r){if(i.charCodeAt(r)!==47)break}var a=i.length;var l=a-r;var h=o<l?o:l;var c=-1;var u=0;for(;u<=h;++u){if(u===h){if(l>h){if(i.charCodeAt(r+u)===47){return i.slice(r+u+1)}else if(u===0){return i.slice(r+u)}}else if(o>h){if(t.charCodeAt(n+u)===47){c=u}else if(u===0){c=0}}break}var p=t.charCodeAt(n+u);var f=i.charCodeAt(r+u);if(p!==f)break;else if(p===47)c=u}var d="";for(u=n+c+1;u<=s;++u){if(u===s||t.charCodeAt(u)===47){if(d.length===0)d+="..";else d+="/.."}}if(d.length>0)return d+i.slice(r+c);else{r+=c;if(i.charCodeAt(r)===47)++r;return i.slice(r)}},_makeLong:function e(t){return t},dirname:function e(t){y(t);if(t.length===0)return".";var i=t.charCodeAt(0);var n=i===47;var s=-1;var o=true;for(var r=t.length-1;r>=1;--r){i=t.charCodeAt(r);if(i===47){if(!o){s=r;break}}else{o=false}}if(s===-1)return n?"/":".";if(n&&s===1)return"//";return t.slice(0,s)},basename:function e(t,i){if(i!==undefined&&typeof i!=="string")throw new TypeError('"ext" argument must be a string');y(t);var n=0;var s=-1;var o=true;var r;if(i!==undefined&&i.length>0&&i.length<=t.length){if(i.length===t.length&&i===t)return"";var a=i.length-1;var l=-1;for(r=t.length-1;r>=0;--r){var h=t.charCodeAt(r);if(h===47){if(!o){n=r+1;break}}else{if(l===-1){o=false;l=r+1}if(a>=0){if(h===i.charCodeAt(a)){if(--a===-1){s=r}}else{a=-1;s=l}}}}if(n===s)s=l;else if(s===-1)s=t.length;return t.slice(n,s)}else{for(r=t.length-1;r>=0;--r){if(t.charCodeAt(r)===47){if(!o){n=r+1;break}}else if(s===-1){o=false;s=r+1}}if(s===-1)return"";return t.slice(n,s)}},extname:function e(t){y(t);var i=-1;var n=0;var s=-1;var o=true;var r=0;for(var a=t.length-1;a>=0;--a){var l=t.charCodeAt(a);if(l===47){if(!o){n=a+1;break}continue}if(s===-1){o=false;s=a+1}if(l===46){if(i===-1)i=a;else if(r!==1)r=1}else if(i!==-1){r=-1}}if(i===-1||s===-1||r===0||r===1&&i===s-1&&i===n+1){return""}return t.slice(i,s)},format:function e(t){if(t===null||typeof t!=="object"){throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof t)}return i("/",t)},parse:function e(t){y(t);var i={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return i;var n=t.charCodeAt(0);var s=n===47;var o;if(s){i.root="/";o=1}else{o=0}var r=-1;var a=0;var l=-1;var h=true;var c=t.length-1;var u=0;for(;c>=o;--c){n=t.charCodeAt(c);if(n===47){if(!h){a=c+1;break}continue}if(l===-1){h=false;l=c+1}if(n===46){if(r===-1)r=c;else if(u!==1)u=1}else if(r!==-1){u=-1}}if(r===-1||l===-1||u===0||u===1&&r===l-1&&r===a+1){if(l!==-1){if(a===0&&s)i.base=i.name=t.slice(1,l);else i.base=i.name=t.slice(a,l)}}else{if(a===0&&s){i.name=t.slice(1,r);i.base=t.slice(1,l)}else{i.name=t.slice(a,r);i.base=t.slice(a,l)}i.ext=t.slice(r,l)}if(a>0)i.dir=t.slice(0,a-1);else if(s)i.dir="/";return i},sep:"/",delimiter:":",win32:null,posix:null};m.posix=m;t.exports=m}).call(this)}).call(this,e("_process"))},{_process:40}],40:[function(e,t,i){var n=t.exports={};var s;var o;function r(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){s=setTimeout}else{s=r}}catch(e){s=r}try{if(typeof clearTimeout==="function"){o=clearTimeout}else{o=a}}catch(e){o=a}})();function l(t){if(s===setTimeout){return setTimeout(t,0)}if((s===r||!s)&&setTimeout){s=setTimeout;return setTimeout(t,0)}try{return s(t,0)}catch(e){try{return s.call(null,t,0)}catch(e){return s.call(this,t,0)}}}function h(t){if(o===clearTimeout){return clearTimeout(t)}if((o===a||!o)&&clearTimeout){o=clearTimeout;return clearTimeout(t)}try{return o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}var c=[];var u=false;var p;var f=-1;function d(){if(!u||!p){return}u=false;if(p.length){c=p.concat(c)}else{f=-1}if(c.length){y()}}function y(){if(u){return}var e=l(d);u=true;var t=c.length;while(t){p=c;c=[];while(++f<t){if(p){p[f].run()}}f=-1;t=c.length}p=null;u=false;h(e)}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){t[i-1]=arguments[i]}}c.push(new m(e,t));if(c.length===1&&!u){l(y)}};function m(e,t){this.fun=e;this.array=t}m.prototype.run=function(){this.fun.apply(null,this.array)};n.title="browser";n.browser=true;n.env={};n.argv=[];n.version="";n.versions={};function b(){}n.on=b;n.addListener=b;n.once=b;n.off=b;n.removeListener=b;n.removeAllListeners=b;n.emit=b;n.prependListener=b;n.prependOnceListener=b;n.listeners=function(e){return[]};n.binding=function(e){throw new Error("process.binding is not supported")};n.cwd=function(){return"/"};n.chdir=function(e){throw new Error("process.chdir is not supported")};n.umask=function(){return 0}},{}],41:[function(e,t,i){(function(g,e){(function(){(function(i,n){"use strict";if(i.setImmediate){return}var s=1;var o={};var r=false;var a=i.document;var l;function e(e){if(typeof e!=="function"){e=new Function(""+e)}var t=new Array(arguments.length-1);for(var i=0;i<t.length;i++){t[i]=arguments[i+1]}var n={callback:e,args:t};o[s]=n;l(s);return s++}function h(e){delete o[e]}function c(e){var t=e.callback;var i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i);break}}function u(e){if(r){setTimeout(u,0,e)}else{var t=o[e];if(t){r=true;try{c(t)}finally{h(e);r=false}}}}function t(){l=function(e){g.nextTick(function(){u(e)})}}function p(){if(i.postMessage&&!i.importScripts){var e=true;var t=i.onmessage;i.onmessage=function(){e=false};i.postMessage("","*");i.onmessage=t;return e}}function f(){var t="setImmediate$"+Math.random()+"$";var e=function(e){if(e.source===i&&typeof e.data==="string"&&e.data.indexOf(t)===0){u(+e.data.slice(t.length))}};if(i.addEventListener){i.addEventListener("message",e,false)}else{i.attachEvent("onmessage",e)}l=function(e){i.postMessage(t+e,"*")}}function d(){var t=new MessageChannel;t.port1.onmessage=function(e){var t=e.data;u(t)};l=function(e){t.port2.postMessage(e)}}function y(){var i=a.documentElement;l=function(e){var t=a.createElement("script");t.onreadystatechange=function(){u(e);t.onreadystatechange=null;i.removeChild(t);t=null};i.appendChild(t)}}function m(){l=function(e){setTimeout(u,0,e)}}var b=Object.getPrototypeOf&&Object.getPrototypeOf(i);b=b&&b.setTimeout?b:i;if({}.toString.call(i.process)==="[object process]"){t()}else if(p()){f()}else if(i.MessageChannel){d()}else if(a&&"onreadystatechange"in a.createElement("script")){y()}else{m()}b.setImmediate=e;b.clearImmediate=h})(typeof self==="undefined"?typeof e==="undefined"?this:e:self)}).call(this)}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:40}],42:[function(e,t,i){"use strict";const s=e("./seventh.js");function n(e,t=4){this.jobRunner=e;this.jobs=new Map;this.pendingJobs=new Map;this.runningJobs=new Map;this.errorJobs=new Map;this.jobsDone=new Map;this.concurrency=+t||1;this.isQueueRunning=true;this.isLoopRunning=false;this.canLoopAgain=false;this.ready=s.resolved;this.startTime=null;this.endTime=null;this.drained=s.resolved;this.idle=s.resolved}s.Queue=n;function o(e,t=null,i=undefined){this.id=e;this.dependencies=t===null?null:[...t];this.data=i===undefined?e:i;this.error=null;this.startTime=null;this.endTime=null}n.Job=o;n.prototype.setConcurrency=function(e){this.concurrency=+e||1};n.prototype.stop=n.prototype.pause=function(){this.isQueueRunning=false};n.prototype.has=function(e){return this.jobs.has(e)};n.prototype.add=n.prototype.addJob=function(e,t,i=null){if(this.jobs.has(e)){return false}var n=new o(e,i,t);this.jobs.set(e,n);this.pendingJobs.set(e,n);this.canLoopAgain=true;if(this.isQueueRunning&&!this.isLoopRunning){this.run()}if(this.drained.isSettled()){this.drained=new s}return n};n.prototype.addBatch=n.prototype.addJobBatch=function(e){var t,i;for(t of e){if(this.jobs.has(t)){return false}i=new o(t);this.jobs.set(t,i);this.pendingJobs.set(t,i)}this.canLoopAgain=true;if(this.isQueueRunning&&!this.isLoopRunning){this.run()}if(this.drained.isSettled()){this.drained=new s}};n.prototype.run=n.prototype.resume=async function(){var e;this.isQueueRunning=true;if(this.isLoopRunning){return}this.isLoopRunning=true;if(!this.startTime){this.startTime=Date.now()}do{this.canLoopAgain=false;for(e of this.pendingJobs.values()){if(e.dependencies&&e.dependencies.some(e=>!this.jobsDone.has(e))){continue}if(this.idle.isSettled()){this.idle=new s}this.canLoopAgain=true;await this.ready;if(!this.isQueueRunning){this.finishRun();return}this.runJob(e)}}while(this.canLoopAgain);this.finishRun()};n.prototype.finishRun=function(){this.isLoopRunning=false;if(!this.pendingJobs.size){this.drained.resolve()}if(!this.runningJobs.size){this.endTime=Date.now();this.idle.resolve()}};n.prototype.runJob=async function(t){this.pendingJobs.delete(t.id);this.runningJobs.set(t.id,t);if(this.runningJobs.size>=this.concurrency){this.ready=new s}try{t.startTime=Date.now();await this.jobRunner(t.data);t.endTime=Date.now();this.jobsDone.set(t.id,t);this.canLoopAgain=true}catch(e){t.endTime=Date.now();t.error=e;this.errorJobs.set(t.id,t)}this.runningJobs.delete(t.id);if(this.runningJobs.size<this.concurrency){this.ready.resolve()}if(!this.isLoopRunning){if(this.isQueueRunning&&this.pendingJobs.size){this.run()}else{this.finishRun()}}};n.prototype.getJobTimes=function(){var e,t={};for(e of this.jobsDone.values()){t[e.id]=e.endTime-e.startTime}return t};n.prototype.getStats=function(){var e,t=0,i={pending:this.pendingJobs.size,running:this.runningJobs.size,failed:this.errorJobs.size,done:this.jobsDone.size,averageJobTime:null,queueTime:null};if(this.jobsDone.size){for(e of this.jobsDone.values()){t+=e.endTime-e.startTime}i.averageJobTime=t/this.jobsDone.size}if(this.endTime){i.queueTime=this.endTime-this.startTime}return i}},{"./seventh.js":49}],43:[function(e,t,i){"use strict";const r=e("./seventh.js");r.promisifyNodeApi=(n,s,o,e,t)=>{var i;s=s||"Async";o=o||"AsyncAll";e=e||(e=>e[0]!=="_"&&!e.endsWith("Sync"));if(t){i=[];for(let e in n){if(typeof n[e]==="function"){i.push(e)}}}else{i=Object.keys(n)}i.filter(t=>{if(typeof n[t]!=="function"){return false}for(let e in n[t].prototype){return false}return e(t,n)}).forEach(e=>{const t=e+s;const i=e+o;if(!n[t]){n[t]=r.promisify(n[e],n)}if(!n[i]){n[i]=r.promisifyAll(n[e],n)}})};r.promisifyAnyNodeApi=(e,t,i,n)=>{r.promisifyNodeApi(e,t,i,n,true)}},{"./seventh.js":49}],44:[function(e,t,i){"use strict";const d=e("./seventh.js");const c={};function u(){}d.all=e=>{var i=-1,n=false,s=0,o=Infinity,r,a=[],l=new d;for(r of e){if(n){break}i++;(()=>{const t=i;d.resolve(r).then(e=>{if(n){return}a[t]=e;s++;if(s>=o){n=true;l._resolveValue(a)}},e=>{if(n){return}n=true;l.reject(e)})})()}o=i+1;if(!o){l._resolveValue(a)}return l};d._allArray=e=>{var t=e.length;if(!t){d._resolveValue([])}var i,n={settled:false,count:0,length:t,values:[],allPromise:new d};for(i=0;!n.settled&&i<t;i++){d._allArrayOne(e[i],i,n)}return n.allPromise};d._allArrayOne=(e,t,i)=>{d._bareThen(e,e=>{if(i.settled){return}i.values[t]=e;i.count++;if(i.count>=i.length){i.settled=true;i.allPromise._resolveValue(i.values)}},e=>{if(i.settled){return}i.settled=true;i.allPromise.reject(e)})};d.every=d.map=(e,i)=>{var n=-1,s=false,o=0,r=Infinity,a,l=[],h=new d;for(a of e){if(s){break}n++;(()=>{const t=n;d.resolve(a).then(e=>{if(s){return}return i(e,t)}).then(e=>{if(s){return}l[t]=e;o++;if(o>=r){s=true;h._resolveValue(l)}},e=>{if(s){return}s=true;h.reject(e)})})()}r=n+1;if(!r){h._resolveValue(l)}return h};d.any=e=>{var i=-1,n=false,s=0,o=Infinity,r,a=[],l=new d;for(r of e){if(n){break}i++;(()=>{const t=i;d.resolve(r).then(e=>{if(n){return}n=true;l._resolveValue(e)},e=>{if(n){return}a[t]=e;s++;if(s>=o){n=true;l.reject(a)}})})()}o=i+1;if(!o){l.reject(new RangeError("Promise.any(): empty array"))}return l};d.some=(e,i)=>{var n=-1,s=false,o=0,r=Infinity,a,l=[],h=new d;for(a of e){if(s){break}n++;(()=>{const t=n;d.resolve(a).then(e=>{if(s){return}return i(e,t)}).then(e=>{if(s){return}s=true;h._resolveValue(e)},e=>{if(s){return}l[t]=e;o++;if(o>=r){s=true;h.reject(l)}})})()}r=n+1;if(!r){h.reject(new RangeError("Promise.any(): empty array"))}return h};d.filter=(e,i)=>{var n=-1,s=false,o=0,r=Infinity,a,l=[],h=new d;for(a of e){if(s){break}n++;(()=>{const t=n;d.resolve(a).then(e=>{if(s){return}l[t]=e;return i(e,t)}).then(e=>{if(s){return}o++;if(!e){l[t]=c}if(o>=r){s=true;l=l.filter(e=>e!==c);h._resolveValue(l)}},e=>{if(s){return}s=true;h.reject(e)})})()}r=n+1;if(!r){h._resolveValue(l)}else if(o>=r){s=true;l=l.filter(e=>e!==c);h._resolveValue(l)}return h};d.foreach=d.forEach=function(e,n,t){var s=-1,o=arguments.length>=3,r=e[Symbol.iterator](),a=new d,l=d.resolve(t);if(d.warnUnhandledRejection){d._handleAll(e)}var h=()=>{l.then(t=>{let{value:e,done:i}=r.next();s++;if(i){a.resolve(t)}else{l=d.resolve(e).then(o?e=>n(t,e,s):e=>n(e,s));h()}},e=>{a.reject(e);for(;;){let{value:e,done:t}=r.next();if(t){break}if(d.isThenable(e)){e.then(u,u)}}})};h();return a};d.reduce=(e,t,i)=>{return d.forEach(e,t,i)};d.mapObject=(e,i)=>{var n=false,s=0,t,o,r=Object.keys(e),a=r.length,l,h={},c=new d;for(t=0;!n&&t<a;t++){o=r[t];l=e[o];(()=>{const t=o;d.resolve(l).then(e=>{if(n){return}return i(e,t)}).then(e=>{if(n){return}h[t]=e;s++;if(s>=a){n=true;c._resolveValue(h)}},e=>{if(n){return}n=true;c.reject(e)})})()}if(!a){c._resolveValue(h)}return c};d.concurrent=(i,e,n)=>{var s=-1,o=false,r=0,a=0,l=Infinity,h,t=false,c=[],u=e[Symbol.iterator](),p=new d;if(d.warnUnhandledRejection){d._handleAll(e)}i=+i||1;const f=()=>{while(!t&&r<i){({value:h,done:t}=u.next());if(t){l=s+1;if(a>=l){o=true;p._resolveValue(c);return}break}if(o){break}s++;(()=>{const t=s;r++;d.resolve(h).then(e=>{if(o){return}return n(e,t)}).then(e=>{if(o){return}c[t]=e;a++;r--;if(a>=l){o=true;p._resolveValue(c);return}if(r<i){f();return}},e=>{if(o){return}o=true;p.reject(e)})})()}};f();if(s<0){p._resolveValue(c)}return p};d.race=e=>{var t=false,i,n=new d;for(i of e){if(t){break}d.resolve(i).then(e=>{if(t){return}t=true;n._resolveValue(e)},e=>{if(t){return}t=true;n.reject(e)})}return n}},{"./seventh.js":49}],45:[function(r,a,e){(function(t,i,o){(function(){"use strict";const e=i.Promise;var n;if(!t.browser){n=t.nextTick}else{r("setimmediate");n=o}function s(e){this.fn=e;this._then=s._dormantThen;this.value=null;this.thenHandlers=null;this.handledRejection=null;if(this.fn){this._exec()}}a.exports=s;s.Native=e;s.warnUnhandledRejection=true;s.prototype._exec=function(){this._then=s._pendingThen;try{this.fn(e=>{this.resolve(e)},e=>{this.reject(e)})}catch(e){this.reject(e)}};s.prototype.resolve=s.prototype.fulfill=function(e){if(this._then.settled){return this}if(s.isThenable(e)){this._execThenPromise(e);return this}return this._resolveValue(e)};s.prototype._resolveValue=function(e){this._then=s._fulfilledThen;this.value=e;if(this.thenHandlers&&this.thenHandlers.length){this._execFulfillHandlers()}return this};s.prototype._execThenPromise=function(e){try{e.then(e=>{this.resolve(e)},e=>{this.reject(e)})}catch(e){this.reject(e)}};s.prototype.reject=function(e){if(this._then.settled){return this}this._then=s._rejectedThen;this.value=e;if(this.thenHandlers&&this.thenHandlers.length){this._execRejectionHandlers()}else if(s.warnUnhandledRejection&&!this.handledRejection){this._unhandledRejection()}return this};s.prototype._execFulfillHandlers=function(){var e,t=this.thenHandlers.length;for(e=0;e<t;e+=3){if(this.thenHandlers[e+1]){this._execOneFulfillHandler(this.thenHandlers[e],this.thenHandlers[e+1])}else{this.thenHandlers[e].resolve(this.value)}}};s.prototype._execOneFulfillHandler=function(t,e){try{t.resolve(e(this.value))}catch(e){t.reject(e)}};s.prototype._execRejectionHandlers=function(){var e,t=this.thenHandlers.length;for(e=0;e<t;e+=3){if(this.thenHandlers[e+2]){this._execOneRejectHandler(this.thenHandlers[e],this.thenHandlers[e+2])}else{this.thenHandlers[e].reject(this.value)}}};s.prototype._execOneRejectHandler=function(t,e){try{t.resolve(e(this.value))}catch(e){t.reject(e)}};s.prototype.resolveTimeout=s.prototype.fulfillTimeout=function(e,t){setTimeout(()=>this.resolve(t),e)};s.prototype.rejectTimeout=function(e,t){setTimeout(()=>this.reject(t),e)};s._dormantThen=function(e,t){if(this.fn){this._exec();return this._then(e,t)}var i=new s;if(!this.thenHandlers){this.thenHandlers=[i,e,t]}else{this.thenHandlers[this.thenHandlers.length]=i;this.thenHandlers[this.thenHandlers.length]=e;this.thenHandlers[this.thenHandlers.length]=t}return i};s._dormantThen.settled=false;s._pendingThen=function(e,t){var i=new s;if(!this.thenHandlers){this.thenHandlers=[i,e,t]}else{this.thenHandlers[this.thenHandlers.length]=i;this.thenHandlers[this.thenHandlers.length]=e;this.thenHandlers[this.thenHandlers.length]=t}return i};s._pendingThen.settled=false;s._fulfilledThen=function(e){if(!e){return this}var t=new s;n(()=>{try{t.resolve(e(this.value))}catch(e){t.reject(e)}});return t};s._fulfilledThen.settled=true;s._rejectedThen=function(e,t){if(!t){return this}this.handledRejection=true;var i=new s;n(()=>{try{i.resolve(t(this.value))}catch(e){i.reject(e)}});return i};s._rejectedThen.settled=true;s.prototype.then=function(e,t){return this._then(e,t)};s.prototype.catch=function(e=()=>undefined){return this._then(undefined,e)};s.prototype.finally=function(e){return this._then(e,e)};s.prototype.tap=s.prototype.tapThen=function(e){this._then(e,undefined);return this};s.prototype.tapCatch=function(e){this._then(undefined,e);return this};s.prototype.tapFinally=function(e){this._then(e,e);return this};s.prototype.fatal=function(){this._then(undefined,e=>{n(()=>{throw e})})};s.prototype.done=function(e,t){this._then(e,t).fatal();return this};s.prototype.callback=function(t){this._then(e=>{t(undefined,e)},e=>{t(e)}).fatal();return this};s.prototype.callbackAll=function(t){this._then(e=>{if(Array.isArray(e)){t(undefined,...e)}else{t(undefined,e)}},e=>{t(e)}).fatal();return this};s.callback=function(e){return new s((i,n)=>{e((e,t)=>{if(e){n(e)}else{i(t)}})})};s.callbackAll=function(e){return new s((i,n)=>{e((e,...t)=>{if(e){n(e)}else{i(t)}})})};s.prototype.toPromise=s.prototype.propagate=function(t){this._then(e=>{t.resolve(e)},e=>{t.reject(e)});return this};s.propagate=function(e,t){e.then(e=>{t.resolve(e)},e=>{t.reject(e)});return e};s.finally=function(e,t){return e.then(t,t)};s.resolve=s.fulfill=function(e){if(s.isThenable(e)){return s.fromThenable(e)}return s._resolveValue(e)};s._resolveValue=function(e){var t=new s;t._then=s._fulfilledThen;t.value=e;return t};s.reject=function(e){var t=new s;t._then=s._rejectedThen;t.value=e;return t};s.resolveTimeout=s.fulfillTimeout=function(t,i){return new s(e=>setTimeout(()=>e(i),t))};s.rejectTimeout=function(i,n){return new s((e,t)=>setTimeout(()=>t(n),i))};s.resolveNextTick=s.fulfillNextTick=function(t){return new s(e=>n(()=>e(t)))};s.rejectNextTick=function(i){return new s((e,t)=>n(()=>t(i)))};s.dormant=function(e){var t=new s;t.fn=e;return t};s.try=function(e){try{return s.resolve(e())}catch(e){return s.reject(e)}};s.isThenable=function(e){return e&&typeof e==="object"&&typeof e.then==="function"};s.fromThenable=function(e){if(e instanceof s){return e}return new s((t,i)=>{e.then(e=>{t(e)},e=>{i(e)})})};s._bareThen=function(e,t,i){if(e&&typeof e==="object"){if(e instanceof s){if(e._then===s._fulfilledThen){t(e.value)}else if(e._then===s._rejectedThen){i(e.value)}else{e._then(t,i)}}else if(typeof e.then==="function"){e.then(t,i)}else{t(e)}}else{t(e)}};s._handleAll=function(e){var t;for(t of e){if(s.isThenable(t)){t.handledRejection=true}}};s.prototype._unhandledRejection=function(){this.handledRejection=false;const t=e=>setTimeout(e,0);if(this.value instanceof Error){t(()=>{if(this.handledRejection===false){this.value.message="Unhandled promise rejection: "+this.value.message;console.error(this.value)}})}else{let e=new Error("Unhandled promise rejection");t(()=>{if(this.handledRejection===false){console.error(e);console.error("Rejection reason:",this.value)}})}};s.prototype.isSettled=function(){return this._then.settled};s.prototype.getStatus=function(){switch(this._then){case s._dormantThen:return"dormant";case s._pendingThen:return"pending";case s._fulfilledThen:return"fulfilled";case s._rejectedThen:return"rejected"}};s.prototype.inspect=function(){switch(this._then){case s._dormantThen:return"Promise { <DORMANT> }";case s._pendingThen:return"Promise { <PENDING> }";case s._fulfilledThen:return"Promise { <FULFILLED> "+this.value+" }";case s._rejectedThen:return"Promise { <REJECTED> "+this.value+" }"}};s.resolved=s.dummy=s.resolve();if(t.browser){s.prototype.resolveAtAnimationFrame=function(e){window.requestAnimationFrame(()=>this.resolve(e))};s.prototype.rejectAtAnimationFrame=function(e){window.requestAnimationFrame(()=>this.reject(e))};s.resolveAtAnimationFrame=function(t){return new s(e=>window.requestAnimationFrame(()=>e(t)))};s.rejectAtAnimationFrame=function(i){return new s((e,t)=>window.requestAnimationFrame(()=>t(i)))}}}).call(this)}).call(this,r("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},r("timers").setImmediate)},{_process:40,setimmediate:41,timers:51}],46:[function(e,t,i){"use strict";const h=e("./seventh.js");h.promisifyAll=(t,s)=>{if(s){return(...e)=>{return new h((i,n)=>{t.call(s,...e,(e,...t)=>{if(e){if(t.length&&e instanceof Error){e.args=t}n(e)}else{i(t)}})})}}return function(...e){return new h((i,n)=>{t.call(this,...e,(e,...t)=>{if(e){if(t.length&&e instanceof Error){e.args=t}n(e)}else{i(t)}})})}};h.promisify=(t,s)=>{if(s){return(...e)=>{return new h((i,n)=>{t.call(s,...e,(e,t)=>{if(e){if(t!==undefined&&e instanceof Error){e.arg=t}n(e)}else{i(t)}})})}}return function(...e){return new h((i,n)=>{t.call(this,...e,(e,t)=>{if(e){if(t!==undefined&&e instanceof Error){e.arg=t}n(e)}else{i(t)}})})}};h.returnValueInterceptor=(i,n,s)=>{return function(...e){var t=n.call(s||this,...e);i(t);return t}};h.once=(t,i)=>{var n=false;var s;return function(...e){if(!n){n=true;s=t.call(i||this,...e)}return s}};h.serialize=(i,n)=>{var s=new h.resolve;return function(...e){var t=new h;s.finally(()=>{h.propagate(i.call(n||this,...e),t)});s=t;return t}};h.debounce=(t,i)=>{var n=null;const s=()=>{n=null};return function(...e){if(n){return n}n=t.call(i||this,...e);h.finally(n,s);return n}};h.debounceDelay=(e,t,i)=>{var n=null;const s=()=>{setTimeout(()=>n=null,e)};return function(...e){if(n){return n}n=t.call(i||this,...e);h.finally(n,s);return n}};h.debounceUpdate=(i,n)=>{var s=null;var o=null;var r=null;const a=()=>{var e,t;s=null;if(o){e=o;o=null;t=r;r=null;s=i.call(...e);h.propagate(s,t);h.finally(s,a);return s}};return function(...e){var t=n||this;if(s){if(!r){r=new h}o=[t,...e];return r}s=i.call(t,...e);h.finally(s,a);return s}};h.NO_DELAY={};h.BATCH_NO_DELAY={};h.debounceSync=(o,r)=>{var i=new Map;const a=e=>{var t=i.get(e);if(!t){t={inProgress:null,inProgressIsFull:null,last:null,lastTime:null,lastFullSync:null,lastFullSyncTime:null,nextFullSyncPromise:null,nextFullSyncWith:null,noDelayBatches:new Set};i.set(e,t)}return t};const l=(e,t)=>{var i,n,s,o=new Date;e.inProgress=null;if(t>=2){e.lastFullSyncTime=e.lastTime=o}else if(t>=1){e.lastTime=o}if(e.nextFullSyncWith){if(r.delay&&e.lastFullSyncTime&&(i=o-e.lastFullSyncTime-r.delay)<0){e.inProgress=h.resolveTimeout(-i+1);e.inProgress.finally(()=>l(e,0));return e.nextFullSyncPromise}n=e.nextFullSyncWith;e.nextFullSyncWith=null;s=e.nextFullSyncPromise;e.nextFullSyncPromise=null;e.lastFullSync=e.last=e.inProgress=r.fn.call(...n);h.propagate(e.inProgress,s);h.finally(e.inProgress,()=>l(e,2));return e.inProgress}};const e=function(e,...t){var i=false,n=o.thisBinding||this,s=a(e);if(t[0]===h.NO_DELAY){i=true;t.shift()}else if(t[0]===h.BATCH_NO_DELAY){t.shift();let e=t.shift();if(!s.noDelayBatches.has(e)){s.noDelayBatches.add(e);i=true}}if(s.inProgress){return s.inProgress}if(!i&&o.delay&&s.lastTime&&new Date-s.lastTime<o.delay){if(typeof o.onDebounce==="function"){o.onDebounce(e,...t)}return s.last}s.last=s.inProgress=o.fn.call(n,e,...t);s.inProgressIsFull=false;h.finally(s.inProgress,()=>l(s,1));return s.inProgress};const t=function(e,...t){var i,n=false,s=r.thisBinding||this,o=a(e);if(t[0]===h.NO_DELAY){n=true;t.shift()}else if(t[0]===h.BATCH_NO_DELAY){t.shift();let e=t.shift();if(!o.noDelayBatches.has(e)){o.noDelayBatches.add(e);n=true}}if(!o.inProgress&&!n&&r.delay&&o.lastFullSyncTime&&(i=new Date-o.lastFullSyncTime-r.delay)<0){o.inProgress=h.resolveTimeout(-i+1);h.finally(o.inProgress,()=>l(o,0))}if(o.inProgress){if(!o.nextFullSyncPromise){o.nextFullSyncPromise=new h}o.nextFullSyncWith=[s,e,...t];return o.nextFullSyncPromise}o.lastFullSync=o.last=o.inProgress=r.fn.call(s,e,...t);h.finally(o.inProgress,()=>l(o,2));return o.inProgress};return[e,t]};h.timeout=(i,n,s)=>{return function(...e){var t=n.call(s||this,...e);setTimeout(()=>t.reject(new Error("Timeout")),i);return t}};h.variableTimeout=(n,s)=>{return function(e,...t){var i=n.call(s||this,...t);setTimeout(()=>i.reject(new Error("Timeout")),e);return i}}},{"./seventh.js":49}],47:[function(e,t,i){(function(r){(function(){"use strict";const s=e("./seventh.js");var o=false;s.asyncExit=function(i,n){if(o){return}o=true;var e=r.listeners("asyncExit");if(!e.length){r.exit(i);return}if(n===undefined){n=1e3}const t=t=>{if(t.length<3){t(i,n);return s.dummy}return new s(e=>{t(i,n,()=>{e()})})};s.map(e,t).finally(()=>r.exit(i));setTimeout(()=>r.exit(i),n)};s.resolveSafeTimeout=function(t,i){return new s(e=>{setTimeout(()=>{setTimeout(()=>{setTimeout(()=>{setTimeout(()=>e(i),0)},t/2)},t/2)},0)})}}).call(this)}).call(this,e("_process"))},{"./seventh.js":49,_process:40}],48:[function(e,t,i){"use strict";const n=e("./seventh.js");n.parasite=()=>{var e=["tap","tapCatch","finally","fatal","done","callback","callbackAll"];e.forEach(e=>n.Native.prototype[e]=n.prototype[e]);n.Native.prototype._then=n.Native.prototype.then}},{"./seventh.js":49}],49:[function(e,t,i){"use strict";const n=e("./core.js");t.exports=n;e("./batch.js");e("./wrapper.js");e("./decorators.js");e("./Queue.js");e("./api.js");e("./parasite.js");e("./misc.js")},{"./Queue.js":42,"./api.js":43,"./batch.js":44,"./core.js":45,"./decorators.js":46,"./misc.js":47,"./parasite.js":48,"./wrapper.js":50}],50:[function(e,t,i){"use strict";const h=e("./seventh.js");h.timeLimit=(i,n)=>{return new h((e,t)=>{if(typeof n==="function"){n=n()}h.resolve(n).then(e,t);setTimeout(()=>t(new Error("Timeout")),i)})};h.retry=(e,t)=>{var i=e.retries||1,n=e.coolDown||0,s=e.raiseFactor||1,o=e.maxCoolDown||Infinity,r=e.timeout||0,a=e.catch||null;const l=()=>{return(r?h.timeLimit(r,t):t()).catch(e=>{if(!i--){throw e}var t=n;n=Math.min(n*s,o);if(a){return h.resolve(a(e)).then(()=>h.resolveTimeout(t).then(l))}return h.resolveTimeout(t).then(l)})};return l()};h.onceEvent=(t,i)=>{return new h(e=>t.once(i,e))};h.onceEventAll=(e,i)=>{return new h(t=>e.once(i,(...e)=>t(e)))};h.onceEventOrError=(a,l,e,i=false)=>{return new h((t,n)=>{var s;var o=(...e)=>{a.removeListener("error",r);if(s){for(let e in s){a.removeListener(e,s[e])}}t(i?e:e[0])};var r=e=>{a.removeListener(l,o);if(s){for(let e in s){a.removeListener(e,s[e])}}n(e)};a.once(l,o);a.once("error",r);if(e){if(!Array.isArray(e)){e=[e]}s={};e.forEach(i=>{var e=(...e)=>{a.removeListener("error",r);a.removeListener(l,o);var t=new Error("Received an excluded event: "+i);t.event=i;t.eventArgs=e;n(t)};a.once(i,e);s[i]=e})}})};h.onceEventAllOrError=(e,t,i)=>{return h.onceEventOrError(e,t,i,true)}},{"./seventh.js":49}],51:[function(l,e,h){(function(n,a){(function(){var e=l("process/browser.js").nextTick;var t=Function.prototype.apply;var s=Array.prototype.slice;var o={};var r=0;h.setTimeout=function(){return new i(t.call(setTimeout,window,arguments),clearTimeout)};h.setInterval=function(){return new i(t.call(setInterval,window,arguments),clearInterval)};h.clearTimeout=h.clearInterval=function(e){e.close()};function i(e,t){this._id=e;this._clearFn=t}i.prototype.unref=i.prototype.ref=function(){};i.prototype.close=function(){this._clearFn.call(window,this._id)};h.enroll=function(e,t){clearTimeout(e._idleTimeoutId);e._idleTimeout=t};h.unenroll=function(e){clearTimeout(e._idleTimeoutId);e._idleTimeout=-1};h._unrefActive=h.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;if(e>=0){t._idleTimeoutId=setTimeout(function e(){if(t._onTimeout)t._onTimeout()},e)}};h.setImmediate=typeof n==="function"?n:function(t){var i=r++;var n=arguments.length<2?false:s.call(arguments,1);o[i]=true;e(function e(){if(o[i]){if(n){t.apply(null,n)}else{t.call(null)}h.clearImmediate(i)}});return i};h.clearImmediate=typeof a==="function"?a:function(e){delete o[e]}}).call(this)}).call(this,l("timers").setImmediate,l("timers").clearImmediate)},{"process/browser.js":40,timers:51}],52:[function(e,t,i){"use strict";function n(e,t,...i){var n,s,o=false,r=i.length;if(!r){return t}if(!e||typeof e!=="object"){e={}}var a={depth:0,prefix:""};if(e.deep){if(Array.isArray(e.deep)){e.deep=new Set(e.deep)}else if(!(e.deep instanceof Set)){e.deep=true}}if(e.immutables){if(Array.isArray(e.immutables)){e.immutables=new Set(e.immutables)}else if(!(e.immutables instanceof Set)){delete e.immutables}}if(!e.maxDepth&&e.deep&&!e.circular){e.maxDepth=100}if(e.deepFunc){e.deep=true}if(e.flat){e.deep=true;e.proto=false;e.inherit=false;e.unflat=false;if(typeof e.flat!=="string"){e.flat="."}}if(e.unflat){e.deep=false;e.proto=false;e.inherit=false;e.flat=false;if(typeof e.unflat!=="string"){e.unflat="."}}if(e.inherit){e.own=true;e.proto=false}else if(e.proto){e.own=true}if(!t||typeof t!=="object"&&typeof t!=="function"){o=true}if(!e.skipRoot&&(e.inherit||e.proto)){for(n=r-1;n>=0;n--){s=i[n];if(s&&(typeof s==="object"||typeof s==="function")){if(e.inherit){if(o){t=Object.create(s)}else{Object.setPrototypeOf(t,s)}}else if(e.proto){if(o){t=Object.create(Object.getPrototypeOf(s))}else{Object.setPrototypeOf(t,Object.getPrototypeOf(s))}}break}}}else if(o){t={}}a.references={sources:[],targets:[]};for(n=0;n<r;n++){s=i[n];if(!s||typeof s!=="object"&&typeof s!=="function"){continue}x(a,e,t,s,e.mask<=n+1)}return t}t.exports=n;function x(e,t,i,n,s){var o,r,a,l,h,c,u,p,f,d,y,m,b,g=-1;if(t.maxDepth&&e.depth>t.maxDepth){throw new Error("[tree] extend(): max depth reached("+t.maxDepth+")")}if(t.circular){e.references.sources.push(n);e.references.targets.push(i)}if(t.own){if(t.nonEnum){l=Object.getOwnPropertyNames(n)}else{l=Object.keys(n)}}else{l=n}for(h in l){if(t.own){h=l[h]}if(h==="__proto__"){continue}if(t.descriptor){f=Object.getOwnPropertyDescriptor(n,h);c=f.value}else{c=n[h]}y=i;d=e.prefix+h;if(t.nofunc&&typeof c==="function"){continue}if(t.unflat&&e.depth===0){a=h.split(t.unflat);r=a.length-1;if(r){for(o=0;o<r;o++){if(!y[a[o]]||typeof y[a[o]]!=="object"&&typeof y[a[o]]!=="function"){y[a[o]]={}}y=y[a[o]]}d=e.prefix+a[r]}}m=y[d];b=m&&(typeof m==="object"||typeof m==="function");u=c&&(typeof c==="object"||typeof c==="function");if(t.deep&&c&&(typeof c==="object"||t.deepFunc&&typeof c==="function")&&(!t.descriptor||!f.get)&&((p=Object.getPrototypeOf(c))||true)&&(!(t.deep instanceof Set)||t.deep.has(p))&&(!t.immutables||!t.immutables.has(p))&&(!t.preserve||b)&&(!s||b)){if(t.circular){g=e.references.sources.indexOf(c)}if(t.flat){if(g>=0){continue}x({depth:e.depth+1,prefix:e.prefix+h+t.flat,references:e.references},t,y,c,s)}else{if(g>=0){m=e.references.targets[g];if(t.descriptor){Object.defineProperty(y,d,{value:m,enumerable:f.enumerable,writable:f.writable,configurable:f.configurable})}else{y[d]=m}continue}if(!b||!Object.prototype.hasOwnProperty.call(y,d)){if(Array.isArray(c)){m=[]}else if(t.proto){m=Object.create(p)}else if(t.inherit){m=Object.create(c)}else{m={}}if(t.descriptor){Object.defineProperty(y,d,{value:m,enumerable:f.enumerable,writable:f.writable,configurable:f.configurable})}else{y[d]=m}}else if(t.proto&&Object.getPrototypeOf(m)!==p){Object.setPrototypeOf(m,p)}else if(t.inherit&&Object.getPrototypeOf(m)!==c){Object.setPrototypeOf(m,c)}if(t.circular){e.references.sources.push(c);e.references.targets.push(m)}x({depth:e.depth+1,prefix:"",references:e.references},t,m,c,s)}}else if(s&&(m===undefined||b||u)){continue}else if(t.preserve&&m!==undefined){continue}else if(!t.inherit){if(t.descriptor){Object.defineProperty(y,d,f)}else{y[d]=m=c}}if(t.move){delete n[h]}}}},{}]},{},[20]);