(function(){function h(r,o,a){function l(i,e){if(!o[i]){if(!r[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(c)return c(i,!0);var n=new Error("Cannot find module '"+i+"'");throw n.code="MODULE_NOT_FOUND",n}var s=o[i]={exports:{}};r[i][0].call(s.exports,function(e){var t=r[i][1][e];return l(t||e)},s,s.exports,h,r,o,a)}return o[i].exports}for(var c="function"==typeof require&&require,e=0;e<a.length;e++)l(a[e]);return l}return h})()({1:[function(e,t,i){"use strict";const s=e("./GTransition.js");const a=e("./vectorUtils.js");const r=e("seventh");function n(e){this.gScene=e;this.mode=null;this.position={x:0,y:0,z:10};this.target={x:0,y:0,z:0};this.rotation={x:0,y:0,z:0,w:1};this.yaw=0;this.pitch=0;this.roll=0;this.distance=10;this.fov=Math.PI/4;this.perspective=1;this.free=false;this.trackingMode=null;this.babylon={type:null,camera:null};this.setMode("firstPerson")}t.exports=n;n.prototype.update=function(e,t=false){console.warn("3D Camera.update()",e);var i=this.babylon.camera,n=this.gScene.babylon.scene;if(e.mode){this.setMode(e.mode)}if(e.transition){e.transition=new s(e.transition)}if(e.free!==undefined){if(this.updateFree(e.free)){if(!e.position){e.position=this.position}if(!e.rotation){e.rotation=this.rotation}if(!e.target){e.target=this.target}if(e.yaw===undefined){e.yaw=this.yaw}if(e.pitch===undefined){e.pitch=this.pitch}if(e.roll===undefined){e.roll=this.roll}if(e.distance===undefined){e.distance=this.distance}}}switch(this.mode){case"positions":if(e.position||e.target||e.roll!==undefined){this.updateFirstPerson(e,false,true)}break;case"firstPerson":if(e.position||e.yaw!==undefined||e.pitch!==undefined||e.roll!==undefined){this.updateFirstPerson(e)}break;case"firstPersonQuaternion":if(e.position||e.rotation){this.updateFirstPerson(e,true)}break;case"orbital":if(e.target||e.yaw!==undefined||e.pitch!==undefined||e.roll!==undefined||e.distance!==undefined){this.updateOrbital(e)}break}if(e.fov!==undefined){this.fov=e.fov||Math.PI/4;if(e.transition){e.transition.createAnimation(n,i,"fov",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.fov/2)}else{i.fov=this.fov/2}}if(e.trackingMode!==undefined){this.trackingMode=e.trackingMode||null}return t&&e.transition&&e.transition.promise||r.resolved};n.prototype.setMode=function(e){var t,i;console.warn("##### Camera.setMode()",e,this.mode);if(e===this.mode){return}this.mode=e;switch(this.mode){case"positions":case"firstPerson":case"firstPersonQuaternion":if(this.babylon.type==="FreeCamera"){this.babylon.camera.position=new BABYLON.Vector3(this.position.x,this.position.y,this.position.z)}else{this.babylon.type="FreeCamera";if(this.babylon.camera){this.babylon.camera.dispose()}this.babylon.camera=new BABYLON.FreeCamera("Camera",new BABYLON.Vector3(this.position.x,this.position.y,this.position.z),this.gScene.babylon.scene);this.babylon.camera.onViewMatrixChangedObservable.add(()=>{this.gScene.changes.camera=true})}if(this.mode==="positions"){this.babylon.camera.rotationQuaternion=BABYLON.Quaternion.FromEulerVector(a.cameraRotationFromOriginAndTarget(this.position,this.target,this.roll))}else if(this.mode==="firstPersonQuaternion"){this.babylon.camera.rotationQuaternion=new BABYLON.Quaternion(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w)}else{this.babylon.camera.rotationQuaternion=BABYLON.Quaternion.FromEulerAngles(this.pitch,this.yaw,this.roll)}break;case"orbital":t=a.toCameraAlpha(this.yaw);i=a.toCameraBeta(this.pitch);if(this.babylon.type==="ArcRotateCamera"){this.babylon.camera.target=new BABYLON.Vector3(this.target.x,this.target.y,this.target.z);this.babylon.camera.alpha=t;this.babylon.camera.beta=i;this.babylon.camera.radius=this.distance}else{this.babylon.type="ArcRotateCamera";if(this.babylon.camera){this.babylon.camera.dispose()}this.babylon.camera=new BABYLON.ArcRotateCamera("Camera",t,i,this.distance,new BABYLON.Vector3(this.target.x,this.target.y,this.target.z),this.gScene.babylon.scene);this.babylon.camera.onViewMatrixChangedObservable.add(()=>{this.gScene.changes.camera=true})}break;default:return}this.babylon.camera.wheelPrecision=100;console.warn("~~~~~~ Camera.setMode() done")};n.prototype.updateFree=function(e){e=!!e;if(e===this.free){return}this.free=e;if(!this.free){this.babylon.camera.detachControl();return true}this.babylon.camera.attachControl();return false};n.prototype.updateFirstPerson=function(e,t,i){var n,s,r=this.babylon.camera,o=this.gScene.babylon.scene;if(e.position){this.position=e.position}if(e.target){this.target=e.target}if(e.rotation){this.rotation=e.rotation}if(e.yaw!==undefined){this.yaw=e.yaw}if(e.pitch!==undefined){this.pitch=e.pitch}if(e.roll!==undefined){this.roll=e.roll}if(i){s=BABYLON.Quaternion.FromEulerVector(a.cameraRotationFromOriginAndTarget(this.position,this.target,this.roll))}else if(t){if(e.rotation){s=new BABYLON.Quaternion(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w)}}else if(e.yaw!==undefined||e.pitch!==undefined||e.roll!==undefined){s=BABYLON.Quaternion.FromEulerAngles(this.pitch,this.yaw,this.roll)}if(e.transition){n=r.rotationQuaternion?r.rotationQuaternion:BABYLON.Quaternion.FromEulerVector(r.rotation);console.warn("[!] camera transition:",r,n,s);if(e.position){e.transition.createAnimation(o,r,"position",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(this.position.x,this.position.y,this.position.z))}if(s){e.transition.createAnimation(o,r,"rotationQuaternion",BABYLON.Animation.ANIMATIONTYPE_QUATERNION,s,n)}}else{console.warn("[!] camera direct:",r,s);if(e.position){r.position=new BABYLON.Vector3(this.position.x,this.position.y,this.position.z)}if(s){r.rotationQuaternion=s}}};n.prototype.updateOrbital=function(e){var t,i,n=this.babylon.camera,s=this.gScene.babylon.scene;if(e.target){this.target=e.target}if(e.yaw){this.yaw=e.yaw;t=a.toCameraAlpha(this.yaw)}if(e.pitch){this.pitch=e.pitch;i=a.toCameraBeta(this.pitch)}if(e.distance){this.distance=e.distance}if(e.transition){console.warn("[!] camera transition:",n);if(e.target){e.transition.createAnimation(s,n,"target",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(this.target.x,this.target.y,this.target.z))}if(e.yaw){e.transition.createAnimation(s,n,"alpha",BABYLON.Animation.ANIMATIONTYPE_FLOAT,t)}if(e.pitch){e.transition.createAnimation(s,n,"beta",BABYLON.Animation.ANIMATIONTYPE_FLOAT,i)}if(e.distance){e.transition.createAnimation(s,n,"radius",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.distance)}}else{console.warn("[!] camera direct:",n);if(e.target){n.target=new BABYLON.Vector3(this.target.x,this.target.y,this.target.z)}if(e.yaw){n.alpha=t}if(e.pitch){n.beta=i}if(e.distance){n.radius=this.distance}}}},{"./GTransition.js":20,"./vectorUtils.js":26,seventh:51}],2:[function(e,t,i){"use strict";const h=e("seventh");const n=e("./meshUtils.js");function s(e,t){this.gScene=e;this.dieCount=t.dice;this.faceValues=t.values;this.dieDiffuseUrl=t.skinUrl||null;this.dieSize=.2;this.dieFaceReindex=[0,5,1,4,2,3];this.diceRollTimeLimit=3e3;this.maxPowerDuration=1e3;this.minThrowingPower=5;this.maxThrowingPower=20;this.arrowLength=.4;this.physicsTimeStep=10;this.gravity=20;this.friction=.9;this.restitution=.6;this.cameraHeight=3.8;this.wallVisibility=false;this.wallSize=3;this.wallThickness=.5;this.stillnessVelocitySumLimit=.01;this.destroyed=false;this.babylon={scene:null,physicsEngine:null,camera:null,light:null,diceMaterial:null,arrowMaterial:null,dice:[],arrow:null,ui:null}}t.exports=s;s.prototype.destroy=function(){if(this.destroyed){return}this.babylon.dice.forEach(e=>e.dispose());this.babylon.dice.length=0;if(this.babylon.arrow){this.babylon.arrow.dispose();this.babylon.arrow=null}if(this.babylon.diceMaterial){this.babylon.diceMaterial.dispose();this.babylon.diceMaterial=null}if(this.babylon.arrowMaterial){this.babylon.arrowMaterial.dispose();this.babylon.arrowMaterial=null}if(this.babylon.physicsEngine){this.babylon.physicsEngine.dispose();this.babylon.physicsEngine=null}if(this.babylon.light){this.babylon.light.dispose();this.babylon.light=null}if(this.babylon.ui){this.babylon.ui.dispose();this.babylon.ui=null}if(this.babylon.camera){this.babylon.camera.dispose();this.babylon.camera=null}if(this.babylon.scene){this.babylon.scene.dispose();this.babylon.scene=this.gScene.babylon.diceRollerScene=null}this.destroyed=true};s.prototype.init=function(){if(this.gScene.babylon.diceRollerScene){throw new Error("DiceRoller: there is already a diceRollerScene for these GScene")}var e=this.gScene.babylon.engine,s=this.babylon.scene=this.gScene.babylon.diceRollerScene=new BABYLON.Scene(e),t=e.getRenderWidth()/e.getRenderHeight();s.autoClear=false;s.enablePhysics(new BABYLON.Vector3(0,-this.gravity,0),new BABYLON.CannonJSPlugin);this.babylon.physicsEngine=s.getPhysicsEngine();this.babylon.physicsEngine.setSubTimeStep(this.physicsTimeStep);var i,n=0,r=0;i=this.babylon.camera=new BABYLON.ArcRotateCamera("camera",-Math.PI/2,0,this.cameraHeight,new BABYLON.Vector3(n,0,r),s);i.wheelPrecision=1e3;i.minZ=.05;this.babylon.light=new BABYLON.HemisphericLight("light",new BABYLON.Vector3(-.3,1,-.3),s);this.babylon.light.intensity=.7;var o=this.babylon.diceMaterial=new BABYLON.StandardMaterial("diceMaterial",s);o.diffuseTexture=new BABYLON.Texture(this.dieDiffuseUrl?this.gScene.dom.cleanUrl(this.dieDiffuseUrl):"/textures/die.png",s);o.specularColor=new BABYLON.Color3(.3,.3,.3);var a=this.babylon.arrowMaterial=new BABYLON.StandardMaterial("arrowMaterial",s);a.diffuseTexture=new BABYLON.Texture("/textures/arrow.png",s);a.diffuseTexture.hasAlpha=true;a.backFaceCulling=false;var l=6;var c=new Array(6);for(let t=0;t<6;t++){let e=this.dieFaceReindex[t];c[t]=new BABYLON.Vector4(e/l,0,(e+1)/l,1)}var h=this.babylon.arrow=BABYLON.MeshBuilder.CreatePlane("arrow",{height:.5,width:this.arrowLength},s);h.material=a;h.rotation.x=Math.PI/2;h.rotation.y=0;h.position.y=1;h.position.x=-.8-this.arrowLength/2;h.bakeTransformIntoVertices(BABYLON.Matrix.Translation(this.arrowLength/2,0,0));var u=BABYLON.MeshBuilder.CreateBox("north",{width:this.wallSize,height:this.wallSize,depth:this.wallThickness},s);u.position.y=this.wallSize/2;u.position.z=this.wallSize/2;u.physicsImpostor=new BABYLON.PhysicsImpostor(u,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:this.restitution,friction:this.friction},s);var p=BABYLON.MeshBuilder.CreateBox("south",{width:this.wallSize,height:this.wallSize,depth:this.wallThickness},s);p.position.y=this.wallSize/2;p.position.z=-this.wallSize/2;p.physicsImpostor=new BABYLON.PhysicsImpostor(p,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:this.restitution,friction:this.friction},s);var f=BABYLON.MeshBuilder.CreateBox("east",{width:this.wallThickness,height:this.wallSize,depth:this.wallSize},s);f.position.y=this.wallSize/2;f.position.x=this.wallSize/2;f.physicsImpostor=new BABYLON.PhysicsImpostor(f,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:this.restitution,friction:this.friction},s);var d=BABYLON.MeshBuilder.CreateBox("west",{width:this.wallThickness,height:this.wallSize,depth:this.wallSize},s);d.position.y=this.wallSize/2;d.position.x=-this.wallSize/2;d.physicsImpostor=new BABYLON.PhysicsImpostor(d,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:this.restitution,friction:this.friction},s);var y=BABYLON.MeshBuilder.CreateBox("top",{width:this.wallSize,height:this.wallThickness,depth:this.wallSize},s);y.position.y=this.wallSize;y.physicsImpostor=new BABYLON.PhysicsImpostor(y,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:this.restitution,friction:this.friction},s);var m=BABYLON.MeshBuilder.CreateBox("bottom",{width:this.wallSize,height:this.wallThickness,depth:this.wallSize},s);m.physicsImpostor=new BABYLON.PhysicsImpostor(m,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:this.restitution,friction:this.friction},s);if(!this.wallVisibility){u.setEnabled(false);p.setEnabled(false);f.setEnabled(false);d.setEnabled(false);y.setEnabled(false);m.setEnabled(false)}for(let n=0;n<this.dieCount;n++){let e=BABYLON.MeshBuilder.CreateBox("die",{size:this.dieSize,faceUV:c,wrap:true},s);e.material=o;let t=Math.round(n/6);let i=n%6;e.position.x=-this.wallSize/2*.75;e.position.y=this.wallThickness/2+.4+t*this.dieSize*1.2;e.position.z=-this.wallSize/2+2*this.wallThickness+i*this.dieSize*1.5;e.rotation.x=2*Math.PI*Math.random();e.rotation.y=2*Math.PI*Math.random();e.rotation.z=2*Math.PI*Math.random();this.babylon.dice.push(e)}console.warn("DirceRoller init done!")};s.prototype.roll=function(){console.warn("DirceRoller roll");var t,i,n,s=this.babylon.scene,r=this.babylon.arrow,e=10,o=new BABYLON.Vector3(10,0,0),a=new h;this.gScene.globalCamera.babylon.camera.detachControl();a.then(()=>{if(this.gScene.globalCamera.free){this.gScene.globalCamera.babylon.camera.attachControl()}});var l=async()=>{s.onPointerDown=s.onPointerMove=s.onPointerUp=null;if(n){clearInterval(n)}r.setEnabled(false);var e=Math.min(1,(Date.now()-i)/this.maxPowerDuration);o.z=-o.y;o.y=0;o.normalize();o.y=.6;o.normalize();try{t=await this.throwDice(e,o);await this.displayDiceRollResult(t)}catch(e){this.destroy();a.reject(e);return}this.destroy();a.resolve(t)};var c=()=>{if(i){return}s.onPointerDown=null;i=Date.now();var t=4*e/this.maxPowerDuration;n=setInterval(()=>{r.scaling.x+=t;var e=o.normalizeToNew();r.rotation.y=Math.atan2(e.y,e.x);if(Date.now()-i>this.maxPowerDuration){l()}},e);s.onPointerMove=e=>{o.x+=e.movementX;o.y+=e.movementY};s.onPointerUp=l};s.onPointerDown=c;setTimeout(c,2e3);return a};s.prototype.throwDice=async function(i,n){var s={},r=this.babylon.scene;i=this.maxThrowingPower*i+this.minThrowingPower*(1-i);for(let t=0;t<this.dieCount;t++){let e=this.babylon.dice[t];e.physicsImpostor=new BABYLON.PhysicsImpostor(e,BABYLON.PhysicsImpostor.BoxImpostor,{mass:1,restitution:this.restitution,friction:this.friction},r);e.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(i*n.x,i*n.y,i*n.z))}var e=Date.now();do{if(this.babylon.dice.every(e=>this.isStill(e))){break}await h.resolveTimeout(100)}while(Date.now()-e<this.diceRollTimeLimit);s.dice=this.babylon.dice.map(e=>this.getDieFace(e));s.sum=0;if(this.faceValues){s.values=s.dice.map(e=>{var t=this.faceValues[e];if(typeof t==="number"){s.sum+=t||0}else if(typeof t!=="string"){t=null}return t})}console.warn("Dice roll: ",s);return s};s.prototype.isStill=function(e){var t=e.physicsImpostor.physicsBody;var i=Math.abs(t.velocity.x)+Math.abs(t.velocity.y)+Math.abs(t.velocity.z)+Math.abs(t.angularVelocity.x)+Math.abs(t.angularVelocity.y)+Math.abs(t.angularVelocity.z);console.warn("velocity sum:",i);return i<this.stillnessVelocitySumLimit};s.prototype.getDieFace=function(e){var t=n.getUpmostBoxMeshFace(e);return this.dieFaceReindex[t]};s.prototype.displayDiceRollResult=function(e){var t=this.babylon.ui=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");var i=new BABYLON.GUI.Rectangle;i.width=.2;i.height="40px";i.cornerRadius=20;i.color="orange";i.thickness=4;i.background="green";t.addControl(i);var n=new BABYLON.GUI.TextBlock;n.text=e.values.join("+")+" = "+e.sum;n.color="white";n.fontSize=24;i.addControl(n);return h.resolveTimeout(2e3)}},{"./meshUtils.js":24,seventh:51}],3:[function(e,t,i){"use strict";const n=e("./GTransition.js");const s=e("./Parametric.js");const r=e("./browser-extension.js");const o=e("nextgen-events/lib/LeanEvents.js");const a=e("seventh");function l(e,t,i){this.id=i.id||null;this.gScene=t;this.gScene.registerGEntity(this.id,this);this.dom=e;this.usage=i.usage||"sprite";this.parent=undefined;this.parentMode=undefined;this.parentTransformNode=undefined;this.transient=i.transient||undefined;this.destroyed=false;this.show=false;this.persistent=true;this.button=null;this.theme=null;this.texturePack=null;this.variant="default";this.frame=0;this.location=null;this.origin={x:0,y:0,z:0};this.position={x:0,y:0,z:0};this.positionMode="default";this.size={x:1,y:1,z:1};this.sizeMode="default";this.rotation={x:0,y:0,z:0};this.rotationMode="default";this.direction={x:1,y:0,z:0};this.facing=0;this.billboard=null;this.opacity=1;this.special={};this.meta={};this.engine={};this.parametric=null;this.clientMods={variant:null,xFlipVariant:null,xFlip:false,origin:null,position:null,size:null};this.firstUpdate=true;this.updateMeshNeeded=true;this.updateMaterialNeeded=true;this.createLightNeeded=false;this.texturePackObject=null;this.variantObject=null;this.frameObject=null;this.lightEmitting=false;this.textureCache={};this.textureAnimationTimer=null;this.children=new Set;this.transformNodes={};this.perPropertyTransformNodes={};if(i.parent){this.setParent(i.parent,i.parentMode)}this.babylon={material:null,mesh:null,light:null,texture:null,particleSystem:null};this.nextTextureFrame=this.nextTextureFrame.bind(this);this.defineStates("loaded","loading");if(this.noLocalLighting){this.gScene.noLocalLightingGEntities.add(this);this.gScene.once("render",()=>this.gScene.updateLightExcludedMeshes(),{unique:true,id:"updateLightExcludedMeshes"})}}l.prototype=Object.create(o.prototype);l.prototype.constructor=l;t.exports=l;l.prototype.localBBoxSize=1;l.prototype.noLocalLighting=false;l.prototype.isLocalLight=true;l.prototype.noParentScaling=false;l.prototype.forceZScalingToX=false;l.prototype.destroy=function(){if(this.destroyed){return}if(this.noLocalLighting){this.gScene.noLocalLightingGEntities.remove(this);this.gScene.once("render",()=>this.gScene.updateLightExcludedMeshes(),{unique:true,id:"updateLightExcludedMeshes"})}if(this.children.size){for(let e of this.children){e.destroy()}}for(let e in this.transformNodes){e.dispose()}if(this.babylon.mesh){this.babylon.mesh.parent=null;this.babylon.mesh.dispose();this.babylon.mesh=null}if(this.babylon.material){this.babylon.material.dispose(false,false,true);this.babylon.material=null}if(this.babylon.texture){this.babylon.texture.dispose();this.babylon.texture=null}if(this.babylon.particleSystem){this.babylon.particleSystem.dispose();this.babylon.particleSystem=null}this.gScene.unregisterGEntity(this.id);this.destroyed=true};const c={default:{mesh:true}};l.prototype.setParent=function(e,t){var i=this.gScene.gEntities[e];if(!i){return}this.parent=i;if(typeof t==="string"){t=c[t]||c.default}if(!t||typeof t!=="object"){t=c.default}this.parentMode={mesh:!!t.mesh,position:{all:false,x:false,y:false,z:false}};if(t.position){if(typeof t.position==="object"){this.parentMode.position.x=!!t.position.x;this.parentMode.position.y=!!t.position.y;this.parentMode.position.z=!!t.position.z;this.parentMode.position.all=this.parentMode.position.x&&this.parentMode.position.y&&this.parentMode.position.z}else{this.parentMode.position.all=this.parentMode.position.x=this.parentMode.position.y=this.parentMode.position.z=true}}i.addChild(this);this.parentTransformNode=i.ensureTransformNode(this.parentMode)};l.prototype.addChild=function(e){this.children.add(e)};l.prototype.update=async function(e,t=false,i=false){console.warn("3D GEntity.update()",e);if(e.delay){await a.resolveTimeout(e.delay*1e3)}if(this.firstUpdate){if(typeof this.transient==="number"){setTimeout(()=>this.destroy(),this.transient*1e3)}this.firstUpdate=false}if(e.transition){if(i){delete e.transition}else{e.transition=new n(e.transition)}}if(e.engine!==undefined){await this.updateEngine(e.engine)}if(e.special!==undefined){await this.updateSpecialStage1(e)}if(e.texturePack!==undefined||e.variant!==undefined||e.theme!==undefined){await this.updateTexture(e.texturePack,e.variant,e.theme)}if(this.updateMeshNeeded){await this.updateMesh()}if(this.updateMaterialNeeded){await this.updateMaterial()}if(this.createLightNeeded){this.createLightNeeded=false;this.lightEmitting=true;await this.createLight()}if(e.special!==undefined){await this.updateSpecialStage2(e)}if(typeof e.opacity==="number"){this.updateOpacity(e.opacity)}if(e.origin!==undefined){this.updateOrigin(e.origin)}if(e.direction!==undefined){this.updateDirection(e.direction)}if(e.facing!==undefined){this.updateFacing(e.facing)}if(e.billboard!==undefined){this.updateBillboard(e.billboard)}if(e.position!==undefined||e.positionMode!==undefined){this.updatePosition(e)}if(e.rotation!==undefined||e.rotationMode!==undefined){this.updateRotation(e)}if(e.size!==undefined||e.sizeMode!==undefined){this.updateSize(e.size)}if(e.parametric!==undefined){if(!e.parametric){if(this.parametric){this.parametric=null;this.gScene.parametricGEntities.delete(this)}}else if(typeof e.parametric==="object"){if(!this.parametric){this.gScene.parametricGEntities.add(this);this.parametric=new s(e.parametric)}else{this.parametric.update(e.parametric)}}console.warn("@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 3D GEntity.update() parametric",e)}return t&&e.transition&&e.transition.promise||a.resolved};l.prototype.parametricUpdate=function(e){var t=this.parametric.compute(e,this);if(!t){this.parametric=null;this.gScene.parametricGEntities.delete(this);return}if(typeof t.opacity==="number"){this.updateOpacity(t.opacity,true)}if(t.position!==undefined||t.positionMode!==undefined){this.updatePosition(t,true)}if(t.rotation!==undefined||t.rotationMode!==undefined){this.updateRotation(t,true)}if(t.size!==undefined||t.sizeMode!==undefined){this.updateSize(t.size,true)}};l.prototype.updateEngine=function(e){};l.prototype.updateSpecialStage1=async function(e){if(this.useVg){if(e.special.vgPixelDensity){this.special.vgPixelDensity=e.special.vgPixelDensity}if(e.special.vgObject){await this.updateVgObject(e.special.vgObject)}else if(e.special.vgMorph){await this.updateVgMorph(e.special.vgMorph)}if(e.special.backVgObject){await this.updateVgObject(e.special.backVgObject,"backVgObject")}else if(e.special.backVgMorph){await this.updateVgMorph(e.special.backVgMorph,"backVgMorph")}}};l.prototype.updateSpecialStage2=function(e){if(e.special.light!==undefined){this.updateLight(e)}if(e.special&&e.special.material){this.updateMaterialParams(e.special.material)}};l.prototype.updateDirection=function(e){this.direction=e};l.prototype.updateFacing=function(e){this.facing=e};l.prototype.updateMesh=function(){this.updateMeshNeeded=false};const h=BABYLON.AbstractMesh.BILLBOARDMODE_X,u=BABYLON.AbstractMesh.BILLBOARDMODE_Y,p=BABYLON.AbstractMesh.BILLBOARDMODE_Z;const f={none:0,all:h|u|p,xyz:h|u|p,xy:h|u,xz:h|p,yz:u|p,x:h,y:u,z:p};l.BILLBOARD_MODES=f;l.prototype.updateBillboard=function(e){var t=this.babylon.mesh;this.billboard=e;if(t){t.billboardMode=f[this.billboard]||0}};l.prototype.updateMeshParent=function(){if(!this.parent||!this.babylon.mesh){return}var e,t=this.babylon.mesh;if(this.parentMode.mesh){e=this.parent.babylon.mesh;if(e){t.parent=e;if(this.noParentScaling){this.updateSize(this.size)}}}else if(this.parentTransformNode){t.parent=this.parentTransformNode}};l.prototype.refreshMaterial=async function(){this.updateTexture();if(this.updateMaterialNeeded){await this.updateMaterial()}};l.prototype.updateMaterial=function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;console.warn("3D GEntity.updateMaterial()",this.texturePackObject,this.variantObject);this.babylon.material=e=new BABYLON.StandardMaterial("basicMaterial",i);e.ambientColor=new BABYLON.Color3(1,1,1);e.diffuseColor=new BABYLON.Color3(0,0,0);e.specularColor=new BABYLON.Color3(0,0,0);e.emissiveColor=new BABYLON.Color3(0,0,0);e.backFaceCulling=true;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};l.prototype.updateMaterialParams=function(e,t=false){var i,n,s,r=this.babylon.material;console.warn("@@@@@@@@@@@@@@@@@@ updateMaterialParams()",e);if(e.ambient&&typeof e.ambient==="object"){if(!this.special.ambient){this.special.ambient={r:1,g:1,b:1}}i=e.ambient.r!==undefined?e.ambient.r:this.special.ambient.r,n=e.ambient.g!==undefined?e.ambient.g:this.special.ambient.g,s=e.ambient.b!==undefined?e.ambient.b:this.special.ambient.b;if(!t){this.special.ambient.r=i;this.special.ambient.g=n;this.special.ambient.b=s}r.ambientColor.set(i,n,s)}var o=e.diffuse||e.albedo;if(o&&typeof o==="object"){if(!this.special.diffuse){this.special.diffuse={r:0,g:0,b:0}}i=o.r!==undefined?o.r:this.special.diffuse.r,n=o.g!==undefined?o.g:this.special.diffuse.g,s=o.b!==undefined?o.b:this.special.diffuse.b;if(!t){this.special.diffuse.r=i;this.special.diffuse.g=n;this.special.diffuse.b=s}r.diffuseColor.set(i,n,s)}if(e.specular&&typeof e.specular==="object"){if(!this.special.specular){this.special.specular={r:0,g:0,b:0}}i=e.specular.r!==undefined?e.specular.r:this.special.specular.r,n=e.specular.g!==undefined?e.specular.g:this.special.specular.g,s=e.specular.b!==undefined?e.specular.b:this.special.specular.b;if(!t){this.special.specular.r=i;this.special.specular.g=n;this.special.specular.b=s}r.specularColor.set(i,n,s)}if(e.emissive&&typeof e.emissive==="object"){console.warn("@@@@@@@@@@@@@@@@@@ updateMaterialParams() emissive",e.emissive);if(!this.special.emissive){this.special.emissive={r:0,g:0,b:0}}i=e.emissive.r!==undefined?e.emissive.r:this.special.emissive.r,n=e.emissive.g!==undefined?e.emissive.g:this.special.emissive.g,s=e.emissive.b!==undefined?e.emissive.b:this.special.emissive.b;if(!t){this.special.emissive.r=i;this.special.emissive.g=n;this.special.emissive.b=s}r.emissiveColor.set(i,n,s)}};l.prototype.updateOpacity=function(e,t=false){var i=this.babylon.material;if(!i){return}if(e<0){e=0}else if(e>1){e=1}if(!t){this.opacity=e}i.alpha=e};l.prototype.updateTexture=function(e,t,i,n,s=false){var r,o,a;if(e!==undefined){this.texturePack=e||null}if(t!==undefined){this.variant=t||null}if(i!==undefined){this.theme=i||null}console.warn("3D GEntity.updateTexture()",e,t,i);r=this.gScene.texturePacks[this.texturePack+"/"+(this.theme||this.gScene.theme)];if(!r){console.warn("3D Texture pack",this.texturePack+"/"+(this.theme||this.gScene.theme),"not found");r=this.gScene.texturePacks[this.texturePack+"/default"];if(!r){console.warn("3D Texture pack fallback",this.texturePack+"/default","not found");return}}var l=this.clientMods.xFlip;this.clientMods.xFlip=false;if(this.clientMods.variant){o=r.variants[this.variant+"@"+this.clientMods.variant];if(!o){o=r.variants[this.variant+"@"+this.clientMods.xFlipVariant];if(o){this.clientMods.xFlip=true}else{o=r.variants[this.variant]||r.variants.default}}}else{o=r.variants[this.variant]||r.variants.default}if(!o){console.warn("3D Texture pack variant",this.variant,"not found, and default variant missing too");return}if(o===this.variantObject){if(n!==undefined){this.frame=o.frames[n]?+n:0}}else{this.frame=n!==undefined&&o.frames[n]?+n:0}a=o.frames[this.frame]||o.frames[0];if(r!==this.texturePackObject){this.whenTextureCacheReady().then(()=>{if(r===this.texturePackObject){this.preloadTexturePack()}})}if(r===this.texturePackObject&&o===this.variantObject&&a===this.frameObject&&l===this.clientMods.xFlip){return}this.texturePackObject=r;this.variantObject=o;this.frameObject=a;if(this.variantObject.animation){this.startTextureAnimation(!s)}else{this.stopTextureAnimation()}this.updateMaterialNeeded=true};l.prototype.startTextureAnimation=function(e=false){if(!this.variantObject.animation){if(this.textureAnimationTimer){clearTimeout(this.textureAnimationTimer);this.textureAnimationTimer=null}return}if(this.textureAnimationTimer){if(!e){return}clearTimeout(this.textureAnimationTimer);this.textureAnimationTimer=null}this.textureAnimationTimer=setTimeout(this.nextTextureFrame,1e3*this.frameObject.duration)};l.prototype.stopTextureAnimation=function(){if(this.textureAnimationTimer){clearTimeout(this.textureAnimationTimer);this.textureAnimationTimer=null}};l.prototype.nextTextureFrame=function(){if(this.frame>=this.variantObject.frames.length-1){if(this.variantObject.animation==="loop"){this.frame=0}else{this.stopTextureAnimation();return}}else{this.frame++}this.frameObject=this.variantObject.frames[this.frame];this.textureAnimationTimer=setTimeout(this.nextTextureFrame,1e3*this.frameObject.duration);this.updateMaterial()};l.prototype.updateVgObject=async function(e,t="vgObject"){const i=r.host.exports.svg;if(!(e instanceof i.VG)){e=i.objectToVG(e);if(!(e instanceof i.VG)){return}}this.special[t]=e;console.warn("vgObject:",e)};l.prototype.updateOrigin=function(e,t=false){if(this.clientMods.origin&&!t){this.origin=e;return}var i=this.clientMods.origin||this.origin;if(i.x===e.x&&i.y===e.y&&i.z===e.z){return}var n=this.babylon.mesh,s=this.localBBoxSize/2;n.bakeTransformIntoVertices(BABYLON.Matrix.Translation((i.x-e.x)*s,(i.y-e.y)*s,(i.z-e.z)*s));if(t){this.clientMods.origin=e}else{this.origin=e}};l.prototype.updatePosition=function(e,t=false,i=false){var n,s,r,o,a,l,c=this.clientMods.position,h=e.position,u=this.babylon.mesh,p=this.gScene.babylon.scene;if(i){if(c){if(h.x===c.x&&h.y===c.y&&h.z===c.z){return}n=u.position.x-c.x;s=u.position.y-c.y;r=u.position.z-c.z}else{if(!h.x&&!h.y&&!h.z){return}n=u.position.x;s=u.position.y;r=u.position.z}this.clientMods.position=h}else if(t){n=h.x!==undefined?h.x:this.position.x;s=h.y!==undefined?h.y:this.position.y;r=h.z!==undefined?h.z:this.position.z}else{n=this.position.x=h.x!==undefined?h.x:this.position.x;s=this.position.y=h.y!==undefined?h.y:this.position.y;r=this.position.z=h.z!==undefined?h.z:this.position.z}if(!u){return}o=n;a=s;l=r;if(this.clientMods.position){n+=this.clientMods.position.x;s+=this.clientMods.position.y;r+=this.clientMods.position.z}if(e.transition){e.transition.createAnimation(p,u,"position",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(n,s,r));if(this.perPropertyTransformNodes.position?.length){this.updatePositionOfTransformNodesWithTransition(e.transition,o,a,l)}}else{u.position.set(n,s,r);if(this.perPropertyTransformNodes.position?.length){this.updatePositionOfTransformNodes(o,a,l)}}};l.prototype.ensureTransformNode=function(e){var t="";if(e.position.all){t+="Pall"}else{if(e.position.x){t+="Px"}if(e.position.y){t+="Py"}if(e.position.z){t+="Pz"}}if(this.transformNodes[t]){return this.transformNodes[t]}var i=this.transformNodes[t]=new BABYLON.TransformNode(t,this.scene);i.__key=t;i.__px=i.__py=i.__pz=0;if(e.position.all){i.position.set(this.position.x,this.position.y,this.position.z);i.__px=i.__py=i.__pz=1;if(!this.perPropertyTransformNodes.position){this.perPropertyTransformNodes.position=[]}this.perPropertyTransformNodes.position.push(i)}else if(e.position.x||e.position.y||e.position.z){if(e.position.x){i.position.x=this.position.x;i.__px=1}if(e.position.y){i.position.y=this.position.y;i.__py=1}if(e.position.z){i.position.z=this.position.z;i.__pz=1}if(!this.perPropertyTransformNodes.position){this.perPropertyTransformNodes.position=[]}this.perPropertyTransformNodes.position.push(i)}return i};l.prototype.updatePositionOfTransformNodes=function(t,i,n){for(let e of this.perPropertyTransformNodes.position){e.position.set(e.__px*t,e.__py*i,e.__pz*n)}};l.prototype.updatePositionOfTransformNodesWithTransition=function(t,i,n,s){for(let e of this.perPropertyTransformNodes.position){t.createAnimation(this.scene,e,"position",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(e.__px*i,e.__py*n,e.__pz*s))}};l.prototype.updateRotation=function(e,t=false){console.warn("3D GEntity.updateRotation()",e);var i=this.babylon.mesh,n=this.gScene.babylon.scene;if(!i){return}var s=e.rotation.x!==undefined?e.rotation.x:this.rotation.x,r=e.rotation.y!==undefined?e.rotation.y:this.rotation.y,o=e.rotation.z!==undefined?e.rotation.z:this.rotation.z;if(!t){this.rotation.x=s;this.rotation.y=r;this.rotation.z=o}if(e.transition){e.transition.createAnimation(n,i,"rotation",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(s,r,o))}else{i.rotation.set(s,r,o)}};l.prototype.updateSize=function(e,t=false,i=false){console.warn("3D GEntity.updateSize()",e);var n,s,r,o=this.babylon.mesh,a=this.gScene.babylon.scene;if(i){this.clientMods.size={x:e.x!==undefined?e.x:1,y:e.y!==undefined?e.y:1,z:e.z!==undefined?e.z:1};n=this.size.x;s=this.size.y;r=this.size.z}else if(t){n=e.x!==undefined?e.x:this.size.x;s=e.y!==undefined?e.y:this.size.y;r=e.z!==undefined?e.z:this.size.z}else{n=this.size.x=e.x!==undefined?e.x:this.size.x;s=this.size.y=e.y!==undefined?e.y:this.size.y;r=this.size.z=e.z!==undefined?e.z:this.size.z}if(!o){return}if(this.clientMods.size){n*=this.clientMods.size.x;s*=this.clientMods.size.y;r*=this.clientMods.size.z}if(this.parent&&this.noParentScaling){let e=this.parent.babylon.mesh;n/=e.scaling.x;s/=e.scaling.y;r/=e.scaling.z}o.scaling.x=n;o.scaling.y=s;o.scaling.z=this.forceZScalingToX?n:r};l.prototype.updateLight=function(e,t=false){console.warn("3D GEntity.updateLight()",e);if(e.special.light===undefined){return}if(!e.special.light!==!this.lightEmitting){this.lightEmitting=!!e.special.light;if(!this.lightEmitting){this.destroyLight();return}this.createLight()}if(!e.special.light||typeof e.special.light!=="object"){return}var i=this.gScene.babylon.scene,n=this.babylon.light;if(e.special.light.diffuse&&typeof e.special.light.diffuse==="object"){this.special.light.diffuse=e.special.light.diffuse;if(e.transition){e.transition.createAnimation(i,n,"diffuse",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(this.special.light.diffuse.r,this.special.light.diffuse.g,this.special.light.diffuse.b))}else{n.diffuse.set(this.special.light.diffuse.r,this.special.light.diffuse.g,this.special.light.diffuse.b)}}if(e.special.light.specular&&typeof e.special.light.specular==="object"){this.special.light.specular=e.special.light.specular;if(e.transition){e.transition.createAnimation(i,n,"specular",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(this.special.light.specular.r,this.special.light.specular.g,this.special.light.specular.b))}else{n.specular.set(this.special.light.specular.r,this.special.light.specular.g,this.special.light.specular.b)}}if(e.special.light.intensity!==undefined){this.special.light.intensity=e.special.light.intensity;if(e.transition){e.transition.createAnimation(i,n,"intensity",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.light.intensity)}else{n.intensity=this.special.light.intensity}}};l.prototype.createLight=function(){console.warn("@@@@@@@@@@@@@@@@@@@@@@@@@ GEntity.createLight()");if(!this.babylon.mesh){throw new Error("Non pure light GEntity needs a mesh to be light-emitting")}var e=this.gScene.babylon.scene;if(!this.special.light){this.special.light={diffuse:new BABYLON.Color3(1,1,1),specular:new BABYLON.Color3(.5,.5,.5),intensity:1}}this.babylon.light=new BABYLON.PointLight("pointLight",new BABYLON.Vector3(0,0,0),e);this.babylon.light.parent=this.babylon.mesh;this.babylon.light.diffuse=this.special.light.diffuse;this.babylon.light.specular=this.special.light.specular;this.babylon.light.intensity=this.special.light.intensity;if(this.isLocalLight){this.registerLocalLight()}};l.prototype.destroyLight=function(){if(this.isLocalLight){this.unregisterLocalLight()}if(this.babylon.light){this.babylon.light.dispose()}this.special.light=null};l.prototype.registerLocalLight=function(){this.gScene.localLightGEntities.add(this);this.babylon.light.excludedMeshes=[...this.gScene.noLocalLightingGEntities].map(e=>e.babylon.mesh)};l.prototype.unregisterLocalLight=function(){this.gScene.localLightGEntities.delete(this)};l.prototype.getTexture=function(e){var t,i=this.gScene.babylon.scene;e=this.dom.cleanUrl(e);if(this.textureCache[e]){return this.textureCache[e]}t=this.textureCache[e]=new BABYLON.Texture(e,i);return t};l.prototype.preloadTexturePack=function(){var e,t,i,n,s=[];for(e in this.texturePackObject.variants){t=this.texturePackObject.variants[e];for(i of t.frames){if(i.url){s.push(this.getTexture(i.url))}if(i.maps){for(n in i.maps){s.push(this.getTexture(i.maps[n]))}}}}return new a(e=>BABYLON.Texture.WhenAllReady(s,()=>e()))};l.prototype.whenTextureCacheReady=function(){return new a(e=>BABYLON.Texture.WhenAllReady([...Object.values(this.textureCache)],()=>e()))};l.prototype.flipTexture=function(e,t,i){if(t){e.uScale=-1;e.uOffset=1}else{e.uScale=1;e.uOffset=0}if(i){e.vScale=-1;e.vOffset=1}else{e.vScale=1;e.vOffset=0}};l.prototype.updateSizeFromPixelDensity=function(e,t){var i;if(e.isReady()){i=e.getBaseSize();this.updateSize({x:i.width/t,y:i.height/t},false,true)}else{BABYLON.Texture.WhenAllReady([e],()=>{i=e.getBaseSize();this.updateSize({x:i.width/t,y:i.height/t},false,true)})}}},{"./GTransition.js":20,"./Parametric.js":21,"./browser-extension.js":22,"nextgen-events/lib/LeanEvents.js":41,seventh:51}],4:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("seventh");function o(e,t,i){n.call(this,e,t,i)}o.prototype=Object.create(n.prototype);o.prototype.constructor=o;t.exports=o;o.prototype.localBBoxSize=1e3;o.prototype.noLocalLighting=true;o.prototype.updateMaterial=function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;console.warn("3D GEntityBackground.updateMaterial()",this.texturePackObject,this.variantObject);var s=this.variantObject.frames[0].url;this.babylon.material=e=new BABYLON.StandardMaterial("simpleMaterial",i);e.backFaceCulling=true;e.diffuseTexture=new BABYLON.Texture(this.dom.cleanUrl(s),i);e.specularColor=new BABYLON.Color3(0,0,0);e.ambientColor=new BABYLON.Color3(1,1,1);e.backFaceCulling=false;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};o.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.MeshBuilder.CreateCylinder("background",{height:this.localBBoxSize,diameter:this.localBBoxSize,tessellation:24,cap:BABYLON.Mesh.NO_CAP,sideOrientation:BABYLON.Mesh.BACKSIDE},t);this.updateMeshNeeded=false;return e}},{"./GEntity.js":3,"./GTransition.js":20,seventh:51}],5:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");const a={sphere:"CreateSphere"};function l(e,t,i){n.call(this,e,t,i);this.shapeClass=null;this.shapeParams={}}l.prototype=Object.create(n.prototype);l.prototype.constructor=l;t.exports=l;l.prototype.updateSpecialStage1=function(e){n.prototype.updateSpecialStage1.call(this,e);if(e.special.shape&&typeof e.special.shape==="object"){if(e.special.shape&&a[e.special.shape.type]){this.shapeClass=a[e.special.shape.type]}Object.assign(this.shapeParams,e.special.shape);this.updateMeshNeeded=true}};l.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;console.warn("@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ GEntityBasicShape.updateMesh()",this.shapeClass);if(!this.shapeClass){return}if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.MeshBuilder[this.shapeClass]("basic-shape",this.shapeParams,t);e.scaling.x=this.size.x;e.scaling.y=this.size.y;e.scaling.z=this.size.z;console.warn("@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Mesh:",e);this.updateMeshNeeded=false;return e}},{"./GEntity.js":3,"./GTransition.js":20,"./vectorUtils.js":26,seventh:51}],6:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i)}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.useVg=true;a.prototype.forceZScalingToX=true;a.prototype.updateMaterial=async function(){var e,t,i,n=this.special.vgObject,s=this.special.backVgObject,r=this.babylon.material,o=this.gScene.babylon.scene,a=this.babylon.mesh;if(!n||!s){console.error("No VG object or back VG object",n,s);return}console.warn("3D GEntityCard.updateMaterial()");t=new BABYLON.StandardMaterial("cardMaterial",o);t.backFaceCulling=true;t.ambientColor=new BABYLON.Color3(1,1,1);var l={width:n.viewBox.width,height:n.viewBox.height};t.diffuseTexture=new BABYLON.DynamicTexture("cardDynamicTexture",l,o);t.diffuseTexture.hasAlpha=true;t.diffuseTexture.wrapU=t.diffuseTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;var c=t.diffuseTexture.getContext();await n.renderCanvas(c);t.diffuseTexture.update();i=new BABYLON.StandardMaterial("cardBackMaterial",o);i.backFaceCulling=true;i.ambientColor=new BABYLON.Color3(1,1,1);var h={width:s.viewBox.width,height:s.viewBox.height};i.diffuseTexture=new BABYLON.DynamicTexture("cardBackDynamicTexture",h,o);i.diffuseTexture.hasAlpha=true;i.diffuseTexture.wrapU=i.diffuseTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;var c=i.diffuseTexture.getContext();await s.renderCanvas(c);i.diffuseTexture.update();this.babylon.material=e=new BABYLON.MultiMaterial("multi",o);e.subMaterials.push(t);e.subMaterials.push(i);if(this.special.vgPixelDensity){this.updateSizeFromPixelDensity(t.diffuseTexture,this.special.vgPixelDensity)}if(!a){a=this.updateMesh()}a.material=e;if(r){r.dispose(false,false,true)}this.updateMaterialNeeded=false};var l,c;a.prototype.updateMesh=function(){var e,t,i,n=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}t=BABYLON.Mesh.CreatePlane("card",undefined,n);i=BABYLON.Mesh.CreatePlane("card-back",undefined,n,undefined,BABYLON.Mesh.BACKSIDE);if(!l){l=new BABYLON.StandardMaterial("card-front-fake-material");c=new BABYLON.StandardMaterial("card-back-fake-material")}t.material=l;i.material=c;this.babylon.mesh=e=BABYLON.Mesh.MergeMeshes([t,i],true,undefined,undefined,undefined,true);if(this.parent){this.updateMeshParent()}console.warn("Card Mesh:",e);this.updateMeshNeeded=false;return e}},{"./GEntity.js":3,"./GTransition.js":20,"./vectorUtils.js":26,seventh:51}],7:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.updateMeshNeeded=this.updateMaterialNeeded=false}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.isLocalLight=false;a.prototype.updateLight=function(e){console.warn("3D GEntityDirectionalLight.updateLight()",e);n.prototype.updateLight.call(this,e);if(!e.special.light||typeof e.special.light!=="object"){return}var t=this.gScene.babylon.scene,i=this.babylon.light;if(e.special.light.direction&&typeof e.special.light.direction==="object"){this.special.light.direction=e.special.light.direction;if(e.transition){e.transition.createAnimation(t,i,"direction",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(this.special.light.direction.x,this.special.light.direction.y,this.special.light.direction.z))}else{i.direction.set(this.special.light.direction.x,this.special.light.direction.y,this.special.light.direction.z)}}};a.prototype.createLight=function(){var e=this.gScene.babylon.scene;if(this.babylon.light){console.warn("GEntityDirectionalLight.createLight(): light is already existing");return}if(!this.special.light){this.special.light={direction:new BABYLON.Vector3(0,-1,0),diffuse:new BABYLON.Color3(1,1,1),specular:new BABYLON.Color3(0,0,0),intensity:.2}}this.babylon.light=new BABYLON.DirectionalLight("directionalLight",this.special.light.direction,e);this.babylon.light.diffuse=this.special.light.diffuse;this.babylon.light.specular=this.special.light.specular;this.babylon.light.intensity=this.special.light.intensity;if(this.isLocalLight){this.registerLocalLight()}}},{"./GEntity.js":3,"./GTransition.js":20,"./vectorUtils.js":26,seventh:51}],8:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.special.content={text:"",textColor:"white"}}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.noParentScaling=true;a.prototype.destroy=function(){if(this.babylon.advancedTexture){this.babylon.advancedTexture.parent=null;this.babylon.advancedTexture.dispose()}n.prototype.destroy.call(this)};a.prototype.updateTexture=function(){};a.prototype.updateMaterial=function(){var e,t,i,n=this.gScene.babylon.scene,s=this.babylon.mesh;console.warn("3D GEntityFloatingText.updateMaterial()");if(this.babylon.advancedTexture){e=this.babylon.advancedTexture}else{if(!s){s=this.updateMesh()}this.babylon.advancedTexture=e=BABYLON.GUI.AdvancedDynamicTexture.CreateForMesh(s,1024,64)}if(this.babylon.textBlock){t=this.babylon.textBlock}else{this.babylon.textBlock=t=new BABYLON.GUI.TextBlock;t.fontSizeInPixels=46;t.text=this.special.content.text;t.color=this.special.content.textColor;t.alpha=this.opacity;t.resizeToFit=true;e.addControl(t)}this.updateMaterialNeeded=false};const l=.7;a.prototype.updateContent=function(e){var t,i=this.babylon.advancedTexture,n=this.babylon.textBlock;if(!n){return}if(e.text!==undefined){n.text=this.special.content.text=""+e.text}if(typeof e.textColor==="string"){n.color=this.special.content.textColor=e.textColor}if(typeof e.outlineColor==="string"){n.outlineColor=this.special.content.outlineColor=e.outlineColor}if(typeof e.outlineWidth==="number"){n.outlineWidth=this.special.content.outlineWidth=e.outlineWidth}if(typeof e.shadowColor==="string"){n.shadowColor=this.special.content.shadowColor=e.shadowColor}if(typeof e.shadowBlur==="number"){n.shadowBlur=this.special.content.shadowBlur=e.shadowBlur}if(e.icon){if(this.babylon.icon){t=this.babylon.icon;t.source=this.dom.cleanUrl(e.icon);t.width=l*.0625;t.height=l}else{this.babylon.icon=t=new BABYLON.GUI.Image("icon",this.dom.cleanUrl(e.icon));t.width=l*.0625;t.height=l;i.addControl(t)}this.fixIcon()}};a.prototype.fixIcon=function(){if(this.babylon.textBlock._width.isPixel){this.babylon.icon.left=-32-this.babylon.textBlock.widthInPixels/2}else{setTimeout(()=>this.fixIcon(),10)}};a.prototype.updateMaterialParams=function(e,t=false){};a.prototype.updateOpacity=function(e,t=false){if(e<0){e=0}else if(e>1){e=1}if(!t){this.opacity=e}if(this.babylon.textBlock){this.babylon.textBlock.alpha=e}if(this.babylon.icon){this.babylon.icon.alpha=e}};a.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.PlaneBuilder.CreatePlane("floating-text",{width:80,height:5},t);e.billboardMode=BABYLON.AbstractMesh.BILLBOARDMODE_ALL;if(this.parent){this.updateMeshParent()}console.warn("GEntityFloatingText .updateMesh() Mesh:",e);this.updateMeshNeeded=false;return e};a.prototype.updateSpecialStage2=function(e){if(e.special&&e.special.content){this.updateContent(e.special.content)}}},{"./GEntity.js":3,"./GTransition.js":20,"./vectorUtils.js":26,seventh:51}],9:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i)}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.updateMaterial=async function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;console.warn("3D GEntityFx.updateMaterial()",this.texturePackObject,this.variantObject);this.babylon.material=e=new BABYLON.StandardMaterial("fxMaterial",i);e.backFaceCulling=false;e.transparencyMode=BABYLON.Material.MATERIAL_ALPHABLEND;e.useAlphaFromDiffuseTexture=true;e.alpha=t?t.alpha:this.opacity;e.ambientColor=new BABYLON.Color3(1,1,1);var s=this.frameObject.maps&&(this.frameObject.maps.diffuse||this.frameObject.maps.albedo)||this.frameObject.url;e.diffuseTexture=this.getTexture(s);e.diffuseTexture.hasAlpha=true;e.diffuseTexture.wrapU=e.diffuseTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;e.specularColor=new BABYLON.Color3(0,0,0);var r=this.frameObject.xFlip,o=this.frameObject.yFlip;this.flipTexture(e.diffuseTexture,r,o);if(this.frameObject.origin){let e;if(!r&&!o){e=this.frameObject.origin}else{e={x:(r?-this.frameObject.origin.x:this.frameObject.origin.x)||0,y:(o?-this.frameObject.origin.y:this.frameObject.origin.y)||0,z:this.frameObject.origin.z||0}}this.updateOrigin(e,true)}if(this.texturePackObject.pixelDensity){this.updateSizeFromPixelDensity(e.diffuseTexture,this.texturePackObject.pixelDensity)}else if(this.frameObject.relSize){this.updateSize(this.frameObject.relSize,false,true)}if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};a.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.Mesh.CreatePlane("fx",undefined,t);if(this.parent){this.updateMeshParent()}console.warn("FX Mesh:",e);this.updateMeshNeeded=false;return e}},{"./GEntity.js":3,"./GTransition.js":20,"./vectorUtils.js":26,seventh:51}],10:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("seventh");function o(e,t,i){n.call(this,e,t,i)}o.prototype=Object.create(n.prototype);o.prototype.constructor=o;t.exports=o;o.prototype.updateMaterial=function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;console.warn("3D GEntityGround.updateMaterial()",this.texturePackObject,this.variantObject);var s=this.variantObject.frames[0].url;this.babylon.material=e=new BABYLON.StandardMaterial("simpleMaterial",i);e.backFaceCulling=true;e.diffuseTexture=new BABYLON.Texture(this.dom.cleanUrl(s),i);e.diffuseTexture.uScale=20;e.diffuseTexture.vScale=20;e.specularColor=new BABYLON.Color3(0,0,0);e.ambientColor=new BABYLON.Color3(1,1,1);e.backFaceCulling=false;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};o.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.MeshBuilder.CreateGround("ground",{height:1e3,width:1e3,subdivisions:4},t);this.updateMeshNeeded=false;return e}},{"./GEntity.js":3,"./GTransition.js":20,seventh:51}],11:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.updateMeshNeeded=this.updateMaterialNeeded=false;this.createLightNeeded=true}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.isLocalLight=false;a.prototype.updateLight=function(e){console.warn("3D GEntityHemisphericLight.updateLight()",e);n.prototype.updateLight.call(this,e);if(!e.special.light||typeof e.special.light!=="object"){return}var t=this.gScene.babylon.scene,i=this.babylon.light;if(e.special.light.ground&&typeof e.special.light.ground==="object"){this.special.light.ground=e.special.light.ground;if(e.transition){e.transition.createAnimation(t,i,"groundColor",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(this.special.light.ground.r,this.special.light.ground.g,this.special.light.ground.b))}else{i.groundColor.set(this.special.light.ground.r,this.special.light.ground.g,this.special.light.ground.b)}}if(e.special.light.up&&typeof e.special.light.up==="object"){this.special.light.up=e.special.light.up;if(e.transition){e.transition.createAnimation(t,i,"direction",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(this.special.light.up.x,this.special.light.up.y,this.special.light.up.z))}else{i.direction.set(this.special.light.up.x,this.special.light.up.y,this.special.light.up.z)}}};a.prototype.createLight=function(){var e=this.gScene.babylon.scene;if(this.babylon.light){console.warn("GEntityHemisphericLight.createLight(): light is already existing");return}if(!this.special.light){this.special.light={up:new BABYLON.Vector3(0,1,0),diffuse:new BABYLON.Color3(1,1,1),specular:new BABYLON.Color3(0,0,0),ground:new BABYLON.Color3(.2,.2,.2),intensity:.2}}this.babylon.light=new BABYLON.HemisphericLight("hemisphericLight",this.special.light.up,e);this.babylon.light.diffuse=this.special.light.diffuse;this.babylon.light.specular=this.special.light.specular;this.babylon.light.groundColor=this.special.light.ground;this.babylon.light.intensity=this.special.light.intensity;if(this.isLocalLight){this.registerLocalLight()}}},{"./GEntity.js":3,"./GTransition.js":20,"./vectorUtils.js":26,seventh:51}],12:[function(e,t,i){"use strict";const r=e("./GEntity.js");const n=e("./GTransition.js");const s=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){r.call(this,e,t,i);this.special.particleSystem={capacity:100,updateRate:1,attachToCamera:false,shape:{type:"box",xmin:0,xmax:0,ymin:0,ymax:0,zmin:0,zmax:0,minRadius:0,maxRadius:0,height:0,angle:0},emitRate:100,duration:{min:10,max:10},blendMode:l.default,speed:{x:0,y:0,z:0,xyzmin:1,xyzmax:1},altSpeed:null,speedFactorGradient:null,rotation:{min:0,max:0},rotationSpeed:{min:0,max:0},rotationSpeedGradient:null,acceleration:{x:0,y:0,z:0},size:{xmin:1,xmax:1,ymin:1,ymax:1,xymin:1,xymax:1},sizeGradient:null,color:{r:1,g:1,b:1,a:1},altColor:null,endColor:null,colorGradient:null,billboard:"all"};this.emitterShape="box"}a.prototype=Object.create(r.prototype);a.prototype.constructor=a;t.exports=a;const l={add:BABYLON.ParticleSystem.BLENDMODE_ADD,multiply:BABYLON.ParticleSystem.BLENDMODE_MULTIPLY,multiplyAdd:BABYLON.ParticleSystem.BLENDMODE_MULTIPLYADD,oneOne:BABYLON.ParticleSystem.BLENDMODE_ONEONE,standard:BABYLON.ParticleSystem.BLENDMODE_STANDARD};l.default=l.standard;const c={box:"box",sphere:"sphere",hemisphere:"hemisphere",hemispheric:"hemisphere",cylinder:"cylinder",cone:"cone"};const h={none:"none",all:"all","all-axis":"all",y:"y","y-axis":"y"};a.prototype.updateSpecialStage2=function(e){var t,i,n,s;r.prototype.updateSpecialStage2.call(this,e);if(e.special.particleSystem&&typeof e.special.particleSystem==="object"){i=e.special.particleSystem;t=this.special.particleSystem;if(Number.isFinite(i.capacity)){t.capacity=i.capacity}if(Number.isFinite(i.updateRate)){t.updateRate=i.updateRate}if(typeof i.attachToCamera==="boolean"){t.attachToCamera=i.attachToCamera}if(i.shape&&typeof i.shape==="object"){if(i.shape.type&&c[i.shape.type]){t.shape.type=c[i.shape.type]}if(Number.isFinite(i.shape.xmin)){t.shape.xmin=i.shape.xmin}if(Number.isFinite(i.shape.ymin)){t.shape.ymin=i.shape.ymin}if(Number.isFinite(i.shape.zmin)){t.shape.zmin=i.shape.zmin}if(Number.isFinite(i.shape.xmax)){t.shape.xmax=i.shape.xmax}if(Number.isFinite(i.shape.ymax)){t.shape.ymax=i.shape.ymax}if(Number.isFinite(i.shape.zmax)){t.shape.zmax=i.shape.zmax}if(Number.isFinite(i.shape.minRadius)){t.shape.minRadius=i.shape.minRadius}if(Number.isFinite(i.shape.maxRadius)){t.shape.maxRadius=i.shape.maxRadius}else if(Number.isFinite(i.shape.radius)){t.shape.maxRadius=i.shape.radius}if(Number.isFinite(i.shape.height)){t.shape.height=i.shape.height}if(Number.isFinite(i.shape.angle)){t.shape.angle=i.shape.angle}}if(Number.isFinite(i.emitRate)){t.emitRate=i.emitRate}if(i.duration!==undefined){if(typeof i.duration==="object"){if(Number.isFinite(i.duration.min)){t.duration.min=i.duration.min}if(Number.isFinite(i.duration.max)){t.duration.max=i.duration.max}}else if(Number.isFinite(i.duration)){t.duration.min=t.duration.max=i.duration}}if(i.blendMode&&l[i.blendMode]){t.blendMode=l[i.blendMode]}if(i.speed&&typeof i.speed==="object"){if(Number.isFinite(i.speed.x)){t.speed.x=i.speed.x}if(Number.isFinite(i.speed.y)){t.speed.y=i.speed.y}if(Number.isFinite(i.speed.z)){t.speed.z=i.speed.z}if(Number.isFinite(i.speed.xyzmin)){t.speed.xyzmin=i.speed.xyzmin}if(Number.isFinite(i.speed.xyzmax)){t.speed.xyzmax=i.speed.xyzmax}}if(i.altSpeed===null){t.altSpeed=null}else if(i.altSpeed&&typeof i.altSpeed==="object"){if(!t.altSpeed){t.altSpeed={x:0,y:0,z:0}}if(Number.isFinite(i.altSpeed.x)){t.altSpeed.x=i.altSpeed.x}if(Number.isFinite(i.altSpeed.y)){t.altSpeed.y=i.altSpeed.y}if(Number.isFinite(i.altSpeed.z)){t.altSpeed.z=i.altSpeed.z}}if(i.speedFactorGradient===null){t.speedFactorGradient=null}else if(Array.isArray(i.speedFactorGradient)&&i.speedFactorGradient.length>=2){if(t.speedFactorGradient){t.speedFactorGradient.length=0}else{t.speedFactorGradient=[]}for(s of i.speedFactorGradient){n={t:0,min:1,max:1};t.speedFactorGradient.push(n);if(Number.isFinite(s.t)){n.t=s.t}if(Number.isFinite(s.v)){n.min=n.max=s.v}else{if(Number.isFinite(s.min)){n.min=s.min}if(Number.isFinite(s.max)){n.max=s.max}}}}if(i.acceleration&&typeof i.acceleration==="object"){if(Number.isFinite(i.acceleration.x)){t.acceleration.x=i.acceleration.x}if(Number.isFinite(i.acceleration.y)){t.acceleration.y=i.acceleration.y}if(Number.isFinite(i.acceleration.z)){t.acceleration.z=i.acceleration.z}}if(i.rotation!==undefined){if(typeof i.rotation==="object"){if(Number.isFinite(i.rotation.min)){t.rotation.min=i.rotation.min}if(Number.isFinite(i.rotation.max)){t.rotation.max=i.rotation.max}}else if(Number.isFinite(i.rotation)){t.rotation.min=t.rotation.max=i.rotation}}if(i.rotationSpeed!==undefined){if(typeof i.rotationSpeed==="object"){if(Number.isFinite(i.rotationSpeed.min)){t.rotationSpeed.min=i.rotationSpeed.min}if(Number.isFinite(i.rotationSpeed.max)){t.rotationSpeed.max=i.rotationSpeed.max}}else if(Number.isFinite(i.rotationSpeed)){t.rotationSpeed.min=t.rotationSpeed.max=i.rotationSpeed}}if(i.rotationSpeedGradient===null){t.rotationSpeedGradient=null}else if(Array.isArray(i.rotationSpeedGradient)&&i.rotationSpeedGradient.length>=2){if(t.rotationSpeedGradient){t.rotationSpeedGradient.length=0}else{t.rotationSpeedGradient=[]}for(s of i.rotationSpeedGradient){n={t:0,min:1,max:1};t.rotationSpeedGradient.push(n);if(Number.isFinite(s.t)){n.t=s.t}if(Number.isFinite(s.v)){n.min=n.max=s.v}else{if(Number.isFinite(s.min)){n.min=s.min}if(Number.isFinite(s.max)){n.max=s.max}}}}if(i.size&&typeof i.size==="object"){if(Number.isFinite(i.size.x)){t.size.xmin=t.size.xmax=i.size.x}else{if(Number.isFinite(i.size.xmin)){t.size.xmin=i.size.xmin}if(Number.isFinite(i.size.xmax)){t.size.xmax=i.size.xmax}}if(Number.isFinite(i.size.y)){t.size.ymin=t.size.ymax=i.size.y}else{if(Number.isFinite(i.size.ymin)){t.size.ymin=i.size.ymin}if(Number.isFinite(i.size.ymax)){t.size.ymax=i.size.ymax}}if(Number.isFinite(i.size.xy)){t.size.xymin=t.size.xymax=i.size.xy}else{if(Number.isFinite(i.size.xymin)){t.size.xymin=i.size.xymin}if(Number.isFinite(i.size.xymax)){t.size.xymax=i.size.xymax}}}if(i.sizeGradient===null){t.sizeGradient=null}else if(Array.isArray(i.sizeGradient)&&i.sizeGradient.length>=2){if(t.sizeGradient){t.sizeGradient.length=0}else{t.sizeGradient=[]}for(s of i.sizeGradient){n={t:0,min:1,max:1};t.sizeGradient.push(n);if(Number.isFinite(s.t)){n.t=s.t}if(Number.isFinite(s.v)){n.min=n.max=s.v}else{if(Number.isFinite(s.min)){n.min=s.min}if(Number.isFinite(s.max)){n.max=s.max}}}}if(i.color===null){t.color=null}else if(i.color&&typeof i.color==="object"){if(!t.color){t.color={r:1,g:1,b:1,a:1}}if(Number.isFinite(i.color.r)){t.color.r=i.color.r}if(Number.isFinite(i.color.g)){t.color.g=i.color.g}if(Number.isFinite(i.color.b)){t.color.b=i.color.b}if(Number.isFinite(i.color.a)){t.color.a=i.color.a}}if(i.altColor===null){t.altColor=null}else if(i.altColor&&typeof i.altColor==="object"){if(!t.altColor){t.altColor={r:1,g:1,b:1,a:1}}if(Number.isFinite(i.altColor.r)){t.altColor.r=i.altColor.r}if(Number.isFinite(i.altColor.g)){t.altColor.g=i.altColor.g}if(Number.isFinite(i.altColor.b)){t.altColor.b=i.altColor.b}if(Number.isFinite(i.altColor.a)){t.altColor.a=i.altColor.a}}if(i.endColor===null){t.endColor=null}else if(i.endColor&&typeof i.endColor==="object"){if(!t.endColor){t.endColor={r:1,g:1,b:1,a:1}}if(Number.isFinite(i.endColor.r)){t.endColor.r=i.endColor.r}if(Number.isFinite(i.endColor.g)){t.endColor.g=i.endColor.g}if(Number.isFinite(i.endColor.b)){t.endColor.b=i.endColor.b}if(Number.isFinite(i.endColor.a)){t.endColor.a=i.endColor.a}}if(i.colorGradient===null){t.colorGradient=null}else if(Array.isArray(i.colorGradient)&&i.colorGradient.length>=2){if(t.colorGradient){t.colorGradient.length=0}else{t.colorGradient=[]}for(s of i.colorGradient){n={t:0,color:{r:1,g:1,b:1,a:1},altColor:null};t.colorGradient.push(n);if(Number.isFinite(s.t)){n.t=s.t}if(s.color){if(Number.isFinite(s.color.r)){n.color.r=s.color.r}if(Number.isFinite(s.color.g)){n.color.g=s.color.g}if(Number.isFinite(s.color.b)){n.color.b=s.color.b}if(Number.isFinite(s.color.a)){n.color.a=s.color.a}if(s.altColor){n.altColor={r:1,g:1,b:1,a:1};if(Number.isFinite(s.altColor.r)){n.altColor.r=s.altColor.r}if(Number.isFinite(s.altColor.g)){n.altColor.g=s.altColor.g}if(Number.isFinite(s.altColor.b)){n.altColor.b=s.altColor.b}if(Number.isFinite(s.altColor.a)){n.altColor.a=s.altColor.a}}}else{if(Number.isFinite(s.r)){n.color.r=s.r}if(Number.isFinite(s.g)){n.color.g=s.g}if(Number.isFinite(s.b)){n.color.b=s.b}if(Number.isFinite(s.a)){n.color.a=s.a}}}}if(i.billboard!==undefined){if(i.billboard&&h[i.billboard]){t.billboard=h[i.billboard]}else if(i.billboard){t.billboard="all"}else{t.billboard="none"}}console.warn("$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$ data.special.particleSystem",this.special.particleSystem);this.updateParticleSystem()}};a.prototype.updateParticleSystem=function(){var e,t,i,n,s=false,r=this.special.particleSystem,o=this.gScene.babylon.scene;console.warn("3D GEntityParticleSystem.updateParticleSystem()",this.texturePackObject,this.variantObject);if(this.babylon.texture){this.babylon.texture.dispose()}if(this.babylon.particleSystem){this.babylon.particleSystem.dispose()}var a=this.variantObject.frames[0].url;this.babylon.texture=e=new BABYLON.Texture(this.dom.cleanUrl(a),o);this.babylon.particleSystem=t=new BABYLON.ParticleSystem("particles",r.capacity,o);t.updateSpeed=r.updateRate*.01;t.particleTexture=e;if(r.attachToCamera){t.emitter=this.gScene.globalCamera.babylon.camera}else{t.emitter=new BABYLON.Vector3(0,0,0)}this.emitterShape=r.shape.type;switch(this.emitterShape){case"box":t.minEmitBox=new BABYLON.Vector3(r.shape.xmin,r.shape.ymin,r.shape.zmin);t.maxEmitBox=new BABYLON.Vector3(r.shape.xmax,r.shape.ymax,r.shape.zmax);break;case"sphere":s=true;i=t.createSphereEmitter();i.radius=r.shape.maxRadius;i.radiusRange=1-r.shape.minRadius/r.shape.maxRadius;break;case"hemisphere":s=true;i=t.createHemisphericEmitter();i.radius=r.shape.maxRadius;i.radiusRange=1-r.shape.minRadius/r.shape.maxRadius;break;case"cylinder":s=true;i=t.createCylinderEmitter();i.radius=r.shape.maxRadius;i.radiusRange=1-r.shape.minRadius/r.shape.maxRadius;i.height=r.shape.height;break;case"cone":s=true;i=t.createConeEmitter();i.radius=r.shape.maxRadius;i.radiusRange=1-r.shape.minRadius/r.shape.maxRadius;i.angle=r.shape.angle;break}t.emitRate=r.emitRate;t.minLifeTime=r.duration.min;t.maxLifeTime=r.duration.max;t.blendMode=r.blendMode;if(!s){t.direction1=new BABYLON.Vector3(r.speed.x,+r.speed.y,+r.speed.z);t.direction2=r.altSpeed?new BABYLON.Vector3(r.altSpeed.x,r.altSpeed.y,r.altSpeed.z):new BABYLON.Vector3(r.speed.x,+r.speed.y,+r.speed.z)}t.minEmitPower=r.speed.xyzmin;t.maxEmitPower=r.speed.xyzmax;if(r.speedFactorGradient){for(n of r.speedFactorGradient){t.addVelocityGradient(n.t,n.min,n.max)}}t.minInitialRotation=r.rotation.min;t.maxInitialRotation=r.rotation.max;t.minAngularSpeed=r.rotationSpeed.min;t.maxAngularSpeed=r.rotationSpeed.max;if(r.rotationSpeedGradient){for(n of r.rotationSpeedGradient){t.addAngularSpeedGradient(n.t,n.min,n.max)}}t.gravity=new BABYLON.Vector3(r.acceleration.x,r.acceleration.y,r.acceleration.z);t.minScaleX=r.size.xmin;t.maxScaleX=r.size.xmax;t.minScaleY=r.size.ymin;t.maxScaleY=r.size.ymax;t.minSize=r.size.xymin;t.maxSize=r.size.xymax;if(r.sizeGradient){for(n of r.sizeGradient){t.addSizeGradient(n.t,n.min,n.max)}}t.color1=new BABYLON.Color4(r.color.r,r.color.g,r.color.b,r.color.a);t.color2=r.altColor?new BABYLON.Color4(r.altColor.r,r.altColor.g,r.altColor.b,r.altColor.a):new BABYLON.Color4(r.color.r,r.color.g,r.color.b,r.color.a);t.colorDead=r.endColor?new BABYLON.Color4(r.endColor.r,r.endColor.g,r.endColor.b,r.endColor.a):new BABYLON.Color4(r.color.r,r.color.g,r.color.b,r.color.a);if(r.colorGradient){for(n of r.colorGradient){t.addColorGradient(n.t,new BABYLON.Color4(n.color.r,n.color.g,n.color.b,n.color.a),n.altColor?new BABYLON.Color4(n.altColor.r,n.altColor.g,n.altColor.b,n.altColor.a):undefined)}}switch(r.billboard){case"none":t.isBillboardBased=false;break;case"y":t.isBillboardBased=true;t.billboardMode=BABYLON.ParticleSystem.BILLBOARDMODE_Y;break;case"all":default:t.isBillboardBased=true;t.billboardMode=BABYLON.ParticleSystem.BILLBOARDMODE_ALL;break}t.renderingGroupId=1;t.start()};a.prototype.updateMaterial=function(){this.updateMaterialNeeded=false;return};a.prototype.updateMesh=function(){this.updateMeshNeeded=false;return};a.prototype.updateOrigin=function(e,t=false){};a.prototype.updatePosition=function(e,t=false){var i=this.babylon.particleSystem,n=this.gScene.babylon.scene;if(!i||this.special.particleSystem.attachToCamera){return}var s=e.position.x!==undefined?e.position.x:this.position.x,r=e.position.y!==undefined?e.position.y:this.position.y,o=e.position.z!==undefined?e.position.z:this.position.z;if(!t){this.position.x=s;this.position.y=r;this.position.z=o}if(e.transition){e.transition.createAnimation(n,i,"emitter",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(s,r,o))}else{i.emitter.set(s,r,o)}};a.prototype.updateRotation=function(e,t=false){};a.prototype.updateSize=function(e,t=false,i=false){}},{"./GEntity.js":3,"./GTransition.js":20,"./vectorUtils.js":26,seventh:51}],13:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.updateMeshNeeded=this.updateMaterialNeeded=false}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.isLocalLight=true;a.prototype.updatePosition=function(e,t=false){var i=this.babylon.light,n=this.gScene.babylon.scene;if(!i){return}var s=e.position.x!==undefined?e.position.x:this.position.x,r=e.position.y!==undefined?e.position.y:this.position.y,o=e.position.z!==undefined?e.position.z:this.position.z;if(!t){this.position.x=s;this.position.y=r;this.position.z=o}if(e.transition){e.transition.createAnimation(n,i,"position",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(s,r,o))}else{i.position.set(s,r,o)}};a.prototype.updateMaterialParams=function(){};a.prototype.createLight=function(){var e=this.gScene.babylon.scene;if(this.babylon.light){console.warn("GEntityPointLight.createLight(): light is already existing");return}if(!this.special.light){this.special.light={diffuse:new BABYLON.Color3(1,1,1),specular:new BABYLON.Color3(.5,.5,.5),intensity:1}}this.babylon.light=new BABYLON.PointLight("pointLight",new BABYLON.Vector3(this.position.x,this.position.y,this.position.z),e);this.babylon.light.diffuse=this.special.light.diffuse;this.babylon.light.specular=this.special.light.specular;this.babylon.light.intensity=this.special.light.intensity;if(this.isLocalLight){this.registerLocalLight()}}},{"./GEntity.js":3,"./GTransition.js":20,"./vectorUtils.js":26,seventh:51}],14:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i)}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.updateMaterial=function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;this.babylon.material=e=new BABYLON.StandardMaterial("spriteMaterial",i);e.backFaceCulling=true;e.diffuseTexture=new BABYLON.Texture("/textures/shadow.png",i);e.diffuseTexture.wrapU=e.diffuseTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;e.diffuseTexture.hasAlpha=true;e.useAlphaFromDiffuseTexture=true;e.transparencyMode=BABYLON.Material.MATERIAL_ALPHABLEND;e.disableLighting=true;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};a.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.Mesh.CreatePlane("shadow",undefined,t);e.rotation.x=Math.PI/2;e.bakeCurrentTransformIntoVertices();if(this.parent){this.updateMeshParent()}console.warn("Mesh:",e);this.updateMeshNeeded=false;return e}},{"./GEntity.js":3,"./GTransition.js":20,"./vectorUtils.js":26,seventh:51}],15:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.updateMeshNeeded=this.updateMaterialNeeded=false;console.error("Not supported ATM!")}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a},{"./GEntity.js":3,"./GTransition.js":20,"./vectorUtils.js":26,seventh:51}],16:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const a=e("./vectorUtils.js");const r=e("seventh");function o(e,t,i){n.call(this,e,t,i);this.autoFacing=this.autoFacing.bind(this)}o.prototype=Object.create(n.prototype);o.prototype.constructor=o;t.exports=o;o.prototype.forceZScalingToX=true;o.prototype.updateSpecialStage1=function(e){n.prototype.updateSpecialStage1.call(this,e);if(e.special.spriteAutoFacing!==undefined&&(e.special.spriteAutoFacing===false||a.radToSector[e.special.spriteAutoFacing])&&e.special.spriteAutoFacing!==this.special.spriteAutoFacing){this.special.spriteAutoFacing=e.special.spriteAutoFacing;if(this.special.spriteAutoFacing){this.gScene.on("render",this.autoFacing)}else{this.gScene.off("render",this.autoFacing)}}};o.prototype.updateFacing=function(e){this.facing=e;if(this.special.spriteAutoFacing){this.autoFacing()}};o.prototype.updateMaterial=async function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;console.warn("3D GEntitySprite.updateMaterial()",this.texturePackObject,this.variantObject);this.babylon.material=e=new BABYLON.StandardMaterial("spriteMaterial",i);e.backFaceCulling=true;e.ambientColor=new BABYLON.Color3(1,1,1);var s=this.frameObject.maps&&(this.frameObject.maps.diffuse||this.frameObject.maps.albedo)||this.frameObject.url;e.diffuseTexture=this.getTexture(s);e.diffuseTexture.hasAlpha=true;e.diffuseTexture.wrapU=e.diffuseTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;var r=this.frameObject.maps&&(this.frameObject.maps.normal||this.frameObject.maps.bump);if(r){e.bumpTexture=this.getTexture(r);e.bumpTexture.wrapU=e.bumpTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;e.invertNormalMapX=true;e.invertNormalMapY=true}var o=this.frameObject.maps&&this.frameObject.maps.specular;if(o){e.specularTexture=this.getTexture(o);e.specularTexture.wrapU=e.specularTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;e.useGlossinessFromSpecularMapAlpha=true}else{e.specularColor=new BABYLON.Color3(0,0,0)}var a=!this.frameObject.xFlip!==!this.clientMods.xFlip,l=this.frameObject.yFlip;this.flipTexture(e.diffuseTexture,a,l);if(e.bumpTexture){this.flipTexture(e.bumpTexture,a,l)}if(e.specularTexture){this.flipTexture(e.specularTexture,a,l)}if(this.frameObject.origin){let e;if(!a&&!l){e=this.frameObject.origin}else{e={x:(a?-this.frameObject.origin.x:this.frameObject.origin.x)||0,y:(l?-this.frameObject.origin.y:this.frameObject.origin.y)||0,z:this.frameObject.origin.z||0}}this.updateOrigin(e,true)}if(this.texturePackObject.pixelDensity){this.updateSizeFromPixelDensity(e.diffuseTexture,this.texturePackObject.pixelDensity)}else if(this.frameObject.relSize){this.updateSize(this.frameObject.relSize,false,true)}e.backFaceCulling=false;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};o.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.Mesh.CreatePlane("sprite",undefined,t);e.billboardMode=BABYLON.AbstractMesh.BILLBOARDMODE_X|BABYLON.AbstractMesh.BILLBOARDMODE_Y;if(this.parent){this.updateMeshParent()}console.warn("Sprite Mesh:",e);this.updateMeshNeeded=false;return e};o.prototype.updateBillboard=function(){};o.prototype.autoFacing=function(e=null){if(e){if(!e.camera&&!this.parametric){return}}var t,i=this.babylon.mesh,n=i.position,s=this.gScene.globalCamera.babylon.camera.position,r=a.facingAngleRad(s,n,this.facing),o=a.radToSector[this.special.spriteAutoFacing](r);if(this.frameObject.zOffset!==null){t=s.subtract(n);t.y=0;t.normalize().scaleInPlace(this.frameObject.zOffset*this.size.y);this.updatePosition({position:t},false,true)}if(this.clientMods.variant!==o){this.clientMods.variant=o;this.clientMods.xFlipVariant=a.xFlipSector[o];this.refreshMaterial()}}},{"./GEntity.js":3,"./GTransition.js":20,"./vectorUtils.js":26,seventh:51}],17:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GEntityFloatingText.js");function r(e,t,i){s.call(this,e,t,i);this.special.content.textSize=.05;this.iconOffset=0;this.safeIconOffset=false;this.blinkSafe=false}r.prototype=Object.create(s.prototype);r.prototype.constructor=r;t.exports=r;r.prototype.destroy=function(){if(this.babylon.textBlock){this.babylon.textBlock.dispose()}if(this.babylon.icon){this.babylon.icon.dispose()}n.prototype.destroy.call(this)};r.prototype.updateMaterial=function(){var e,t=this.gScene.getUi();console.warn("3D GEntityUiFloatingText.updateMaterial()");if(this.babylon.textBlock){e=this.babylon.textBlock}else{this.babylon.textBlock=e=new BABYLON.GUI.TextBlock;e.text=this.special.content.text;e.color=this.special.content.textColor;e.alpha=this.opacity;e.resizeToFit=true;t.addControl(e);if(this.parent){e.linkWithMesh(this.parent.babylon.mesh);if(!this.blinkSafe){e.alpha=0;setTimeout(()=>{this.blinkSafe=true;e.alpha=this.opacity},20)}}}this.updateMaterialNeeded=false};r.prototype.updateOpacity=function(e,t=false){if(!this.blinkSafe){setTimeout(()=>{this.blinkSafe=true;this.updateOpacity(e,t)},20);return}s.prototype.updateOpacity.call(this,e,t)};const o=.8;r.prototype.updateContent=function(e){var t=this.gScene.getUi(),i=t.getSize(),n=this.babylon.textBlock;if(!n){return}if(e.text!==undefined){this.safeIconOffset=false;n.text=this.special.content.text=""+e.text}if(typeof e.textSize==="number"){this.safeIconOffset=false;this.special.content.textSize=e.textSize;n.fontSizeInPixels=Math.round(e.textSize*i.height)}if(typeof e.textColor==="string"){n.color=this.special.content.textColor=e.textColor}if(typeof e.outlineColor==="string"){n.outlineColor=this.special.content.outlineColor=e.outlineColor}if(typeof e.outlineWidth==="number"){this.special.content.outlineWidth=e.outlineWidth;n.outlineWidth=Math.round(e.outlineWidth*i.height)}if(typeof e.shadowColor==="string"){n.shadowColor=this.special.content.shadowColor=e.shadowColor}if(typeof e.shadowBlur==="number"){this.special.content.shadowBlur=e.shadowBlur;n.shadowBlur=Math.round(e.shadowBlur*i.height)}if(e.icon){this.updateContentIcon(e)}};r.prototype.updateContentIcon=function(e){var t,i=this.gScene.getUi(),n=this.babylon.textBlock;if(this.babylon.icon){t=this.babylon.icon;t.source=this.dom.cleanUrl(e.icon);t.width=n.fontSizeInPixels*o;t.height=n.fontSizeInPixels*o}else{this.babylon.icon=t=new BABYLON.GUI.Image("icon",this.dom.cleanUrl(e.icon));t.widthInPixels=n.fontSizeInPixels*o;t.heightInPixels=n.fontSizeInPixels*o;i.addControl(t);if(this.parent){t.linkWithMesh(this.parent.babylon.mesh);if(!this.blinkSafe){t.alpha=0;setTimeout(()=>{this.blinkSafe=true;t.alpha=this.opacity},20)}}}this.updateContentIconOffset(()=>{if(this.parent){t.linkOffsetXInPixels=n.linkOffsetXInPixels-this.iconOffset}else{t.leftInPixels=n.leftInPixels-this.iconOffset}})};r.prototype.updateContentIconOffset=function(e=null,t=false){var i=this.babylon.icon,n=this.babylon.textBlock;if(t){this.safeIconOffset=true}if(!this.safeIconOffset||!n._width.isPixel&&!t){setTimeout(()=>this.updateContentIconOffset(e,true),20);return}this.iconOffset=Math.round(i.widthInPixels/2+n.fontSizeInPixels/4+(n._width.isPixel?n.widthInPixels/2:n.fontSizeInPixels));if(e){e()}};r.prototype.updateMesh=function(){this.updateMeshNeeded=false;return};r.prototype.updateSpecialStage2=function(e){if(e.special&&e.special.content){this.updateContent(e.special.content)}};r.prototype.updatePosition=function(e,t=false){var i=this.babylon.textBlock,n=this.babylon.icon;if(n&&!this.safeIconOffset){this.updateContentIconOffset(()=>this.updatePosition(e,t));return}var s=this.gScene.getUi(),r=s.getSize(),o=this.gScene.babylon.scene;var a,l=e.position.x!==undefined?e.position.x:this.position.x,c=e.position.y!==undefined?e.position.y:this.position.y;if(!t){this.position.x=l;this.position.y=c}l=-l*r.width/2;c=-c*r.height/2;a=l-this.iconOffset;if(this.parent){if(e.transition){e.transition.createAnimation(o,i,"linkOffsetXInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,l);e.transition.createAnimation(o,i,"linkOffsetYInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,c);if(n){e.transition.createAnimation(o,n,"linkOffsetXInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,a);e.transition.createAnimation(o,n,"linkOffsetYInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,c)}}else{i.linkOffsetXInPixels=l;i.linkOffsetYInPixels=c;if(n){n.linkOffsetXInPixels=a;n.linkOffsetYInPixels=c}}}else if(e.transition){e.transition.createAnimation(o,i,"leftInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,l);e.transition.createAnimation(o,i,"topInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,c);if(n){e.transition.createAnimation(o,n,"leftInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,a);e.transition.createAnimation(o,n,"topInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,c)}}else{i.leftInPixels=l;i.topInPixels=c;if(n){n.leftInPixels=a;n.topInPixels=c}}}},{"./GEntity.js":3,"./GEntityFloatingText.js":8}],18:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i)}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.useVg=true;a.prototype.forceZScalingToX=true;a.prototype.updateMaterial=async function(){var e,t=this.special.vgObject,i=this.babylon.material,n=this.gScene.babylon.scene,s=this.babylon.mesh;if(!t){console.error("No VG object!");return}console.warn("3D GEntityVg.updateMaterial()");this.babylon.material=e=new BABYLON.StandardMaterial("vgMaterial",n);e.ambientColor=new BABYLON.Color3(1,1,1);var r={width:t.viewBox.width,height:t.viewBox.height};e.diffuseTexture=new BABYLON.DynamicTexture("vgDynamicTexture",r,n);e.diffuseTexture.hasAlpha=true;e.diffuseTexture.wrapU=e.diffuseTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;var o=e.diffuseTexture.getContext();await t.renderCanvas(o);e.diffuseTexture.update();if(this.special.vgPixelDensity){this.updateSizeFromPixelDensity(e.diffuseTexture,this.special.vgPixelDensity)}e.backFaceCulling=false;if(!s){s=this.updateMesh()}s.material=e;if(i){i.dispose(false,false,true)}this.updateMaterialNeeded=false};a.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.Mesh.CreatePlane("vg",undefined,t);if(this.parent){this.updateMeshParent()}console.warn("Vg Mesh:",e);this.updateMeshNeeded=false;return e}},{"./GEntity.js":3,"./GTransition.js":20,"./vectorUtils.js":26,seventh:51}],19:[function(e,t,i){"use strict";const s=e("./Camera.js");const n=e("./widgets/Message.js");const r=e("./widgets/Choices.js");const o=e("./widgets/TextInput.js");const a=e("./GTransition.js");const l=e("nextgen-events/lib/LeanEvents.js");const c=e("seventh");function h(e,t){this.dom=e;this.engineId=t.engineId;this.controller=this.dom.controller;this.active=false;this.paused=false;this.persistent=false;this.theme="default";this.special={};this.engine={};this.texturePacks={};this.gEntityLocations={};this.gEntities={};this.parametricGEntities=new Set;this.noLocalLightingGEntities=new Set;this.localLightGEntities=new Set;this.animationFunctions=new Set;this.navigationByKey=false;this.mainChoices=null;this.mainTextInput=null;this.globalCamera=null;this.roleCamera=null;this.$gscene=document.createElement("canvas");this.$gscene.classList.add("gscene");this.$gscene.style.visibility="hidden";this.dom.$gfx.append(this.$gscene);this.resizeObserver=null;this.changes={camera:false};this.babylon={engine:null,scene:null,diceRollerScene:null,ui:null};this.initScene()}h.prototype=Object.create(l.prototype);h.prototype.constructor=h;t.exports=h;h.prototype.childrenWidthInPixelsRequired=false;h.prototype.childrenHeightInPixelsRequired=false;h.prototype.initScene=function(){var e=this.babylon.engine=new BABYLON.Engine(this.$gscene,true);var n=this.babylon.scene=new BABYLON.Scene(e);n.autoClear=false;n.autoClearDepthAndStencil=false;n.setRenderingAutoClearDepthStencil(1,false);this.globalCamera=new s(this);e.runRenderLoop(()=>{var e,t,i=Date.now()/1e3;if(this.parametricGEntities.size){for(e of this.parametricGEntities){e.parametricUpdate(i)}}if(this.animationFunctions.size){for(t of this.animationFunctions){t(i)}}this.emit("render",this.changes);this.changes.camera=false;n.render();if(this.babylon.diceRollerScene){this.babylon.diceRollerScene.render()}});this.resizeObserver=new ResizeObserver(()=>e.resize());this.resizeObserver.observe(this.$gscene)};h.prototype.update=function(e,t=false,i=false){console.warn("3D GScene.update()",e);var n;if(e.transition){if(i){delete e.transition}else{e.transition=new a(e.transition)}}if(e.active!==undefined){this.active=!!e.active;this.$gscene.style.visibility=this.active?"visible":"hidden"}if(e.paused!==undefined){this.paused=!!e.paused}if(e.persistent!==undefined){this.persistent=!!e.persistent}if(e.theme!==undefined){this.theme=e.theme||"default"}if(e.special&&typeof e.special==="object"){if(e.special.ambient){this.updateAmbient(e)}if(typeof e.special.contrast==="number"){this.updateContrast(e)}if(typeof e.special.exposure==="number"){this.updateExposure(e)}if(e.special.colorGrading){this.updateColorGrading(e)}if(e.special.colorCurves){this.updateColorCurves(e)}if(e.special.vignette){this.updateVignette(e)}}if(e.engine&&typeof e.engine==="object"){Object.assign(this.engine,e.engine)}if(e.globalCamera!==undefined){this.globalCamera.update(e.globalCamera)}return t&&e.transition&&e.transition.promise||c.resolved};h.prototype.updateAmbient=function(e){console.warn(".updateAmbient()",this.special.ambient);var t=this.babylon.scene;if(!e.special.ambient||typeof e.special.ambient!=="object"){return}if(!this.special.ambient){this.special.ambient=new BABYLON.Color3(0,0,0)}Object.assign(this.special.ambient,e.special.ambient);if(e.transition){e.transition.createAnimation(t,t,"ambientColor",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(this.special.ambient.r,this.special.ambient.g,this.special.ambient.b))}else{t.ambientColor.set(this.special.ambient.r,this.special.ambient.g,this.special.ambient.b)}};h.prototype.updateContrast=function(e){console.warn(".updateContrast()",this.special.contrast);var t=this.babylon.scene;this.special.contrast=e.special.contrast;if(e.transition){e.transition.createAnimationFn(this,t.imageProcessingConfiguration,"contrast",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.contrast)}else{t.imageProcessingConfiguration.contrast=this.special.contrast}};h.prototype.updateExposure=function(e){console.warn(".updateExposure()",this.special.exposure);var t=this.babylon.scene;this.special.exposure=e.special.exposure;if(e.transition){e.transition.createAnimationFn(this,t.imageProcessingConfiguration,"exposure",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.exposure)}else{t.imageProcessingConfiguration.exposure=this.special.exposure}};const u=new Set(["globalHue","globalDensity","globalSaturation","highlightsHue","highlightsDensity","highlightsSaturation","shadowsHue","shadowsDensity","shadowsSaturation"]);h.prototype.updateColorCurves=function(e){console.warn(".updateColorCurves()",this.special.colorCurves);var t,i=e.special.colorCurves,n=this.babylon.scene;if(!i){if(this.special.colorCurves){this.special.colorCurves=null}n.imageProcessingConfiguration.colorCurvesEnabled=false;return}if(typeof i!=="object"){return}n.imageProcessingConfiguration.colorCurvesEnabled=true;if(!this.special.colorCurves){this.special.colorCurves={}}if(!n.imageProcessingConfiguration.colorCurves){n.imageProcessingConfiguration.colorCurves={globalHue:0,globalDensity:0,globalSaturation:0,highlightsHue:0,highlightsDensity:0,highlightsSaturation:0,shadowsHue:0,shadowsDensity:0,shadowsSaturation:0}}for(t in i){if(!u.has(t)&&typeof i[t]!=="number"){continue}this.special.colorCurves[t]=i[t];if(e.transition){e.transition.createAnimationFn(this,n.imageProcessingConfiguration.colorCurves,t,BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.colorCurves[t])}else{n.imageProcessingConfiguration.colorCurves[t]=this.special.colorCurves[t]}}};const p={stretch:"vignetteStretch",centerX:"vignetteCentreX",centerY:"vignetteCentreY",weight:"vignetteWeight"};h.prototype.updateVignette=function(e){console.warn(".updateVignette()",this.special.vignette);var t,i,n=e.special.vignette,s=this.babylon.scene;if(!n){if(this.special.vignette){this.special.vignette=null}s.imageProcessingConfiguration.vignetteEnabled=false;return}if(typeof n!=="object"){return}s.imageProcessingConfiguration.vignetteEnabled=true;if(!this.special.vignette){this.special.vignette={}}if(!s.imageProcessingConfiguration.vignette){}for(t in n){i=p[t];if(!i){continue}this.special.vignette[t]=n[t];if(e.transition){e.transition.createAnimationFn(this,s.imageProcessingConfiguration,i,BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.vignette[t])}else{s.imageProcessingConfiguration[i]=this.special.vignette[t]}}if(n.color){this.special.vignette.color=n.color;if(e.transition){e.transition.createAnimationFn(this,s.imageProcessingConfiguration,"vignetteColor",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(n.color.r,n.color.g,n.color.b))}else{s.imageProcessingConfiguration.vignetteColor.set(n.color.r,n.color.g,n.color.b)}}if(n.blendMode){switch(n.blendMode){case"multiply":this.special.vignette.blendMode=0;break;case"opaque":default:this.special.vignette.blendMode=1;break}s.imageProcessingConfiguration.vignetteBlendMode=this.special.vignette.blendMode}};h.prototype.updateColorGrading=function(e){console.warn(".updateColorGrading()",this.special.colorGrading);var t=this.babylon.scene,i=e.special.colorGrading,n,s,r=false,o;if(!i){if(this.special.colorGrading){this.special.colorGrading=null}t.imageProcessingConfiguration.colorGradingEnabled=false;if(t.imageProcessingConfiguration.colorGradingTexture){t.imageProcessingConfiguration.colorGradingTexture.dispose()}return}if(typeof i!=="object"){return}if(i.url&&typeof i.url==="string"){n=this.dom.cleanUrl(i.url)}if(!this.special.colorGrading){if(!n){return}this.special.colorGrading={url:n,level:typeof i.level==="number"?i.level:1};o=new BABYLON.Texture(this.special.colorGrading.url,t,true,false);o.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE;o.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;t.imageProcessingConfiguration.colorGradingEnabled=true;t.imageProcessingConfiguration.colorGradingTexture=o;t.imageProcessingConfiguration.colorGradingWithGreenDepth=false;s=0;r=true}else{if(n&&n!==this.special.colorGrading.url){this.special.colorGrading.url=n;o=new BABYLON.Texture(this.special.colorGrading.url,t,true,false);o.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE;o.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;t.imageProcessingConfiguration.colorGradingTexture=o}else{o=t.imageProcessingConfiguration.colorGradingTexture}if(typeof i.level==="number"){s=this.special.colorGrading.level;r=true;this.special.colorGrading.level=i.level}}if(r){console.warn("level",s,this.special.colorGrading.level,e.transition);if(e.transition){e.transition.createAnimation(t,o,"level",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.colorGrading.level,s)}else{o.level=this.special.colorGrading.level}}};h.prototype.updateLightExcludedMeshes=function(){var e,t=[...this.noLocalLightingGEntities].map(e=>e.babylon.mesh);for(e of this.localLightGEntities){e.babylon.light.excludedMeshes=t}};h.prototype.hasGEntity=function(e){return e in this.gEntities};h.prototype.getGEntity=function(e){return this.gEntities[e]};h.prototype.registerGEntity=function(e,t){if(this.gEntities[e]){throw new Error("Entity '"+e+"' already exists for this gScene")}this.gEntities[e]=t};h.prototype.unregisterGEntity=function(e){delete this.gEntities[e]};h.prototype.removeGEntity=function(e){var t=this.gEntities[e];if(!t){return false}t.destroy();return true};h.prototype.getUi=function(){if(this.babylon.ui){return this.babylon.ui}this.babylon.ui=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("ui");return this.babylon.ui};h.prototype.setNavigationByKey=function(e){this.navigationByKey=!!e};h.prototype.addMessage=function(e,t){var i=new n(this.dom,this,e,t);return i.run()};h.prototype.addChoices=function(e,t,i,n){console.warn("3DGWS .addChoices()",e,t,i,n);if(this.mainChoices){this.clearChoices()}this.mainChoices=new r(this.dom,this,e,t,i,n);this.mainChoices.run()};h.prototype.clearChoices=function(){console.warn("3DGWS .clearChoices()");if(this.mainChoices){this.mainChoices.destroy()}};h.prototype.textInput=function(e){console.warn("3DGWS .textInput()");if(this.mainTextInput){this.mainTextInput.destroy()}this.mainTextInput=new o(this.dom,this,e);return this.mainTextInput.run(true)};h.prototype.textInputDisabled=function(e){console.warn("3DGWS .textInputDisabled()");if(this.mainTextInput){this.mainTextInput.destroy()}this.mainTextInput=new o(this.dom,this,e);return this.mainTextInput.runDisabled()}},{"./Camera.js":1,"./GTransition.js":20,"./widgets/Choices.js":29,"./widgets/Message.js":30,"./widgets/TextInput.js":32,"nextgen-events/lib/LeanEvents.js":41,seventh:51}],20:[function(e,t,i){"use strict";const u=e("seventh");const p=e("array-kit");function n(e){this.duration=.2;this.easing="linear";this.running=0;this.promise=null;if(e){this.update(e)}}t.exports=n;n.prototype.update=function(e){if(!e||typeof e!=="object"){return}if(e.duration!==undefined){this.duration=+e.duration||0}if(e.easing!==undefined){this.easing=e.easing||"linear"}return this};n.prototype.toString=function(e){return e+" "+this.duration+"s"+(" "+this.easing||"")};const f={circle:BABYLON.CircleEase,back:BABYLON.BackEase,bounce:BABYLON.BounceEase,cubic:BABYLON.CubicEase,elastic:BABYLON.ElasticEase,exponential:BABYLON.ExponentialEase,power:BABYLON.PowerEase,quadratic:BABYLON.QuadraticEase,quartic:BABYLON.QuarticEase,quintic:BABYLON.QuinticEase,sine:BABYLON.SineEase,bezier:BABYLON.BezierCurveEase};n.prototype.createAnimation=function(e,t,i,n,s,r=null){var o,a,l,c=30,h=Math.round(this.duration*c);a=new BABYLON.Animation("transition",i,c,n,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT,false);if(r===null){r=t[i];if(r&&typeof r==="object"&&r.clone){r=r.clone()}}l=[{frame:0,value:r},{frame:h,value:s}];a.setKeys(l);if(this.easing&&f[this.easing]){o=new f[this.easing];o.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT);a.setEasingFunction(o)}t.animations.push(a);if(!this.promise){this.promise=new u;this.promise.resolveTimeout(1e3*this.duration+20)}this.running++;e.beginAnimation(t,0,h,false,1,()=>{this.running--;e.removeAnimation(a);p.deleteValue(t.animations,a);if(this.running<=0){this.promise.resolve()}},undefined,false)};const d=[];d[BABYLON.Animation.ANIMATIONTYPE_COLOR3]=BABYLON.Animation.prototype.color3InterpolateFunction;d[BABYLON.Animation.ANIMATIONTYPE_COLOR4]=BABYLON.Animation.prototype.color4InterpolateFunction;d[BABYLON.Animation.ANIMATIONTYPE_FLOAT]=(e,t,i)=>e+i*(t-e);d[BABYLON.Animation.ANIMATIONTYPE_MATRIX]=BABYLON.Animation.prototype.matrixInterpolateFunction;d[BABYLON.Animation.ANIMATIONTYPE_QUATERNION]=BABYLON.Animation.prototype.quaternionInterpolateFunction;d[BABYLON.Animation.ANIMATIONTYPE_SIZE]=BABYLON.Animation.prototype.sizeInterpolateFunction;d[BABYLON.Animation.ANIMATIONTYPE_VECTOR2]=BABYLON.Animation.prototype.vector2InterpolateFunction;d[BABYLON.Animation.ANIMATIONTYPE_VECTOR3]=BABYLON.Animation.prototype.vector3InterpolateFunction;n.prototype.createAnimationFn=function(n,s,r,o,a,l=null){if(l===null){l=s[r];if(l&&typeof l==="object"&&l.clone){l=l.clone()}}var c=Date.now()/1e3;if(!this.promise){this.promise=new u;this.promise.resolveTimeout(1e3*this.duration+20)}this.running++;var h=e=>{var t,i=e-c;if(i>=this.duration){t=1;this.running--;n.animationFunctions.delete(h);if(this.running<=0){this.promise.resolve()}}else{t=i/this.duration}s[r]=d[o](l,a,t)};n.animationFunctions.add(h);return h}},{"array-kit":34,seventh:51}],21:[function(e,t,i){"use strict";const n=e("./browser-extension.js");const o=n.host.exports.op;const a=n.host.exports.xop;function s(e){this.var={};this.formula={};this.ctx={t:0,rt:0,tOffset:-Date.now()/1e3};this.computed={};this.stopAt=Infinity;this.cleanStop=false;this.update(e)}t.exports=s;function r(e){var t;for(t in e){delete e[t]}}s.prototype.update=function(e){if(e.reset){r(this.var);r(this.formula);r(this.ctx);r(this.computed);this.ctx.t=this.ctx.rt=0;this.ctx.tOffset=-Date.now()/1e3}else if(e.resetT){this.ctx.tOffset=-Date.now()/1e3}if(typeof e.stopAt==="number"){this.stopAt=e.stopAt}if(e.var){this.recursiveUpdate(this.var,e.var)}if(e.formula){this.recursiveUpdate(this.formula,e.formula,this.computed)}};s.prototype.recursiveUpdate=function(e,t,i){var n,s;for(n in t){s=t[n];if(s===null){delete e[n];if(i&&typeof i[n]==="object"){delete i[n]}}else if(typeof s==="boolean"||typeof s==="number"){e[n]=s}else if(typeof s==="string"){e[n]=new Function("op","xop","ctx","return ( "+s+" ) ;")}else if(typeof s==="object"){e[n]={};this.recursiveUpdate(e[n],s,i&&typeof i[n]==="object"?i[n]:null)}console.warn("########## k/v/V",n,s,e[n])}};s.prototype.compute=function(e,t){this.ctx.t=e+this.ctx.tOffset;if(this.ctx.t>this.stopAt){if(this.cleanStop){return null}this.ctx.t=this.stopAt;this.cleanStop=true}else if(this.ctx.t===this.stopAt){this.cleanStop=true}this.ctx.rt=this.ctx.t/this.stopAt;this.recursiveCompute(this.var,this.ctx);this.recursiveCompute(this.formula,this.computed,t);return this.computed};s.prototype.recursiveCompute=function(e,t,i){var n,s,r;for(n in e){s=e[n];r=i&&typeof i==="object"?i[n]:undefined;if(typeof s==="boolean"||typeof s==="number"){t[n]=s}else if(typeof s==="function"){this.ctx.base=r;t[n]=s(o,a,this.ctx)}else if(s&&typeof s==="object"){t[n]={};this.recursiveCompute(s,t[n],r)}}}},{"./browser-extension.js":22}],22:[function(e,t,i){"use strict";const n=e("exm/lib/BrowserExm.js");const s=e("path");const r=n.registerExtension({module:t,ns:"spellcast.web-client",id:"3dgws",exports:{},hooks:{init:async()=>{console.warn("Extension 3DGWS: starting init");await import(r.dirPath+"/babylonjs.js");await import(r.dirPath+"/babylonjs.gui.js");await import(r.dirPath+"/cannon.js");r.host.api.addEngine("3dgws",e("./engine.js"));console.warn("Extension 3DGWS fully loaded")}}});t.exports=r},{"./engine.js":23,"exm/lib/BrowserExm.js":40,path:54}],23:[function(e,t,i){"use strict";const n={};t.exports=n;n.GScene=e("./GScene.js");n.Camera=e("./Camera.js");n.GEntity=e("./GEntity.js");n.perUsageGEntity={hemisphericLight:e("./GEntityHemisphericLight.js"),directionalLight:e("./GEntityDirectionalLight.js"),pointLight:e("./GEntityPointLight.js"),spotLight:e("./GEntitySpotLight.js"),background:e("./GEntityBackground.js"),sprite:e("./GEntitySprite.js"),shadow:e("./GEntityShadow.js"),fx:e("./GEntityFx.js"),particleSystem:e("./GEntityParticleSystem.js"),floatingText:e("./GEntityFloatingText.js"),uiFloatingText:e("./GEntityUiFloatingText.js"),basicShape:e("./GEntityBasicShape.js"),ground:e("./GEntityGround.js"),vg:e("./GEntityVg.js"),card:e("./GEntityCard.js")};n.DiceRoller=e("./DiceRoller.js")},{"./Camera.js":1,"./DiceRoller.js":2,"./GEntity.js":3,"./GEntityBackground.js":4,"./GEntityBasicShape.js":5,"./GEntityCard.js":6,"./GEntityDirectionalLight.js":7,"./GEntityFloatingText.js":8,"./GEntityFx.js":9,"./GEntityGround.js":10,"./GEntityHemisphericLight.js":11,"./GEntityParticleSystem.js":12,"./GEntityPointLight.js":13,"./GEntityShadow.js":14,"./GEntitySpotLight.js":15,"./GEntitySprite.js":16,"./GEntityUiFloatingText.js":17,"./GEntityVg.js":18,"./GScene.js":19}],24:[function(e,t,i){"use strict";i.getUpmostBoxMeshFace=e=>{var t=e.rotationQuaternion;var i=new BABYLON.Vector3(0,0,0);BABYLON.Vector3.Right().rotateByQuaternionToRef(t,i);if(i.y>=Math.SQRT1_2){return 2}else if(i.y<=-Math.SQRT1_2){return 3}BABYLON.Vector3.Up().rotateByQuaternionToRef(t,i);if(i.y>=Math.SQRT1_2){return 4}else if(i.y<=-Math.SQRT1_2){return 5}BABYLON.Vector3.Forward().rotateByQuaternionToRef(t,i);if(i.y>=Math.SQRT1_2){return 0}else if(i.y<=-Math.SQRT1_2){return 1}return 0}},{}],25:[function(e,t,i){"use strict";const n=e("./browser-extension.js");const l=BABYLON.GUI.Control;const s={};t.exports=s;s.getContrastColorCode=(e,t=.5)=>{var i=n.host.exports.toolkit.hexToRgb(e);if(i.r+i.g+i.b>=192){i.r=Math.round(i.r*t);i.g=Math.round(i.g*t);i.b=Math.round(i.b*t)}else{i.r=Math.round(255-(255-i.r)*t);i.g=Math.round(255-(255-i.g)*t);i.b=Math.round(255-(255-i.b)*t)}return n.host.exports.toolkit.rgbToHex(i)};s.scaleSizeString=(e,t)=>{if(typeof e==="number"){return e*t}if(typeof e!=="string"){throw new TypeError("scaleSizeString: bad type: "+typeof e)}if(e.endsWith("px")){return Math.round(parseInt(e,10)*t)+"px"}return parseInt(e,10)*t};s.addToSizeString=(e,t)=>{if(typeof e==="number"){return e+t}if(typeof e!=="string"){throw new TypeError("addToSizeString: bad type: "+typeof e)}if(e.endsWith("px")){return Math.round(parseInt(e,10)+t)+"px"}return parseInt(e,10)+t};s.positionToAlignment=e=>{switch(e){case"top":return{horizontalAlignment:l.HORIZONTAL_ALIGNMENT_CENTER,verticalAlignment:l.VERTICAL_ALIGNMENT_TOP};case"bottom":return{horizontalAlignment:l.HORIZONTAL_ALIGNMENT_CENTER,verticalAlignment:l.VERTICAL_ALIGNMENT_BOTTOM};case"center":return{horizontalAlignment:l.HORIZONTAL_ALIGNMENT_CENTER,verticalAlignment:l.VERTICAL_ALIGNMENT_CENTER};case"top-left":return{horizontalAlignment:l.HORIZONTAL_ALIGNMENT_LEFT,verticalAlignment:l.VERTICAL_ALIGNMENT_TOP};case"bottom-left":return{horizontalAlignment:l.HORIZONTAL_ALIGNMENT_LEFT,verticalAlignment:l.VERTICAL_ALIGNMENT_BOTTOM};case"left":return{horizontalAlignment:l.HORIZONTAL_ALIGNMENT_LEFT,verticalAlignment:l.VERTICAL_ALIGNMENT_CENTER};case"top-right":return{horizontalAlignment:l.HORIZONTAL_ALIGNMENT_RIGHT,verticalAlignment:l.VERTICAL_ALIGNMENT_TOP};case"bottom-right":return{horizontalAlignment:l.HORIZONTAL_ALIGNMENT_RIGHT,verticalAlignment:l.VERTICAL_ALIGNMENT_BOTTOM};case"right":return{horizontalAlignment:l.HORIZONTAL_ALIGNMENT_RIGHT,verticalAlignment:l.VERTICAL_ALIGNMENT_CENTER};default:return{horizontalAlignment:l.HORIZONTAL_ALIGNMENT_CENTER,verticalAlignment:l.VERTICAL_ALIGNMENT_CENTER}}};s.getControlPositionRelativeTo=(e,t,i=e.horizontalAlignment,n=e.verticalAlignment,s=null,r=null)=>{var o=e._currentMeasure.left-t._currentMeasure.left,a=e._currentMeasure.top-t._currentMeasure.top;if(i===l.HORIZONTAL_ALIGNMENT_LEFT){if(s===1){o+=e._currentMeasure.width}else if(s===0){o+=e._currentMeasure.width/2}}else if(i===l.HORIZONTAL_ALIGNMENT_RIGHT){if(s===-1){o+=-t._currentMeasure.width}else if(s===0){o+=-t._currentMeasure.width+e._currentMeasure.width/2}else{o=-t._currentMeasure.width+e._currentMeasure.width}}else if(i===l.HORIZONTAL_ALIGNMENT_CENTER){if(s===-1){o+=-t._currentMeasure.width/2}else if(s===1){o+=-t._currentMeasure.width/2+e._currentMeasure.width}else{o+=(-t._currentMeasure.width+e._currentMeasure.width)/2}}if(n===l.VERTICAL_ALIGNMENT_TOP){if(r===1){a+=e._currentMeasure.height}else if(r===0){a+=e._currentMeasure.height/2}}else if(n===l.VERTICAL_ALIGNMENT_BOTTOM){if(r===-1){a+=-t._currentMeasure.height}else if(r===0){a+=-t._currentMeasure.height+e._currentMeasure.height/2}else{a=-t._currentMeasure.height+e._currentMeasure.height}}else if(n===l.VERTICAL_ALIGNMENT_CENTER){if(r===-1){a+=-t._currentMeasure.height/2}else if(r===1){a+=-t._currentMeasure.height/2+e._currentMeasure.height}else{a+=(-t._currentMeasure.height+e._currentMeasure.height)/2}}return{left:o,top:a}}},{"./browser-extension.js":22}],26:[function(e,t,i){"use strict";const l={};t.exports=l;const n=0,s=Math.PI/8,r=Math.PI/4,o=Math.PI/2,a=Math.PI*3/4,c=Math.PI,h=Math.PI*5/4,u=Math.PI*3/2,p=Math.PI*7/4,f=2*Math.PI;l.flatVectorsAngleRad=(e,t)=>l.normalizeAngleRad(Math.atan2(-t.x,t.z)-Math.atan2(-e.x,e.z));l.facingAngleRad=(e,t,i)=>l.normalizeAngleRad(i-Math.atan2(-(t.x-e.x),t.z-e.z));l.radToSector={};l.radToSector["ns"]=e=>e<=o||e>=u?"n":"s";l.radToSector["we"]=e=>e<=c?"w":"e";const d=["n","nw","w","sw","s","se","e","ne","n"];l.radToSector["8"]=e=>d[Math.floor((e+s)/r)];const y=["n","w","s","e","n"];l.radToSector["4"]=e=>y[Math.floor((e+r)/o)];const m=["nw","sw","se","ne"];l.radToSector["4-diag"]=e=>m[Math.floor(e/o)];l.xFlipSector={n:"n",ne:"nw",e:"w",se:"sw",s:"s",sw:"se",w:"e",nw:"ne"};l.cameraRotationFromOriginAndTarget=(e,t,i=0)=>{var n=t.x-e.x,s=t.y-e.y,r=t.z-e.z,o=Math.atan2(n,r),a=-l.epsilonAsin(s/Math.hypot(n,s,r));console.warn("[!] .rotationFromOriginAndTarget()",e,t,n,s,r,o);return new BABYLON.Vector3(a,o,i)};l.toCameraAlpha=e=>-l.PI_2-e;l.toCameraBeta=e=>l.PI_2-e;l.RAD_TO_DEG=180/Math.PI;l.DEG_TO_RAD=Math.PI/180;l.PI_2=Math.PI/2;l.normalizeAngleRad=e=>e>=n?e%f:f+e%f;var g=1e-10;var b=Math.round(1/g);l.setEpsilon=e=>{g=e;b=Math.round(1/e)};l.getEpsilon=()=>g;l.epsilonAcos=l.eacos=e=>{if(e>=-1&&e<=1){return Math.acos(e)}if(e>0){if(e<1+g){return 0}}else if(e>-1-g){return Math.PI}return NaN};l.epsilonAsin=l.easin=e=>{if(e>=-1&&e<=1){return Math.asin(e)}if(e>0){if(e<1+g){return Math.PI/2}}else if(e>-1-g){return Math.PI/2}return NaN}},{}],27:[function(e,t,i){"use strict";const n=e("../misc.js");const s=e("../browser-extension.js");const r=e("nextgen-events/lib/LeanEvents.js");const o=e("seventh");function a(e,t,i={},n=null){this.dom=e;this.gScene=t;this.parent=n??this.gScene;this.paddingRight=this.paddingLeft=this.paddingBottom=this.paddingTop=0;this.ninePatchImageUrl=null;this.containerRectStyle={};this.guiCreated=false;this.babylon={containerRect:null,boxImage:null}}a.prototype=Object.create(r.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.childrenWidthInPixelsRequired=false;a.prototype.childrenHeightInPixelsRequired=false;a.prototype.childrenMaxWidth=0;a.prototype.childrenMaxHeight=0;a.prototype.destroy=function(){if(this.babylon.containerRect){this.babylon.containerRect.dispose()}if(this.babylon.boxImage){this.babylon.boxImage.dispose()}};a.prototype.getUi=function(){return this.babylon.containerRect};a.prototype.run=function(){if(!this.guiCreated){this.createGUI()}this.destroy()};const l=a.THEME={default:{position:"center",panel:{width:.5,height:.2,opacity:1,backgroundColor:"green",borderColor:"orange",borderWidth:4,cornerRadius:20,padding:{left:"16px",right:"16px",top:"0px",bottom:"0px"}}}};a.prototype.createGUI=function(e,t=l.default){if(this.guiCreated){return}var i,n,s,r,o;r=e?.panel?.width??t?.panel?.width??.5;o=e?.panel?.height??t?.panel?.height??.2;console.warn(".childrenHeightInPixelsRequired:",this.parent.childrenHeightInPixelsRequired,o);if(this.parent.childrenHeightInPixelsRequired&&typeof o==="number"){o=o*this.parent.childrenMaxHeight+"px";console.warn("Set height to:",o)}i=this.babylon.containerRect=new BABYLON.GUI.Rectangle("containerRect");i.width=this.containerRectStyle.width=r;i.height=this.containerRectStyle.height=o;i.thickness=0;this.setControlAlignment(i,e?.position??t?.position);this.parent.getUi().addControl(i);console.warn("THEME: ",e,e?.panel?.ninePatchImage?.url??t?.panel?.ninePatchImage?.url);this.ninePatchImageUrl=e?.panel?.ninePatchImage?.url??t?.panel?.ninePatchImage?.url;if(this.ninePatchImageUrl){n=this.babylon.boxImage=new BABYLON.GUI.Image("boxImage",this.ninePatchImageUrl);n.stretch=BABYLON.GUI.Image.STRETCH_NINE_PATCH;n.sliceLeft=this.paddingLeft=e?.panel?.ninePatchImage?.sliceLeft??t?.panel?.ninePatchImage?.sliceLeft??0;n.sliceTop=this.paddingTop=e?.panel?.ninePatchImage?.sliceTop??t?.panel?.ninePatchImage?.sliceTop??0;n.sliceRight=e?.panel?.ninePatchImage?.sliceRight??t?.panel?.ninePatchImage?.sliceRight??n.width;n.sliceBottom=e?.panel?.ninePatchImage?.sliceBottom??t?.panel?.ninePatchImage?.sliceBottom??n.height;this.paddingRight=this.paddingLeft;this.paddingBottom=this.paddingTop;i.addControl(n)}else{this.containerRectStyle.opacity=e?.panel?.opacity??t?.panel?.opacity;this.containerRectStyle.backgroundColor=e?.panel?.backgroundColor??t?.panel?.backgroundColor;this.containerRectStyle.borderColor=e?.panel?.borderColor??t?.panel?.borderColor;this.containerRectStyle.borderWidth=e?.panel?.borderWidth??t?.panel?.borderWidth;this.containerRectStyle.cornerRadius=e?.panel?.cornerRadius??t?.panel?.cornerRadius;this.applyRectangleStyle(i,this.containerRectStyle)}this.babylon.containerRect.isPointerBlocker=true;this.guiCreated=true};a.prototype.setControlAlignment=function(e,t){switch(t){case"top":e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;break;case"bottom":e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;break;case"left":e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER;break;case"right":e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER;break;case"top-left":e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;break;case"top-right":e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;break;case"bottom-left":e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;break;case"bottom-right":e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;break;case"center":default:e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER;break}};a.prototype.applyRectangleStyle=function(e,t){console.warn("******** APPLY STYLE",t);if(t.width!==undefined){e.width=t.width}if(t.height!==undefined){e.height=t.height}if(t.opacity!==undefined){e.alpha=t.opacity}if(t.backgroundColor!==undefined){e.background=t.backgroundColor}if(t.borderColor!==undefined){e.color=t.borderColor}if(t.borderWidth!==undefined){e.thickness=t.borderWidth}if(t.cornerRadius!==undefined){e.cornerRadius=t.cornerRadius}}},{"../browser-extension.js":22,"../misc.js":25,"nextgen-events/lib/LeanEvents.js":41,seventh:51}],28:[function(e,t,i){"use strict";const r=e("./TextBox.js");const n=e("../misc.js");const s=e("../browser-extension.js");const o=e("tree-kit/lib/extend.js").bind(null,{deep:true});const a=e("seventh");function l(e,t,i,n={},s=null){r.call(this,e,t,i,n,s);this.containerRectHoverStyle={};this.containerRectPressedDownStyle={};this.hoverNinePatchImageUrl=null;this.pressedDownNinePatchImageUrl=null;this.onPress=null}l.prototype=Object.create(r.prototype);l.prototype.constructor=l;t.exports=l;l.prototype.destroy=function(){r.prototype.destroy.call(this)};l.prototype.run=function(e){if(!this.guiCreated){this.createGUI()}this.onPress=e};const c=l.THEME=o({},r.THEME,{default:{panel:{width:.25,height:.2,opacity:1,backgroundColor:"#496ad4",borderColor:"#ddd",borderWidth:2,cornerRadius:4,padding:{left:"10px",right:"10px",top:"4px",bottom:"4px"},hover:{opacity:1,backgroundColor:"#748dde",borderColor:"#eee",borderWidth:2},pressedDown:{size:.95,opacity:1,backgroundColor:"#748dde",borderColor:"#eee",borderWidth:2}},text:{color:"white"}}});l.prototype.createGUI=function(e=this.dom.themeConfig?.button?.default,t=c.default){if(this.guiCreated){return}r.prototype.createGUI.call(this,e,t);if(t?.panel?.hover){o(this.containerRectHoverStyle,t.panel.hover)}if(e?.panel?.hover){o(this.containerRectHoverStyle,e.panel.hover)}if(t?.panel?.pressedDown){o(this.containerRectPressedDownStyle,t.panel.pressedDown)}if(e?.panel?.pressedDown){o(this.containerRectPressedDownStyle,e.panel.pressedDown)}if(this.containerRectHoverStyle.size){this.containerRectHoverStyle.width=n.scaleSizeString(this.containerRectStyle.width,this.containerRectHoverStyle.size);this.containerRectHoverStyle.height=n.scaleSizeString(this.containerRectStyle.height,this.containerRectHoverStyle.size)}if(this.containerRectPressedDownStyle.size){this.containerRectPressedDownStyle.width=n.scaleSizeString(this.containerRectStyle.width,this.containerRectPressedDownStyle.size);this.containerRectPressedDownStyle.height=n.scaleSizeString(this.containerRectStyle.height,this.containerRectPressedDownStyle.size)}this.babylon.containerRect.hoverCursor="pointer";this.babylon.containerRect.onPointerEnterObservable.add(()=>this.onPointerEnter());this.babylon.containerRect.onPointerOutObservable.add(()=>this.onPointerOut());this.babylon.containerRect.onPointerDownObservable.add(()=>this.onPointerDown());this.babylon.containerRect.onPointerUpObservable.add(()=>this.onPointerUp())};l.prototype.onPointerEnter=function(){this.emit("mouseInteracting");this.hover()};l.prototype.onPointerOut=function(){this.emit("mouseInteracting");this.standingBy()};l.prototype.onPointerDown=function(){this.emit("mouseInteracting");this.pressDown()};l.prototype.onPointerUp=function(){this.emit("mouseInteracting");this.pressUp()};l.prototype.standingBy=function(){console.warn("!!!!! ENTERING .standingBy()");if(this.babylon.containerRect){this.applyRectangleStyle(this.babylon.containerRect,this.containerRectStyle)}};l.prototype.hover=function(){console.warn("!!!!! ENTERING .hover()");if(this.babylon.containerRect){this.applyRectangleStyle(this.babylon.containerRect,this.containerRectHoverStyle)}};l.prototype.pressDown=function(){if(this.babylon.containerRect){this.applyRectangleStyle(this.babylon.containerRect,this.containerRectPressedDownStyle)}};l.prototype.pressUp=function(){this.standingBy();if(this.onPress){this.onPress()}}},{"../browser-extension.js":22,"../misc.js":25,"./TextBox.js":31,seventh:51,"tree-kit/lib/extend.js":53}],29:[function(e,t,i){"use strict";const a=e("./Button.js");const l=e("../misc.js");const n=e("../browser-extension.js");const r=BABYLON.GUI.Control;const s=e("tree-kit/lib/extend.js").bind(null,{deep:true});const o=e("seventh");function c(e,t,i,n,s,r={},o=null){this.dom=e;this.gScene=t;this.parent=o??this.gScene;this.choices=i;this.undecidedNames=n;this.onSelect=s;this.keyFocusIndex=0;this.position=r.nextStyle?.position??null;this.buttons=this.choices.map(e=>new a(this.dom,this.gScene,e.label,{},this));this.guiCreates=false;this.babylon={containerStack:null,focusImage:null}}t.exports=c;c.prototype.destroy=function(){this.buttons.forEach(e=>e.destroy());if(this.babylon.containerStack){this.babylon.containerStack.dispose()}if(this.babylon.focusImage){this.babylon.focusImage.dispose()}};c.prototype.getUi=function(){return this.babylon.containerStack};c.prototype.run=async function(){if(!this.guiCreated){this.createGUI()}var i=e=>{console.warn("Choice index:",e);this.gScene.controller.off("command",t);this.onSelect(e)};var t=t=>{if(this.gScene.navigationByKey){let e=this.keyFocusIndex;switch(t){case"confirm":this.buttons[e].pressDown();setTimeout(()=>this.buttons[e].pressUp(),200);break;case"up":if(this.keyFocusIndex>0){this.keyFocusIndex--;this.focus(this.keyFocusIndex)}break;case"down":if(this.keyFocusIndex<this.buttons.length-1){this.keyFocusIndex++;this.focus(this.keyFocusIndex)}break}}else if(t==="confirm"||t==="up"||t==="down"){this.gScene.setNavigationByKey(true);this.focus(this.keyFocusIndex)}};this.gScene.controller.on("command",t);this.buttons.forEach((e,t)=>{e.run(()=>i(t));e.on("mouseInteracting",()=>{this.gScene.setNavigationByKey(false);this.focus(null)})});if(this.gScene.navigationByKey){setTimeout(()=>this.focus(this.keyFocusIndex),50)}};c.prototype.focus=function(i){var n=false,s=this.babylon.focusImage;this.buttons.forEach((t,e)=>{if(e===i){let e=l.getControlPositionRelativeTo(t.babylon.containerRect,s.parent,r.HORIZONTAL_ALIGNMENT_CENTER,r.VERTICAL_ALIGNMENT_CENTER,-1,0);console.warn("focusImage.parent",s.parent,"position",e);s.isVisible=true;s.leftInPixels=e.left;s.topInPixels=e.top;t.hover();n=true}else{t.standingBy()}});if(!n){s.isVisible=false}};const h=c.THEME=s({},a.THEME,{default:{group:{spacing:.01},panel:{width:.2,height:"38px"},text:{color:"black",fontSize:"22px",outlineWidth:2,outlineColor:"white"}}});c.prototype.createGUI=function(t=this.dom.themeConfig?.choices?.default,i=h.default){if(this.guiCreated){return}var e,n,s=this.parent.getUi(),r=s.getSize();e=this.babylon.containerStack=new BABYLON.GUI.StackPanel;n=t?.group?.spacing??i?.group?.spacing??0;var o=l.positionToAlignment(this.position);e.horizontalAlignment=o.horizontalAlignment;e.verticalAlignment=o.verticalAlignment;e.isVertical=true;this.childrenWidthInPixelsRequired=false;this.childrenHeightInPixelsRequired=true;this.childrenMaxHeight=r.height;if(typeof n==="number"){n=Math.ceil(n*r.height)}e.spacing=n;s.addControl(e);this.buttons.forEach(e=>{e.createGUI(t,i)});var a=this.babylon.focusImage=new BABYLON.GUI.Image("message-next","/icons/focus.png");a.width="15px";a.height="30px";a.isVisible=false;s.addControl(a);this.guiCreated=true}},{"../browser-extension.js":22,"../misc.js":25,"./Button.js":28,seventh:51,"tree-kit/lib/extend.js":53}],30:[function(e,t,i){"use strict";const r=e("./TextBox.js");const n=e("../browser-extension.js");const s=e("tree-kit/lib/extend.js").bind(null,{deep:true});const c=e("seventh");function o(e,t,i,n={},s=null){r.call(this,e,t,i,n,s);this.wait=n.wait||0;this.slowTyping=!!n.slowTyping;this.next=!!n.next;this.babylon.nextImage=null}o.prototype=Object.create(r.prototype);o.prototype.constructor=o;t.exports=o;o.prototype.destroy=function(){r.prototype.destroy.call(this);if(this.babylon.nextImage){this.babylon.nextImage.dispose()}};o.prototype.run=async function(){if(!this.guiCreated){this.createGUI()}if(this.slowTyping){await this.slowType()}if(this.next){await this.confirm()}if(this.wait){await c.resolveTimeout(this.wait*1e3)}this.destroy()};const h=o.THEME=s({},r.THEME,{default:{panel:{width:.5,height:.2,backgroundColor:"green",borderColor:"orange",borderWidth:4,cornerRadius:20,padding:{left:"10px",top:"10px",right:"10px",bottom:"10px"}},text:{color:"white"}}});o.prototype.createGUI=function(e=this.dom.themeConfig?.message?.default,t=h.default){if(this.guiCreated){return}r.prototype.createGUI.call(this,e,t);if(this.next){let e=this.babylon.nextImage=new BABYLON.GUI.Image("message-next","/icons/dialog-next.png");e.width="30px";e.height="15px";e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;e.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;e.isVisible=false;this.babylon.containerRect.addControl(e)}if(this.slowTyping){this.babylon.structuredTextBlock.characterLimit=0}};const l=.5;const u={" ":.3,",":1,":":1,";":1.5,".":2,"!":2,"?":2.5,"":4,"\n":4};const p={normal:{base:30,special:180,increment:1},fast:{base:20,special:150,increment:1},faster:{base:20,special:80,increment:2}};o.prototype.slowType=async function(){var t,i,e=false,n="faster",s=p[n].base,r=p[n].special,o=p[n].increment,a=this.babylon.structuredTextBlock;this.babylon.containerRect.onPointerClickObservable.addOnce(()=>e=true);await c.resolveTimeout(s);for(t=1;t<=a.characterCount;t++){if(e){a.characterLimit=a.characterCount;return}i=this.getNthCharacter(t-1);if(u[i]!==undefined){a.characterLimit=t;let e=u[i];if(i===this.getNthCharacter(t)){e*=l}await c.resolveTimeout(r*e)}else if(t>=a.characterCount){a.characterLimit=Infinity;await c.resolveTimeout(s)}else if(t%o===0){a.characterLimit=t;await c.resolveTimeout(s)}}};o.prototype.confirm=function(){var e=new c;var t,i=this.dom.themeConfig?.message?.default,n=h.default,s=this.babylon.nextImage,r=Date.now();s.isVisible=true;s.topInPixels=t=s.topInPixels-Math.round((i?.panel?.padding?.top??n?.panel?.padding?.top??0)/2);s.leftInPixels=s.leftInPixels-(i?.panel?.padding?.left??n?.panel?.padding?.left??0);var o=setInterval(()=>{var e=(Date.now()-r)/1e3;s.topInPixels=t-Math.abs(Math.sin(3*e)*10)},20);var a=()=>{clearInterval(o);this.gScene.controller.off("command",l);e.resolve()};var l=e=>{if(e==="confirm"){this.gScene.setNavigationByKey(true);a()}};this.gScene.controller.on("command",l);this.babylon.containerRect.onPointerClickObservable.addOnce(()=>{this.gScene.setNavigationByKey(false);a()});return e}},{"../browser-extension.js":22,"./TextBox.js":31,seventh:51,"tree-kit/lib/extend.js":53}],31:[function(e,t,i){"use strict";const r=e("./Box.js");const s=e("./textFx.js");const n=e("../misc.js");const o=e("../browser-extension.js");const a=e("tree-kit/lib/extend.js").bind(null,{deep:true});const l=e("seventh");function c(e,t,i,n={},s=null){r.call(this,e,t,n,s);this.text=i;this.fxTextParts=[];this.fxUpdateCount=0;this.isFxInit=false;this.updateFx=this.updateFx.bind(this);this.babylon.structuredTextBlock=null}c.prototype=Object.create(r.prototype);c.prototype.constructor=c;t.exports=c;c.prototype.destroy=function(){r.prototype.destroy.call(this);if(this.babylon.structuredTextBlock){this.babylon.structuredTextBlock.dispose()}this.gScene.off("render",this.updateFx)};c.prototype.run=function(){if(!this.guiCreated){this.createGUI()}this.destroy()};const h=c.THEME=a({},r.THEME,{default:{text:{color:"white"}}});c.prototype.createGUI=function(e,t=h.default){if(this.guiCreated){return}r.prototype.createGUI.call(this,e,t);if(!this.text){return}var i=this.babylon.containerStack||this.babylon.containerRect;var n=this.babylon.structuredTextBlock=new BABYLON.GUI.StructuredTextBlock("structuredTextBlock");n.paddingLeft=e?.panel?.padding?.left??t?.panel?.padding?.left??this.paddingLeft;n.paddingTop=e?.panel?.padding?.top??t?.panel?.padding?.top??this.paddingTop;n.paddingRight=e?.panel?.padding?.right??t?.panel?.padding?.right??this.paddingRight;n.paddingBottom=e?.panel?.padding?.bottom??t?.panel?.padding?.bottom??this.paddingBottom;n.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;n.fontSize=e?.text?.fontSize??t?.text?.fontSize??"14px";n.color=e?.text?.color??t?.text?.color;n.outlineWidth=e?.text?.outlineWidth??t?.text?.outlineWidth??0;n.outlineColor=e?.text?.outlineColor??t?.text?.outlineColor??null;n.structuredText=this.parseText(this.text);n.onLinesReadyObservable.addOnce(()=>{this.fxTextParts.length=0;for(let t of n.lines){for(let e of t.parts){if(e.staticCustomData?.fx&&s[e.staticCustomData.fx].update){this.fxTextParts.push(e)}}}if(this.fxTextParts.length){this.gScene.on("render",this.updateFx)}});n.textWrapping=BABYLON.GUI.TextWrapping.WordWrap;i.addControl(n)};c.prototype.updateFx=function(){var t,i=0,n=false;if(!this.isFxInit){for(let e of this.fxTextParts){t=s[e.staticCustomData.fx];if(t.initDynamic){e.dynamicCustomData={};t.initDynamic(e,this,this.babylon.structuredTextBlock)}}this.isFxInit=true}for(let e of this.fxTextParts){t=s[e.staticCustomData.fx];if(!t.updateEvery||this.fxUpdateCount%t.updateEvery===0){t.update(e,this,this.babylon.structuredTextBlock,i);n=true}i++}this.fxUpdateCount++;if(n){this.babylon.structuredTextBlock._markAsDirty()}};const u={black:"#000000",brightBlack:"#555753",red:"#cc0000",brightRed:"#ef2929",green:"#4e9a06",brightGreen:"#8ae234",yellow:"#c4a000",brightYellow:"#fce94f",blue:"#3465a4",brightBlue:"#729fcf",magenta:"#75507b",brightMagenta:"#ad7fa8",cyan:"#06989a",brightCyan:"#34e2e2",white:"#d3d7cf",brightWhite:"#eeeeec"};u.grey=u.gray=u.brightBlack;c.prototype.parseText=function(e){return o.host.exports.toolkit.parseMarkup(e).map(e=>{var t={text:e.text};if(e.color){t.color=e.color[0]==="#"?e.color:u[e.color]}if(e.italic){t.fontStyle="italic"}if(e.bold){t.fontWeight="bold"}if(e.underline){t.underline=true}if(e.strike){t.lineThrough=true}if(e.bgColor){t.frame=true;t.frameColor=e.bgColor;t.frameOutlineWidth=2;t.frameOutlineColor=n.getContrastColorCode(t.frameColor,.7);t.frameCornerRadius=5}if(e.fx&&s[e.fx]){t.staticCustomData={fx:e.fx};if(s[e.fx].initStatic){s[e.fx].initStatic(t,this)}}return t})};c.prototype.getNthCharacter=function(e){var t,i,n=this.babylon.structuredTextBlock,s=n.lines,r=n.characterCount;if(e>r){return""}for(i of s){for(t of i.parts){if(e<t.text.length){return t.text[e]}e-=t.text.length}}return""}},{"../browser-extension.js":22,"../misc.js":25,"./Box.js":27,"./textFx.js":33,seventh:51,"tree-kit/lib/extend.js":53}],32:[function(e,t,i){"use strict";const c=e("./TextBox.js");const h=e("../misc.js");const n=e("../browser-extension.js");const s=e("tree-kit/lib/extend.js").bind(null,{deep:true});const r=e("seventh");function o(e,t,i={},n=null){c.call(this,e,t,i.label,i,n);this.input=i.placeholder||"";this.babylon.inputText=null;this.babylon.containerStack=null}o.prototype=Object.create(c.prototype);o.prototype.constructor=o;t.exports=o;o.prototype.destroy=function(){c.prototype.destroy.call(this);if(this.babylon.inputText){this.babylon.inputText.dispose()}};o.prototype.run=async function(e=false){if(!this.guiCreated){this.createGUI()}var t=new r;if(e){this.babylon.inputText.focus()}this.babylon.inputText.onKeyboardEventProcessedObservable.add(e=>{if(e.key==="Enter"){t.resolve()}});await t;var i=this.babylon.inputText.text;this.destroy();return i};const u=o.THEME=s({},c.THEME,{default:{textInput:{labelMargin:"10px",color:"white",focusBackgroundColor:"gray",blurBackgroundColor:"#555",borderWidth:1}}});o.prototype.createGUI=function(e=this.dom.themeConfig?.textInput?.default,t=u.default){if(this.guiCreated){return}var i=this.babylon.containerStack=new BABYLON.GUI.StackPanel;c.prototype.createGUI.call(this,e,t);var n=this.babylon.structuredTextBlock;if(n){n.height=h.scaleSizeString(n.fontSize,2);n.paddingBottom=0}i.isVertical=true;i.spacing=parseInt(e?.textInput?.labelMargin??t?.textInput?.labelMargin??0,10);this.babylon.containerRect.addControl(i);var s=this.babylon.inputText=new BABYLON.GUI.InputText("inputText");var r=e?.panel?.padding?.left??t?.panel?.padding?.left??this.paddingLeft,o=n?0:e?.panel?.padding?.top??t?.panel?.padding?.top??this.paddingTop,a=e?.panel?.padding?.right??t?.panel?.padding?.right??this.paddingRight,l=e?.panel?.padding?.bottom??t?.panel?.padding?.bottom??this.paddingBottom;s.textHorizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;s.fontSize=e?.textInput?.fontSize??t?.textInput?.fontSize??"14px";s.color=e?.textInput?.color??t?.textInput?.color;s.outlineWidth=e?.textInput?.outlineWidth??t?.textInput?.outlineWidth??0;s.outlineColor=e?.textInput?.outlineColor??t?.textInput?.outlineColor??null;s.focusedBackground=e?.textInput?.focusBackgroundColor??e?.textInput?.backgroundColor??t?.textInput?.focusBackgroundColor??t?.textInput?.backgroundColor??this.containerRectStyle.backgroundColor;s.background=e?.textInput?.blurBackgroundColor??e?.textInput?.backgroundColor??t?.textInput?.blurBackgroundColor??t?.textInput?.backgroundColor??this.containerRectStyle.backgroundColor;s.thickness=e?.textInput?.borderWidth??t?.textInput?.borderWidth??1;s.textWrapping=BABYLON.GUI.TextWrapping.WordWrap;s.width=.8;s.maxWidth=.8;s.height=h.scaleSizeString(s.fontSize,2.618);i.addControl(s)}},{"../browser-extension.js":22,"../misc.js":25,"./TextBox.js":31,seventh:51,"tree-kit/lib/extend.js":53}],33:[function(e,t,i){"use strict";const r={};t.exports=r;const o=Math.PI/2;const a=Math.PI*2;r.shake={initStatic:e=>{e.splitIntoCharacters=true},initDynamic:(e,t,i)=>{var n=parseFloat(e.fontSize??i.style?.fontSize??i.fontSize);e.dynamicCustomData.deltaX=n/22;e.dynamicCustomData.deltaY=n/11;e.dynamicCustomData.x=e.metrics.x;e.dynamicCustomData.baselineY=e.metrics.baselineY},update:e=>{var t=Math.round((2*Math.random()-1)*e.dynamicCustomData.deltaX),i=Math.round((2*Math.random()-1)*e.dynamicCustomData.deltaY);e.metrics.x=e.dynamicCustomData.x+t;e.metrics.baselineY=e.dynamicCustomData.baselineY+i},updateEvery:3};r.bumpy={initDynamic:(e,t,i)=>{var n=parseFloat(e.fontSize??i.style?.fontSize??i.fontSize);e.dynamicCustomData.deltaY=n/3;e.dynamicCustomData.baselineY=e.metrics.baselineY},update:(e,t)=>{var i=40;var n=-Math.round(e.dynamicCustomData.deltaY*.5*(1+Math.sin(-o+t.fxUpdateCount*a/i)));e.metrics.baselineY=e.dynamicCustomData.baselineY+n},updateEvery:2};const l=Math.PI/10;r.ola={initStatic:e=>{e.splitIntoCharacters=true},initDynamic:(e,t,i)=>{var n=parseFloat(e.fontSize??i.style?.fontSize??i.fontSize);e.dynamicCustomData.deltaY=n/3;e.dynamicCustomData.baselineY=e.metrics.baselineY},update:(e,t,i,n)=>{var s=40;var r=-Math.round(e.dynamicCustomData.deltaY*.5*(1+Math.sin(-o-n*l+t.fxUpdateCount*a/s)));e.metrics.baselineY=e.dynamicCustomData.baselineY+r},updateEvery:2};const c=["#ff000d","#ef9000","#fffd00","#66ff00","#0085fc","#2f00ff","#bd00ed"];r.rainbow={initStatic:e=>{e.splitIntoCharacters=true},update:(e,t,i,n)=>{var s=(n+t.fxUpdateCount/r.rainbow.updateEvery)%c.length;e.color=c[s]},updateEvery:10}},{}],34:[function(e,t,i){"use strict";const s={range:e("./range.js"),sample:e("./sample.js"),inPlaceFilter:e("./inPlaceFilter.js"),delete:e("./delete.js"),deleteValue:e("./deleteValue.js")};t.exports=s;s.randomInteger=(e,t)=>e+Math.floor((t-e+1)*Math.random());s.random=s.randomElement=e=>e[Math.floor(e.length*Math.random())];s.shuffle=e=>s.sample(e,e.length,true);s.randomSampleSize=(e,t,i,n)=>s.sample(e,s.randomInteger(t,i),n)},{"./delete.js":35,"./deleteValue.js":36,"./inPlaceFilter.js":37,"./range.js":38,"./sample.js":39}],35:[function(e,t,i){"use strict";t.exports=(e,t)=>{if(t>=e.length){return}var i=e.length-2;while(t<=i){e[t]=e[t+1];t++}e.length--}},{}],36:[function(e,t,i){"use strict";t.exports=(e,t)=>{var i,n,s=0,r=0;while(s<e.length){i=e[s];if(t!==i&&(t||!Number.isNaN(t)||!Number.isNaN(i))){e[r]=i;r++}s++}n=e.length-r;e.length=r;return n}},{}],37:[function(e,t,i){"use strict";t.exports=(e,t,i,n)=>{var s=arguments.length>=4,r,o=0,a=0;while(o<e.length){r=e[o];if(t.call(i,r,s?n:o,e)){e[a]=r;a++}o++}e.length=a;return e}},{}],38:[function(e,t,i){"use strict";t.exports=function(e,t,i){if(!arguments.length){return[]}if(arguments.length===1){t=e;e=0}if(!i){i=e<=t?1:-1}if(i>0&&e>=t||i<0&&e<=t){return[]}var n=0,s=e,r=[];if(i>0){for(;s<t;n++,s+=i){r[n]=s}}else{for(;s>t;n++,s+=i){r[n]=s}}return r}},{}],39:[function(e,t,i){"use strict";t.exports=(e,t=Infinity,i=false)=>{var n,s,r,o=i?e:[...e];t=Math.max(Math.min(t,e.length),0);for(n=0;n<t;n++){s=n+Math.floor((o.length-n)*Math.random());r=o[n];o[n]=o[s];o[s]=r}o.length=t;return o}},{}],40:[function(e,t,i){(function(r){(function(){"use strict";function i(e={}){if(!e.ns){throw new Error("EXM: namespace ('ns') is required!")}this.ns=e.ns;this.extensionPath=e.extensionPath||"/ext";this.suffix=e.suffix||"/extension.js";this.api=e.api||{};this.exports=e.exports||{};this.extensions=new Map}t.exports=i;i.prototype.__prototypeUID__="exm/browser/Exm";i.prototype.__prototypeVersion__="0.5";i.registerNs=function(e={}){if(!e.ns||typeof e.ns!=="string"){throw new Error("EXM: namespace ('ns' property) is required!")}if(r.EXM.ns[e.ns]){throw new Error("EXM: namespace '"+e.ns+"' is already registered!")}var t=new i(e);r.EXM.ns[e.ns]=t;return t};i.prototype.requireExtension=async function(i){if(this.extensions.has(i)){return this.extensions.get(i)}var e,t=this.ns+"."+i,n=this.extensionPath+"/"+t,s=n+this.suffix;try{console.warn("Trying EXM extension: ",s);e=await import(s)}catch(e){throw new Error("Required extension '"+i+"' not found.")}if(!e||typeof e!=="object"){throw new Error("EXM: this is not an EXM Extension (not an object)")}if(e.extension){e=e.extension}else{e=r.EXM.extensions[t];if(!e||typeof e!=="object"){throw new Error("EXM: this is not an EXM Extension (not an ES6 module extension and not registered)")}}if(e.__prototypeUID__!=="exm/Extension"&&e.__prototypeUID__!=="exm/browser/Extension"){throw new Error("EXM: this is not an EXM Extension (no prototype UID found)")}if(e.id!==i){throw new Error("EXM: Extension ID mismatch (wanted '"+i+"' but got "+e.id+"'.")}try{await e.init(this,s,n);console.log("Extension '"+e.id+"'"+(e.version?" (v"+e.version+") ":"")+"is loaded.")}catch(e){let t=new Error("EXM: Failed to init extension '"+i+"': "+e);t.from=e;throw e}this.extensions.set(i,e);return e};i.Extension=function(e={}){this.isInit=false;this.id=e.id;this.ns=e.ns;this.uid=e.ns+"."+e.id;this.version=e.version||null;this.host=null;this.path=null;this.dirPath=null;this.fromModule=e.module;this.hooks=e.hooks||{};this.api=e.api||{};this.exports=e.exports||{}};i.Extension.prototype.__prototypeUID__="exm/browser/Extension";i.Extension.prototype.__prototypeVersion__=i.prototype.__prototypeVersion__;i.registerExtension=i.Extension.register=function(e={}){if(!e.id||typeof e.id!=="string"){throw new Error("EXM Extension: ID ('id' property) is required!")}if(!e.ns||typeof e.ns!=="string"){throw new Error("EXM Extension: namespace ('ns' property) is required!")}var t=new i.Extension(e);if(r.EXM.extensions[t.uid]){throw new Error("EXM Extension: ID '"+t.id+"' is already registered for namespace '"+t.ns+"'!")}r.EXM.extensions[t.uid]=t;return t};i.Extension.prototype.init=async function(e,t,i){if(this.isInit){return}if(e.ns!==this.ns){throw new Error("EXM Extension's namespace mismatches the Host!")}if(t){this.path=t}if(i){this.dirPath=i}this.host=e;if(typeof this.hooks.init==="function"){await this.hooks.init()}this.isInit=true};if(!r.EXM){r.EXM={master:null,ns:{},extensions:{}}}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],41:[function(e,t,i){"use strict";function n(){}t.exports=n;n.prototype.__prototypeUID__="nextgen-events/LeanEvents";n.prototype.__prototypeVersion__=e("../package.json").version;n.prototype.on=n.prototype.addListener=function(e,t,i,n){if(!this.__listeners){this.__listeners={}}if(!this.__listeners[e]){this.__listeners[e]=[]}var s=this.__states&&this.__states[e];if(s&&n){t(...s);return}var r={id:i??t,fn:t,once:!!n};var o=this.__listeners[e];o[o.length]=r;if(s){t(...s)}};n.prototype.once=function(e,t,i){return this.addListener(e,t,i,true)};n.prototype.waitFor=function(e){return new Promise(t=>{this.addListener(e,e=>t(e),undefined,true)})};n.prototype.waitForAll=function(e){return new Promise(t=>{this.addListener(e,(...e)=>t(e),undefined,true)})};n.prototype.off=n.prototype.removeListener=function(e,t){if(!this.__listeners||!this.__listeners[e]||!this.__listeners[e].length){return}this.__listeners[e]=this.__listeners[e].filter(e=>e.id!==t);return this};n.prototype.removeAllListeners=function(e){if(!this.__listeners){return}if(e){delete this.__listeners[e]}else{this.__listeners={}}return this};n.prototype.emit=function(e,...t){var i,n,s,r,o,a;if(this.__states&&(o=this.__states[e])!==undefined){if(o&&t.length===o.length&&(!t.length||t.every((e,t)=>e===o[t]))){return}a=this.__stateGroups[e];for(i=0,n=a.length;i<n;i++){this.__states[a[i]]=null}this.__states[e]=t}if(!this.__listeners){return}s=this.__listeners[e];if(!s||!s.length){return}for(i=0,n=s.length;i<n;i++){r=s[i];if(r.once){this.removeListener(e,r.id)}r.fn(...t)}return this};n.prototype.listeners=function(e){if(!this.__listeners||!this.__listeners[e]){return[]}return this.__listeners[e].slice()};n.prototype.listenerCount=function(e){if(!this.__listeners||!this.__listeners[e]){return 0}return this.__listeners[e].length};n.prototype.defineStates=function(...t){if(!this.__states){this.__states={};this.__stateGroups={}}t.forEach(e=>{this.__states[e]=null;this.__stateGroups[e]=t})};n.prototype.hasState=function(e){if(!this.__states){return false}return!!this.__states[e]};n.prototype.getAllStates=function(){if(!this.__states){return[]}return Object.keys(this.__states).filter(e=>this.__states[e])}},{"../package.json":42}],42:[function(e,t,i){t.exports={name:"nextgen-events",version:"1.5.3",description:"The next generation of events handling for javascript! New: abstract away the network!",main:"lib/NextGenEvents.js",engines:{node:">=6.0.0"},directories:{test:"test",bench:"bench"},dependencies:{},devDependencies:{browserify:"^17.0.0","uglify-js-es6":"^2.8.9",ws:"^7.4.6"},scripts:{test:"tea-time -R dot"},repository:{type:"git",url:"https://github.com/cronvel/nextgen-events.git"},keywords:["events","async","emit","listener","context","series","serialize","namespace","proxy","network"],author:"Cdric Ronvel",license:"MIT",bugs:{url:"https://github.com/cronvel/nextgen-events/issues"},config:{"tea-time":{coverDir:["lib"]}},copyright:{title:"Next-Gen Events",years:[2015,2021],owner:"Cdric Ronvel"}}},{}],43:[function(e,t,i){(function(b,e){(function(){(function(i,n){"use strict";if(i.setImmediate){return}var s=1;var r={};var o=false;var a=i.document;var l;function e(e){if(typeof e!=="function"){e=new Function(""+e)}var t=new Array(arguments.length-1);for(var i=0;i<t.length;i++){t[i]=arguments[i+1]}var n={callback:e,args:t};r[s]=n;l(s);return s++}function c(e){delete r[e]}function h(e){var t=e.callback;var i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i);break}}function u(e){if(o){setTimeout(u,0,e)}else{var t=r[e];if(t){o=true;try{h(t)}finally{c(e);o=false}}}}function t(){l=function(e){b.nextTick(function(){u(e)})}}function p(){if(i.postMessage&&!i.importScripts){var e=true;var t=i.onmessage;i.onmessage=function(){e=false};i.postMessage("","*");i.onmessage=t;return e}}function f(){var t="setImmediate$"+Math.random()+"$";var e=function(e){if(e.source===i&&typeof e.data==="string"&&e.data.indexOf(t)===0){u(+e.data.slice(t.length))}};if(i.addEventListener){i.addEventListener("message",e,false)}else{i.attachEvent("onmessage",e)}l=function(e){i.postMessage(t+e,"*")}}function d(){var t=new MessageChannel;t.port1.onmessage=function(e){var t=e.data;u(t)};l=function(e){t.port2.postMessage(e)}}function y(){var i=a.documentElement;l=function(e){var t=a.createElement("script");t.onreadystatechange=function(){u(e);t.onreadystatechange=null;i.removeChild(t);t=null};i.appendChild(t)}}function m(){l=function(e){setTimeout(u,0,e)}}var g=Object.getPrototypeOf&&Object.getPrototypeOf(i);g=g&&g.setTimeout?g:i;if({}.toString.call(i.process)==="[object process]"){t()}else if(p()){f()}else if(i.MessageChannel){d()}else if(a&&"onreadystatechange"in a.createElement("script")){y()}else{m()}g.setImmediate=e;g.clearImmediate=c})(typeof self==="undefined"?typeof e==="undefined"?this:e:self)}).call(this)}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:55}],44:[function(e,t,i){"use strict";const s=e("./seventh.js");function n(e,t=4){this.jobRunner=e;this.jobs=new Map;this.pendingJobs=new Map;this.runningJobs=new Map;this.errorJobs=new Map;this.jobsDone=new Map;this.concurrency=+t||1;this.isQueueRunning=true;this.isLoopRunning=false;this.canLoopAgain=false;this.ready=s.resolved;this.startTime=null;this.endTime=null;this.drained=s.resolved;this.idle=s.resolved}s.Queue=n;function r(e,t=null,i=undefined){this.id=e;this.dependencies=t===null?null:[...t];this.data=i===undefined?e:i;this.error=null;this.startTime=null;this.endTime=null}n.Job=r;n.prototype.setConcurrency=function(e){this.concurrency=+e||1};n.prototype.stop=n.prototype.pause=function(){this.isQueueRunning=false};n.prototype.has=function(e){return this.jobs.has(e)};n.prototype.add=n.prototype.addJob=function(e,t,i=null){if(this.jobs.has(e)){return false}var n=new r(e,i,t);this.jobs.set(e,n);this.pendingJobs.set(e,n);this.canLoopAgain=true;if(this.isQueueRunning&&!this.isLoopRunning){this.run()}if(this.drained.isSettled()){this.drained=new s}return n};n.prototype.addBatch=n.prototype.addJobBatch=function(e){var t,i;for(t of e){if(this.jobs.has(t)){return false}i=new r(t);this.jobs.set(t,i);this.pendingJobs.set(t,i)}this.canLoopAgain=true;if(this.isQueueRunning&&!this.isLoopRunning){this.run()}if(this.drained.isSettled()){this.drained=new s}};n.prototype.run=n.prototype.resume=async function(){var e;this.isQueueRunning=true;if(this.isLoopRunning){return}this.isLoopRunning=true;if(!this.startTime){this.startTime=Date.now()}do{this.canLoopAgain=false;for(e of this.pendingJobs.values()){if(e.dependencies&&e.dependencies.some(e=>!this.jobsDone.has(e))){continue}if(this.idle.isSettled()){this.idle=new s}this.canLoopAgain=true;await this.ready;if(!this.isQueueRunning){this.finishRun();return}this.runJob(e)}}while(this.canLoopAgain);this.finishRun()};n.prototype.finishRun=function(){this.isLoopRunning=false;if(!this.pendingJobs.size){this.drained.resolve()}if(!this.runningJobs.size){this.endTime=Date.now();this.idle.resolve()}};n.prototype.runJob=async function(t){this.pendingJobs.delete(t.id);this.runningJobs.set(t.id,t);if(this.runningJobs.size>=this.concurrency){this.ready=new s}try{t.startTime=Date.now();await this.jobRunner(t.data);t.endTime=Date.now();this.jobsDone.set(t.id,t);this.canLoopAgain=true}catch(e){t.endTime=Date.now();t.error=e;this.errorJobs.set(t.id,t)}this.runningJobs.delete(t.id);if(this.runningJobs.size<this.concurrency){this.ready.resolve()}if(!this.isLoopRunning){if(this.isQueueRunning&&this.pendingJobs.size){this.run()}else{this.finishRun()}}};n.prototype.getJobTimes=function(){var e,t={};for(e of this.jobsDone.values()){t[e.id]=e.endTime-e.startTime}return t};n.prototype.getStats=function(){var e,t=0,i={pending:this.pendingJobs.size,running:this.runningJobs.size,failed:this.errorJobs.size,done:this.jobsDone.size,averageJobTime:null,queueTime:null};if(this.jobsDone.size){for(e of this.jobsDone.values()){t+=e.endTime-e.startTime}i.averageJobTime=t/this.jobsDone.size}if(this.endTime){i.queueTime=this.endTime-this.startTime}return i}},{"./seventh.js":51}],45:[function(e,t,i){"use strict";const o=e("./seventh.js");o.promisifyNodeApi=(n,s,r,e,t)=>{var i;s=s||"Async";r=r||"AsyncAll";e=e||(e=>e[0]!=="_"&&!e.endsWith("Sync"));if(t){i=[];for(let e in n){if(typeof n[e]==="function"){i.push(e)}}}else{i=Object.keys(n)}i.filter(t=>{if(typeof n[t]!=="function"){return false}for(let e in n[t].prototype){return false}return e(t,n)}).forEach(e=>{const t=e+s;const i=e+r;if(!n[t]){n[t]=o.promisify(n[e],n)}if(!n[i]){n[i]=o.promisifyAll(n[e],n)}})};o.promisifyAnyNodeApi=(e,t,i,n)=>{o.promisifyNodeApi(e,t,i,n,true)}},{"./seventh.js":51}],46:[function(e,t,i){"use strict";const y=e("./seventh.js");const h={};function u(){}y.all=e=>{var t=-1,i=false,n=0,s=Infinity,r,o=[],a=new y;for(r of e){if(i){break}const l=++t;y.resolve(r).then(e=>{if(i){return}o[l]=e;n++;if(n>=s){i=true;a._resolveValue(o)}},e=>{if(i){return}i=true;a.reject(e)})}s=t+1;if(!s){a._resolveValue(o)}return a};y._allArray=e=>{var t=e.length;if(!t){y._resolveValue([])}var i,n={settled:false,count:0,length:t,values:[],allPromise:new y};for(i=0;!n.settled&&i<t;i++){y._allArrayOne(e[i],i,n)}return n.allPromise};y._allArrayOne=(e,t,i)=>{y._bareThen(e,e=>{if(i.settled){return}i.values[t]=e;i.count++;if(i.count>=i.length){i.settled=true;i.allPromise._resolveValue(i.values)}},e=>{if(i.settled){return}i.settled=true;i.allPromise.reject(e)})};y.allSettled=e=>{var t=-1,i=false,n=0,s=Infinity,r,o=[],a=new y;for(r of e){if(i){break}const l=++t;y.resolve(r).then(e=>{if(i){return}o[l]={status:"fulfilled",value:e};n++;if(n>=s){i=true;a._resolveValue(o)}},e=>{if(i){return}o[l]={status:"rejected",reason:e};n++;if(n>=s){i=true;a._resolveValue(o)}})}s=t+1;if(!s){a._resolveValue(o)}return a};y.every=y.map=(e,t)=>{var i=-1,n=false,s=0,r=Infinity,o,a=[],l=new y;for(o of e){if(n){break}const c=++i;y.resolve(o).then(e=>{if(n){return}return t(e,c)}).then(e=>{if(n){return}a[c]=e;s++;if(s>=r){n=true;l._resolveValue(a)}},e=>{if(n){return}n=true;l.reject(e)})}r=i+1;if(!r){l._resolveValue(a)}return l};y.any=e=>{var t=-1,i=false,n=0,s=Infinity,r,o=[],a=new y;for(r of e){if(i){break}const l=++t;y.resolve(r).then(e=>{if(i){return}i=true;a._resolveValue(e)},e=>{if(i){return}o[l]=e;n++;if(n>=s){i=true;a.reject(new AggregateError(o),"Promise.any(): All promises have rejected")}})}s=t+1;if(!s){a.reject(new RangeError("Promise.any(): empty array"))}return a};y.some=(e,t)=>{var i=-1,n=false,s=0,r=Infinity,o,a=[],l=new y;for(o of e){if(n){break}const c=++i;y.resolve(o).then(e=>{if(n){return}return t(e,c)}).then(e=>{if(n){return}n=true;l._resolveValue(e)},e=>{if(n){return}a[c]=e;s++;if(s>=r){n=true;l.reject(new AggregateError(a,"Promise.some(): All promises have rejected"))}})}r=i+1;if(!r){l.reject(new RangeError("Promise.some(): empty array"))}return l};y.filter=(e,t)=>{var i=-1,n=false,s=0,r=Infinity,o,a=[],l=new y;for(o of e){if(n){break}const c=++i;y.resolve(o).then(e=>{if(n){return}a[c]=e;return t(e,c)}).then(e=>{if(n){return}s++;if(!e){a[c]=h}if(s>=r){n=true;a=a.filter(e=>e!==h);l._resolveValue(a)}},e=>{if(n){return}n=true;l.reject(e)})}r=i+1;if(!r){l._resolveValue(a)}else if(s>=r){n=true;a=a.filter(e=>e!==h);l._resolveValue(a)}return l};y.foreach=y.forEach=function(e,n,t){var s=-1,r=arguments.length>=3,o=e[Symbol.iterator](),a=new y,l=y.resolve(t);if(y.warnUnhandledRejection){y._handleAll(e)}var c=()=>{l.then(t=>{let{value:e,done:i}=o.next();s++;if(i){a.resolve(t)}else{l=y.resolve(e).then(r?e=>n(t,e,s):e=>n(e,s));c()}},e=>{a.reject(e);for(;;){let{value:e,done:t}=o.next();if(t){break}if(y.isThenable(e)){e.then(u,u)}}})};c();return a};y.reduce=(e,t,i)=>{return y.forEach(e,t,i)};y.mapObject=(t,i)=>{var n=false,s=0,r=Object.keys(t),o=r.length,a={},l=new y;for(let e=0;!n&&e<o;e++){const c=r[e];const h=t[c];y.resolve(h).then(e=>{if(n){return}return i(e,c)}).then(e=>{if(n){return}a[c]=e;s++;if(s>=o){n=true;l._resolveValue(a)}},e=>{if(n){return}n=true;l.reject(e)})}if(!o){l._resolveValue(a)}return l};y.concurrent=(i,e,n)=>{var s=-1,r=false,o=0,a=0,l=Infinity,c,h=false,u=[],p=e[Symbol.iterator](),f=new y;if(y.warnUnhandledRejection){y._handleAll(e)}i=+i||1;const d=()=>{while(!h&&o<i){({value:c,done:h}=p.next());if(h){l=s+1;if(a>=l){r=true;f._resolveValue(u);return}break}if(r){break}const t=++s;o++;y.resolve(c).then(e=>{if(r){return}return n(e,t)}).then(e=>{if(r){return}u[t]=e;a++;o--;if(a>=l){r=true;f._resolveValue(u);return}if(o<i){d();return}},e=>{if(r){return}r=true;f.reject(e)})}};d();if(s<0){f._resolveValue(u)}return f};y.race=e=>{var t=false,i,n=new y;for(i of e){if(t){break}y.resolve(i).then(e=>{if(t){return}t=true;n._resolveValue(e)},e=>{if(t){return}t=true;n.reject(e)})}return n}},{"./seventh.js":51}],47:[function(o,a,e){(function(t,i,r){(function(){"use strict";const e=i.Promise;var n;if(!t.browser){n=t.nextTick}else{o("setimmediate");n=r}function s(e){this.fn=e;this._then=s._dormantThen;this.value=null;this.thenHandlers=null;this.handledRejection=null;if(this.fn){this._exec()}}a.exports=s;s.Native=e;s.warnUnhandledRejection=true;s.nextTick=n;s.prototype._exec=function(){this._then=s._pendingThen;try{this.fn(e=>{this.resolve(e)},e=>{this.reject(e)})}catch(e){this.reject(e)}};s.prototype.resolve=s.prototype.fulfill=function(e){if(this._then.settled){return this}if(s.isThenable(e)){this._execThenPromise(e);return this}return this._resolveValue(e)};s.prototype._resolveValue=function(e){this._then=s._fulfilledThen;this.value=e;if(this.thenHandlers&&this.thenHandlers.length){this._execFulfillHandlers()}return this};s.prototype._execThenPromise=function(e){try{e.then(e=>{this.resolve(e)},e=>{this.reject(e)})}catch(e){this.reject(e)}};s.prototype.reject=function(e){if(this._then.settled){return this}this._then=s._rejectedThen;this.value=e;if(this.thenHandlers&&this.thenHandlers.length){this._execRejectionHandlers()}else if(s.warnUnhandledRejection&&!this.handledRejection){this._unhandledRejection()}return this};s.prototype._execFulfillHandlers=function(){var e,t=this.thenHandlers.length;for(e=0;e<t;e+=3){if(this.thenHandlers[e+1]){this._execOneFulfillHandler(this.thenHandlers[e],this.thenHandlers[e+1])}else{this.thenHandlers[e].resolve(this.value)}}};s.prototype._execOneFulfillHandler=function(t,e){try{t.resolve(e(this.value))}catch(e){t.reject(e)}};s.prototype._execRejectionHandlers=function(){var e,t=this.thenHandlers.length;for(e=0;e<t;e+=3){if(this.thenHandlers[e+2]){this._execOneRejectHandler(this.thenHandlers[e],this.thenHandlers[e+2])}else{this.thenHandlers[e].reject(this.value)}}};s.prototype._execOneRejectHandler=function(t,e){try{t.resolve(e(this.value))}catch(e){t.reject(e)}};s.prototype.resolveTimeout=s.prototype.fulfillTimeout=function(e,t){setTimeout(()=>this.resolve(t),e)};s.prototype.rejectTimeout=function(e,t){setTimeout(()=>this.reject(t),e)};s.prototype.resolveNextTick=s.prototype.fulfillNextTick=function(e){n(()=>this.resolve(e))};s.prototype.rejectNextTick=function(e){n(()=>this.reject(e))};s._dormantThen=function(e,t){if(this.fn){this._exec();return this._then(e,t)}var i=new s;if(!this.thenHandlers){this.thenHandlers=[i,e,t]}else{this.thenHandlers[this.thenHandlers.length]=i;this.thenHandlers[this.thenHandlers.length]=e;this.thenHandlers[this.thenHandlers.length]=t}return i};s._dormantThen.settled=false;s._pendingThen=function(e,t){var i=new s;if(!this.thenHandlers){this.thenHandlers=[i,e,t]}else{this.thenHandlers[this.thenHandlers.length]=i;this.thenHandlers[this.thenHandlers.length]=e;this.thenHandlers[this.thenHandlers.length]=t}return i};s._pendingThen.settled=false;s._fulfilledThen=function(e){if(!e){return this}var t=new s;n(()=>{try{t.resolve(e(this.value))}catch(e){t.reject(e)}});return t};s._fulfilledThen.settled=true;s._rejectedThen=function(e,t){if(!t){return this}this.handledRejection=true;var i=new s;n(()=>{try{i.resolve(t(this.value))}catch(e){i.reject(e)}});return i};s._rejectedThen.settled=true;s.prototype.then=function(e,t){return this._then(e,t)};s.prototype.catch=function(e=()=>undefined){return this._then(undefined,e)};s.prototype.finally=function(e){return this._then(e,e)};s.prototype.tap=s.prototype.tapThen=function(e){this._then(e,undefined);return this};s.prototype.tapCatch=function(e){this._then(undefined,e);return this};s.prototype.tapFinally=function(e){this._then(e,e);return this};s.prototype.fatal=function(){this._then(undefined,e=>{n(()=>{throw e})})};s.prototype.done=function(e,t){this._then(e,t).fatal();return this};s.prototype.callback=function(t){this._then(e=>{t(undefined,e)},e=>{t(e)}).fatal();return this};s.prototype.callbackAll=function(t){this._then(e=>{if(Array.isArray(e)){t(undefined,...e)}else{t(undefined,e)}},e=>{t(e)}).fatal();return this};s.callback=function(e){return new s((i,n)=>{e((e,t)=>{if(e){n(e)}else{i(t)}})})};s.callbackAll=function(e){return new s((i,n)=>{e((e,...t)=>{if(e){n(e)}else{i(t)}})})};s.prototype.toPromise=s.prototype.propagate=function(t){this._then(e=>{t.resolve(e)},e=>{t.reject(e)});return this};s.propagate=function(e,t){e.then(e=>{t.resolve(e)},e=>{t.reject(e)});return e};s.finally=function(e,t){return e.then(t,t)};s.resolve=s.fulfill=function(e){if(s.isThenable(e)){return s.fromThenable(e)}return s._resolveValue(e)};s._resolveValue=function(e){var t=new s;t._then=s._fulfilledThen;t.value=e;return t};s.reject=function(e){var t=new s;t._then=s._rejectedThen;t.value=e;return t};s.prototype.resolveTimeout=s.prototype.fulfillTimeout=function(e,t){setTimeout(()=>this.resolve(t),e)};s.resolveTimeout=s.fulfillTimeout=function(t,i){return new s(e=>setTimeout(()=>e(i),t))};s.prototype.rejectTimeout=function(e,t){setTimeout(()=>this.reject(t),e)};s.rejectTimeout=function(i,n){return new s((e,t)=>setTimeout(()=>t(n),i))};s.resolveNextTick=s.fulfillNextTick=function(t){return new s(e=>n(()=>e(t)))};s.rejectNextTick=function(i){return new s((e,t)=>n(()=>t(i)))};s.dormant=function(e){var t=new s;t.fn=e;return t};s.try=function(e,...t){try{return s.resolve(e(...t))}catch(e){return s.reject(e)}};s.isThenable=function(e){return e&&typeof e==="object"&&typeof e.then==="function"};s.fromThenable=function(e){if(e instanceof s){return e}return new s((t,i)=>{e.then(e=>{t(e)},e=>{i(e)})})};s._bareThen=function(e,t,i){if(e&&typeof e==="object"){if(e instanceof s){if(e._then===s._fulfilledThen){t(e.value)}else if(e._then===s._rejectedThen){i(e.value)}else{e._then(t,i)}}else if(typeof e.then==="function"){e.then(t,i)}else{t(e)}}else{t(e)}};s._handleAll=function(e){var t;for(t of e){if(s.isThenable(t)){t.handledRejection=true}}};s.prototype._unhandledRejection=function(){this.handledRejection=false;const t=e=>setTimeout(e,0);if(this.value instanceof Error){t(()=>{if(this.handledRejection===false){this.value.message="Unhandled promise rejection: "+this.value.message;console.error(this.value)}})}else{let e=new Error("Unhandled promise rejection");t(()=>{if(this.handledRejection===false){console.error(e);console.error("Rejection reason:",this.value)}})}};s.prototype.isSettled=function(){return this._then.settled};s.prototype.getStatus=function(){switch(this._then){case s._dormantThen:return"dormant";case s._pendingThen:return"pending";case s._fulfilledThen:return"fulfilled";case s._rejectedThen:return"rejected"}};s.prototype.inspect=function(){switch(this._then){case s._dormantThen:return"Promise { <DORMANT> }";case s._pendingThen:return"Promise { <PENDING> }";case s._fulfilledThen:return"Promise { <FULFILLED> "+this.value+" }";case s._rejectedThen:return"Promise { <REJECTED> "+this.value+" }"}};s.resolved=s.dummy=s.resolve();s.withResolvers=()=>{var e=new s;return{promise:e,resolve:e.resolve.bind(e),reject:e.reject.bind(e)}};if(t.browser){s.prototype.resolveAtAnimationFrame=function(e){window.requestAnimationFrame(()=>this.resolve(e))};s.prototype.rejectAtAnimationFrame=function(e){window.requestAnimationFrame(()=>this.reject(e))};s.resolveAtAnimationFrame=function(t){return new s(e=>window.requestAnimationFrame(()=>e(t)))};s.rejectAtAnimationFrame=function(i){return new s((e,t)=>window.requestAnimationFrame(()=>t(i)))}}}).call(this)}).call(this,o("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},o("timers").setImmediate)},{_process:55,setimmediate:43,timers:56}],48:[function(e,t,i){"use strict";const p=e("./seventh.js");const a=()=>undefined;p.promisifyAll=(t,s)=>{if(s){return(...e)=>{return new p((i,n)=>{t.call(s,...e,(e,...t)=>{if(e){if(t.length&&e instanceof Error){e.args=t}n(e)}else{i(t)}})})}}return function(...e){return new p((i,n)=>{t.call(this,...e,(e,...t)=>{if(e){if(t.length&&e instanceof Error){e.args=t}n(e)}else{i(t)}})})}};p.promisify=(t,s)=>{if(s){return(...e)=>{return new p((i,n)=>{t.call(s,...e,(e,t)=>{if(e){if(t!==undefined&&e instanceof Error){e.arg=t}n(e)}else{i(t)}})})}}return function(...e){return new p((i,n)=>{t.call(this,...e,(e,t)=>{if(e){if(t!==undefined&&e instanceof Error){e.arg=t}n(e)}else{i(t)}})})}};p.interceptor=(n,s,r,o)=>{if(typeof r!=="function"){o=r;r=a}return function(...e){var t=o||this,i=n.call(t,...e);p.resolve(i).then(e=>s.call(t,e),e=>r.call(t,e));return i}};p.once=(n,s)=>{var i=null,r=new WeakMap;const o=e=>{var t=e?r.get(e):i;if(t){return t}t={triggered:false,result:undefined};if(e){r.set(e,t)}else{i=t}return t};return function(...e){var t=s||this,i=o(t);if(!i.triggered){i.triggered=true;i.result=n.call(t,...e)}return i.result}};p.serialize=(s,r)=>{var i=null,n=new WeakMap;const o=e=>{var t=e?n.get(e):i;if(t){return t}t={lastPromise:p.resolve()};if(e){n.set(e,t)}else{i=t}return t};return function(...e){var t=r||this,i=o(t),n=new p;i.lastPromise.finally(()=>{p.propagate(s.call(t,...e),n)});i.lastPromise=n;return n}};p.debounce=(s,r)=>{var i=null,n=new WeakMap;const o=e=>{var t=e?n.get(e):i;if(t){return t}t={inProgress:null};if(e){n.set(e,t)}else{i=t}return t};return function(...e){var t=r||this,i=o(t);if(i.inProgress){return i.inProgress}let n=i.inProgress=s.call(t,...e);p.finally(n,()=>i.inProgress=null);return n}};p.debounceDelay=(s,r,o)=>{var i=null,n=new WeakMap;const a=e=>{var t=e?n.get(e):i;if(t){return t}t={inProgress:null};if(e){n.set(e,t)}else{i=t}return t};return function(...e){var t=o||this,i=a(t);if(i.inProgress){return i.inProgress}let n=i.inProgress=r.call(t,...e);p.finally(n,()=>setTimeout(()=>i.inProgress=null,s));return n}};p.debounceNextTick=(i,n)=>{var s=null,e=null,t=null,r=null,o=new WeakMap;const a=e=>{var t=e?o.get(e):r;if(t){return t}t={inProgress:null,waitingNextTick:false,currentUpdateWith:null,currentUpdatePromise:null,nextUpdateWith:null,nextUpdatePromise:null};if(e){o.set(e,t)}else{r=t}return t};const l=function(){var i=a(this);i.inProgress=i.currentUpdatePromise=null;if(i.nextUpdateWith){let e=i.nextUpdateWith;i.nextUpdateWith=null;let t=i.nextUpdatePromise;i.nextUpdatePromise=null;i.inProgress=s.call(this,e);p.propagate(i.inProgress,t)}};s=function(e){var t=a(this);t.inProgress=new p;t.currentUpdateWith=e;t.waitingNextTick=true;p.nextTick(()=>{t.waitingNextTick=false;let e=i.call(this,...t.currentUpdateWith);if(p.isThenable(e)){t.currentUpdatePromise=e;p.finally(e,l.bind(this));p.propagate(e,t.inProgress)}else{t.currentUpdatePromise=null;t.inProgress.resolve(e);l.call(this)}});return t.inProgress};return function(...e){var t=n||this,i=a(t);if(i.waitingNextTick){i.currentUpdateWith=e;return i.inProgress}if(i.currentUpdatePromise){if(!i.nextUpdatePromise){i.nextUpdatePromise=new p}i.nextUpdateWith=e;return i.nextUpdatePromise}return s.call(t,e)}};p.debounceUpdate=(e,i,n)=>{var s=null,r=null,t=0,o=null,a=null,l=null,c=new WeakMap;if(typeof e==="function"){n=i;i=e}else{if(typeof e.delay==="number"){t=e.delay}if(typeof e.delayFn==="function"){o=e.delayFn}if(e.waitNextTick){a=p.resolveNextTick}else if(typeof e.waitFn==="function"){a=e.waitFn}}const h=e=>{var t=e?c.get(e):l;if(t){return t}t={inProgress:null,waitInProgress:null,currentUpdateWith:null,currentUpdatePromise:null,nextUpdateWith:null,nextUpdatePromise:null};if(e){c.set(e,t)}else{l=t}return t};const u=function(){var i=h(this);i.inProgress=i.currentUpdatePromise=null;if(i.nextUpdateWith){let e=i.nextUpdateWith;i.nextUpdateWith=null;let t=i.nextUpdatePromise;i.nextUpdatePromise=null;i.inProgress=s.call(this,e);p.propagate(i.inProgress,t)}};if(o){r=function(){o().then(u.bind(this))}}else if(t){r=function(){setTimeout(u.bind(this),t)}}else{r=u}if(a){s=function(e){var t=h(this);t.inProgress=new p;t.currentUpdateWith=e;t.waitInProgress=a();p.finally(t.waitInProgress,()=>{t.waitInProgress=null;t.currentUpdatePromise=i.call(this,...t.currentUpdateWith);p.finally(t.currentUpdatePromise,r.bind(this));p.propagate(t.currentUpdatePromise,t.inProgress)});return t.inProgress};return function(...e){var t=n||this,i=h(t);if(i.waitInProgress){i.currentUpdateWith=e;return i.inProgress}if(i.currentUpdatePromise){if(!i.nextUpdatePromise){i.nextUpdatePromise=new p}i.nextUpdateWith=e;return i.nextUpdatePromise}return s.call(t,e)}}s=function(e){var t=h(this);t.inProgress=i.call(this,...e);p.finally(t.inProgress,r.bind(this));return t.inProgress};return function(...e){var t=n||this,i=h(t);if(i.inProgress){if(!i.nextUpdatePromise){i.nextUpdatePromise=new p}i.nextUpdateWith=e;return i.nextUpdatePromise}return s.call(t,e)}};p.NO_DELAY={};p.BATCH_NO_DELAY={};p.debounceSync=(r,o)=>{var i=new Map;const a=e=>{var t=i.get(e);if(!t){t={inProgress:null,inProgressIsFull:null,last:null,lastTime:null,lastFullSync:null,lastFullSyncTime:null,nextFullSyncPromise:null,nextFullSyncWith:null,noDelayBatches:new Set};i.set(e,t)}return t};const l=(e,t)=>{var i,n,s,r=new Date;e.inProgress=null;if(t>=2){e.lastFullSyncTime=e.lastTime=r}else if(t>=1){e.lastTime=r}if(e.nextFullSyncWith){if(o.delay&&e.lastFullSyncTime&&(i=r-e.lastFullSyncTime-o.delay)<0){e.inProgress=p.resolveTimeout(-i+1);e.inProgress.finally(()=>l(e,0));return e.nextFullSyncPromise}n=e.nextFullSyncWith;e.nextFullSyncWith=null;s=e.nextFullSyncPromise;e.nextFullSyncPromise=null;e.lastFullSync=e.last=e.inProgress=o.fn.call(...n);p.propagate(e.inProgress,s);p.finally(e.inProgress,()=>l(e,2));return e.inProgress}};const e=function(e,...t){var i=false,n=r.thisBinding||this,s=a(e);if(t[0]===p.NO_DELAY){i=true;t.shift()}else if(t[0]===p.BATCH_NO_DELAY){t.shift();let e=t.shift();if(!s.noDelayBatches.has(e)){s.noDelayBatches.add(e);i=true}}if(s.inProgress){return s.inProgress}if(!i&&r.delay&&s.lastTime&&new Date-s.lastTime<r.delay){if(typeof r.onDebounce==="function"){r.onDebounce(e,...t)}return s.last}s.last=s.inProgress=r.fn.call(n,e,...t);s.inProgressIsFull=false;p.finally(s.inProgress,()=>l(s,1));return s.inProgress};const t=function(e,...t){var i,n=false,s=o.thisBinding||this,r=a(e);if(t[0]===p.NO_DELAY){n=true;t.shift()}else if(t[0]===p.BATCH_NO_DELAY){t.shift();let e=t.shift();if(!r.noDelayBatches.has(e)){r.noDelayBatches.add(e);n=true}}if(!r.inProgress&&!n&&o.delay&&r.lastFullSyncTime&&(i=new Date-r.lastFullSyncTime-o.delay)<0){r.inProgress=p.resolveTimeout(-i+1);p.finally(r.inProgress,()=>l(r,0))}if(r.inProgress){if(!r.nextFullSyncPromise){r.nextFullSyncPromise=new p}r.nextFullSyncWith=[s,e,...t];return r.nextFullSyncPromise}r.lastFullSync=r.last=r.inProgress=o.fn.call(s,e,...t);p.finally(r.inProgress,()=>l(r,2));return r.inProgress};return[e,t]};p.timeout=(i,n,s)=>{return function(...e){var t=new p;p.propagate(n.call(s||this,...e),t);setTimeout(()=>t.reject(new Error("Timeout")),i);return t}};p.variableTimeout=(n,s)=>{return function(e,...t){var i=new p;p.propagate(n.call(s||this,...t),i);setTimeout(()=>i.reject(new Error("Timeout")),e);return i}}},{"./seventh.js":51}],49:[function(e,t,i){(function(o){(function(){"use strict";const s=e("./seventh.js");var r=false;s.asyncExit=function(i,n){if(r){return}r=true;var e=o.listeners("asyncExit");if(!e.length){o.exit(i);return}if(n===undefined){n=1e3}const t=t=>{if(t.length<3){t(i,n);return s.dummy}return new s(e=>{t(i,n,()=>{e()})})};s.map(e,t).finally(()=>o.exit(i));setTimeout(()=>o.exit(i),n)};s.resolveSafeTimeout=function(t,i){return new s(e=>{setTimeout(()=>{setTimeout(()=>{setTimeout(()=>{setTimeout(()=>e(i),0)},t/2)},t/2)},0)})}}).call(this)}).call(this,e("_process"))},{"./seventh.js":51,_process:55}],50:[function(e,t,i){"use strict";const n=e("./seventh.js");n.parasite=()=>{var e=["tap","tapCatch","finally","fatal","done","callback","callbackAll"];e.forEach(e=>n.Native.prototype[e]=n.prototype[e]);n.Native.prototype._then=n.Native.prototype.then}},{"./seventh.js":51}],51:[function(e,t,i){"use strict";const n=e("./core.js");t.exports=n;e("./batch.js");e("./wrapper.js");e("./decorators.js");e("./Queue.js");e("./api.js");e("./parasite.js");e("./misc.js")},{"./Queue.js":44,"./api.js":45,"./batch.js":46,"./core.js":47,"./decorators.js":48,"./misc.js":49,"./parasite.js":50,"./wrapper.js":52}],52:[function(e,t,i){"use strict";const c=e("./seventh.js");c.timeLimit=(i,n)=>{return new c((e,t)=>{if(typeof n==="function"){n=n()}c.resolve(n).then(e,t);setTimeout(()=>t(new Error("Timeout")),i)})};c.retry=(e,t)=>{var i=e.retries||1,n=e.coolDown||0,s=e.raiseFactor||1,r=e.maxCoolDown||Infinity,o=e.timeout||0,a=e.catch||null;const l=()=>{return(o?c.timeLimit(o,t):t()).catch(e=>{if(!i--){throw e}var t=n;n=Math.min(n*s,r);if(a){return c.resolve(a(e)).then(()=>c.resolveTimeout(t).then(l))}return c.resolveTimeout(t).then(l)})};return l()};c.onceEvent=(t,i)=>{return new c(e=>t.once(i,e))};c.onceEventAll=(e,i)=>{return new c(t=>e.once(i,(...e)=>t(e)))};c.onceEventOrError=(a,l,e,i=false)=>{return new c((t,n)=>{var s;var r=(...e)=>{a.removeListener("error",o);if(s){for(let e in s){a.removeListener(e,s[e])}}t(i?e:e[0])};var o=e=>{a.removeListener(l,r);if(s){for(let e in s){a.removeListener(e,s[e])}}n(e)};a.once(l,r);a.once("error",o);if(e){if(!Array.isArray(e)){e=[e]}s={};e.forEach(i=>{var e=(...e)=>{a.removeListener("error",o);a.removeListener(l,r);var t=new Error("Received an excluded event: "+i);t.event=i;t.eventArgs=e;n(t)};a.once(i,e);s[i]=e})}})};c.onceEventAllOrError=(e,t,i)=>{return c.onceEventOrError(e,t,i,true)}},{"./seventh.js":51}],53:[function(e,t,i){"use strict";function n(e,t,...i){var n,s,r=false,o=i.length;if(!o){return t}if(!e||typeof e!=="object"){e={}}var a={depth:0,prefix:""};if(e.deep){if(Array.isArray(e.deep)){e.deep=new Set(e.deep)}else if(!(e.deep instanceof Set)){e.deep=true}}if(e.immutables){if(Array.isArray(e.immutables)){e.immutables=new Set(e.immutables)}else if(!(e.immutables instanceof Set)){delete e.immutables}}if(!e.maxDepth&&e.deep&&!e.circular){e.maxDepth=100}if(e.deepFunc){e.deep=true}if(e.flat){e.deep=true;e.proto=false;e.inherit=false;e.unflat=false;if(typeof e.flat!=="string"){e.flat="."}}if(e.unflat){e.deep=false;e.proto=false;e.inherit=false;e.flat=false;if(typeof e.unflat!=="string"){e.unflat="."}}if(e.inherit){e.own=true;e.proto=false}else if(e.proto){e.own=true}if(!t||typeof t!=="object"&&typeof t!=="function"){r=true}if(!e.skipRoot&&(e.inherit||e.proto)){for(n=o-1;n>=0;n--){s=i[n];if(s&&(typeof s==="object"||typeof s==="function")){if(e.inherit){if(r){t=Object.create(s)}else{Object.setPrototypeOf(t,s)}}else if(e.proto){if(r){t=Object.create(Object.getPrototypeOf(s))}else{Object.setPrototypeOf(t,Object.getPrototypeOf(s))}}break}}}else if(r){t={}}a.references={sources:[],targets:[]};for(n=0;n<o;n++){s=i[n];if(!s||typeof s!=="object"&&typeof s!=="function"){continue}f(a,e,t,s,e.mask<=n+1)}return t}t.exports=n;function f(e,t,i,n,s){var r,o;if(t.maxDepth&&e.depth>t.maxDepth){throw new Error("[tree] extend(): max depth reached("+t.maxDepth+")")}if(t.circular){e.references.sources.push(n);e.references.targets.push(i)}if(t.unflat&&e.depth===0){for(o in n){e.unflatKeys=o.split(t.unflat);e.unflatIndex=0;e.unflatFullKey=o;d(e,t,i,n,e.unflatKeys[e.unflatIndex],s)}delete e.unflatKeys;delete e.unflatIndex;delete e.unflatFullKey}else if(t.own){if(t.nonEnum){r=Object.getOwnPropertyNames(n)}else{r=Object.keys(n)}for(o of r){d(e,t,i,n,o,s)}}else{for(o in n){d(e,t,i,n,o,s)}}}function d(t,i,n,s,r,o){if(r==="__proto__"){return}let a,l,c;if(t.unflatKeys){if(t.unflatIndex<t.unflatKeys.length-1){a={}}else{a=s[t.unflatFullKey]}}else if(i.descriptor){l=Object.getOwnPropertyDescriptor(s,r);a=l.value}else{a=s[r]}let h=t.prefix+r;if(i.nofunc&&typeof a==="function"){return}let u=n[h];let p=u&&(typeof u==="object"||typeof u==="function");let e=a&&(typeof a==="object"||typeof a==="function");if((i.deep||t.unflatKeys)&&a&&(typeof a==="object"||i.deepFunc&&typeof a==="function")&&(!i.descriptor||!l.get)&&((c=Object.getPrototypeOf(a))||true)&&(!(i.deep instanceof Set)||i.deep.has(c))&&(!i.immutables||!i.immutables.has(c))&&(!i.preserve||p)&&(!o||p)){let e=i.circular?t.references.sources.indexOf(a):-1;if(i.flat){if(e>=0){return}f({depth:t.depth+1,prefix:t.prefix+r+i.flat,references:t.references},i,n,a,o)}else{if(e>=0){u=t.references.targets[e];if(i.descriptor){Object.defineProperty(n,h,{value:u,enumerable:l.enumerable,writable:l.writable,configurable:l.configurable})}else{n[h]=u}return}if(!p||!Object.hasOwn(n,h)){if(Array.isArray(a)){u=[]}else if(i.proto){u=Object.create(c)}else if(i.inherit){u=Object.create(a)}else{u={}}if(i.descriptor){Object.defineProperty(n,h,{value:u,enumerable:l.enumerable,writable:l.writable,configurable:l.configurable})}else{n[h]=u}}else if(i.proto&&Object.getPrototypeOf(u)!==c){Object.setPrototypeOf(u,c)}else if(i.inherit&&Object.getPrototypeOf(u)!==a){Object.setPrototypeOf(u,a)}if(i.circular){t.references.sources.push(a);t.references.targets.push(u)}if(t.unflatKeys&&t.unflatIndex<t.unflatKeys.length-1){let e=t.unflatKeys[t.unflatIndex+1];d({depth:t.depth,unflatKeys:t.unflatKeys,unflatIndex:t.unflatIndex+1,unflatFullKey:t.unflatFullKey,prefix:"",references:t.references},i,u,s,e,o)}else{f({depth:t.depth+1,prefix:"",references:t.references},i,u,a,o)}}}else if(o&&(u===undefined||p||e)){return}else if(i.preserve&&u!==undefined){return}else if(!i.inherit){if(i.descriptor){Object.defineProperty(n,h,l)}else{n[h]=u=a}}if(i.move){delete s[r]}}},{}],54:[function(e,t,i){(function(a){(function(){"use strict";function y(e){if(typeof e!=="string"){throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}}function o(e,t){var i="";var n=0;var s=-1;var r=0;var o;for(var a=0;a<=e.length;++a){if(a<e.length)o=e.charCodeAt(a);else if(o===47)break;else o=47;if(o===47){if(s===a-1||r===1){}else if(s!==a-1&&r===2){if(i.length<2||n!==2||i.charCodeAt(i.length-1)!==46||i.charCodeAt(i.length-2)!==46){if(i.length>2){var l=i.lastIndexOf("/");if(l!==i.length-1){if(l===-1){i="";n=0}else{i=i.slice(0,l);n=i.length-1-i.lastIndexOf("/")}s=a;r=0;continue}}else if(i.length===2||i.length===1){i="";n=0;s=a;r=0;continue}}if(t){if(i.length>0)i+="/..";else i="..";n=2}}else{if(i.length>0)i+="/"+e.slice(s+1,a);else i=e.slice(s+1,a);n=a-s-1}s=a;r=0}else if(o===46&&r!==-1){++r}else{r=-1}}return i}function i(e,t){var i=t.dir||t.root;var n=t.base||(t.name||"")+(t.ext||"");if(!i){return n}if(i===t.root){return i+n}return i+e+n}var m={resolve:function e(){var t="";var i=false;var n;for(var s=arguments.length-1;s>=-1&&!i;s--){var r;if(s>=0)r=arguments[s];else{if(n===undefined)n=a.cwd();r=n}y(r);if(r.length===0){continue}t=r+"/"+t;i=r.charCodeAt(0)===47}t=o(t,!i);if(i){if(t.length>0)return"/"+t;else return"/"}else if(t.length>0){return t}else{return"."}},normalize:function e(t){y(t);if(t.length===0)return".";var i=t.charCodeAt(0)===47;var n=t.charCodeAt(t.length-1)===47;t=o(t,!i);if(t.length===0&&!i)t=".";if(t.length>0&&n)t+="/";if(i)return"/"+t;return t},isAbsolute:function e(t){y(t);return t.length>0&&t.charCodeAt(0)===47},join:function e(){if(arguments.length===0)return".";var t;for(var i=0;i<arguments.length;++i){var n=arguments[i];y(n);if(n.length>0){if(t===undefined)t=n;else t+="/"+n}}if(t===undefined)return".";return m.normalize(t)},relative:function e(t,i){y(t);y(i);if(t===i)return"";t=m.resolve(t);i=m.resolve(i);if(t===i)return"";var n=1;for(;n<t.length;++n){if(t.charCodeAt(n)!==47)break}var s=t.length;var r=s-n;var o=1;for(;o<i.length;++o){if(i.charCodeAt(o)!==47)break}var a=i.length;var l=a-o;var c=r<l?r:l;var h=-1;var u=0;for(;u<=c;++u){if(u===c){if(l>c){if(i.charCodeAt(o+u)===47){return i.slice(o+u+1)}else if(u===0){return i.slice(o+u)}}else if(r>c){if(t.charCodeAt(n+u)===47){h=u}else if(u===0){h=0}}break}var p=t.charCodeAt(n+u);var f=i.charCodeAt(o+u);if(p!==f)break;else if(p===47)h=u}var d="";for(u=n+h+1;u<=s;++u){if(u===s||t.charCodeAt(u)===47){if(d.length===0)d+="..";else d+="/.."}}if(d.length>0)return d+i.slice(o+h);else{o+=h;if(i.charCodeAt(o)===47)++o;return i.slice(o)}},_makeLong:function e(t){return t},dirname:function e(t){y(t);if(t.length===0)return".";var i=t.charCodeAt(0);var n=i===47;var s=-1;var r=true;for(var o=t.length-1;o>=1;--o){i=t.charCodeAt(o);if(i===47){if(!r){s=o;break}}else{r=false}}if(s===-1)return n?"/":".";if(n&&s===1)return"//";return t.slice(0,s)},basename:function e(t,i){if(i!==undefined&&typeof i!=="string")throw new TypeError('"ext" argument must be a string');y(t);var n=0;var s=-1;var r=true;var o;if(i!==undefined&&i.length>0&&i.length<=t.length){if(i.length===t.length&&i===t)return"";var a=i.length-1;var l=-1;for(o=t.length-1;o>=0;--o){var c=t.charCodeAt(o);if(c===47){if(!r){n=o+1;break}}else{if(l===-1){r=false;l=o+1}if(a>=0){if(c===i.charCodeAt(a)){if(--a===-1){s=o}}else{a=-1;s=l}}}}if(n===s)s=l;else if(s===-1)s=t.length;return t.slice(n,s)}else{for(o=t.length-1;o>=0;--o){if(t.charCodeAt(o)===47){if(!r){n=o+1;break}}else if(s===-1){r=false;s=o+1}}if(s===-1)return"";return t.slice(n,s)}},extname:function e(t){y(t);var i=-1;var n=0;var s=-1;var r=true;var o=0;for(var a=t.length-1;a>=0;--a){var l=t.charCodeAt(a);if(l===47){if(!r){n=a+1;break}continue}if(s===-1){r=false;s=a+1}if(l===46){if(i===-1)i=a;else if(o!==1)o=1}else if(i!==-1){o=-1}}if(i===-1||s===-1||o===0||o===1&&i===s-1&&i===n+1){return""}return t.slice(i,s)},format:function e(t){if(t===null||typeof t!=="object"){throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof t)}return i("/",t)},parse:function e(t){y(t);var i={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return i;var n=t.charCodeAt(0);var s=n===47;var r;if(s){i.root="/";r=1}else{r=0}var o=-1;var a=0;var l=-1;var c=true;var h=t.length-1;var u=0;for(;h>=r;--h){n=t.charCodeAt(h);if(n===47){if(!c){a=h+1;break}continue}if(l===-1){c=false;l=h+1}if(n===46){if(o===-1)o=h;else if(u!==1)u=1}else if(o!==-1){u=-1}}if(o===-1||l===-1||u===0||u===1&&o===l-1&&o===a+1){if(l!==-1){if(a===0&&s)i.base=i.name=t.slice(1,l);else i.base=i.name=t.slice(a,l)}}else{if(a===0&&s){i.name=t.slice(1,o);i.base=t.slice(1,l)}else{i.name=t.slice(a,o);i.base=t.slice(a,l)}i.ext=t.slice(o,l)}if(a>0)i.dir=t.slice(0,a-1);else if(s)i.dir="/";return i},sep:"/",delimiter:":",win32:null,posix:null};m.posix=m;t.exports=m}).call(this)}).call(this,e("_process"))},{_process:55}],55:[function(e,t,i){var n=t.exports={};var s;var r;function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){s=setTimeout}else{s=o}}catch(e){s=o}try{if(typeof clearTimeout==="function"){r=clearTimeout}else{r=a}}catch(e){r=a}})();function l(t){if(s===setTimeout){return setTimeout(t,0)}if((s===o||!s)&&setTimeout){s=setTimeout;return setTimeout(t,0)}try{return s(t,0)}catch(e){try{return s.call(null,t,0)}catch(e){return s.call(this,t,0)}}}function c(t){if(r===clearTimeout){return clearTimeout(t)}if((r===a||!r)&&clearTimeout){r=clearTimeout;return clearTimeout(t)}try{return r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}var h=[];var u=false;var p;var f=-1;function d(){if(!u||!p){return}u=false;if(p.length){h=p.concat(h)}else{f=-1}if(h.length){y()}}function y(){if(u){return}var e=l(d);u=true;var t=h.length;while(t){p=h;h=[];while(++f<t){if(p){p[f].run()}}f=-1;t=h.length}p=null;u=false;c(e)}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){t[i-1]=arguments[i]}}h.push(new m(e,t));if(h.length===1&&!u){l(y)}};function m(e,t){this.fun=e;this.array=t}m.prototype.run=function(){this.fun.apply(null,this.array)};n.title="browser";n.browser=true;n.env={};n.argv=[];n.version="";n.versions={};function g(){}n.on=g;n.addListener=g;n.once=g;n.off=g;n.removeListener=g;n.removeAllListeners=g;n.emit=g;n.prependListener=g;n.prependOnceListener=g;n.listeners=function(e){return[]};n.binding=function(e){throw new Error("process.binding is not supported")};n.cwd=function(){return"/"};n.chdir=function(e){throw new Error("process.chdir is not supported")};n.umask=function(){return 0}},{}],56:[function(l,e,c){(function(n,a){(function(){var e=l("process/browser.js").nextTick;var t=Function.prototype.apply;var s=Array.prototype.slice;var r={};var o=0;c.setTimeout=function(){return new i(t.call(setTimeout,window,arguments),clearTimeout)};c.setInterval=function(){return new i(t.call(setInterval,window,arguments),clearInterval)};c.clearTimeout=c.clearInterval=function(e){e.close()};function i(e,t){this._id=e;this._clearFn=t}i.prototype.unref=i.prototype.ref=function(){};i.prototype.close=function(){this._clearFn.call(window,this._id)};c.enroll=function(e,t){clearTimeout(e._idleTimeoutId);e._idleTimeout=t};c.unenroll=function(e){clearTimeout(e._idleTimeoutId);e._idleTimeout=-1};c._unrefActive=c.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;if(e>=0){t._idleTimeoutId=setTimeout(function e(){if(t._onTimeout)t._onTimeout()},e)}};c.setImmediate=typeof n==="function"?n:function(t){var i=o++;var n=arguments.length<2?false:s.call(arguments,1);r[i]=true;e(function e(){if(r[i]){if(n){t.apply(null,n)}else{t.call(null)}c.clearImmediate(i)}});return i};c.clearImmediate=typeof a==="function"?a:function(e){delete r[e]}}).call(this)}).call(this,l("timers").setImmediate,l("timers").clearImmediate)},{"process/browser.js":55,timers:56}]},{},[22]);