(function(){function h(r,o,a){function l(i,e){if(!o[i]){if(!r[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(c)return c(i,!0);var n=new Error("Cannot find module '"+i+"'");throw n.code="MODULE_NOT_FOUND",n}var s=o[i]={exports:{}};r[i][0].call(s.exports,function(e){var t=r[i][1][e];return l(t||e)},s,s.exports,h,r,o,a)}return o[i].exports}for(var c="function"==typeof require&&require,e=0;e<a.length;e++)l(a[e]);return l}return h})()({1:[function(e,t,i){"use strict";const s=e("./GTransition.js");const a=e("./vectorUtils.js");const r=e("seventh");function n(e){this.gScene=e;this.mode=null;this.position={x:0,y:0,z:10};this.target={x:0,y:0,z:0};this.rotation={x:0,y:0,z:0,w:1};this.yaw=0;this.pitch=0;this.roll=0;this.distance=10;this.fov=Math.PI/4;this.perspective=1;this.free=false;this.trackingMode=null;this.babylon={type:null,camera:null};this.setMode("firstPerson")}t.exports=n;n.prototype.update=function(e,t=false){console.warn("3D Camera.update()",e);var i=this.babylon.camera,n=this.gScene.babylon.scene;if(e.mode){this.setMode(e.mode)}if(e.transition){e.transition=new s(e.transition)}if(e.free!==undefined){if(this.updateFree(e.free)){if(!e.position){e.position=this.position}if(!e.rotation){e.rotation=this.rotation}if(!e.target){e.target=this.target}if(e.yaw===undefined){e.yaw=this.yaw}if(e.pitch===undefined){e.pitch=this.pitch}if(e.roll===undefined){e.roll=this.roll}if(e.distance===undefined){e.distance=this.distance}}}switch(this.mode){case"positions":if(e.position||e.target||e.roll!==undefined){this.updateFirstPerson(e,false,true)}break;case"firstPerson":if(e.position||e.yaw!==undefined||e.pitch!==undefined||e.roll!==undefined){this.updateFirstPerson(e)}break;case"firstPersonQuaternion":if(e.position||e.rotation){this.updateFirstPerson(e,true)}break;case"orbital":if(e.target||e.yaw!==undefined||e.pitch!==undefined||e.roll!==undefined||e.distance!==undefined){this.updateOrbital(e)}break}if(e.fov!==undefined){this.fov=e.fov||Math.PI/4;if(e.transition){e.transition.createAnimation(n,i,"fov",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.fov/2)}else{i.fov=this.fov/2}}if(e.trackingMode!==undefined){this.trackingMode=e.trackingMode||null}return t&&e.transition&&e.transition.promise||r.resolved};n.prototype.setMode=function(e){var t,i;console.warn("##### Camera.setMode()",e,this.mode);if(e===this.mode){return}this.mode=e;switch(this.mode){case"positions":case"firstPerson":case"firstPersonQuaternion":if(this.babylon.type==="FreeCamera"){this.babylon.camera.position=new BABYLON.Vector3(this.position.x,this.position.y,this.position.z)}else{this.babylon.type="FreeCamera";if(this.babylon.camera){this.babylon.camera.dispose()}this.babylon.camera=new BABYLON.FreeCamera("Camera",new BABYLON.Vector3(this.position.x,this.position.y,this.position.z),this.gScene.babylon.scene);this.babylon.camera.onViewMatrixChangedObservable.add(()=>{this.gScene.changes.camera=true})}if(this.mode==="positions"){this.babylon.camera.rotationQuaternion=BABYLON.Quaternion.FromEulerVector(a.cameraRotationFromOriginAndTarget(this.position,this.target,this.roll))}else if(this.mode==="firstPersonQuaternion"){this.babylon.camera.rotationQuaternion=new BABYLON.Quaternion(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w)}else{this.babylon.camera.rotationQuaternion=BABYLON.Quaternion.FromEulerAngles(this.pitch,this.yaw,this.roll)}break;case"orbital":t=a.toCameraAlpha(this.yaw);i=a.toCameraBeta(this.pitch);if(this.babylon.type==="ArcRotateCamera"){this.babylon.camera.target=new BABYLON.Vector3(this.target.x,this.target.y,this.target.z);this.babylon.camera.alpha=t;this.babylon.camera.beta=i;this.babylon.camera.radius=this.distance}else{this.babylon.type="ArcRotateCamera";if(this.babylon.camera){this.babylon.camera.dispose()}this.babylon.camera=new BABYLON.ArcRotateCamera("Camera",t,i,this.distance,new BABYLON.Vector3(this.target.x,this.target.y,this.target.z),this.gScene.babylon.scene);this.babylon.camera.onViewMatrixChangedObservable.add(()=>{this.gScene.changes.camera=true})}break;default:return}this.babylon.camera.wheelPrecision=100;console.warn("~~~~~~ Camera.setMode() done")};n.prototype.updateFree=function(e){e=!!e;if(e===this.free){return}this.free=e;if(!this.free){this.babylon.camera.detachControl();return true}this.babylon.camera.attachControl();return false};n.prototype.updateFirstPerson=function(e,t,i){var n,s,r=this.babylon.camera,o=this.gScene.babylon.scene;if(e.position){this.position=e.position}if(e.target){this.target=e.target}if(e.rotation){this.rotation=e.rotation}if(e.yaw!==undefined){this.yaw=e.yaw}if(e.pitch!==undefined){this.pitch=e.pitch}if(e.roll!==undefined){this.roll=e.roll}if(i){s=BABYLON.Quaternion.FromEulerVector(a.cameraRotationFromOriginAndTarget(this.position,this.target,this.roll))}else if(t){if(e.rotation){s=new BABYLON.Quaternion(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w)}}else if(e.yaw!==undefined||e.pitch!==undefined||e.roll!==undefined){s=BABYLON.Quaternion.FromEulerAngles(this.pitch,this.yaw,this.roll)}if(e.transition){n=r.rotationQuaternion?r.rotationQuaternion:BABYLON.Quaternion.FromEulerVector(r.rotation);console.warn("[!] camera transition:",r,n,s);if(e.position){e.transition.createAnimation(o,r,"position",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(this.position.x,this.position.y,this.position.z))}if(s){e.transition.createAnimation(o,r,"rotationQuaternion",BABYLON.Animation.ANIMATIONTYPE_QUATERNION,s,n)}}else{console.warn("[!] camera direct:",r,s);if(e.position){r.position=new BABYLON.Vector3(this.position.x,this.position.y,this.position.z)}if(s){r.rotationQuaternion=s}}};n.prototype.updateOrbital=function(e){var t,i,n=this.babylon.camera,s=this.gScene.babylon.scene;if(e.target){this.target=e.target}if(e.yaw){this.yaw=e.yaw;t=a.toCameraAlpha(this.yaw)}if(e.pitch){this.pitch=e.pitch;i=a.toCameraBeta(this.pitch)}if(e.distance){this.distance=e.distance}if(e.transition){console.warn("[!] camera transition:",n);if(e.target){e.transition.createAnimation(s,n,"target",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(this.target.x,this.target.y,this.target.z))}if(e.yaw){e.transition.createAnimation(s,n,"alpha",BABYLON.Animation.ANIMATIONTYPE_FLOAT,t)}if(e.pitch){e.transition.createAnimation(s,n,"beta",BABYLON.Animation.ANIMATIONTYPE_FLOAT,i)}if(e.distance){e.transition.createAnimation(s,n,"radius",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.distance)}}else{console.warn("[!] camera direct:",n);if(e.target){n.target=new BABYLON.Vector3(this.target.x,this.target.y,this.target.z)}if(e.yaw){n.alpha=t}if(e.pitch){n.beta=i}if(e.distance){n.radius=this.distance}}}},{"./GTransition.js":16,"./vectorUtils.js":20,seventh:42}],2:[function(e,t,i){"use strict";const n=e("./GTransition.js");const s=e("./Parametric.js");const r=e("nextgen-events/lib/browser.js");const o=e("seventh");function a(e,t,i){this.id=i.id||null;this.dom=e;this.gScene=t;this.usage=i.usage||"sprite";this.transient=i.transient||undefined;this.parent=undefined;this.show=false;this.persistent=true;this.button=null;this.theme=null;this.texturePack=null;this.variant="default";this.frame=0;this.opacity=1;this.location=null;this.origin={x:0,y:0,z:0};this.position={x:0,y:0,z:0};this.positionMode="default";this.size={x:1,y:1,z:1};this.sizeMode="default";this.rotation={x:0,y:0,z:0};this.rotationMode="default";this.direction={x:1,y:0,z:0};this.facing=0;this.opacity=1;this.special={};this.meta={};this.engine={};this.parametric=null;this.clientMods={variant:null,xFlipVariant:null,xFlip:false,origin:null,size:null};this.updateMeshNeeded=true;this.updateMaterialNeeded=true;this.createLightNeeded=false;this.texturePackObject=null;this.variantObject=null;this.frameObject=null;this.lightEmitting=false;this.textureCache={};this.textureAnimationTimer=null;this.children=new Set;if(i.parent){this.setParent(i.parent)}this.babylon={material:null,mesh:null,light:null,texture:null,particleSystem:null};this.nextTextureFrame=this.nextTextureFrame.bind(this);this.defineStates("loaded","loading");if(this.transient){setTimeout(()=>this.destroy(),this.transient*1e3)}if(this.noLocalLighting){this.gScene.noLocalLightingGEntities.add(this);this.gScene.once("render",()=>this.gScene.updateLightExcludedMeshes(),{unique:true,id:"updateLightExcludedMeshes"})}}a.prototype=Object.create(r.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.localBBoxSize=1;a.prototype.noLocalLighting=false;a.prototype.isLocalLight=true;a.prototype.destroy=function(){if(this.noLocalLighting){this.gScene.noLocalLightingGEntities.remove(this);this.gScene.once("render",()=>this.gScene.updateLightExcludedMeshes(),{unique:true,id:"updateLightExcludedMeshes"})}if(this.children.size){for(let e of this.children){e.destroy()}}if(this.babylon.mesh){this.babylon.mesh.parent=null;this.babylon.mesh.dispose();this.babylon.mesh=null}if(this.babylon.material){this.babylon.material.dispose(false,false,true);this.babylon.material=null}if(this.babylon.texture){this.babylon.texture.dispose();this.babylon.texture=null}if(this.babylon.particleSystem){this.babylon.particleSystem.dispose();this.babylon.particleSystem=null}this.gScene.removeGEntity(this.id);this.destroyed=true};a.prototype.setParent=function(e){var t=this.gScene.gEntities[e];if(!t){return}this.parent=t;t.addChild(this)};a.prototype.addChild=function(e){this.children.add(e)};a.prototype.update=async function(e,t=false,i=false){console.warn("3D GEntity.update()",e);if(e.transition){if(i){delete e.transition}else{e.transition=new n(e.transition)}}if(e.engine!==undefined){await this.updateEngine(e.engine)}if(e.special!==undefined){await this.updateSpecialStage1(e)}if(e.texturePack!==undefined||e.variant!==undefined||e.theme!==undefined){await this.updateTexture(e.texturePack,e.variant,e.theme)}if(this.updateMeshNeeded){await this.updateMesh()}if(this.updateMaterialNeeded){await this.updateMaterial()}if(this.createLightNeeded){this.createLightNeeded=false;this.lightEmitting=true;await this.createLight()}if(e.special!==undefined){await this.updateSpecialStage2(e)}if(typeof e.opacity==="number"){this.updateOpacity(e.opacity)}if(e.origin!==undefined){this.updateOrigin(e.origin)}if(e.direction!==undefined){this.updateDirection(e.direction)}if(e.facing!==undefined){this.updateFacing(e.facing)}if(e.position!==undefined||e.positionMode!==undefined){this.updatePosition(e)}if(e.rotation!==undefined||e.rotationMode!==undefined){this.updateRotation(e)}if(e.size!==undefined||e.sizeMode!==undefined){this.updateSize(e.size)}if(e.parametric!==undefined){if(!e.parametric){if(this.parametric){this.parametric=null;this.gScene.parametricGEntities.delete(this)}}else if(typeof e.parametric==="object"){if(!this.parametric){this.gScene.parametricGEntities.add(this);this.parametric=new s(e.parametric)}else{this.parametric.update(e.parametric)}}console.warn("@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 3D GEntity.update() parametric",e)}return t&&e.transition&&e.transition.promise||o.resolved};a.prototype.parametricUpdate=function(e){var t=this.parametric.compute(e,this);if(!t){this.parametric=null;this.gScene.parametricGEntities.delete(this);return}if(typeof t.opacity==="number"){this.updateOpacity(t.opacity,true)}if(t.position!==undefined||t.positionMode!==undefined){this.updatePosition(t,true)}if(t.rotation!==undefined||t.rotationMode!==undefined){this.updateRotation(t,true)}if(t.size!==undefined||t.sizeMode!==undefined){this.updateSize(t.size,true)}};a.prototype.updateEngine=function(e){};a.prototype.updateSpecialStage1=function(e){};a.prototype.updateSpecialStage2=function(e){if(e.special.light!==undefined){this.updateLight(e)}if(e.special&&e.special.material){this.updateMaterialParams(e.special.material)}};a.prototype.updateDirection=function(e){this.direction=e};a.prototype.updateFacing=function(e){this.facing=e};a.prototype.updateMesh=function(){this.updateMeshNeeded=false};a.prototype.refreshMaterial=async function(){this.updateTexture();if(this.updateMaterialNeeded){await this.updateMaterial()}};a.prototype.updateMaterial=function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;console.warn("3D GEntity.updateMaterial()",this.texturePackObject,this.variantObject);this.babylon.material=e=new BABYLON.StandardMaterial("basicMaterial",i);e.ambientColor=new BABYLON.Color3(1,1,1);e.diffuseColor=new BABYLON.Color3(0,0,0);e.specularColor=new BABYLON.Color3(0,0,0);e.emissiveColor=new BABYLON.Color3(0,0,0);e.backFaceCulling=true;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};a.prototype.updateMaterialParams=function(e,t=false){var i,n,s,r=this.babylon.material;console.warn("@@@@@@@@@@@@@@@@@@ updateMaterialParams()",e);if(e.ambient&&typeof e.ambient==="object"){if(!this.special.ambient){this.special.ambient={r:1,g:1,b:1}}i=e.ambient.r!==undefined?e.ambient.r:this.special.ambient.r,n=e.ambient.g!==undefined?e.ambient.g:this.special.ambient.g,s=e.ambient.b!==undefined?e.ambient.b:this.special.ambient.b;if(!t){this.special.ambient.r=i;this.special.ambient.g=n;this.special.ambient.b=s}r.ambientColor.set(i,n,s)}if(e.diffuse&&typeof e.diffuse==="object"){if(!this.special.diffuse){this.special.diffuse={r:0,g:0,b:0}}i=e.diffuse.r!==undefined?e.diffuse.r:this.special.diffuse.r,n=e.diffuse.g!==undefined?e.diffuse.g:this.special.diffuse.g,s=e.diffuse.b!==undefined?e.diffuse.b:this.special.diffuse.b;if(!t){this.special.diffuse.r=i;this.special.diffuse.g=n;this.special.diffuse.b=s}r.diffuseColor.set(i,n,s)}if(e.specular&&typeof e.specular==="object"){if(!this.special.specular){this.special.specular={r:0,g:0,b:0}}i=e.specular.r!==undefined?e.specular.r:this.special.specular.r,n=e.specular.g!==undefined?e.specular.g:this.special.specular.g,s=e.specular.b!==undefined?e.specular.b:this.special.specular.b;if(!t){this.special.specular.r=i;this.special.specular.g=n;this.special.specular.b=s}r.specularColor.set(i,n,s)}if(e.emissive&&typeof e.emissive==="object"){console.warn("@@@@@@@@@@@@@@@@@@ updateMaterialParams() emissive",e.emissive);if(!this.special.emissive){this.special.emissive={r:0,g:0,b:0}}i=e.emissive.r!==undefined?e.emissive.r:this.special.emissive.r,n=e.emissive.g!==undefined?e.emissive.g:this.special.emissive.g,s=e.emissive.b!==undefined?e.emissive.b:this.special.emissive.b;if(!t){this.special.emissive.r=i;this.special.emissive.g=n;this.special.emissive.b=s}r.emissiveColor.set(i,n,s)}};a.prototype.updateOpacity=function(e,t=false){var i=this.babylon.material;if(!i){return}if(e<0){e=0}else if(e>1){e=1}if(!t){this.opacity=e}i.alpha=e};a.prototype.updateTexture=function(e,t,i,n,s=false){var r,o,a;if(e!==undefined){this.texturePack=e||null}if(t!==undefined){this.variant=t||null}if(i!==undefined){this.theme=i||null}console.warn("3D GEntity.updateTexture()",e,t,i);r=this.gScene.texturePacks[this.texturePack+"/"+(this.theme||this.gScene.theme)];if(!r){console.warn("3D Texture pack",this.texturePack+"/"+(this.theme||this.gScene.theme),"not found");r=this.gScene.texturePacks[this.texturePack+"/default"];if(!r){console.warn("3D Texture pack fallback",this.texturePack+"/default","not found");return}}var l=this.clientMods.xFlip;this.clientMods.xFlip=false;if(this.clientMods.variant){o=r.variants[this.variant+"@"+this.clientMods.variant];if(!o){o=r.variants[this.variant+"@"+this.clientMods.xFlipVariant];if(o){this.clientMods.xFlip=true}else{o=r.variants[this.variant]||r.variants.default}}}else{o=r.variants[this.variant]||r.variants.default}if(!o){console.warn("3D Texture pack variant",this.variant,"not found, and default variant missing too");return}if(o===this.variantObject){if(n!==undefined){this.frame=o.frames[n]?+n:0}}else{this.frame=n!==undefined&&o.frames[n]?+n:0}a=o.frames[this.frame]||o.frames[0];if(r!==this.texturePackObject){this.whenTextureCacheReady().then(()=>{if(r===this.texturePackObject){this.preloadTexturePack()}})}if(r===this.texturePackObject&&o===this.variantObject&&a===this.frameObject&&l===this.clientMods.xFlip){return}this.texturePackObject=r;this.variantObject=o;this.frameObject=a;if(this.variantObject.animation){this.startTextureAnimation(!s)}else{this.stopTextureAnimation()}this.updateMaterialNeeded=true};a.prototype.startTextureAnimation=function(e=false){if(!this.variantObject.animation){if(this.textureAnimationTimer){clearTimeout(this.textureAnimationTimer);this.textureAnimationTimer=null}return}if(this.textureAnimationTimer){if(!e){return}clearTimeout(this.textureAnimationTimer);this.textureAnimationTimer=null}this.textureAnimationTimer=setTimeout(this.nextTextureFrame,1e3*this.frameObject.duration)};a.prototype.stopTextureAnimation=function(){if(this.textureAnimationTimer){clearTimeout(this.textureAnimationTimer);this.textureAnimationTimer=null}};a.prototype.nextTextureFrame=function(){if(this.frame>=this.variantObject.frames.length-1){if(this.variantObject.animation==="loop"){this.frame=0}else{this.stopTextureAnimation();return}}else{this.frame++}this.frameObject=this.variantObject.frames[this.frame];this.textureAnimationTimer=setTimeout(this.nextTextureFrame,1e3*this.frameObject.duration);this.updateMaterial()};a.prototype.updateOrigin=function(e,t=false){if(this.clientMods.origin&&!t){this.origin=e;return}var i=this.clientMods.origin||this.origin;if(i.x===e.x&&i.y===e.y&&i.z===e.z){return}var n=this.babylon.mesh,s=this.localBBoxSize/2;n.bakeTransformIntoVertices(BABYLON.Matrix.Translation((i.x-e.x)*s,(i.y-e.y)*s,(i.z-e.z)*s));if(t){this.clientMods.origin=e}else{this.origin=e}};a.prototype.updatePosition=function(e,t=false){var i=this.babylon.mesh,n=this.gScene.babylon.scene;if(!i){return}var s=e.position.x!==undefined?e.position.x:this.position.x,r=e.position.y!==undefined?e.position.y:this.position.y,o=e.position.z!==undefined?e.position.z:this.position.z;if(!t){this.position.x=s;this.position.y=r;this.position.z=o}if(e.transition){e.transition.createAnimation(n,i,"position",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(s,r,o))}else{i.position.set(s,r,o)}};a.prototype.updateRotation=function(e,t=false){console.warn("3D GEntity.updateRotation()",e);var i=this.babylon.mesh,n=this.gScene.babylon.scene;if(!i){return}var s=e.rotation.x!==undefined?e.rotation.x:this.rotation.x,r=e.rotation.y!==undefined?e.rotation.y:this.rotation.y,o=e.rotation.z!==undefined?e.rotation.z:this.rotation.z;if(!t){this.rotation.x=s;this.rotation.y=r;this.rotation.z=o}i.angle=o};a.prototype.updateSize=function(e,t=false,i=false){console.warn("3D GEntity.updateSize()",e);var n,s,r,o=this.babylon.mesh,a=this.gScene.babylon.scene;if(i){this.clientMods.size={x:e.x!==undefined?e.x:1,y:e.y!==undefined?e.y:1,z:e.z!==undefined?e.z:1};n=this.size.x;s=this.size.y;r=this.size.z}else if(t){n=e.x!==undefined?e.x:this.size.x;s=e.y!==undefined?e.y:this.size.y;r=e.z!==undefined?e.z:this.size.z}else{n=this.size.x=e.x!==undefined?e.x:this.size.x;s=this.size.y=e.y!==undefined?e.y:this.size.y;r=this.size.z=e.z!==undefined?e.z:this.size.z}if(!o){return}if(this.clientMods.size){n*=this.clientMods.size.x;s*=this.clientMods.size.y;r*=this.clientMods.size.z}o.scaling.x=n;o.scaling.y=s;o.scaling.z=r};a.prototype.updateLight=function(e,t=false){console.warn("3D GEntity.updateLight()",e);if(e.special.light===undefined){return}if(!e.special.light!==!this.lightEmitting){this.lightEmitting=!!e.special.light;if(!this.lightEmitting){this.destroyLight();return}this.createLight()}if(!e.special.light||typeof e.special.light!=="object"){return}var i=this.gScene.babylon.scene,n=this.babylon.light;if(e.special.light.diffuse&&typeof e.special.light.diffuse==="object"){this.special.light.diffuse=e.special.light.diffuse;if(e.transition){e.transition.createAnimation(i,n,"diffuse",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(this.special.light.diffuse.r,this.special.light.diffuse.g,this.special.light.diffuse.b))}else{n.diffuse.set(this.special.light.diffuse.r,this.special.light.diffuse.g,this.special.light.diffuse.b)}}if(e.special.light.specular&&typeof e.special.light.specular==="object"){this.special.light.specular=e.special.light.specular;if(e.transition){e.transition.createAnimation(i,n,"specular",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(this.special.light.specular.r,this.special.light.specular.g,this.special.light.specular.b))}else{n.specular.set(this.special.light.specular.r,this.special.light.specular.g,this.special.light.specular.b)}}if(e.special.light.intensity!==undefined){this.special.light.intensity=e.special.light.intensity;if(e.transition){e.transition.createAnimation(i,n,"intensity",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.light.intensity)}else{n.intensity=this.special.light.intensity}}};a.prototype.createLight=function(){console.warn("@@@@@@@@@@@@@@@@@@@@@@@@@ GEntity.createLight()");if(!this.babylon.mesh){throw new Error("Non pure light GEntity needs a mesh to be light-emitting")}var e=this.gScene.babylon.scene;if(!this.special.light){this.special.light={diffuse:new BABYLON.Color3(1,1,1),specular:new BABYLON.Color3(.5,.5,.5),intensity:1}}this.babylon.light=new BABYLON.PointLight("pointLight",new BABYLON.Vector3(0,0,0),e);this.babylon.light.parent=this.babylon.mesh;this.babylon.light.diffuse=this.special.light.diffuse;this.babylon.light.specular=this.special.light.specular;this.babylon.light.intensity=this.special.light.intensity;if(this.isLocalLight){this.registerLocalLight()}};a.prototype.destroyLight=function(){if(this.isLocalLight){this.unregisterLocalLight()}if(this.babylon.light){this.babylon.light.dispose()}this.special.light=null};a.prototype.registerLocalLight=function(){this.gScene.localLightGEntities.add(this);this.babylon.light.excludedMeshes=[...this.gScene.noLocalLightingGEntities].map(e=>e.babylon.mesh)};a.prototype.unregisterLocalLight=function(){this.gScene.localLightGEntities.delete(this)};a.prototype.getTexture=function(e){var t,i=this.gScene.babylon.scene;e=this.dom.cleanUrl(e);if(this.textureCache[e]){return this.textureCache[e]}t=this.textureCache[e]=new BABYLON.Texture(e,i);return t};a.prototype.preloadTexturePack=function(){var e,t,i,n,s=[];for(e in this.texturePackObject.variants){t=this.texturePackObject.variants[e];for(i of t.frames){if(i.url){s.push(this.getTexture(i.url))}if(i.maps){for(n in i.maps){s.push(this.getTexture(i.maps[n]))}}}}return new o(e=>BABYLON.Texture.WhenAllReady(s,()=>e()))};a.prototype.whenTextureCacheReady=function(){return new o(e=>BABYLON.Texture.WhenAllReady([...Object.values(this.textureCache)],()=>e()))};a.prototype.flipTexture=function(e,t,i){if(t){e.uScale=-1;e.uOffset=1}else{e.uScale=1;e.uOffset=0}if(i){e.vScale=-1;e.vOffset=1}else{e.vScale=1;e.vOffset=0}};a.prototype.updateSizeFromPixelDensity=function(e,t){var i;if(e.isReady()){i=e.getBaseSize();this.updateSize({x:i.width/t,y:i.height/t},false,true)}else{BABYLON.Texture.WhenAllReady([e],()=>{i=e.getBaseSize();this.updateSize({x:i.width/t,y:i.height/t},false,true)})}}},{"./GTransition.js":16,"./Parametric.js":17,"nextgen-events/lib/browser.js":30,seventh:42}],3:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("seventh");function o(e,t,i){n.call(this,e,t,i)}o.prototype=Object.create(n.prototype);o.prototype.constructor=o;t.exports=o;o.prototype.localBBoxSize=1e3;o.prototype.noLocalLighting=true;o.prototype.updateMaterial=function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;console.warn("3D GEntityBackground.updateMaterial()",this.texturePackObject,this.variantObject);var s=this.variantObject.frames[0].url;this.babylon.material=e=new BABYLON.StandardMaterial("simpleMaterial",i);e.backFaceCulling=true;e.diffuseTexture=new BABYLON.Texture(this.dom.cleanUrl(s),i);e.specularColor=new BABYLON.Color3(0,0,0);e.ambientColor=new BABYLON.Color3(1,1,1);e.backFaceCulling=false;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};o.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.MeshBuilder.CreateCylinder("background",{height:this.localBBoxSize,diameter:this.localBBoxSize,tessellation:24,cap:BABYLON.Mesh.NO_CAP,sideOrientation:BABYLON.Mesh.BACKSIDE},t);this.updateMeshNeeded=false;return e}},{"./GEntity.js":2,"./GTransition.js":16,seventh:42}],4:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");const a={sphere:"CreateSphere"};function l(e,t,i){n.call(this,e,t,i);this.shapeClass=null;this.shapeParams={}}l.prototype=Object.create(n.prototype);l.prototype.constructor=l;t.exports=l;l.prototype.updateSpecialStage1=function(e){n.prototype.updateSpecialStage1.call(this,e);if(e.special.shape&&typeof e.special.shape==="object"){if(e.special.shape&&a[e.special.shape.type]){this.shapeClass=a[e.special.shape.type]}Object.assign(this.shapeParams,e.special.shape);this.updateMeshNeeded=true}};l.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;console.warn("@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ GEntityBasicShape.updateMesh()",this.shapeClass);if(!this.shapeClass){return}if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.MeshBuilder[this.shapeClass]("basic-shape",this.shapeParams,t);e.scaling.x=this.size.x;e.scaling.y=this.size.y;e.scaling.z=this.size.z;console.warn("@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Mesh:",e);this.updateMeshNeeded=false;return e}},{"./GEntity.js":2,"./GTransition.js":16,"./vectorUtils.js":20,seventh:42}],5:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.updateMeshNeeded=this.updateMaterialNeeded=false}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.isLocalLight=false;a.prototype.updateLight=function(e){console.warn("3D GEntityDirectionalLight.updateLight()",e);n.prototype.updateLight.call(this,e);if(!e.special.light||typeof e.special.light!=="object"){return}var t=this.gScene.babylon.scene,i=this.babylon.light;if(e.special.light.direction&&typeof e.special.light.direction==="object"){this.special.light.direction=e.special.light.direction;if(e.transition){e.transition.createAnimation(t,i,"direction",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(this.special.light.direction.x,this.special.light.direction.y,this.special.light.direction.z))}else{i.direction.set(this.special.light.direction.x,this.special.light.direction.y,this.special.light.direction.z)}}};a.prototype.createLight=function(){var e=this.gScene.babylon.scene;if(this.babylon.light){console.warn("GEntityDirectionalLight.createLight(): light is already existing");return}if(!this.special.light){this.special.light={direction:new BABYLON.Vector3(0,-1,0),diffuse:new BABYLON.Color3(1,1,1),specular:new BABYLON.Color3(0,0,0),intensity:.2}}this.babylon.light=new BABYLON.DirectionalLight("directionalLight",this.special.light.direction,e);this.babylon.light.diffuse=this.special.light.diffuse;this.babylon.light.specular=this.special.light.specular;this.babylon.light.intensity=this.special.light.intensity;if(this.isLocalLight){this.registerLocalLight()}}},{"./GEntity.js":2,"./GTransition.js":16,"./vectorUtils.js":20,seventh:42}],6:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.special.content={text:"",textColor:"white"}}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.destroy=function(){if(this.babylon.advancedTexture){this.babylon.advancedTexture.parent=null;this.babylon.advancedTexture.dispose()}n.prototype.destroy.call(this)};a.prototype.updateTexture=function(){};a.prototype.updateMaterial=function(){var e,t,i,n=this.gScene.babylon.scene,s=this.babylon.mesh;console.warn("3D GEntityFloatingText.updateMaterial()");if(this.babylon.advancedTexture){e=this.babylon.advancedTexture}else{if(!s){s=this.updateMesh()}this.babylon.advancedTexture=e=BABYLON.GUI.AdvancedDynamicTexture.CreateForMesh(s,1024,64)}if(this.babylon.textBlock){t=this.babylon.textBlock}else{this.babylon.textBlock=t=new BABYLON.GUI.TextBlock;t.fontSizeInPixels=46;t.text=this.special.content.text;t.color=this.special.content.textColor;t.alpha=this.opacity;t.resizeToFit=true;e.addControl(t)}this.updateMaterialNeeded=false};const l=.7;a.prototype.updateContent=function(e){var t,i=this.babylon.advancedTexture,n=this.babylon.textBlock;if(!n){return}if(e.text!==undefined){n.text=this.special.content.text=""+e.text}if(typeof e.textColor==="string"){n.color=this.special.content.textColor=e.textColor}if(typeof e.outlineColor==="string"){n.outlineColor=this.special.content.outlineColor=e.outlineColor}if(typeof e.outlineWidth==="number"){n.outlineWidth=this.special.content.outlineWidth=e.outlineWidth}if(typeof e.shadowColor==="string"){n.shadowColor=this.special.content.shadowColor=e.shadowColor}if(typeof e.shadowBlur==="number"){n.shadowBlur=this.special.content.shadowBlur=e.shadowBlur}if(e.icon){if(this.babylon.icon){t=this.babylon.icon;t.source=this.dom.cleanUrl(e.icon);t.width=l*.0625;t.height=l}else{this.babylon.icon=t=new BABYLON.GUI.Image("icon",this.dom.cleanUrl(e.icon));t.width=l*.0625;t.height=l;i.addControl(t)}this.fixIcon()}};a.prototype.fixIcon=function(){if(this.babylon.textBlock._width.isPixel){this.babylon.icon.left=-32-this.babylon.textBlock.widthInPixels/2}else{setTimeout(()=>this.fixIcon(),10)}};a.prototype.updateMaterialParams=function(e,t=false){};a.prototype.updateOpacity=function(e,t=false){if(e<0){e=0}else if(e>1){e=1}if(!t){this.opacity=e}if(this.babylon.textBlock){this.babylon.textBlock.alpha=e}if(this.babylon.icon){this.babylon.icon.alpha=e}};a.prototype.updateMesh=function(){var e,t,i=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.PlaneBuilder.CreatePlane("floating-text",{width:80,height:5},i);e.billboardMode=BABYLON.AbstractMesh.BILLBOARDMODE_ALL;if(this.parent&&this.parent.babylon.mesh){e.parent=t=this.parent.babylon.mesh;e.scaling.x=1/t.scaling.x;e.scaling.y=1/t.scaling.y}console.warn("GEntityFloatingText .updateMesh() Mesh:",e);this.updateMeshNeeded=false;return e};a.prototype.updateSpecialStage2=function(e){if(e.special&&e.special.content){this.updateContent(e.special.content)}}},{"./GEntity.js":2,"./GTransition.js":16,"./vectorUtils.js":20,seventh:42}],7:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("seventh");function o(e,t,i){n.call(this,e,t,i)}o.prototype=Object.create(n.prototype);o.prototype.constructor=o;t.exports=o;o.prototype.updateMaterial=function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;console.warn("3D GEntityGround.updateMaterial()",this.texturePackObject,this.variantObject);var s=this.variantObject.frames[0].url;this.babylon.material=e=new BABYLON.StandardMaterial("simpleMaterial",i);e.backFaceCulling=true;e.diffuseTexture=new BABYLON.Texture(this.dom.cleanUrl(s),i);e.diffuseTexture.uScale=20;e.diffuseTexture.vScale=20;e.specularColor=new BABYLON.Color3(0,0,0);e.ambientColor=new BABYLON.Color3(1,1,1);e.backFaceCulling=false;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};o.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.MeshBuilder.CreateGround("ground",{height:1e3,width:1e3,subdivisions:4},t);this.updateMeshNeeded=false;return e}},{"./GEntity.js":2,"./GTransition.js":16,seventh:42}],8:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.updateMeshNeeded=this.updateMaterialNeeded=false;this.createLightNeeded=true}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.isLocalLight=false;a.prototype.updateLight=function(e){console.warn("3D GEntityHemisphericLight.updateLight()",e);n.prototype.updateLight.call(this,e);if(!e.special.light||typeof e.special.light!=="object"){return}var t=this.gScene.babylon.scene,i=this.babylon.light;if(e.special.light.ground&&typeof e.special.light.ground==="object"){this.special.light.ground=e.special.light.ground;if(e.transition){e.transition.createAnimation(t,i,"groundColor",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(this.special.light.ground.r,this.special.light.ground.g,this.special.light.ground.b))}else{i.groundColor.set(this.special.light.ground.r,this.special.light.ground.g,this.special.light.ground.b)}}if(e.special.light.up&&typeof e.special.light.up==="object"){this.special.light.up=e.special.light.up;if(e.transition){e.transition.createAnimation(t,i,"direction",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(this.special.light.up.x,this.special.light.up.y,this.special.light.up.z))}else{i.direction.set(this.special.light.up.x,this.special.light.up.y,this.special.light.up.z)}}};a.prototype.createLight=function(){var e=this.gScene.babylon.scene;if(this.babylon.light){console.warn("GEntityHemisphericLight.createLight(): light is already existing");return}if(!this.special.light){this.special.light={up:new BABYLON.Vector3(0,1,0),diffuse:new BABYLON.Color3(1,1,1),specular:new BABYLON.Color3(0,0,0),ground:new BABYLON.Color3(.2,.2,.2),intensity:.2}}this.babylon.light=new BABYLON.HemisphericLight("hemisphericLight",this.special.light.up,e);this.babylon.light.diffuse=this.special.light.diffuse;this.babylon.light.specular=this.special.light.specular;this.babylon.light.groundColor=this.special.light.ground;this.babylon.light.intensity=this.special.light.intensity;if(this.isLocalLight){this.registerLocalLight()}}},{"./GEntity.js":2,"./GTransition.js":16,"./vectorUtils.js":20,seventh:42}],9:[function(e,t,i){"use strict";const s=e("./GEntity.js");const n=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){s.call(this,e,t,i);this.special.particleSystem={capacity:100,updateRate:1,attachToCamera:false,shape:{type:"box",xmin:0,xmax:0,ymin:0,ymax:0,zmin:0,zmax:0,minRadius:0,maxRadius:0,height:0,angle:0},emitRate:100,duration:{min:10,max:10},blendMode:l.default,speed:{x:0,y:0,z:0,xyzmin:1,xyzmax:1},altSpeed:null,speedGradient:null,rotation:{min:0,max:0},rotationSpeed:{min:0,max:0},rotationSpeedGradient:null,acceleration:{x:0,y:0,z:0},size:{xmin:1,xmax:1,ymin:1,ymax:1,xymin:1,xymax:1},color:{r:1,g:1,b:1,a:1},altColor:null,endColor:null,colorGradient:null,autoFacing:"all"};this.emitterShape="box"}a.prototype=Object.create(s.prototype);a.prototype.constructor=a;t.exports=a;const l={add:BABYLON.ParticleSystem.BLENDMODE_ADD,multiply:BABYLON.ParticleSystem.BLENDMODE_MULTIPLY,multiplyAdd:BABYLON.ParticleSystem.BLENDMODE_MULTIPLYADD,oneOne:BABYLON.ParticleSystem.BLENDMODE_ONEONE,standard:BABYLON.ParticleSystem.BLENDMODE_STANDARD};l.default=l.standard;const c={box:"box",sphere:"sphere",hemisphere:"hemisphere",hemispheric:"hemisphere",cylinder:"cylinder",cone:"cone"};const h={none:"none",all:"all","all-axis":"all",y:"y","y-axis":"y"};a.prototype.updateSpecialStage2=function(e){var i,n;s.prototype.updateSpecialStage2.call(this,e);if(e.special.particleSystem&&typeof e.special.particleSystem==="object"){n=e.special.particleSystem;i=this.special.particleSystem;if(Number.isFinite(n.capacity)){i.capacity=n.capacity}if(Number.isFinite(n.updateRate)){i.updateRate=n.updateRate}if(typeof n.attachToCamera==="boolean"){i.attachToCamera=n.attachToCamera}if(n.shape&&typeof n.shape==="object"){if(n.shape.type&&c[n.shape.type]){i.shape.type=c[n.shape.type]}if(Number.isFinite(n.shape.xmin)){i.shape.xmin=n.shape.xmin}if(Number.isFinite(n.shape.ymin)){i.shape.ymin=n.shape.ymin}if(Number.isFinite(n.shape.zmin)){i.shape.zmin=n.shape.zmin}if(Number.isFinite(n.shape.xmax)){i.shape.xmax=n.shape.xmax}if(Number.isFinite(n.shape.ymax)){i.shape.ymax=n.shape.ymax}if(Number.isFinite(n.shape.zmax)){i.shape.zmax=n.shape.zmax}if(Number.isFinite(n.shape.minRadius)){i.shape.minRadius=n.shape.minRadius}if(Number.isFinite(n.shape.maxRadius)){i.shape.maxRadius=n.shape.maxRadius}else if(Number.isFinite(n.shape.radius)){i.shape.maxRadius=n.shape.radius}if(Number.isFinite(n.shape.height)){i.shape.height=n.shape.height}if(Number.isFinite(n.shape.angle)){i.shape.angle=n.shape.angle}}if(Number.isFinite(n.emitRate)){i.emitRate=n.emitRate}if(n.duration!==undefined){if(typeof n.duration==="object"){if(Number.isFinite(n.duration.min)){i.duration.min=n.duration.min}if(Number.isFinite(n.duration.max)){i.duration.max=n.duration.max}}else if(Number.isFinite(n.duration)){i.duration.min=i.duration.max=n.duration}}if(n.blendMode&&l[n.blendMode]){i.blendMode=l[n.blendMode]}if(n.speed&&typeof n.speed==="object"){if(Number.isFinite(n.speed.x)){i.speed.x=n.speed.x}if(Number.isFinite(n.speed.y)){i.speed.y=n.speed.y}if(Number.isFinite(n.speed.z)){i.speed.z=n.speed.z}if(Number.isFinite(n.speed.xyzmin)){i.speed.xyzmin=n.speed.xyzmin}if(Number.isFinite(n.speed.xyzmax)){i.speed.xyzmax=n.speed.xyzmax}}if(n.altSpeed===null){i.altSpeed=null}else if(n.altSpeed&&typeof n.altSpeed==="object"){if(!i.altSpeed){i.altSpeed={x:0,y:0,z:0}}if(Number.isFinite(n.altSpeed.x)){i.altSpeed.x=n.altSpeed.x}if(Number.isFinite(n.altSpeed.y)){i.altSpeed.y=n.altSpeed.y}if(Number.isFinite(n.altSpeed.z)){i.altSpeed.z=n.altSpeed.z}}if(n.speedGradient===null){i.speedGradient=null}else if(Array.isArray(n.speedGradient)&&n.speedGradient.length>=2){if(i.speedGradient){i.speedGradient.length=0}else{i.speedGradient=[]}for(let t of n.speedGradient){let e={t:0,xyz:1};i.speedGradient.push(e);if(Number.isFinite(t.t)){e.t=t.t}if(Number.isFinite(t.xyz)){e.xyz=t.xyz}}}if(n.acceleration&&typeof n.acceleration==="object"){if(Number.isFinite(n.acceleration.x)){i.acceleration.x=n.acceleration.x}if(Number.isFinite(n.acceleration.y)){i.acceleration.y=n.acceleration.y}if(Number.isFinite(n.acceleration.z)){i.acceleration.z=n.acceleration.z}}if(n.rotation!==undefined){if(typeof n.rotation==="object"){if(Number.isFinite(n.rotation.min)){i.rotation.min=n.rotation.min}if(Number.isFinite(n.rotation.max)){i.rotation.max=n.rotation.max}}else if(Number.isFinite(n.rotation)){i.rotation.min=i.rotation.max=n.rotation}}if(n.rotationSpeed!==undefined){if(typeof n.rotationSpeed==="object"){if(Number.isFinite(n.rotationSpeed.min)){i.rotationSpeed.min=n.rotationSpeed.min}if(Number.isFinite(n.rotationSpeed.max)){i.rotationSpeed.max=n.rotationSpeed.max}}else if(Number.isFinite(n.rotationSpeed)){i.rotationSpeed.min=i.rotationSpeed.max=n.rotationSpeed}}if(n.rotationSpeedGradient===null){i.rotationSpeedGradient=null}else if(Array.isArray(n.rotationSpeedGradient)&&n.rotationSpeedGradient.length>=2){if(i.rotationSpeedGradient){i.rotationSpeedGradient.length=0}else{i.rotationSpeedGradient=[]}for(let t of n.rotationSpeedGradient){let e={t:0,a:1};i.rotationSpeedGradient.push(e);if(Number.isFinite(t.t)){e.t=t.t}if(Number.isFinite(t.a)){e.a=t.a}}}if(n.size&&typeof n.size==="object"){if(Number.isFinite(n.size.x)){i.size.xmin=i.size.xmax=n.size.x}else{if(Number.isFinite(n.size.xmin)){i.size.xmin=n.size.xmin}if(Number.isFinite(n.size.xmax)){i.size.xmax=n.size.xmax}}if(Number.isFinite(n.size.y)){i.size.ymin=i.size.ymax=n.size.y}else{if(Number.isFinite(n.size.ymin)){i.size.ymin=n.size.ymin}if(Number.isFinite(n.size.ymax)){i.size.ymax=n.size.ymax}}if(Number.isFinite(n.size.xy)){i.size.xymin=i.size.xymax=n.size.xy}else{if(Number.isFinite(n.size.xymin)){i.size.xymin=n.size.xymin}if(Number.isFinite(n.size.xymax)){i.size.xymax=n.size.xymax}}}if(n.color&&typeof n.color==="object"){if(Number.isFinite(n.color.r)){i.color.r=n.color.r}if(Number.isFinite(n.color.g)){i.color.g=n.color.g}if(Number.isFinite(n.color.b)){i.color.b=n.color.b}if(Number.isFinite(n.color.a)){i.color.a=n.color.a}}if(n.altColor===null){i.altColor=null}else if(n.altColor&&typeof n.altColor==="object"){if(!i.altColor){i.altColor={r:1,g:1,b:1,a:1}}if(Number.isFinite(n.altColor.r)){i.altColor.r=n.altColor.r}if(Number.isFinite(n.altColor.g)){i.altColor.g=n.altColor.g}if(Number.isFinite(n.altColor.b)){i.altColor.b=n.altColor.b}if(Number.isFinite(n.altColor.a)){i.altColor.a=n.altColor.a}}if(n.endColor===null){i.endColor=null}else if(n.endColor&&typeof n.endColor==="object"){if(!i.endColor){i.endColor={r:1,g:1,b:1,a:1}}if(Number.isFinite(n.endColor.r)){i.endColor.r=n.endColor.r}if(Number.isFinite(n.endColor.g)){i.endColor.g=n.endColor.g}if(Number.isFinite(n.endColor.b)){i.endColor.b=n.endColor.b}if(Number.isFinite(n.endColor.a)){i.endColor.a=n.endColor.a}}if(n.colorGradient===null){i.colorGradient=null}else if(Array.isArray(n.colorGradient)&&n.colorGradient.length>=2){if(i.colorGradient){i.colorGradient.length=0}else{i.colorGradient=[]}for(let t of n.colorGradient){let e={t:0,r:1,g:1,b:1,a:1};i.colorGradient.push(e);if(Number.isFinite(t.t)){e.t=t.t}if(Number.isFinite(t.r)){e.r=t.r}if(Number.isFinite(t.g)){e.g=t.g}if(Number.isFinite(t.b)){e.b=t.b}if(Number.isFinite(t.a)){e.a=t.a}}}if(n.autoFacing!==undefined){if(n.autoFacing&&h[n.autoFacing]){i.autoFacing=h[n.autoFacing]}else if(n.autoFacing){i.autoFacing="all"}else{i.autoFacing="none"}}console.warn("$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$ data.special.particleSystem",this.special.particleSystem);this.updateParticleSystem()}};a.prototype.updateParticleSystem=function(){var e,t,i,n=false,s=this.special.particleSystem,r=this.gScene.babylon.scene;console.warn("3D GEntityParticleSystem.updateParticleSystem()",this.texturePackObject,this.variantObject);if(this.babylon.texture){this.babylon.texture.dispose()}if(this.babylon.particleSystem){this.babylon.particleSystem.dispose()}var o=this.variantObject.frames[0].url;this.babylon.texture=e=new BABYLON.Texture(this.dom.cleanUrl(o),r);this.babylon.particleSystem=t=new BABYLON.ParticleSystem("particles",s.capacity);t.updateSpeed=s.updateRate*.01;t.particleTexture=e;if(s.attachToCamera){t.emitter=this.gScene.globalCamera.babylon.camera}else{t.emitter=new BABYLON.Vector3(0,0,0)}this.emitterShape=s.shape.type;switch(this.emitterShape){case"box":t.minEmitBox=new BABYLON.Vector3(s.shape.xmin,s.shape.ymin,s.shape.zmin);t.maxEmitBox=new BABYLON.Vector3(s.shape.xmax,s.shape.ymax,s.shape.zmax);break;case"sphere":n=true;i=t.createSphereEmitter();i.radius=s.shape.maxRadius;i.radiusRange=1-s.shape.minRadius/s.shape.maxRadius;break;case"hemisphere":n=true;i=t.createHemisphericEmitter();i.radius=s.shape.maxRadius;i.radiusRange=1-s.shape.minRadius/s.shape.maxRadius;break;case"cylinder":n=true;i=t.createCylinderEmitter();i.radius=s.shape.maxRadius;i.radiusRange=1-s.shape.minRadius/s.shape.maxRadius;i.height=s.shape.height;break;case"cone":n=true;i=t.createConeEmitter();i.radius=s.shape.maxRadius;i.radiusRange=1-s.shape.minRadius/s.shape.maxRadius;i.angle=s.shape.angle;break}t.emitRate=s.emitRate;t.minLifeTime=s.duration.min;t.maxLifeTime=s.duration.max;t.blendMode=s.blendMode;if(!n){t.direction1=new BABYLON.Vector3(s.speed.x,+s.speed.y,+s.speed.z);t.direction2=s.altSpeed?new BABYLON.Vector3(s.altSpeed.x,s.altSpeed.y,s.altSpeed.z):new BABYLON.Vector3(s.speed.x,+s.speed.y,+s.speed.z)}t.minEmitPower=s.speed.xyzmin;t.maxEmitPower=s.speed.xyzmax;if(s.speedGradient){for(let e of s.speedGradient){t.addVelocityGradient(e.t,e.xyz)}}t.minInitialRotation=s.rotation.min;t.maxInitialRotation=s.rotation.max;t.minAngularSpeed=s.rotationSpeed.min;t.maxAngularSpeed=s.rotationSpeed.max;if(s.rotationSpeedGradient){for(let e of s.rotationSpeedGradient){t.addAngularSpeedGradient(e.t,e.a)}}t.gravity=new BABYLON.Vector3(s.acceleration.x,s.acceleration.y,s.acceleration.z);t.minSize=s.size.xymin;t.maxSize=s.size.xymax;t.minScaleX=s.size.xmin;t.maxScaleX=s.size.xmax;t.minScaleY=s.size.ymin;t.maxScaleY=s.size.ymax;t.color1=new BABYLON.Color4(s.color.r,s.color.g,s.color.b,s.color.a);t.color2=s.altColor?new BABYLON.Color4(s.altColor.r,s.altColor.g,s.altColor.b,s.altColor.a):new BABYLON.Color4(s.color.r,s.color.g,s.color.b,s.color.a);t.colorDead=s.endColor?new BABYLON.Color4(s.endColor.r,s.endColor.g,s.endColor.b,s.endColor.a):new BABYLON.Color4(s.color.r,s.color.g,s.color.b,s.color.a);if(s.colorGradient){for(let e of s.colorGradient){t.addColorGradient(e.t,new BABYLON.Color4(e.r,e.g,e.b,e.a))}}switch(s.autoFacing){case"none":t.isBillboardBased=false;break;case"y":t.isBillboardBased=true;t.billboardMode=BABYLON.ParticleSystem.BILLBOARDMODE_Y;break;case"all":default:t.isBillboardBased=true;t.billboardMode=BABYLON.ParticleSystem.BILLBOARDMODE_ALL;break}t.renderingGroupId=1;t.start()};a.prototype.updateMaterial=function(){this.updateMaterialNeeded=false;return};a.prototype.updateMesh=function(){this.updateMeshNeeded=false;return};a.prototype.updateOrigin=function(e,t=false){};a.prototype.updatePosition=function(e,t=false){var i=this.babylon.particleSystem,n=this.gScene.babylon.scene;if(!i||this.special.particleSystem.attachToCamera){return}var s=e.position.x!==undefined?e.position.x:this.position.x,r=e.position.y!==undefined?e.position.y:this.position.y,o=e.position.z!==undefined?e.position.z:this.position.z;if(!t){this.position.x=s;this.position.y=r;this.position.z=o}if(e.transition){e.transition.createAnimation(n,i,"emitter",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(s,r,o))}else{i.emitter.set(s,r,o)}};a.prototype.updateRotation=function(e,t=false){};a.prototype.updateSize=function(e,t=false,i=false){}},{"./GEntity.js":2,"./GTransition.js":16,"./vectorUtils.js":20,seventh:42}],10:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.updateMeshNeeded=this.updateMaterialNeeded=false}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.isLocalLight=true;a.prototype.updatePosition=function(e,t=false){var i=this.babylon.light,n=this.gScene.babylon.scene;if(!i){return}var s=e.position.x!==undefined?e.position.x:this.position.x,r=e.position.y!==undefined?e.position.y:this.position.y,o=e.position.z!==undefined?e.position.z:this.position.z;if(!t){this.position.x=s;this.position.y=r;this.position.z=o}if(e.transition){e.transition.createAnimation(n,i,"position",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(s,r,o))}else{i.position.set(s,r,o)}};a.prototype.updateMaterialParams=function(){};a.prototype.createLight=function(){var e=this.gScene.babylon.scene;if(this.babylon.light){console.warn("GEntityPointLight.createLight(): light is already existing");return}if(!this.special.light){this.special.light={diffuse:new BABYLON.Color3(1,1,1),specular:new BABYLON.Color3(.5,.5,.5),intensity:1}}this.babylon.light=new BABYLON.PointLight("pointLight",new BABYLON.Vector3(this.position.x,this.position.y,this.position.z),e);this.babylon.light.diffuse=this.special.light.diffuse;this.babylon.light.specular=this.special.light.specular;this.babylon.light.intensity=this.special.light.intensity;if(this.isLocalLight){this.registerLocalLight()}}},{"./GEntity.js":2,"./GTransition.js":16,"./vectorUtils.js":20,seventh:42}],11:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i)}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.updateMaterial=function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;this.babylon.material=e=new BABYLON.StandardMaterial("spriteMaterial",i);e.backFaceCulling=true;e.diffuseColor=new BABYLON.Color3(.5,.5,.5);e.disableLighting=true;e.opacityTexture=new BABYLON.Texture("/textures/shadow.png",i);e.opacityTexture.wrapU=e.opacityTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};a.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.Mesh.CreatePlane("shadow",undefined,t);e.rotation.x=Math.PI/2;e.bakeCurrentTransformIntoVertices();e.scaling.x=this.size.x;e.scaling.z=this.size.z;console.warn("Mesh:",e);this.updateMeshNeeded=false;return e}},{"./GEntity.js":2,"./GTransition.js":16,"./vectorUtils.js":20,seventh:42}],12:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.updateMeshNeeded=this.updateMaterialNeeded=false;console.error("Not supported ATM!")}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a},{"./GEntity.js":2,"./GTransition.js":16,"./vectorUtils.js":20,seventh:42}],13:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.autoFacing=this.autoFacing.bind(this)}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.updateSpecialStage1=function(e){n.prototype.updateSpecialStage1.call(this,e);if(e.special.spriteAutoFacing!==undefined&&(e.special.spriteAutoFacing===false||r.degToSector[e.special.spriteAutoFacing])&&e.special.spriteAutoFacing!==this.special.spriteAutoFacing){this.special.spriteAutoFacing=e.special.spriteAutoFacing;if(this.special.spriteAutoFacing){this.gScene.on("render",this.autoFacing)}else{this.gScene.off("render",this.autoFacing)}}};a.prototype.updateFacing=function(e){this.facing=e;if(this.special.spriteAutoFacing){this.autoFacing()}};a.prototype.updateMaterial=async function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;console.warn("3D GEntitySprite.updateMaterial()",this.texturePackObject,this.variantObject);this.babylon.material=e=new BABYLON.StandardMaterial("spriteMaterial",i);e.backFaceCulling=true;e.ambientColor=new BABYLON.Color3(1,1,1);var s=this.frameObject.maps&&(this.frameObject.maps.diffuse||this.frameObject.maps.albedo)||this.frameObject.url;e.diffuseTexture=this.getTexture(s);e.diffuseTexture.hasAlpha=true;e.diffuseTexture.wrapU=e.diffuseTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;var r=this.frameObject.maps&&(this.frameObject.maps.normal||this.frameObject.maps.bump);if(r){e.bumpTexture=this.getTexture(r);e.bumpTexture.wrapU=e.bumpTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;e.invertNormalMapX=true;e.invertNormalMapY=true}var o=this.frameObject.maps&&this.frameObject.maps.specular;if(o){e.specularTexture=this.getTexture(o);e.specularTexture.wrapU=e.specularTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;e.useGlossinessFromSpecularMapAlpha=true}else{e.specularColor=new BABYLON.Color3(0,0,0)}var a=!this.frameObject.xFlip!==!this.clientMods.xFlip,l=this.frameObject.yFlip;this.flipTexture(e.diffuseTexture,a,l);if(e.bumpTexture){this.flipTexture(e.bumpTexture,a,l)}if(e.specularTexture){this.flipTexture(e.specularTexture,a,l)}if(this.frameObject.origin){let e;if(!a&&!l){e=this.frameObject.origin}else{e={x:(a?-this.frameObject.origin.x:this.frameObject.origin.x)||0,y:(l?-this.frameObject.origin.y:this.frameObject.origin.y)||0,z:this.frameObject.origin.z||0}}this.updateOrigin(e,true)}if(this.texturePackObject.pixelDensity){this.updateSizeFromPixelDensity(e.diffuseTexture,this.texturePackObject.pixelDensity)}else if(this.frameObject.relSize){this.updateSize(this.frameObject.relSize,false,true)}e.backFaceCulling=false;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};a.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.Mesh.CreatePlane("sprite",undefined,t);e.billboardMode=BABYLON.AbstractMesh.BILLBOARDMODE_X|BABYLON.AbstractMesh.BILLBOARDMODE_Y;e.scaling.x=this.size.x;e.scaling.y=this.size.y;console.warn("Mesh:",e);this.updateMeshNeeded=false;return e};a.prototype.updateRotation=function(e,t=false){var i=this.babylon.mesh,n=this.gScene.babylon.scene;var s=e.rotation.x!==undefined?e.rotation.x:this.rotation.x,r=e.rotation.y!==undefined?e.rotation.y:this.rotation.y,o=e.rotation.z!==undefined?e.rotation.z:this.rotation.z;if(!t){this.rotation.x=s;this.rotation.y=r;this.rotation.z=o}i.rotation.z=o};a.prototype.autoFacing=function(e=null){if(e){if(!e.camera&&!this.parametric){return}}var t=r.facingAngleDeg(this.gScene.globalCamera.babylon.camera.position,this.babylon.mesh.position,this.facing);var i=r.degToSector[this.special.spriteAutoFacing](t);if(this.clientMods.variant===i){return}this.clientMods.variant=i;this.clientMods.xFlipVariant=r.xFlipSector[i];this.refreshMaterial()}},{"./GEntity.js":2,"./GTransition.js":16,"./vectorUtils.js":20,seventh:42}],14:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GEntityFloatingText.js");function r(e,t,i){s.call(this,e,t,i);this.special.content.textSize=.05;this.iconOffset=0;this.safeIconOffset=false;this.blinkSafe=false}r.prototype=Object.create(s.prototype);r.prototype.constructor=r;t.exports=r;r.prototype.destroy=function(){if(this.babylon.textBlock){this.babylon.textBlock.dispose()}if(this.babylon.icon){this.babylon.icon.dispose()}n.prototype.destroy.call(this)};r.prototype.updateMaterial=function(){var e,t;console.warn("3D GEntityUiFloatingText.updateMaterial()");if(this.gScene.babylon.ui){e=this.gScene.babylon.ui}else{this.gScene.babylon.ui=e=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("ui")}if(this.babylon.textBlock){t=this.babylon.textBlock}else{this.babylon.textBlock=t=new BABYLON.GUI.TextBlock;t.text=this.special.content.text;t.color=this.special.content.textColor;t.alpha=this.opacity;t.resizeToFit=true;e.addControl(t);if(this.parent){t.linkWithMesh(this.parent.babylon.mesh);if(!this.blinkSafe){t.alpha=0;setTimeout(()=>{this.blinkSafe=true;t.alpha=this.opacity},20)}}}this.updateMaterialNeeded=false};r.prototype.updateOpacity=function(e,t=false){if(!this.blinkSafe){setTimeout(()=>{this.blinkSafe=true;this.updateOpacity(e,t)},20);return}s.prototype.updateOpacity.call(this,e,t)};const o=.8;r.prototype.updateContent=function(e){var t=this.gScene.babylon.ui,i=t.getSize(),n=this.babylon.textBlock;if(!n){return}if(e.text!==undefined){this.safeIconOffset=false;n.text=this.special.content.text=""+e.text}if(typeof e.textSize==="number"){this.safeIconOffset=false;this.special.content.textSize=e.textSize;n.fontSizeInPixels=Math.round(e.textSize*i.height)}if(typeof e.textColor==="string"){n.color=this.special.content.textColor=e.textColor}if(typeof e.outlineColor==="string"){n.outlineColor=this.special.content.outlineColor=e.outlineColor}if(typeof e.outlineWidth==="number"){this.special.content.outlineWidth=e.outlineWidth;n.outlineWidth=Math.round(e.outlineWidth*i.height)}if(typeof e.shadowColor==="string"){n.shadowColor=this.special.content.shadowColor=e.shadowColor}if(typeof e.shadowBlur==="number"){this.special.content.shadowBlur=e.shadowBlur;n.shadowBlur=Math.round(e.shadowBlur*i.height)}if(e.icon){this.updateContentIcon(e)}};r.prototype.updateContentIcon=function(e){var t,i=this.gScene.babylon.ui,n=this.babylon.textBlock;if(this.babylon.icon){t=this.babylon.icon;t.source=this.dom.cleanUrl(e.icon);t.width=n.fontSizeInPixels*o;t.height=n.fontSizeInPixels*o}else{this.babylon.icon=t=new BABYLON.GUI.Image("icon",this.dom.cleanUrl(e.icon));t.widthInPixels=n.fontSizeInPixels*o;t.heightInPixels=n.fontSizeInPixels*o;i.addControl(t);if(this.parent){t.linkWithMesh(this.parent.babylon.mesh);if(!this.blinkSafe){t.alpha=0;setTimeout(()=>{this.blinkSafe=true;t.alpha=this.opacity},20)}}}this.updateContentIconOffset(()=>{if(this.parent){t.linkOffsetXInPixels=n.linkOffsetXInPixels-this.iconOffset}else{t.leftInPixels=n.leftInPixels-this.iconOffset}})};r.prototype.updateContentIconOffset=function(e=null,t=false){var i=this.babylon.icon,n=this.babylon.textBlock;if(t){this.safeIconOffset=true}if(!this.safeIconOffset||!n._width.isPixel&&!t){setTimeout(()=>this.updateContentIconOffset(e,true),20);return}this.iconOffset=Math.round(i.widthInPixels/2+n.fontSizeInPixels/4+(n._width.isPixel?n.widthInPixels/2:n.fontSizeInPixels));if(e){e()}};r.prototype.updateMesh=function(){this.updateMeshNeeded=false;return};r.prototype.updateSpecialStage2=function(e){if(e.special&&e.special.content){this.updateContent(e.special.content)}};r.prototype.updatePosition=function(e,t=false){var i=this.babylon.textBlock,n=this.babylon.icon;if(n&&!this.safeIconOffset){this.updateContentIconOffset(()=>this.updatePosition(e,t));return}var s=this.gScene.babylon.ui,r=s.getSize(),o=this.gScene.babylon.scene;var a,l=e.position.x!==undefined?e.position.x:this.position.x,c=e.position.y!==undefined?e.position.y:this.position.y;if(!t){this.position.x=l;this.position.y=c}l=-l*r.width/2;c=-c*r.height/2;a=l-this.iconOffset;if(this.parent){if(e.transition){e.transition.createAnimation(o,i,"linkOffsetXInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,l);e.transition.createAnimation(o,i,"linkOffsetYInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,c);if(n){e.transition.createAnimation(o,n,"linkOffsetXInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,a);e.transition.createAnimation(o,n,"linkOffsetYInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,c)}}else{i.linkOffsetXInPixels=l;i.linkOffsetYInPixels=c;if(n){n.linkOffsetXInPixels=a;n.linkOffsetYInPixels=c}}}else if(e.transition){e.transition.createAnimation(o,i,"leftInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,l);e.transition.createAnimation(o,i,"topInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,c);if(n){e.transition.createAnimation(o,n,"leftInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,a);e.transition.createAnimation(o,n,"topInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,c)}}else{i.leftInPixels=l;i.topInPixels=c;if(n){n.leftInPixels=a;n.topInPixels=c}}}},{"./GEntity.js":2,"./GEntityFloatingText.js":6}],15:[function(e,t,i){"use strict";const s=e("./Camera.js");const r=e("./GTransition.js");const n=e("nextgen-events/lib/browser.js");const o=e("seventh");function a(e,t){this.dom=e;this.engineId=t.engineId;this.rightHanded=t.rightHanded!==undefined?!!t.rightHanded:true;this.active=false;this.paused=false;this.persistent=false;this.theme="default";this.special={};this.engine={};this.texturePacks={};this.gEntityLocations={};this.gEntities={};this.parametricGEntities=new Set;this.noLocalLightingGEntities=new Set;this.localLightGEntities=new Set;this.animationFunctions=new Set;this.globalCamera=null;this.roleCamera=null;this.$gscene=document.createElement("canvas");this.$gscene.classList.add("gscene");this.$gscene.style.visibility="hidden";this.dom.$gfx.append(this.$gscene);this.resizeObserver=null;this.changes={camera:false};this.babylon={engine:null,scene:null,ui:null};this.initScene()}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.initScene=function(){var e=this.babylon.engine=new BABYLON.Engine(this.$gscene,true);var n=this.babylon.scene=new BABYLON.Scene(e);n.autoClear=false;n.autoClearDepthAndStencil=false;n.setRenderingAutoClearDepthStencil(1,false);this.globalCamera=new s(this);e.runRenderLoop(()=>{var e,t,i=Date.now()/1e3;if(this.parametricGEntities.size){for(e of this.parametricGEntities){e.parametricUpdate(i)}}if(this.animationFunctions.size){for(t of this.animationFunctions){t(i)}}this.emitIfListener("render",this.changes);this.changes.camera=false;n.render()});this.resizeObserver=new ResizeObserver(()=>e.resize());this.resizeObserver.observe(this.$gscene)};a.prototype.update=function(e,t=false,i=false){console.warn("3D GScene.update()",e);var n;if(e.transition){if(i){delete e.transition}else{e.transition=new r(e.transition)}}if(e.active!==undefined){this.active=!!e.active;this.$gscene.style.visibility=this.active?"visible":"hidden"}if(e.paused!==undefined){this.paused=!!e.paused}if(e.persistent!==undefined){this.persistent=!!e.persistent}if(e.theme!==undefined){this.theme=e.theme||"default"}if(e.special&&typeof e.special==="object"){if(e.special.ambient){this.updateAmbient(e)}if(typeof e.special.contrast==="number"){this.updateContrast(e)}if(typeof e.special.exposure==="number"){this.updateExposure(e)}if(e.special.colorGrading){this.updateColorGrading(e)}if(e.special.colorCurves){this.updateColorCurves(e)}if(e.special.vignette){this.updateVignette(e)}}if(e.engine&&typeof e.engine==="object"){Object.assign(this.engine,e.engine)}if(e.globalCamera!==undefined){this.globalCamera.update(e.globalCamera)}return t&&e.transition&&e.transition.promise||o.resolved};a.prototype.updateAmbient=function(e){console.warn(".updateAmbient()",this.special.ambient);var t=this.babylon.scene;if(!e.special.ambient||typeof e.special.ambient!=="object"){return}if(!this.special.ambient){this.special.ambient=new BABYLON.Color3(0,0,0)}Object.assign(this.special.ambient,e.special.ambient);if(e.transition){e.transition.createAnimation(t,t,"ambientColor",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(this.special.ambient.r,this.special.ambient.g,this.special.ambient.b))}else{t.ambientColor.set(this.special.ambient.r,this.special.ambient.g,this.special.ambient.b)}};a.prototype.updateContrast=function(e){console.warn(".updateContrast()",this.special.contrast);var t=this.babylon.scene;this.special.contrast=e.special.contrast;if(e.transition){e.transition.createAnimationFn(this,t.imageProcessingConfiguration,"contrast",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.contrast)}else{t.imageProcessingConfiguration.contrast=this.special.contrast}};a.prototype.updateExposure=function(e){console.warn(".updateExposure()",this.special.exposure);var t=this.babylon.scene;this.special.exposure=e.special.exposure;if(e.transition){e.transition.createAnimationFn(this,t.imageProcessingConfiguration,"exposure",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.exposure)}else{t.imageProcessingConfiguration.exposure=this.special.exposure}};const l=new Set(["globalHue","globalDensity","globalSaturation","highlightsHue","highlightsDensity","highlightsSaturation","shadowsHue","shadowsDensity","shadowsSaturation"]);a.prototype.updateColorCurves=function(e){console.warn(".updateColorCurves()",this.special.colorCurves);var t,i=e.special.colorCurves,n=this.babylon.scene;if(!i){if(this.special.colorCurves){this.special.colorCurves=null}n.imageProcessingConfiguration.colorCurvesEnabled=false;return}if(typeof i!=="object"){return}n.imageProcessingConfiguration.colorCurvesEnabled=true;if(!this.special.colorCurves){this.special.colorCurves={}}if(!n.imageProcessingConfiguration.colorCurves){n.imageProcessingConfiguration.colorCurves={globalHue:0,globalDensity:0,globalSaturation:0,highlightsHue:0,highlightsDensity:0,highlightsSaturation:0,shadowsHue:0,shadowsDensity:0,shadowsSaturation:0}}for(t in i){if(!l.has(t)&&typeof i[t]!=="number"){continue}this.special.colorCurves[t]=i[t];if(e.transition){e.transition.createAnimationFn(this,n.imageProcessingConfiguration.colorCurves,t,BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.colorCurves[t])}else{n.imageProcessingConfiguration.colorCurves[t]=this.special.colorCurves[t]}}};const c={stretch:"vignetteStretch",centerX:"vignetteCentreX",centerY:"vignetteCentreY",weight:"vignetteWeight"};a.prototype.updateVignette=function(e){console.warn(".updateVignette()",this.special.vignette);var t,i,n=e.special.vignette,s=this.babylon.scene;if(!n){if(this.special.vignette){this.special.vignette=null}s.imageProcessingConfiguration.vignetteEnabled=false;return}if(typeof n!=="object"){return}s.imageProcessingConfiguration.vignetteEnabled=true;if(!this.special.vignette){this.special.vignette={}}if(!s.imageProcessingConfiguration.vignette){}for(t in n){i=c[t];if(!i){continue}this.special.vignette[t]=n[t];if(e.transition){e.transition.createAnimationFn(this,s.imageProcessingConfiguration,i,BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.vignette[t])}else{s.imageProcessingConfiguration[i]=this.special.vignette[t]}}if(n.color){this.special.vignette.color=n.color;if(e.transition){e.transition.createAnimationFn(this,s.imageProcessingConfiguration,"vignetteColor",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(n.color.r,n.color.g,n.color.b))}else{s.imageProcessingConfiguration.vignetteColor.set(n.color.r,n.color.g,n.color.b)}}if(n.blendMode){switch(n.blendMode){case"multiply":this.special.vignette.blendMode=0;break;case"opaque":default:this.special.vignette.blendMode=1;break}s.imageProcessingConfiguration.vignetteBlendMode=this.special.vignette.blendMode}};a.prototype.updateColorGrading=function(e){console.warn(".updateColorGrading()",this.special.colorGrading);var t=this.babylon.scene,i=e.special.colorGrading,n,s,r=false,o;if(!i){if(this.special.colorGrading){this.special.colorGrading=null}t.imageProcessingConfiguration.colorGradingEnabled=false;if(t.imageProcessingConfiguration.colorGradingTexture){t.imageProcessingConfiguration.colorGradingTexture.dispose()}return}if(typeof i!=="object"){return}if(i.url&&typeof i.url==="string"){n=this.dom.cleanUrl(i.url)}if(!this.special.colorGrading){if(!n){return}this.special.colorGrading={url:n,level:typeof i.level==="number"?i.level:1};o=new BABYLON.Texture(this.special.colorGrading.url,t,true,false);o.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE;o.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;t.imageProcessingConfiguration.colorGradingEnabled=true;t.imageProcessingConfiguration.colorGradingTexture=o;t.imageProcessingConfiguration.colorGradingWithGreenDepth=false;s=0;r=true}else{if(n&&n!==this.special.colorGrading.url){this.special.colorGrading.url=n;o=new BABYLON.Texture(this.special.colorGrading.url,t,true,false);o.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE;o.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;t.imageProcessingConfiguration.colorGradingTexture=o}else{o=t.imageProcessingConfiguration.colorGradingTexture}if(typeof i.level==="number"){s=this.special.colorGrading.level;r=true;this.special.colorGrading.level=i.level}}if(r){console.warn("level",s,this.special.colorGrading.level,e.transition);if(e.transition){e.transition.createAnimation(t,o,"level",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.colorGrading.level,s)}else{o.level=this.special.colorGrading.level}}};a.prototype.updateLightExcludedMeshes=function(){var e,t=[...this.noLocalLightingGEntities].map(e=>e.babylon.mesh);for(e of this.localLightGEntities){e.babylon.light.excludedMeshes=t}};a.prototype.hasGEntity=function(e){return e in this.gEntities};a.prototype.getGEntity=function(e){return this.gEntities[e]};a.prototype.addGEntity=function(e,t){this.gEntities[e]=t};a.prototype.removeGEntity=function(e){var t=this.gEntities[e];if(!t){return false}delete this.gEntities[e];return true}},{"./Camera.js":1,"./GTransition.js":16,"nextgen-events/lib/browser.js":30,seventh:42}],16:[function(e,t,i){"use strict";const u=e("seventh");const f=e("array-kit");function n(e){this.duration=.2;this.easing="linear";this.running=0;this.promise=null;if(e){this.update(e)}}t.exports=n;n.prototype.update=function(e){if(!e||typeof e!=="object"){return}if(e.duration!==undefined){this.duration=+e.duration||0}if(e.easing!==undefined){this.easing=e.easing||"linear"}return this};n.prototype.toString=function(e){return e+" "+this.duration+"s"+(" "+this.easing||"")};const p={circle:BABYLON.CircleEase,back:BABYLON.BackEase,bounce:BABYLON.BounceEase,cubic:BABYLON.CubicEase,elastic:BABYLON.ElasticEase,exponential:BABYLON.ExponentialEase,power:BABYLON.PowerEase,quadratic:BABYLON.QuadraticEase,quartic:BABYLON.QuarticEase,quintic:BABYLON.QuinticEase,sine:BABYLON.SineEase,bezier:BABYLON.BezierCurveEase};n.prototype.createAnimation=function(e,t,i,n,s,r=null){var o,a,l,c=30,h=Math.round(this.duration*c);a=new BABYLON.Animation("transition",i,c,n,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT,false);if(r===null){r=t[i];if(r&&typeof r==="object"&&r.clone){r=r.clone()}}l=[{frame:0,value:r},{frame:h,value:s}];a.setKeys(l);if(this.easing&&p[this.easing]){o=new p[this.easing];o.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT);a.setEasingFunction(o)}t.animations.push(a);if(!this.promise){this.promise=new u;this.promise.resolveTimeout(1e3*this.duration+20)}this.running++;e.beginAnimation(t,0,h,false,1,()=>{this.running--;e.removeAnimation(a);f.deleteValue(t.animations,a);if(this.running<=0){this.promise.resolve()}},undefined,false)};const d=[];d[BABYLON.Animation.ANIMATIONTYPE_COLOR3]=BABYLON.Animation.prototype.color3InterpolateFunction;d[BABYLON.Animation.ANIMATIONTYPE_COLOR4]=BABYLON.Animation.prototype.color4InterpolateFunction;d[BABYLON.Animation.ANIMATIONTYPE_FLOAT]=(e,t,i)=>e+i*(t-e);d[BABYLON.Animation.ANIMATIONTYPE_MATRIX]=BABYLON.Animation.prototype.matrixInterpolateFunction;d[BABYLON.Animation.ANIMATIONTYPE_QUATERNION]=BABYLON.Animation.prototype.quaternionInterpolateFunction;d[BABYLON.Animation.ANIMATIONTYPE_SIZE]=BABYLON.Animation.prototype.sizeInterpolateFunction;d[BABYLON.Animation.ANIMATIONTYPE_VECTOR2]=BABYLON.Animation.prototype.vector2InterpolateFunction;d[BABYLON.Animation.ANIMATIONTYPE_VECTOR3]=BABYLON.Animation.prototype.vector3InterpolateFunction;n.prototype.createAnimationFn=function(n,s,r,o,a,l=null){if(l===null){l=s[r];if(l&&typeof l==="object"&&l.clone){l=l.clone()}}var c=Date.now()/1e3;if(!this.promise){this.promise=new u;this.promise.resolveTimeout(1e3*this.duration+20)}this.running++;var h=e=>{var t,i=e-c;if(i>=this.duration){t=1;this.running--;n.animationFunctions.delete(h);if(this.running<=0){this.promise.resolve()}}else{t=i/this.duration}s[r]=d[o](l,a,t)};n.animationFunctions.add(h);return h}},{"array-kit":21,seventh:42}],17:[function(e,t,i){"use strict";const n=e("./browser-extension.js");const o=n.host.exports.expressionOperators;function s(e){this.var={};this.formula={};this.ctx={t:0,rt:0,tOffset:-Date.now()/1e3};this.computed={};this.stopAt=Infinity;this.cleanStop=false;this.update(e)}t.exports=s;function r(e){var t;for(t in e){delete e[t]}}s.prototype.update=function(e){if(e.reset){r(this.var);r(this.formula);r(this.ctx);r(this.computed);this.ctx.t=this.ctx.rt=0;this.ctx.tOffset=-Date.now()/1e3}else if(e.resetT){this.ctx.tOffset=-Date.now()/1e3}if(typeof e.stopAt==="number"){this.stopAt=e.stopAt}if(e.var){this.recursiveUpdate(this.var,e.var)}if(e.formula){this.recursiveUpdate(this.formula,e.formula,this.computed)}};s.prototype.recursiveUpdate=function(e,t,i){var n,s;for(n in t){s=t[n];if(s===null){delete e[n];if(i&&typeof i[n]==="object"){delete i[n]}}else if(typeof s==="boolean"||typeof s==="number"){e[n]=s}else if(typeof s==="string"){e[n]=new Function("op","ctx","return ( "+s+" ) ;")}else if(typeof s==="object"){e[n]={};this.recursiveUpdate(e[n],s,i&&typeof i[n]==="object"?i[n]:null)}console.warn("########## k/v/V",n,s,e[n])}};s.prototype.compute=function(e,t){this.ctx.t=e+this.ctx.tOffset;if(this.ctx.t>this.stopAt){if(this.cleanStop){return null}this.ctx.t=this.stopAt;this.cleanStop=true}else if(this.ctx.t===this.stopAt){this.cleanStop=true}this.ctx.rt=this.ctx.t/this.stopAt;this.recursiveCompute(this.var,this.ctx);this.recursiveCompute(this.formula,this.computed,t);return this.computed};s.prototype.recursiveCompute=function(e,t,i){var n,s,r;for(n in e){s=e[n];r=i&&typeof i==="object"?i[n]:undefined;if(typeof s==="boolean"||typeof s==="number"){t[n]=s}else if(typeof s==="function"){this.ctx.base=r;t[n]=s(o,this.ctx)}else if(s&&typeof s==="object"){t[n]={};this.recursiveCompute(s,t[n],r)}}}},{"./browser-extension.js":18}],18:[function(e,t,i){"use strict";const n=e("exm/lib/BrowserExm.js");const s=e("path");const r=n.registerExtension({module:t,ns:"spellcast.web-client",id:"3dgws",exports:{},hooks:{init:async()=>{console.warn("Extension 3DGWS: starting init");await import(r.dirPath+"/babylonjs.js");await import(r.dirPath+"/babylonjs.gui.js");r.host.api.addEngine("3dgws",e("./engine.js"));console.warn("Extension 3DGWS fully loaded")}}});t.exports=r},{"./engine.js":19,"exm/lib/BrowserExm.js":27,path:32}],19:[function(e,t,i){"use strict";const n={};t.exports=n;n.GScene=e("./GScene.js");n.Camera=e("./Camera.js");n.GEntity=e("./GEntity.js");n.perUsageGEntity={hemisphericLight:e("./GEntityHemisphericLight.js"),directionalLight:e("./GEntityDirectionalLight.js"),pointLight:e("./GEntityPointLight.js"),spotLight:e("./GEntitySpotLight.js"),background:e("./GEntityBackground.js"),sprite:e("./GEntitySprite.js"),shadow:e("./GEntityShadow.js"),particleSystem:e("./GEntityParticleSystem.js"),floatingText:e("./GEntityFloatingText.js"),uiFloatingText:e("./GEntityUiFloatingText.js"),basicShape:e("./GEntityBasicShape.js"),ground:e("./GEntityGround.js")}},{"./Camera.js":1,"./GEntity.js":2,"./GEntityBackground.js":3,"./GEntityBasicShape.js":4,"./GEntityDirectionalLight.js":5,"./GEntityFloatingText.js":6,"./GEntityGround.js":7,"./GEntityHemisphericLight.js":8,"./GEntityParticleSystem.js":9,"./GEntityPointLight.js":10,"./GEntityShadow.js":11,"./GEntitySpotLight.js":12,"./GEntitySprite.js":13,"./GEntityUiFloatingText.js":14,"./GScene.js":15}],20:[function(e,t,i){"use strict";const l={};t.exports=l;l.flatVectorsAngleDeg=(e,t)=>l.normalizeAngleDeg((Math.atan2(-t.x,t.z)-Math.atan2(-e.x,e.z))*l.RAD_TO_DEG);l.facingAngleDeg=(e,t,i)=>l.normalizeAngleDeg(i-Math.atan2(-(t.x-e.x),t.z-e.z)*l.RAD_TO_DEG);l.degToSector={};l.degToSector["ns"]=e=>e<=90||e>=270?"n":"s";l.degToSector["we"]=e=>e<=180?"w":"e";const n=["n","nw","w","sw","s","se","e","ne","n"];l.degToSector["8"]=e=>n[Math.floor((e+22.5)/45)];const s=["n","w","s","e","n"];l.degToSector["4"]=e=>s[Math.floor((e+45)/90)];const r=["nw","sw","se","ne"];l.degToSector["4-diag"]=e=>r[Math.floor(e/90)];l.xFlipSector={n:"n",ne:"nw",e:"w",se:"sw",s:"s",sw:"se",w:"e",nw:"ne"};l.cameraRotationFromOriginAndTarget=(e,t,i=0)=>{var n=t.x-e.x,s=t.y-e.y,r=t.z-e.z,o=Math.atan2(n,r),a=-l.epsilonAsin(s/Math.hypot(n,s,r));console.warn("[!] .rotationFromOriginAndTarget()",e,t,n,s,r,o);return new BABYLON.Vector3(a,o,i)};l.toCameraAlpha=e=>-l.PI_2-e;l.toCameraBeta=e=>l.PI_2-e;l.RAD_TO_DEG=180/Math.PI;l.DEG_TO_RAD=Math.PI/180;l.PI_2=Math.PI/2;l.normalizeAngleDeg=e=>e>=0?e%360:360+e%360;var o=1e-10;var a=Math.round(1/o);l.setEpsilon=e=>{o=e;a=Math.round(1/e)};l.getEpsilon=()=>o;l.epsilonAcos=l.eacos=e=>{if(e>=-1&&e<=1){return Math.acos(e)}if(e>0){if(e<1+o){return 0}}else if(e>-1-o){return Math.PI}return NaN};l.epsilonAsin=l.easin=e=>{if(e>=-1&&e<=1){return Math.asin(e)}if(e>0){if(e<1+o){return Math.PI/2}}else if(e>-1-o){return Math.PI/2}return NaN}},{}],21:[function(e,t,i){"use strict";const n={range:e("./range.js"),sample:e("./sample.js"),inPlaceFilter:e("./inPlaceFilter.js"),delete:e("./delete.js"),deleteValue:e("./deleteValue.js")};t.exports=n;n.shuffle=e=>n.sample(e,e.length,true)},{"./delete.js":22,"./deleteValue.js":23,"./inPlaceFilter.js":24,"./range.js":25,"./sample.js":26}],22:[function(e,t,i){"use strict";t.exports=(e,t)=>{if(t>=e.length){return}var i=e.length-2;while(t<=i){e[t]=e[t+1];t++}e.length--}},{}],23:[function(e,t,i){"use strict";t.exports=(e,t)=>{var i,n,s=0,r=0;while(s<e.length){i=e[s];if(t!==i&&(t||!Number.isNaN(t)||!Number.isNaN(i))){e[r]=i;r++}s++}n=e.length-r;e.length=r;return n}},{}],24:[function(e,t,i){"use strict";t.exports=(e,t,i,n)=>{var s=arguments.length>=4,r,o=0,a=0;while(o<e.length){r=e[o];if(t.call(i,r,s?n:o,e)){e[a]=r;a++}o++}e.length=a;return e}},{}],25:[function(e,t,i){"use strict";t.exports=function(e,t,i){if(!arguments.length){return[]}if(arguments.length===1){t=e;e=0}if(!i){i=e<=t?1:-1}if(i>0&&e>=t||i<0&&e<=t){return[]}var n=0,s=e,r=[];if(i>0){for(;s<t;n++,s+=i){r[n]=s}}else{for(;s>t;n++,s+=i){r[n]=s}}return r}},{}],26:[function(e,t,i){"use strict";t.exports=(e,t=Infinity,i=false)=>{var n,s,r,o=i?e:[...e];t=Math.max(Math.min(t,e.length),0);for(n=0;n<t;n++){s=n+Math.floor((o.length-n)*Math.random());r=o[n];o[n]=o[s];o[s]=r}o.length=t;return o}},{}],27:[function(e,t,i){(function(r){"use strict";function i(e={}){if(!e.ns){throw new Error("EXM: namespace ('ns') is required!")}this.ns=e.ns;this.extensionPath=e.extensionPath||"/ext";this.suffix=e.suffix||"/extension.js";this.api=e.api||{};this.exports=e.exports||{};this.extensions=new Map}t.exports=i;i.prototype.__prototypeUID__="exm/browser/Exm";i.prototype.__prototypeVersion__="0.5";i.registerNs=function(e={}){if(!e.ns||typeof e.ns!=="string"){throw new Error("EXM: namespace ('ns' property) is required!")}if(r.EXM.ns[e.ns]){throw new Error("EXM: namespace '"+e.ns+"' is already registered!")}var t=new i(e);r.EXM.ns[e.ns]=t;return t};i.prototype.requireExtension=async function(i){if(this.extensions.has(i)){return this.extensions.get(i)}var e,t=this.ns+"."+i,n=this.extensionPath+"/"+t,s=n+this.suffix;try{console.warn("Trying EXM extension: ",s);e=await import(s)}catch(e){throw new Error("Required extension '"+i+"' not found.")}if(!e||typeof e!=="object"){throw new Error("EXM: this is not an EXM Extension (not an object)")}if(e.extension){e=e.extension}else{e=r.EXM.extensions[t];if(!e||typeof e!=="object"){throw new Error("EXM: this is not an EXM Extension (not an ES6 module extension and not registered)")}}if(e.__prototypeUID__!=="exm/Extension"&&e.__prototypeUID__!=="exm/browser/Extension"){throw new Error("EXM: this is not an EXM Extension (no prototype UID found)")}if(e.id!==i){throw new Error("EXM: Extension ID mismatch (wanted '"+i+"' but got "+e.id+"'.")}try{await e.init(this,s,n);console.log("Extension '"+e.id+"'"+(e.version?" (v"+e.version+") ":"")+"is loaded.")}catch(e){let t=new Error("EXM: Failed to init extension '"+i+"': "+e);t.from=e;throw e}this.extensions.set(i,e);return e};i.Extension=function(e={}){this.isInit=false;this.id=e.id;this.ns=e.ns;this.uid=e.ns+"."+e.id;this.version=e.version||null;this.host=null;this.path=null;this.dirPath=null;this.fromModule=e.module;this.hooks=e.hooks||{};this.api=e.api||{};this.exports=e.exports||{}};i.Extension.prototype.__prototypeUID__="exm/browser/Extension";i.Extension.prototype.__prototypeVersion__=i.prototype.__prototypeVersion__;i.registerExtension=i.Extension.register=function(e={}){if(!e.id||typeof e.id!=="string"){throw new Error("EXM Extension: ID ('id' property) is required!")}if(!e.ns||typeof e.ns!=="string"){throw new Error("EXM Extension: namespace ('ns' property) is required!")}var t=new i.Extension(e);if(r.EXM.extensions[t.uid]){throw new Error("EXM Extension: ID '"+t.id+"' is already registered for namespace '"+t.ns+"'!")}r.EXM.extensions[t.uid]=t;return t};i.Extension.prototype.init=async function(e,t,i){if(this.isInit){return}if(e.ns!==this.ns){throw new Error("EXM Extension's namespace mismatches the Host!")}if(t){this.path=t}if(i){this.dirPath=i}this.host=e;if(typeof this.hooks.init==="function"){await this.hooks.init()}this.isInit=true};if(!r.EXM){r.EXM={master:null,ns:{},extensions:{}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],28:[function(n,s,e){(function(r,e,t){"use strict";const i=r.browser?window.setImmediate:r.nextTick;if(!e.__NEXTGEN_EVENTS__){e.__NEXTGEN_EVENTS__={recursions:0}}var c=e.__NEXTGEN_EVENTS__;function h(){}s.exports=h;h.prototype.__prototypeUID__="nextgen-events/NextGenEvents";h.prototype.__prototypeVersion__=n("../package.json").version;h.SYNC=-Infinity;h.DESYNC=-1;h.defaultMaxListeners=Infinity;h.init=function(){Object.defineProperty(this,"__ngev",{configurable:true,value:new h.Internal})};h.Internal=function(i){this.nice=h.SYNC;this.interruptible=false;this.contexts={};this.desync=t;this.depth=0;this.states={};this.stateGroups={};this.listeners={error:[],interrupt:[],newListener:[],removeListener:[]};this.hasListenerPriority=false;this.maxListeners=h.defaultMaxListeners;if(i){this.nice=i.nice;this.interruptible=i.interruptible;Object.assign(this.states,i.states),Object.assign(this.stateGroups,i.stateGroups),Object.keys(i.listeners).forEach(e=>{this.listeners[e]=i.listeners[e].slice()});Object.keys(i.contexts).forEach(e=>{var t=i.contexts[e];this.contexts[e]={nice:t.nice,ready:true,status:t.status,serial:t.serial,scopes:{}}})}};h.initFrom=function(e){if(!e.__ngev){h.init.call(e)}Object.defineProperty(this,"__ngev",{configurable:true,value:new h.Internal(e.__ngev)})};h.mergeListeners=function(r){if(!this.__ngev){h.init.call(this)}var e=this.__ngev.listeners;this.__ngev.listeners={};Object.keys(e).forEach(e=>{this.__ngev.listeners[e]=[]});r.forEach(e=>{if(!e.__ngev){h.init.call(e)}Object.keys(e.__ngev.listeners).forEach(e=>{if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}})});Object.keys(this.__ngev.listeners).forEach(t=>{var i,n,s=[];if(e[t]){e[t].forEach(e=>{for(i=0,n=r.length;i<n;i++){if(!r[i].__ngev.listeners[t]||r[i].__ngev.listeners[t].indexOf(e)===-1){s.push(e);break}}})}r.forEach(e=>{e.__ngev.listeners[t].forEach(e=>{if(this.__ngev.listeners[t].indexOf(e)===-1&&s.indexOf(e)===-1){this.__ngev.listeners[t].push(e)}})})})};h.filterOutCallback=function(e,t){return e!==t};h.prototype.addListener=function(e,t,i){var n,s;if(!this.__ngev){h.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}if(!e||typeof e!=="string"){throw new TypeError(".addListener(): argument #0 should be a non-empty string")}if(typeof t==="function"){n={};if(!i||typeof i!=="object"){i={}}}else if(i===true&&t&&typeof t==="object"){i=n=t;t=undefined}else{i=t;if(!i||typeof i!=="object"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}t=undefined;n={}}n.fn=t||i.fn;n.id=i.id!==undefined?i.id:n.fn;if(i.unique){if(this.__ngev.listeners[e].find(e=>e.id===n.id)){return}}n.once=!!i.once;n.async=!!i.async;n.eventObject=!!i.eventObject;n.nice=i.nice!==undefined?Math.floor(i.nice):h.SYNC;n.priority=+i.priority||0;n.context=i.context&&(typeof i.context==="string"||typeof i.context==="object")?i.context:null;if(typeof n.fn!=="function"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}if(typeof n.context==="string"){n.context=this.__ngev.contexts[n.context]||this.addListenerContext(n.context)}n.event=e;if(this.__ngev.listeners.newListener.length){s=this.__ngev.listeners.newListener.slice();this.__ngev.listeners[e].push(n);h.emitEvent({emitter:this,name:"newListener",args:[[n]],listeners:s});if(this.__ngev.states[e]){h.emitToOneListener(this.__ngev.states[e],n)}return this}this.__ngev.listeners[e].push(n);if(this.__ngev.hasListenerPriority){this.__ngev.listeners[e].sort((e,t)=>t.priority-e.priority)}if(this.__ngev.listeners[e].length===this.__ngev.maxListeners+1){r.emitWarning("Possible NextGenEvents memory leak detected. "+this.__ngev.listeners[e].length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit",{type:"MaxListenersExceededWarning"})}if(this.__ngev.states[e]){h.emitToOneListener(this.__ngev.states[e],n)}return this};h.prototype.on=h.prototype.addListener;h.prototype.once=function(e,t,i){if(t&&typeof t==="object"){t.once=true}else if(i&&typeof i==="object"){i.once=true}else{i={once:true}}return this.addListener(e,t,i)};h.prototype.waitFor=function(e){return new Promise(t=>{this.addListener(e,e=>t(e),{once:true})})};h.prototype.waitForAll=function(e){return new Promise(t=>{this.addListener(e,(...e)=>t(e),{once:true})})};h.prototype.removeListener=function(e,t){if(!e||typeof e!=="string"){throw new TypeError(".removeListener(): argument #0 should be a non-empty string")}if(!this.__ngev){h.init.call(this)}var i=this.__ngev.listeners[e];if(!i||!i.length){return this}var n,s,r=0,o=i.length,a=this.__ngev.listeners.removeListener.length;if(a){s=[]}for(n=0;n<o;n++){if(i[n].id===t){r++;if(a){s.push(i[n])}}else if(r){i[n-r]=i[n]}}if(r){i.length-=r}if(a&&s.length){this.emit("removeListener",s)}return this};h.prototype.off=h.prototype.removeListener;h.prototype.removeAllListeners=function(e){var t;if(!this.__ngev){h.init.call(this)}if(e){if(!e||typeof e!=="string"){throw new TypeError(".removeAllListeners(): argument #0 should be undefined or a non-empty string")}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}t=this.__ngev.listeners[e];this.__ngev.listeners[e]=[];if(t.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",t)}}else{this.__ngev.listeners={error:[],interrupt:[],newListener:[],removeListener:[]}}return this};h.listenerWrapper=function(e,t,i,n,s){var r,o,a=t.master||t,l=!!t.master||t.emitter.__ngev.interruptible;if(a.interrupt){return}if(e.async){if(i){i.ready=!n}if(s<0){if(c.recursions>=-s){t.emitter.__ngev.desync(h.listenerWrapper.bind(undefined,e,t,i,n,h.SYNC));return}}else{setTimeout(h.listenerWrapper.bind(undefined,e,t,i,n,h.SYNC),s);return}o=e=>{a.listenersDone++;if(e&&l&&!a.interrupt&&t.name!=="interrupt"){a.interrupt=e;if(a.callback){h.emitCallback(t)}t.emitter.emit("interrupt",a.interrupt)}else if(a.listenersDone>=a.listeners.length&&a.callback){h.emitCallback(t)}if(n){h.processScopeQueue(i,true,true)}};if(e.eventObject){e.fn(t,o)}else{r=e.fn(...t.args,o)}}else{if(s<0){if(c.recursions>=-s){t.emitter.__ngev.desync(h.listenerWrapper.bind(undefined,e,t,i,n,h.SYNC));return}}else{setTimeout(h.listenerWrapper.bind(undefined,e,t,i,n,h.SYNC),s);return}if(e.eventObject){e.fn(t)}else{r=e.fn(...t.args)}a.listenersDone++}if(r&&l&&!a.interrupt&&t.name!=="interrupt"){a.interrupt=r;if(a.callback){h.emitCallback(t)}t.emitter.emit("interrupt",a.interrupt)}else if(a.listenersDone>=a.listeners.length&&a.callback){h.emitCallback(t)}};var u=0;h.prototype.emit=function(...e){var t=h.createEvent(this,...e);return h.emitEvent(t)};h.prototype.emitIfListener=function(...e){var t=typeof e[0]==="number"?e[1]:e[0];if(!this.__ngev||!this.__ngev.listeners[t]||!this.__ngev.listeners[t].length){return null}var i=h.createEvent(this,...e);return h.emitEvent(i)};h.prototype.waitForEmit=function(...e){return new Promise(t=>{this.emit(...e,e=>t(e))})};h.createEvent=function(e,...t){var i={emitter:e,interrupt:null,master:null,sync:true};if(typeof t[0]==="number"){i.nice=Math.floor(t[0]);i.name=t[1];if(!i.name||typeof i.name!=="string"){throw new TypeError(".emit(): when argument #0 is a number, argument #1 should be a non-empty string")}if(typeof t[t.length-1]==="function"){i.callback=t[t.length-1];i.args=t.slice(2,-1)}else{i.args=t.slice(2)}}else{i.name=t[0];if(!i.name||typeof i.name!=="string"){throw new TypeError(".emit(): argument #0 should be an number or a non-empty string")}if(typeof t[t.length-1]==="function"){i.callback=t[t.length-1];i.args=t.slice(1,-1)}else{i.args=t.slice(1)}}return i};h.emitEvent=function(e){var t=e.emitter,i,n,s=0,r,o;if(!t.__ngev){h.init.call(t)}r=t.__ngev.states[e.name];if(r!==undefined){if(r&&e.args.length===r.args.length&&e.args.every((e,t)=>e===r.args[t])){return}t.__ngev.stateGroups[e.name].forEach(e=>{t.__ngev.states[e]=null});t.__ngev.states[e.name]=e}if(!t.__ngev.listeners[e.name]){t.__ngev.listeners[e.name]=[]}e.id=u++;e.listenersDone=0;if(e.nice===undefined||e.nice===null){e.nice=t.__ngev.nice}if(!e.listeners){e.listeners=t.__ngev.listeners[e.name].slice()}c.recursions++;e.depth=t.__ngev.depth++;o=[];try{for(i=0,n=e.listeners.length;i<n;i++){s++;h.emitToOneListener(e,e.listeners[i],o)}}catch(e){c.recursions--;t.__ngev.depth--;throw e}c.recursions--;if(!e.callback){t.__ngev.depth--}if(o.length&&t.__ngev.listeners.removeListener.length){t.emit("removeListener",o)}if(!s){if(e.name==="error"){if(e.args[0]){throw e.args[0]}else{throw Error("Uncaught, unspecified 'error' event.")}}if(e.callback){h.emitCallback(e)}}e.sync=false;return e};h.emitIntricatedEvents=function(e,t){var i,n,s=0,r;if(!Array.isArray(e)){throw new TypeError(".emitCorrelatedEvents() argument should be an array")}var o=[],a={nice:h.DESYNC,ready:true,status:h.CONTEXT_ENABLED,serial:true,scopes:{}},l={sync:false,nice:h.DESYNC,context:a,interrupt:null,listeners:o,listenersDone:0,depth:0,callback:t};e.forEach(e=>{var t=h.createEvent(...e);t.master=l;if(!t.emitter.__ngev){h.init.call(t.emitter)}if(!t.emitter.__ngev.listeners[t.name]){t.emitter.__ngev.listeners[t.name]=[]}t.listeners=t.emitter.__ngev.listeners[t.name].slice();t.id=u++;t.listeners.forEach(e=>o.push({event:t,listener:e}))});o.sort((e,t)=>t.listener.priority-e.listener.priority);c.recursions++;r=[];try{for(i=0,n=o.length;i<n;i++){s++;h.emitToOneListener(o[i].event,o[i].listener,r)}}catch(e){c.recursions--;throw e}c.recursions--;if(!s&&l.callback){h.emitCallback(event)}l.sync=false};h.emitToOneListener=function(e,t,i){var n=e.emitter,s=e.master||e,r=e.master?e.master.context:t.context,o,a,l,c=false;if(r){if(r.status===h.CONTEXT_DISABLED){return}l=Math.max(s.nice,t.nice,r.nice);a=r.serial;o=h.getContextScope(r,s.depth)}else{l=Math.max(s.nice,t.nice)}if(t.once){n.__ngev.listeners[e.name]=n.__ngev.listeners[e.name].filter(h.filterOutCallback.bind(undefined,t));if(i){i.push(t)}else{c=true}}if(r&&(r.status===h.CONTEXT_QUEUED||!o.ready)){o.queue.push({event:e,listener:t,nice:l})}else{h.listenerWrapper(t,e,o,a,l)}if(c&&n.__ngev.listeners.removeListener.length){n.emit("removeListener",[t])}};h.emitCallback=function(e){var t;if(e.master){t=e.master.callback;delete e.master.callback;if(e.master.sync){i(()=>t(e.master.interrupt,e))}else{t(e.master.interrupt,e)}return}t=e.callback;delete e.callback;if(e.sync&&e.emitter.__ngev.nice!==h.SYNC){e.emitter.__ngev.desync(()=>{e.emitter.__ngev.depth--;t(e.interrupt,e)})}else{e.emitter.__ngev.depth--;t(e.interrupt,e)}};h.prototype.listeners=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listeners(): argument #0 should be a non-empty string")}if(!this.__ngev){h.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}return this.__ngev.listeners[e].slice()};h.listenerCount=function(e,t){if(!e||!(e instanceof h)){throw new TypeError(".listenerCount(): argument #0 should be an instance of NextGenEvents")}return e.listenerCount(t)};h.prototype.listenerCount=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listenerCount(): argument #1 should be a non-empty string")}if(!this.__ngev||!this.__ngev.listeners[e]){return 0}return this.__ngev.listeners[e].length};h.prototype.setNice=function(e){if(!this.__ngev){h.init.call(this)}this.__ngev.nice=Math.floor(+e||0)};h.prototype.desyncUseNextTick=function(e){if(!this.__ngev){h.init.call(this)}this.__ngev.desync=e?i:t};h.prototype.setInterruptible=function(e){if(!this.__ngev){h.init.call(this)}this.__ngev.interruptible=!!e};h.prototype.setListenerPriority=function(e){if(!this.__ngev){h.init.call(this)}this.__ngev.hasListenerPriority=!!e};h.share=function(e,t){if(!(e instanceof h)||!(t instanceof h)){throw new TypeError("NextGenEvents.share() arguments should be instances of NextGenEvents")}if(!e.__ngev){h.init.call(e)}Object.defineProperty(t,"__ngev",{configurable:true,value:e.__ngev})};h.reset=function(e){Object.defineProperty(e,"__ngev",{configurable:true,value:null})};h.prototype.getMaxListeners=function(){if(!this.__ngev){h.init.call(this)}return this.__ngev.maxListeners};h.prototype.setMaxListeners=function(e){if(!this.__ngev){h.init.call(this)}this.__ngev.maxListeners=typeof e==="number"&&!Number.isNaN(e)?Math.floor(e):h.defaultMaxListeners;return this};h.noop=()=>undefined;h.prototype.defineStates=function(...t){if(!this.__ngev){h.init.call(this)}t.forEach(e=>{this.__ngev.states[e]=null;this.__ngev.stateGroups[e]=t})};h.prototype.hasState=function(e){if(!this.__ngev){h.init.call(this)}return!!this.__ngev.states[e]};h.prototype.getAllStates=function(){if(!this.__ngev){h.init.call(this)}return Object.keys(this.__ngev.states).filter(e=>this.__ngev.states[e])};h.groupAddListener=function(e,t,i,n){if(typeof i!=="function"){n=i;i=undefined}if(!n||typeof n!=="object"){n={}}i=i||n.fn;delete n.fn;n.id=n.id||i;e.forEach(e=>{e.addListener(t,i.bind(undefined,e),n)})};h.groupOn=h.groupAddListener;h.groupOnce=function(e,t,i,n){if(i&&typeof i==="object"){i.once=true}else if(n&&typeof n==="object"){n.once=true}else{n={once:true}}return this.groupAddListener(e,t,i,n)};h.groupWaitFor=function(e,t){return Promise.all(e.map(e=>e.waitFor(t)))};h.groupWaitForAll=function(e,t){return Promise.all(e.map(e=>e.waitForAll(t)))};h.groupOnceFirst=function(t,i,n,s){var r,o=false;if(typeof n!=="function"){s=n;n=undefined}if(!s||typeof s!=="object"){s={}}n=n||s.fn;delete s.fn;s.id=s.id||n;r=(...e)=>{if(o){return}o=true;h.groupRemoveListener(t,i,s.id);n(...e)};t.forEach(e=>{e.once(i,r.bind(undefined,e),s)})};h.groupWaitForFirst=function(e,i){return new Promise(t=>{h.groupOnceFirst(e,i,e=>t(e))})};h.groupWaitForFirstAll=function(e,i){return new Promise(t=>{h.groupOnceFirst(e,i,(...e)=>t(e))})};h.groupOnceLast=function(e,t,i,n){var s,r=false,o=e.length;if(typeof i!=="function"){n=i;i=undefined}if(!n||typeof n!=="object"){n={}}i=i||n.fn;delete n.fn;n.id=n.id||i;s=(...e)=>{if(r){return}if(--o){return}r=true;i(...e)};e.forEach(e=>{e.once(t,s.bind(undefined,e),n)})};h.groupWaitForLast=function(e,i){return new Promise(t=>{h.groupOnceLast(e,i,e=>t(e))})};h.groupWaitForLastAll=function(e,i){return new Promise(t=>{h.groupOnceLast(e,i,(...e)=>t(e))})};h.groupRemoveListener=function(e,t,i){e.forEach(e=>{e.removeListener(t,i)})};h.groupOff=h.groupRemoveListener;h.groupRemoveAllListeners=function(e,t){e.forEach(e=>{e.removeAllListeners(t)})};h.groupEmit=function(e,...t){var i,n,s=1,r,o=e.length,a,l,c=false;if(typeof t[t.length-1]==="function"){r=-1;a=t[t.length-1];l=e=>{if(c){return}if(e){c=true;a(e)}else if(!--o){c=true;a()}}}if(typeof t[0]==="number"){s=2;n=typeof t[0]}i=t[s-1];t=t.slice(s,r);e.forEach(e=>{h.emitEvent({emitter:e,name:i,args:t,nice:n,callback:l})})};h.groupWaitForEmit=function(e,...i){return new Promise(t=>{h.groupEmit(e,...i,e=>t(e))})};h.groupDefineStates=function(e,...t){e.forEach(e=>{e.defineStates(...t)})};h.groupGlobalOnce=h.groupOnceFirst;h.groupGlobalOnceAll=h.groupOnceLast;h.CONTEXT_ENABLED=0;h.CONTEXT_DISABLED=1;h.CONTEXT_QUEUED=2;h.prototype.addListenerContext=function(e,t){if(!this.__ngev){h.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".addListenerContext(): argument #0 should be a non-empty string")}if(!t||typeof t!=="object"){t={}}var i=this.__ngev.contexts[e];if(!i){i=this.__ngev.contexts[e]={nice:h.SYNC,ready:true,status:h.CONTEXT_ENABLED,serial:false,scopes:{}}}if(t.nice!==undefined){i.nice=Math.floor(t.nice)}if(t.status!==undefined){i.status=t.status}if(t.serial!==undefined){i.serial=!!t.serial}return i};h.prototype.getListenerContext=function(e){return this.__ngev.contexts[e]};h.getContextScope=function(e,t){var i=e.scopes[t];if(!i){i=e.scopes[t]={ready:true,queue:[]}}return i};h.prototype.disableListenerContext=function(e){if(!this.__ngev){h.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].status=h.CONTEXT_DISABLED;return this};h.prototype.enableListenerContext=function(e){if(!this.__ngev){h.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".enableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}var t=this.__ngev.contexts[e];t.status=h.CONTEXT_ENABLED;Object.values(t.scopes).forEach(e=>{if(e.queue.length>0){h.processScopeQueue(e,t.serial)}});return this};h.prototype.queueListenerContext=function(e){if(!this.__ngev){h.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".queueListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].status=h.CONTEXT_QUEUED;return this};h.prototype.serializeListenerContext=function(e,t){if(!this.__ngev){h.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".serializeListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].serial=t===undefined?true:!!t;return this};h.prototype.setListenerContextNice=function(e,t){if(!this.__ngev){h.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".setListenerContextNice(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].nice=Math.floor(t);return this};h.prototype.destroyListenerContext=function(e){var t,i,n,s,r,o=[];if(!e||typeof e!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev){h.init.call(this)}n=this.__ngev.contexts[e];if(!n){return}for(s in this.__ngev.listeners){r=null;i=this.__ngev.listeners[s].length;for(t=0;t<i;t++){if(this.__ngev.listeners[s][t].context===n){r=[];o.push(this.__ngev.listeners[s][t])}else if(r){r.push(this.__ngev.listeners[s][t])}}if(r){this.__ngev.listeners[s]=r}}delete this.__ngev.contexts[e];if(o.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",o)}return this};h.processScopeQueue=function(e,t,i){var n,s,r,o;if(i){e.ready=true}c.recursions++;while(e.ready&&e.queue.length){n=e.queue.shift();s=n.event;r=s.master||s;o=s.emitter;if(r.interrupt){continue}h.listenerWrapper(n.listener,s,e,t,n.nice)}c.recursions--};h.on=h.prototype.on;h.once=h.prototype.once;h.off=h.prototype.off;if(e.AsyncTryCatch){h.prototype.asyncTryCatchId=e.AsyncTryCatch.NextGenEvents.length;e.AsyncTryCatch.NextGenEvents.push(h);if(e.AsyncTryCatch.substituted){e.AsyncTryCatch.substitute()}}h.Proxy=n("./Proxy.js")}).call(this,n("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},n("timers").setImmediate)},{"../package.json":31,"./Proxy.js":29,_process:33,timers:44}],29:[function(e,t,i){"use strict";function n(){this.localServices={};this.remoteServices={};this.nextAckId=1}t.exports=n;var r=e("./NextGenEvents.js");var o="NextGenEvents/message";function s(){}n.create=(...e)=>new n(...e);n.prototype.addLocalService=function(e,t,i){this.localServices[e]=a.create(this,e,t,i);return this.localServices[e]};n.prototype.addRemoteService=function(e){this.remoteServices[e]=l.create(this,e);return this.remoteServices[e]};n.prototype.destroy=function(){Object.keys(this.localServices).forEach(e=>{this.localServices[e].destroy();delete this.localServices[e]});Object.keys(this.remoteServices).forEach(e=>{this.remoteServices[e].destroy();delete this.remoteServices[e]});this.receive=this.send=s};n.prototype.push=function(e){if(e.__type!==o||!e.service||typeof e.service!=="string"||!e.event||typeof e.event!=="string"||!e.method){return}switch(e.method){case"event":return this.remoteServices[e.service]&&this.remoteServices[e.service].receiveEvent(e);case"ackEmit":return this.remoteServices[e.service]&&this.remoteServices[e.service].receiveAckEmit(e);case"emit":return this.localServices[e.service]&&this.localServices[e.service].receiveEmit(e);case"listen":return this.localServices[e.service]&&this.localServices[e.service].receiveListen(e);case"ignore":return this.localServices[e.service]&&this.localServices[e.service].receiveIgnore(e);case"ackEvent":return this.localServices[e.service]&&this.localServices[e.service].receiveAckEvent(e);default:return}};n.prototype.receive=function(e){this.push(e)};n.prototype.send=function(){throw new Error("The send() method of the Proxy MUST be extended/overwritten")};function a(e,t,i,n){return a.create(e,t,i,n)}n.LocalService=a;a.create=function(e,t,i,n){var s=Object.create(a.prototype,{proxy:{value:e,enumerable:true},id:{value:t,enumerable:true},emitter:{value:i,writable:true,enumerable:true},internalEvents:{value:Object.create(r.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},canListen:{value:!!n.listen,writable:true,enumerable:true},canEmit:{value:!!n.emit,writable:true,enumerable:true},canAck:{value:!!n.ack,writable:true,enumerable:true},canRpc:{value:!!n.rpc,writable:true,enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return s};a.prototype.destroy=function(){Object.keys(this.events).forEach(e=>{this.emitter.off(e,this.events[e]);delete this.events[e]});this.emitter=null;this.destroyed=true};a.prototype.receiveEmit=function(t){if(this.destroyed||!this.canEmit||t.ack&&!this.canAck){return}var e={emitter:this.emitter,name:t.event,args:t.args||[]};if(t.ack){e.callback=e=>{this.proxy.send({__type:o,service:this.id,method:"ackEmit",ack:t.ack,event:t.event,interruption:e})}}r.emitEvent(e)};a.prototype.receiveListen=function(e){if(this.destroyed||!this.canListen||e.ack&&!this.canAck){return}if(e.ack){if(this.events[e.event]){if(this.events[e.event].ack){return}this.emitter.off(e.event,this.events[e.event])}this.events[e.event]=a.forwardWithAck.bind(this);this.events[e.event].ack=true;this.emitter.on(e.event,this.events[e.event],{eventObject:true,async:true})}else{if(this.events[e.event]){if(!this.events[e.event].ack){return}this.emitter.off(e.event,this.events[e.event])}this.events[e.event]=a.forward.bind(this);this.events[e.event].ack=false;this.emitter.on(e.event,this.events[e.event],{eventObject:true})}};a.prototype.receiveIgnore=function(e){if(this.destroyed||!this.canListen){return}if(!this.events[e.event]){return}this.emitter.off(e.event,this.events[e.event]);this.events[e.event]=null};a.prototype.receiveAckEvent=function(e){if(this.destroyed||!this.canListen||!this.canAck||!e.ack||!this.events[e.event]||!this.events[e.event].ack){return}this.internalEvents.emit("ack",e)};a.forward=function(e){if(this.destroyed){return}this.proxy.send({__type:o,service:this.id,method:"event",event:e.name,args:e.args})};a.forward.ack=false;a.forwardWithAck=function(e,t){if(this.destroyed){return}if(!e.callback){this.proxy.send({__type:o,service:this.id,method:"event",event:e.name,args:e.args});t();return}var i=false;var n=this.proxy.nextAckId++;var s=e=>{if(i||e.ack!==n){return}i=true;this.internalEvents.off("ack",s);t()};this.internalEvents.on("ack",s);this.proxy.send({__type:o,service:this.id,method:"event",event:e.name,ack:n,args:e.args})};a.forwardWithAck.ack=true;function l(e,t){return l.create(e,t)}n.RemoteService=l;var c=1;var h=2;l.create=function(e,t){var i=Object.create(l.prototype,{proxy:{value:e,enumerable:true},id:{value:t,enumerable:true},emitter:{value:Object.create(r.prototype),writable:true,enumerable:true},internalEvents:{value:Object.create(r.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return i};l.prototype.destroy=function(){this.emitter.removeAllListeners();this.emitter=null;Object.keys(this.events).forEach(e=>{delete this.events[e]});this.destroyed=true};l.prototype.emit=function(e,...t){if(this.destroyed){return}var i,n,s;if(typeof e==="number"){throw new TypeError("Cannot emit with a nice value on a remote service")}if(typeof t[t.length-1]!=="function"){this.proxy.send({__type:o,service:this.id,method:"emit",event:e,args:t});return}i=t.pop();n=this.proxy.nextAckId++;s=false;var r=e=>{if(s||e.ack!==n){return}s=true;this.internalEvents.off("ack",r);i(e.interruption)};this.internalEvents.on("ack",r);this.proxy.send({__type:o,service:this.id,method:"emit",ack:n,event:e,args:t})};l.prototype.addListener=function(e,t,i){if(this.destroyed){return}if(typeof t!=="function"){i=t;t=undefined}if(!i||typeof i!=="object"){i={}}i.fn=t||i.fn;this.emitter.addListener(e,i);if(!this.emitter.__ngev.listeners[e]||!this.emitter.__ngev.listeners[e].length){return}if(i.async&&this.events[e]!==h){this.events[e]=h;this.proxy.send({__type:o,service:this.id,method:"listen",ack:true,event:e})}else if(!i.async&&!this.events[e]){this.events[e]=c;this.proxy.send({__type:o,service:this.id,method:"listen",event:e})}};l.prototype.on=l.prototype.addListener;l.prototype.once=r.prototype.once;l.prototype.removeListener=function(e,t){if(this.destroyed){return}this.emitter.removeListener(e,t);if((!this.emitter.__ngev.listeners[e]||!this.emitter.__ngev.listeners[e].length)&&this.events[e]){this.events[e]=0;this.proxy.send({__type:o,service:this.id,method:"ignore",event:e})}};l.prototype.off=l.prototype.removeListener;l.prototype.receiveEvent=function(e){if(this.destroyed||!this.events[e.event]){return}var t={emitter:this.emitter,name:e.event,args:e.args||[]};if(e.ack){t.callback=()=>{this.proxy.send({__type:o,service:this.id,method:"ackEvent",ack:e.ack,event:e.event})}}r.emitEvent(t);var i=t.name;if(!this.emitter.__ngev.listeners[i]||!this.emitter.__ngev.listeners[i].length){this.events[i]=0;this.proxy.send({__type:o,service:this.id,method:"ignore",event:i})}};l.prototype.receiveAckEmit=function(e){if(this.destroyed||!e.ack||this.events[e.event]!==h){return}this.internalEvents.emit("ack",e)}},{"./NextGenEvents.js":28}],30:[function(t,i,e){(function(e){"use strict";if(typeof window.setImmediate!=="function"){window.setImmediate=e=>setTimeout(e,0)}if(!e.emitWarning){e.emitWarning=()=>undefined}i.exports=t("./NextGenEvents.js");i.exports.isBrowser=true}).call(this,t("_process"))},{"./NextGenEvents.js":28,_process:33}],31:[function(e,t,i){t.exports={name:"nextgen-events",version:"1.4.0",description:"The next generation of events handling for javascript! New: abstract away the network!",main:"lib/NextGenEvents.js",engines:{node:">=6.0.0"},directories:{test:"test"},dependencies:{},devDependencies:{browserify:"^16.2.2","uglify-js-es6":"^2.8.9",ws:"^5.1.1"},scripts:{test:"tea-time -R dot"},repository:{type:"git",url:"https://github.com/cronvel/nextgen-events.git"},keywords:["events","async","emit","listener","context","series","serialize","namespace","proxy","network"],author:"Cédric Ronvel",license:"MIT",bugs:{url:"https://github.com/cronvel/nextgen-events/issues"},config:{"tea-time":{coverDir:["lib"]}},copyright:{title:"Next-Gen Events",years:[2015,2019],owner:"Cédric Ronvel"}}},{}],32:[function(e,t,c){(function(s){function r(e,t){var i=0;for(var n=e.length-1;n>=0;n--){var s=e[n];if(s==="."){e.splice(n,1)}else if(s===".."){e.splice(n,1);i++}else if(i){e.splice(n,1);i--}}if(t){for(;i--;i){e.unshift("..")}}return e}c.resolve=function(){var e="",t=false;for(var i=arguments.length-1;i>=-1&&!t;i--){var n=i>=0?arguments[i]:s.cwd();if(typeof n!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!n){continue}e=n+"/"+e;t=n.charAt(0)==="/"}e=r(o(e.split("/"),function(e){return!!e}),!t).join("/");return(t?"/":"")+e||"."};c.normalize=function(e){var t=c.isAbsolute(e),i=a(e,-1)==="/";e=r(o(e.split("/"),function(e){return!!e}),!t).join("/");if(!e&&!t){e="."}if(e&&i){e+="/"}return(t?"/":"")+e};c.isAbsolute=function(e){return e.charAt(0)==="/"};c.join=function(){var e=Array.prototype.slice.call(arguments,0);return c.normalize(o(e,function(e,t){if(typeof e!=="string"){throw new TypeError("Arguments to path.join must be strings")}return e}).join("/"))};c.relative=function(e,t){e=c.resolve(e).substr(1);t=c.resolve(t).substr(1);function i(e){var t=0;for(;t<e.length;t++){if(e[t]!=="")break}var i=e.length-1;for(;i>=0;i--){if(e[i]!=="")break}if(t>i)return[];return e.slice(t,i-t+1)}var n=i(e.split("/"));var s=i(t.split("/"));var r=Math.min(n.length,s.length);var o=r;for(var a=0;a<r;a++){if(n[a]!==s[a]){o=a;break}}var l=[];for(var a=o;a<n.length;a++){l.push("..")}l=l.concat(s.slice(o));return l.join("/")};c.sep="/";c.delimiter=":";c.dirname=function(e){if(typeof e!=="string")e=e+"";if(e.length===0)return".";var t=e.charCodeAt(0);var i=t===47;var n=-1;var s=true;for(var r=e.length-1;r>=1;--r){t=e.charCodeAt(r);if(t===47){if(!s){n=r;break}}else{s=false}}if(n===-1)return i?"/":".";if(i&&n===1){return"/"}return e.slice(0,n)};function n(e){if(typeof e!=="string")e=e+"";var t=0;var i=-1;var n=true;var s;for(s=e.length-1;s>=0;--s){if(e.charCodeAt(s)===47){if(!n){t=s+1;break}}else if(i===-1){n=false;i=s+1}}if(i===-1)return"";return e.slice(t,i)}c.basename=function(e,t){var i=n(e);if(t&&i.substr(-1*t.length)===t){i=i.substr(0,i.length-t.length)}return i};c.extname=function(e){if(typeof e!=="string")e=e+"";var t=-1;var i=0;var n=-1;var s=true;var r=0;for(var o=e.length-1;o>=0;--o){var a=e.charCodeAt(o);if(a===47){if(!s){i=o+1;break}continue}if(n===-1){s=false;n=o+1}if(a===46){if(t===-1)t=o;else if(r!==1)r=1}else if(t!==-1){r=-1}}if(t===-1||n===-1||r===0||r===1&&t===n-1&&t===i+1){return""}return e.slice(t,n)};function o(e,t){if(e.filter)return e.filter(t);var i=[];for(var n=0;n<e.length;n++){if(t(e[n],n,e))i.push(e[n])}return i}var a="ab".substr(-1)==="b"?function(e,t,i){return e.substr(t,i)}:function(e,t,i){if(t<0)t=e.length+t;return e.substr(t,i)}}).call(this,e("_process"))},{_process:33}],33:[function(e,t,i){var n=t.exports={};var s;var r;function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){s=setTimeout}else{s=o}}catch(e){s=o}try{if(typeof clearTimeout==="function"){r=clearTimeout}else{r=a}}catch(e){r=a}})();function l(t){if(s===setTimeout){return setTimeout(t,0)}if((s===o||!s)&&setTimeout){s=setTimeout;return setTimeout(t,0)}try{return s(t,0)}catch(e){try{return s.call(null,t,0)}catch(e){return s.call(this,t,0)}}}function c(t){if(r===clearTimeout){return clearTimeout(t)}if((r===a||!r)&&clearTimeout){r=clearTimeout;return clearTimeout(t)}try{return r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}var h=[];var u=false;var f;var p=-1;function d(){if(!u||!f){return}u=false;if(f.length){h=f.concat(h)}else{p=-1}if(h.length){m()}}function m(){if(u){return}var e=l(d);u=true;var t=h.length;while(t){f=h;h=[];while(++p<t){if(f){f[p].run()}}p=-1;t=h.length}f=null;u=false;c(e)}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){t[i-1]=arguments[i]}}h.push(new y(e,t));if(h.length===1&&!u){l(m)}};function y(e,t){this.fun=e;this.array=t}y.prototype.run=function(){this.fun.apply(null,this.array)};n.title="browser";n.browser=true;n.env={};n.argv=[];n.version="";n.versions={};function g(){}n.on=g;n.addListener=g;n.once=g;n.off=g;n.removeListener=g;n.removeAllListeners=g;n.emit=g;n.prependListener=g;n.prependOnceListener=g;n.listeners=function(e){return[]};n.binding=function(e){throw new Error("process.binding is not supported")};n.cwd=function(){return"/"};n.chdir=function(e){throw new Error("process.chdir is not supported")};n.umask=function(){return 0}},{}],34:[function(e,t,i){(function(b,e){(function(i,n){"use strict";if(i.setImmediate){return}var s=1;var r={};var o=false;var a=i.document;var l;function e(e){if(typeof e!=="function"){e=new Function(""+e)}var t=new Array(arguments.length-1);for(var i=0;i<t.length;i++){t[i]=arguments[i+1]}var n={callback:e,args:t};r[s]=n;l(s);return s++}function c(e){delete r[e]}function h(e){var t=e.callback;var i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i);break}}function u(e){if(o){setTimeout(u,0,e)}else{var t=r[e];if(t){o=true;try{h(t)}finally{c(e);o=false}}}}function t(){l=function(e){b.nextTick(function(){u(e)})}}function f(){if(i.postMessage&&!i.importScripts){var e=true;var t=i.onmessage;i.onmessage=function(){e=false};i.postMessage("","*");i.onmessage=t;return e}}function p(){var t="setImmediate$"+Math.random()+"$";var e=function(e){if(e.source===i&&typeof e.data==="string"&&e.data.indexOf(t)===0){u(+e.data.slice(t.length))}};if(i.addEventListener){i.addEventListener("message",e,false)}else{i.attachEvent("onmessage",e)}l=function(e){i.postMessage(t+e,"*")}}function d(){var t=new MessageChannel;t.port1.onmessage=function(e){var t=e.data;u(t)};l=function(e){t.port2.postMessage(e)}}function m(){var i=a.documentElement;l=function(e){var t=a.createElement("script");t.onreadystatechange=function(){u(e);t.onreadystatechange=null;i.removeChild(t);t=null};i.appendChild(t)}}function y(){l=function(e){setTimeout(u,0,e)}}var g=Object.getPrototypeOf&&Object.getPrototypeOf(i);g=g&&g.setTimeout?g:i;if({}.toString.call(i.process)==="[object process]"){t()}else if(f()){p()}else if(i.MessageChannel){d()}else if(a&&"onreadystatechange"in a.createElement("script")){m()}else{y()}g.setImmediate=e;g.clearImmediate=c})(typeof self==="undefined"?typeof e==="undefined"?this:e:self)}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:33}],35:[function(e,t,i){"use strict";const s=e("./seventh.js");function n(e,t=4){this.jobRunner=e;this.jobs=new Map;this.pendingJobs=new Map;this.runningJobs=new Map;this.errorJobs=new Map;this.jobsDone=new Map;this.concurrency=+t||1;this.isQueueRunning=true;this.isLoopRunning=false;this.canLoopAgain=false;this.ready=s.resolved;this.startTime=null;this.endTime=null;this.drained=s.resolved;this.idle=s.resolved}s.Queue=n;function r(e,t=null,i=undefined){this.id=e;this.dependencies=t===null?null:[...t];this.data=i===undefined?e:i;this.error=null;this.startTime=null;this.endTime=null}n.Job=r;n.prototype.setConcurrency=function(e){this.concurrency=+e||1};n.prototype.stop=n.prototype.pause=function(){this.isQueueRunning=false};n.prototype.has=function(e){return this.jobs.has(e)};n.prototype.add=n.prototype.addJob=function(e,t,i=null){if(this.jobs.has(e)){return false}var n=new r(e,i,t);this.jobs.set(e,n);this.pendingJobs.set(e,n);this.canLoopAgain=true;if(this.isQueueRunning&&!this.isLoopRunning){this.run()}if(this.drained.isSettled()){this.drained=new s}return n};n.prototype.addBatch=n.prototype.addJobBatch=function(e){var t,i;for(t of e){if(this.jobs.has(t)){return false}i=new r(t);this.jobs.set(t,i);this.pendingJobs.set(t,i)}this.canLoopAgain=true;if(this.isQueueRunning&&!this.isLoopRunning){this.run()}if(this.drained.isSettled()){this.drained=new s}};n.prototype.run=n.prototype.resume=async function(){var e;this.isQueueRunning=true;if(this.isLoopRunning){return}this.isLoopRunning=true;if(!this.startTime){this.startTime=Date.now()}do{this.canLoopAgain=false;for(e of this.pendingJobs.values()){if(e.dependencies&&e.dependencies.some(e=>!this.jobsDone.has(e))){continue}if(this.idle.isSettled()){this.idle=new s}this.canLoopAgain=true;await this.ready;if(!this.isQueueRunning){this.finishRun();return}this.runJob(e)}}while(this.canLoopAgain);this.finishRun()};n.prototype.finishRun=function(){this.isLoopRunning=false;if(!this.pendingJobs.size){this.drained.resolve()}if(!this.runningJobs.size){this.endTime=Date.now();this.idle.resolve()}};n.prototype.runJob=async function(t){this.pendingJobs.delete(t.id);this.runningJobs.set(t.id,t);if(this.runningJobs.size>=this.concurrency){this.ready=new s}try{t.startTime=Date.now();await this.jobRunner(t.data);t.endTime=Date.now();this.jobsDone.set(t.id,t);this.canLoopAgain=true}catch(e){t.endTime=Date.now();t.error=e;this.errorJobs.set(t.id,t)}this.runningJobs.delete(t.id);if(this.runningJobs.size<this.concurrency){this.ready.resolve()}if(!this.isLoopRunning){if(this.isQueueRunning&&this.pendingJobs.size){this.run()}else{this.finishRun()}}};n.prototype.getJobTimes=function(){var e,t={};for(e of this.jobsDone.values()){t[e.id]=e.endTime-e.startTime}return t};n.prototype.getStats=function(){var e,t=0,i={pending:this.pendingJobs.size,running:this.runningJobs.size,failed:this.errorJobs.size,done:this.jobsDone.size,averageJobTime:null,queueTime:null};if(this.jobsDone.size){for(e of this.jobsDone.values()){t+=e.endTime-e.startTime}i.averageJobTime=t/this.jobsDone.size}if(this.endTime){i.queueTime=this.endTime-this.startTime}return i}},{"./seventh.js":42}],36:[function(e,t,i){"use strict";const o=e("./seventh.js");o.promisifyNodeApi=(n,s,r,e,t)=>{var i;s=s||"Async";r=r||"AsyncAll";e=e||(e=>e[0]!=="_"&&!e.endsWith("Sync"));if(t){i=[];for(let e in n){if(typeof n[e]==="function"){i.push(e)}}}else{i=Object.keys(n)}i.filter(t=>{if(typeof n[t]!=="function"){return false}for(let e in n[t].prototype){return false}return e(t,n)}).forEach(e=>{const t=e+s;const i=e+r;if(!n[t]){n[t]=o.promisify(n[e],n)}if(!n[i]){n[i]=o.promisifyAll(n[e],n)}})};o.promisifyAnyNodeApi=(e,t,i,n)=>{o.promisifyNodeApi(e,t,i,n,true)}},{"./seventh.js":42}],37:[function(e,t,i){"use strict";const d=e("./seventh.js");const h={};function u(){}d.all=e=>{var i=-1,n=false,s=0,r=Infinity,o,a=[],l=new d;for(o of e){if(n){break}i++;(()=>{const t=i;d.resolve(o).then(e=>{if(n){return}a[t]=e;s++;if(s>=r){n=true;l._resolveValue(a)}},e=>{if(n){return}n=true;l.reject(e)})})()}r=i+1;if(!r){l._resolveValue(a)}return l};d._allArray=e=>{var t=e.length;if(!t){d._resolveValue([])}var i,n={settled:false,count:0,length:t,values:[],allPromise:new d};for(i=0;!n.settled&&i<t;i++){d._allArrayOne(e[i],i,n)}return n.allPromise};d._allArrayOne=(e,t,i)=>{d._bareThen(e,e=>{if(i.settled){return}i.values[t]=e;i.count++;if(i.count>=i.length){i.settled=true;i.allPromise._resolveValue(i.values)}},e=>{if(i.settled){return}i.settled=true;i.allPromise.reject(e)})};d.every=d.map=(e,i)=>{var n=-1,s=false,r=0,o=Infinity,a,l=[],c=new d;for(a of e){if(s){break}n++;(()=>{const t=n;d.resolve(a).then(e=>{if(s){return}return i(e,t)}).then(e=>{if(s){return}l[t]=e;r++;if(r>=o){s=true;c._resolveValue(l)}},e=>{if(s){return}s=true;c.reject(e)})})()}o=n+1;if(!o){c._resolveValue(l)}return c};d.any=e=>{var i=-1,n=false,s=0,r=Infinity,o,a=[],l=new d;for(o of e){if(n){break}i++;(()=>{const t=i;d.resolve(o).then(e=>{if(n){return}n=true;l._resolveValue(e)},e=>{if(n){return}a[t]=e;s++;if(s>=r){n=true;l.reject(a)}})})()}r=i+1;if(!r){l.reject(new RangeError("Promise.any(): empty array"))}return l};d.some=(e,i)=>{var n=-1,s=false,r=0,o=Infinity,a,l=[],c=new d;for(a of e){if(s){break}n++;(()=>{const t=n;d.resolve(a).then(e=>{if(s){return}return i(e,t)}).then(e=>{if(s){return}s=true;c._resolveValue(e)},e=>{if(s){return}l[t]=e;r++;if(r>=o){s=true;c.reject(l)}})})()}o=n+1;if(!o){c.reject(new RangeError("Promise.any(): empty array"))}return c};d.filter=(e,i)=>{var n=-1,s=false,r=0,o=Infinity,a,l=[],c=new d;for(a of e){if(s){break}n++;(()=>{const t=n;d.resolve(a).then(e=>{if(s){return}l[t]=e;return i(e,t)}).then(e=>{if(s){return}r++;if(!e){l[t]=h}if(r>=o){s=true;l=l.filter(e=>e!==h);c._resolveValue(l)}},e=>{if(s){return}s=true;c.reject(e)})})()}o=n+1;if(!o){c._resolveValue(l)}else if(r>=o){s=true;l=l.filter(e=>e!==h);c._resolveValue(l)}return c};d.foreach=d.forEach=function(e,n,t){var s=-1,r=arguments.length>=3,o=e[Symbol.iterator](),a=new d,l=d.resolve(t);if(d.warnUnhandledRejection){d._handleAll(e)}var c=()=>{l.then(t=>{let{value:e,done:i}=o.next();s++;if(i){a.resolve(t)}else{l=d.resolve(e).then(r?e=>n(t,e,s):e=>n(e,s));c()}},e=>{a.reject(e);for(;;){let{value:e,done:t}=o.next();if(t){break}if(d.isThenable(e)){e.then(u,u)}}})};c();return a};d.reduce=(e,t,i)=>{return d.forEach(e,t,i)};d.mapObject=(e,i)=>{var n=false,s=0,t,r,o=Object.keys(e),a=o.length,l,c={},h=new d;for(t=0;!n&&t<a;t++){r=o[t];l=e[r];(()=>{const t=r;d.resolve(l).then(e=>{if(n){return}return i(e,t)}).then(e=>{if(n){return}c[t]=e;s++;if(s>=a){n=true;h._resolveValue(c)}},e=>{if(n){return}n=true;h.reject(e)})})()}if(!a){h._resolveValue(c)}return h};d.concurrent=(i,e,n)=>{var s=-1,r=false,o=0,a=0,l=Infinity,c,t=false,h=[],u=e[Symbol.iterator](),f=new d;if(d.warnUnhandledRejection){d._handleAll(e)}i=+i||1;const p=()=>{while(!t&&o<i){({value:c,done:t}=u.next());if(t){l=s+1;if(a>=l){r=true;f._resolveValue(h);return}break}if(r){break}s++;(()=>{const t=s;o++;d.resolve(c).then(e=>{if(r){return}return n(e,t)}).then(e=>{if(r){return}h[t]=e;a++;o--;if(a>=l){r=true;f._resolveValue(h);return}if(o<i){p();return}},e=>{if(r){return}r=true;f.reject(e)})})()}};p();if(s<0){f._resolveValue(h)}return f};d.race=e=>{var t=false,i,n=new d;for(i of e){if(t){break}d.resolve(i).then(e=>{if(t){return}t=true;n._resolveValue(e)},e=>{if(t){return}t=true;n.reject(e)})}return n}},{"./seventh.js":42}],38:[function(o,a,e){(function(e,t,i){"use strict";const n=t.Promise;var s;if(!e.browser){s=e.nextTick}else{o("setimmediate");s=i}function r(e){this.fn=e;this._then=r._dormantThen;this.value=null;this.thenHandlers=null;this.handledRejection=null;if(this.fn){this._exec()}}a.exports=r;r.Native=n;r.warnUnhandledRejection=true;r.prototype._exec=function(){this._then=r._pendingThen;try{this.fn(e=>{this.resolve(e)},e=>{this.reject(e)})}catch(e){this.reject(e)}};r.prototype.resolve=r.prototype.fulfill=function(e){if(this._then.settled){return this}if(r.isThenable(e)){this._execThenPromise(e);return this}return this._resolveValue(e)};r.prototype._resolveValue=function(e){this._then=r._fulfilledThen;this.value=e;if(this.thenHandlers&&this.thenHandlers.length){this._execFulfillHandlers()}return this};r.prototype._execThenPromise=function(e){try{e.then(e=>{this.resolve(e)},e=>{this.reject(e)})}catch(e){this.reject(e)}};r.prototype.reject=function(e){if(this._then.settled){return this}this._then=r._rejectedThen;this.value=e;if(this.thenHandlers&&this.thenHandlers.length){this._execRejectionHandlers()}else if(r.warnUnhandledRejection&&!this.handledRejection){this._unhandledRejection()}return this};r.prototype._execFulfillHandlers=function(){var e,t=this.thenHandlers.length;for(e=0;e<t;e+=3){if(this.thenHandlers[e+1]){this._execOneFulfillHandler(this.thenHandlers[e],this.thenHandlers[e+1])}else{this.thenHandlers[e].resolve(this.value)}}};r.prototype._execOneFulfillHandler=function(t,e){try{t.resolve(e(this.value))}catch(e){t.reject(e)}};r.prototype._execRejectionHandlers=function(){var e,t=this.thenHandlers.length;for(e=0;e<t;e+=3){if(this.thenHandlers[e+2]){this._execOneRejectHandler(this.thenHandlers[e],this.thenHandlers[e+2])}else{this.thenHandlers[e].reject(this.value)}}};r.prototype._execOneRejectHandler=function(t,e){try{t.resolve(e(this.value))}catch(e){t.reject(e)}};r.prototype.resolveTimeout=r.prototype.fulfillTimeout=function(e,t){setTimeout(()=>this.resolve(t),e)};r.prototype.rejectTimeout=function(e,t){setTimeout(()=>this.reject(t),e)};r._dormantThen=function(e,t){if(this.fn){this._exec();return this._then(e,t)}var i=new r;if(!this.thenHandlers){this.thenHandlers=[i,e,t]}else{this.thenHandlers[this.thenHandlers.length]=i;this.thenHandlers[this.thenHandlers.length]=e;this.thenHandlers[this.thenHandlers.length]=t}return i};r._dormantThen.settled=false;r._pendingThen=function(e,t){var i=new r;if(!this.thenHandlers){this.thenHandlers=[i,e,t]}else{this.thenHandlers[this.thenHandlers.length]=i;this.thenHandlers[this.thenHandlers.length]=e;this.thenHandlers[this.thenHandlers.length]=t}return i};r._pendingThen.settled=false;r._fulfilledThen=function(e){if(!e){return this}var t=new r;s(()=>{try{t.resolve(e(this.value))}catch(e){t.reject(e)}});return t};r._fulfilledThen.settled=true;r._rejectedThen=function(e,t){if(!t){return this}this.handledRejection=true;var i=new r;s(()=>{try{i.resolve(t(this.value))}catch(e){i.reject(e)}});return i};r._rejectedThen.settled=true;r.prototype.then=function(e,t){return this._then(e,t)};r.prototype.catch=function(e=()=>undefined){return this._then(undefined,e)};r.prototype.finally=function(e){return this._then(e,e)};r.prototype.tap=r.prototype.tapThen=function(e){this._then(e,undefined);return this};r.prototype.tapCatch=function(e){this._then(undefined,e);return this};r.prototype.tapFinally=function(e){this._then(e,e);return this};r.prototype.fatal=function(){this._then(undefined,e=>{s(()=>{throw e})})};r.prototype.done=function(e,t){this._then(e,t).fatal();return this};r.prototype.callback=function(t){this._then(e=>{t(undefined,e)},e=>{t(e)}).fatal();return this};r.prototype.callbackAll=function(t){this._then(e=>{if(Array.isArray(e)){t(undefined,...e)}else{t(undefined,e)}},e=>{t(e)}).fatal();return this};r.callback=function(e){return new r((i,n)=>{e((e,t)=>{if(e){n(e)}else{i(t)}})})};r.callbackAll=function(e){return new r((i,n)=>{e((e,...t)=>{if(e){n(e)}else{i(t)}})})};r.prototype.toPromise=r.prototype.propagate=function(t){this._then(e=>{t.resolve(e)},e=>{t.reject(e)});return this};r.propagate=function(e,t){e.then(e=>{t.resolve(e)},e=>{t.reject(e)});return e};r.finally=function(e,t){return e.then(t,t)};r.resolve=r.fulfill=function(e){if(r.isThenable(e)){return r.fromThenable(e)}return r._resolveValue(e)};r._resolveValue=function(e){var t=new r;t._then=r._fulfilledThen;t.value=e;return t};r.reject=function(e){var t=new r;t._then=r._rejectedThen;t.value=e;return t};r.resolveTimeout=r.fulfillTimeout=function(t,i){return new r(e=>setTimeout(()=>e(i),t))};r.rejectTimeout=function(i,n){return new r((e,t)=>setTimeout(()=>t(n),i))};r.resolveNextTick=r.fulfillNextTick=function(t){return new r(e=>s(()=>e(t)))};r.rejectNextTick=function(i){return new r((e,t)=>s(()=>t(i)))};r.dormant=function(e){var t=new r;t.fn=e;return t};r.try=function(e){try{return r.resolve(e())}catch(e){return r.reject(e)}};r.isThenable=function(e){return e&&typeof e==="object"&&typeof e.then==="function"};r.fromThenable=function(e){if(e instanceof r){return e}return new r((t,i)=>{e.then(e=>{t(e)},e=>{i(e)})})};r._bareThen=function(e,t,i){if(e&&typeof e==="object"){if(e instanceof r){if(e._then===r._fulfilledThen){t(e.value)}else if(e._then===r._rejectedThen){i(e.value)}else{e._then(t,i)}}else if(typeof e.then==="function"){e.then(t,i)}else{t(e)}}else{t(e)}};r._handleAll=function(e){var t;for(t of e){if(r.isThenable(t)){t.handledRejection=true}}};r.prototype._unhandledRejection=function(){this.handledRejection=false;const t=e=>setTimeout(e,0);if(this.value instanceof Error){t(()=>{if(this.handledRejection===false){this.value.message="Unhandled promise rejection: "+this.value.message;console.error(this.value)}})}else{let e=new Error("Unhandled promise rejection");t(()=>{if(this.handledRejection===false){console.error(e);console.error("Rejection reason:",this.value)}})}};r.prototype.isSettled=function(){return this._then.settled};r.prototype.getStatus=function(){switch(this._then){case r._dormantThen:return"dormant";case r._pendingThen:return"pending";case r._fulfilledThen:return"fulfilled";case r._rejectedThen:return"rejected"}};r.prototype.inspect=function(){switch(this._then){case r._dormantThen:return"Promise { <DORMANT> }";case r._pendingThen:return"Promise { <PENDING> }";case r._fulfilledThen:return"Promise { <FULFILLED> "+this.value+" }";case r._rejectedThen:return"Promise { <REJECTED> "+this.value+" }"}};r.resolved=r.dummy=r.resolve();if(e.browser){r.prototype.resolveAtAnimationFrame=function(e){window.requestAnimationFrame(()=>this.resolve(e))};r.prototype.rejectAtAnimationFrame=function(e){window.requestAnimationFrame(()=>this.reject(e))};r.resolveAtAnimationFrame=function(t){return new r(e=>window.requestAnimationFrame(()=>e(t)))};r.rejectAtAnimationFrame=function(i){return new r((e,t)=>window.requestAnimationFrame(()=>t(i)))}}}).call(this,o("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},o("timers").setImmediate)},{_process:33,setimmediate:34,timers:44}],39:[function(e,t,i){"use strict";const c=e("./seventh.js");c.promisifyAll=(t,s)=>{if(s){return(...e)=>{return new c((i,n)=>{t.call(s,...e,(e,...t)=>{if(e){if(t.length&&e instanceof Error){e.args=t}n(e)}else{i(t)}})})}}return function(...e){return new c((i,n)=>{t.call(this,...e,(e,...t)=>{if(e){if(t.length&&e instanceof Error){e.args=t}n(e)}else{i(t)}})})}};c.promisify=(t,s)=>{if(s){return(...e)=>{return new c((i,n)=>{t.call(s,...e,(e,t)=>{if(e){if(t!==undefined&&e instanceof Error){e.arg=t}n(e)}else{i(t)}})})}}return function(...e){return new c((i,n)=>{t.call(this,...e,(e,t)=>{if(e){if(t!==undefined&&e instanceof Error){e.arg=t}n(e)}else{i(t)}})})}};c.returnValueInterceptor=(i,n,s)=>{return function(...e){var t=n.call(s||this,...e);i(t);return t}};c.once=(t,i)=>{var n=false;var s;return function(...e){if(!n){n=true;s=t.call(i||this,...e)}return s}};c.serialize=(i,n)=>{var s=new c.resolve;return function(...e){var t=new c;s.finally(()=>{c.propagate(i.call(n||this,...e),t)});s=t;return t}};c.debounce=(t,i)=>{var n=null;const s=()=>{n=null};return function(...e){if(n){return n}n=t.call(i||this,...e);c.finally(n,s);return n}};c.debounceDelay=(e,t,i)=>{var n=null;const s=()=>{setTimeout(()=>n=null,e)};return function(...e){if(n){return n}n=t.call(i||this,...e);c.finally(n,s);return n}};c.debounceUpdate=(i,n)=>{var s=null;var r=null;var o=null;const a=()=>{var e,t;s=null;if(r){e=r;r=null;t=o;o=null;s=i.call(...e);c.propagate(s,t);c.finally(s,a);return s}};return function(...e){var t=n||this;if(s){if(!o){o=new c}r=[t,...e];return o}s=i.call(t,...e);c.finally(s,a);return s}};c.NO_DELAY={};c.BATCH_NO_DELAY={};c.debounceSync=(r,o)=>{var i=new Map;const a=e=>{var t=i.get(e);if(!t){t={inProgress:null,inProgressIsFull:null,last:null,lastTime:null,lastFullSync:null,lastFullSyncTime:null,nextFullSyncPromise:null,nextFullSyncWith:null,noDelayBatches:new Set};i.set(e,t)}return t};const l=(e,t)=>{var i,n,s,r=new Date;e.inProgress=null;if(t>=2){e.lastFullSyncTime=e.lastTime=r}else if(t>=1){e.lastTime=r}if(e.nextFullSyncWith){if(o.delay&&e.lastFullSyncTime&&(i=r-e.lastFullSyncTime-o.delay)<0){e.inProgress=c.resolveTimeout(-i+1);e.inProgress.finally(()=>l(e,0));return e.nextFullSyncPromise}n=e.nextFullSyncWith;e.nextFullSyncWith=null;s=e.nextFullSyncPromise;e.nextFullSyncPromise=null;e.lastFullSync=e.last=e.inProgress=o.fn.call(...n);c.propagate(e.inProgress,s);c.finally(e.inProgress,()=>l(e,2));return e.inProgress}};const e=function(e,...t){var i=false,n=r.thisBinding||this,s=a(e);if(t[0]===c.NO_DELAY){i=true;t.shift()}else if(t[0]===c.BATCH_NO_DELAY){t.shift();let e=t.shift();if(!s.noDelayBatches.has(e)){s.noDelayBatches.add(e);i=true}}if(s.inProgress){return s.inProgress}if(!i&&r.delay&&s.lastTime&&new Date-s.lastTime<r.delay){if(typeof r.onDebounce==="function"){r.onDebounce(e,...t)}return s.last}s.last=s.inProgress=r.fn.call(n,e,...t);s.inProgressIsFull=false;c.finally(s.inProgress,()=>l(s,1));return s.inProgress};const t=function(e,...t){var i,n=false,s=o.thisBinding||this,r=a(e);if(t[0]===c.NO_DELAY){n=true;t.shift()}else if(t[0]===c.BATCH_NO_DELAY){t.shift();let e=t.shift();if(!r.noDelayBatches.has(e)){r.noDelayBatches.add(e);n=true}}if(!r.inProgress&&!n&&o.delay&&r.lastFullSyncTime&&(i=new Date-r.lastFullSyncTime-o.delay)<0){r.inProgress=c.resolveTimeout(-i+1);c.finally(r.inProgress,()=>l(r,0))}if(r.inProgress){if(!r.nextFullSyncPromise){r.nextFullSyncPromise=new c}r.nextFullSyncWith=[s,e,...t];return r.nextFullSyncPromise}r.lastFullSync=r.last=r.inProgress=o.fn.call(s,e,...t);c.finally(r.inProgress,()=>l(r,2));return r.inProgress};return[e,t]};c.timeout=(i,n,s)=>{return function(...e){var t=n.call(s||this,...e);setTimeout(()=>t.reject(new Error("Timeout")),i);return t}};c.variableTimeout=(n,s)=>{return function(e,...t){var i=n.call(s||this,...t);setTimeout(()=>i.reject(new Error("Timeout")),e);return i}}},{"./seventh.js":42}],40:[function(e,t,i){(function(s){"use strict";const r=e("./seventh.js");var o=false;r.asyncExit=function(i,n){if(o){return}o=true;var e=s.listeners("asyncExit");if(!e.length){s.exit(i);return}if(n===undefined){n=1e3}const t=t=>{if(t.length<3){t(i,n);return r.dummy}return new r(e=>{t(i,n,()=>{e()})})};r.map(e,t).finally(()=>s.exit(i));setTimeout(()=>s.exit(i),n)};r.resolveSafeTimeout=function(t,i){return new r(e=>{setTimeout(()=>{setTimeout(()=>{setTimeout(()=>{setTimeout(()=>e(i),0)},t/2)},t/2)},0)})}}).call(this,e("_process"))},{"./seventh.js":42,_process:33}],41:[function(e,t,i){"use strict";const n=e("./seventh.js");n.parasite=()=>{var e=["tap","tapCatch","finally","fatal","done","callback","callbackAll"];e.forEach(e=>n.Native.prototype[e]=n.prototype[e]);n.Native.prototype._then=n.Native.prototype.then}},{"./seventh.js":42}],42:[function(e,t,i){"use strict";const n=e("./core.js");t.exports=n;e("./batch.js");e("./wrapper.js");e("./decorators.js");e("./Queue.js");e("./api.js");e("./parasite.js");e("./misc.js")},{"./Queue.js":35,"./api.js":36,"./batch.js":37,"./core.js":38,"./decorators.js":39,"./misc.js":40,"./parasite.js":41,"./wrapper.js":43}],43:[function(e,t,i){"use strict";const c=e("./seventh.js");c.timeLimit=(i,n)=>{return new c((e,t)=>{if(typeof n==="function"){n=n()}c.resolve(n).then(e,t);setTimeout(()=>t(new Error("Timeout")),i)})};c.retry=(e,t)=>{var i=e.retries||1,n=e.coolDown||0,s=e.raiseFactor||1,r=e.maxCoolDown||Infinity,o=e.timeout||0,a=e.catch||null;const l=()=>{return(o?c.timeLimit(o,t):t()).catch(e=>{if(!i--){throw e}var t=n;n=Math.min(n*s,r);if(a){return c.resolve(a(e)).then(()=>c.resolveTimeout(t).then(l))}return c.resolveTimeout(t).then(l)})};return l()};c.onceEvent=(t,i)=>{return new c(e=>t.once(i,e))};c.onceEventAll=(e,i)=>{return new c(t=>e.once(i,(...e)=>t(e)))};c.onceEventOrError=(a,l,e,i=false)=>{return new c((t,n)=>{var s;var r=(...e)=>{a.removeListener("error",o);if(s){for(let e in s){a.removeListener(e,s[e])}}t(i?e:e[0])};var o=e=>{a.removeListener(l,r);if(s){for(let e in s){a.removeListener(e,s[e])}}n(e)};a.once(l,r);a.once("error",o);if(e){if(!Array.isArray(e)){e=[e]}s={};e.forEach(i=>{var e=(...e)=>{a.removeListener("error",o);a.removeListener(l,r);var t=new Error("Received an excluded event: "+i);t.event=i;t.eventArgs=e;n(t)};a.once(i,e);s[i]=e})}})};c.onceEventAllOrError=(e,t,i)=>{return c.onceEventOrError(e,t,i,true)}},{"./seventh.js":42}],44:[function(l,e,c){(function(e,t){var s=l("process/browser.js").nextTick;var i=Function.prototype.apply;var r=Array.prototype.slice;var o={};var a=0;c.setTimeout=function(){return new n(i.call(setTimeout,window,arguments),clearTimeout)};c.setInterval=function(){return new n(i.call(setInterval,window,arguments),clearInterval)};c.clearTimeout=c.clearInterval=function(e){e.close()};function n(e,t){this._id=e;this._clearFn=t}n.prototype.unref=n.prototype.ref=function(){};n.prototype.close=function(){this._clearFn.call(window,this._id)};c.enroll=function(e,t){clearTimeout(e._idleTimeoutId);e._idleTimeout=t};c.unenroll=function(e){clearTimeout(e._idleTimeoutId);e._idleTimeout=-1};c._unrefActive=c.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;if(e>=0){t._idleTimeoutId=setTimeout(function e(){if(t._onTimeout)t._onTimeout()},e)}};c.setImmediate=typeof e==="function"?e:function(t){var i=a++;var n=arguments.length<2?false:r.call(arguments,1);o[i]=true;s(function e(){if(o[i]){if(n){t.apply(null,n)}else{t.call(null)}c.clearImmediate(i)}});return i};c.clearImmediate=typeof t==="function"?t:function(e){delete o[e]}}).call(this,l("timers").setImmediate,l("timers").clearImmediate)},{"process/browser.js":33,timers:44}]},{},[18]);