(function(){function e(t,i,n){function s(o,a){if(!i[o]){if(!t[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(r)return r(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var h=i[o]={exports:{}};t[o][0].call(h.exports,function(e){var i=t[o][1][e];return s(i||e)},h,h.exports,e,t,i,n)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}return e})()({1:[function(e,t,i){"use strict";const n=e("./GTransition.js");const s=e("./vectorUtils.js");const r=e("seventh");function o(e){this.gScene=e;this.mode=null;this.position={x:0,y:0,z:10};this.target={x:0,y:0,z:0};this.rotation={x:0,y:0,z:0,w:1};this.yaw=0;this.pitch=0;this.roll=0;this.distance=10;this.fov=90;this.perspective=1;this.free=false;this.trackingMode=null;this.babylon={type:null,camera:null};this.setMode("firstPerson")}t.exports=o;o.prototype.update=function(e,t=false){console.warn("3D Camera.update()",e);var i=this.babylon.camera,s=this.gScene.babylon.scene;if(e.mode){this.setMode(e.mode)}if(e.transition){e.transition=new n(e.transition)}if(e.free!==undefined){if(this.updateFree(e.free)){if(!e.position){e.position=this.position}if(!e.rotation){e.rotation=this.rotation}if(!e.target){e.target=this.target}if(e.yaw===undefined){e.yaw=this.yaw}if(e.pitch===undefined){e.pitch=this.pitch}if(e.roll===undefined){e.roll=this.roll}if(e.distance===undefined){e.distance=this.distance}}}switch(this.mode){case"positions":if(e.position||e.target||e.roll!==undefined){this.updateFirstPerson(e,false,true)}break;case"firstPerson":if(e.position||e.yaw!==undefined||e.pitch!==undefined||e.roll!==undefined){this.updateFirstPerson(e)}break;case"firstPersonQuaternion":if(e.position||e.rotation){this.updateFirstPerson(e,true)}break;case"orbital":if(e.target||e.yaw!==undefined||e.pitch!==undefined||e.roll!==undefined||e.distance!==undefined){this.updateOrbital(e)}break}if(e.fov!==undefined){this.fov=e.fov||90;if(e.transition){e.transition.createAnimation(s,i,"fov",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.fov*Math.PI/360)}else{i.fov=this.fov*Math.PI/360}}if(e.trackingMode!==undefined){this.trackingMode=e.trackingMode||null}return t&&e.transition&&e.transition.promise||r.resolved};o.prototype.setMode=function(e){var t,i;console.warn("##### Camera.setMode()",e,this.mode);if(e===this.mode){return}this.mode=e;switch(this.mode){case"positions":case"firstPerson":case"firstPersonQuaternion":if(this.babylon.type==="FreeCamera"){this.babylon.camera.position=new BABYLON.Vector3(this.position.x,this.position.y,this.position.z)}else{this.babylon.type="FreeCamera";if(this.babylon.camera){this.babylon.camera.dispose()}this.babylon.camera=new BABYLON.FreeCamera("Camera",new BABYLON.Vector3(this.position.x,this.position.y,this.position.z),this.gScene.babylon.scene);this.babylon.camera.onViewMatrixChangedObservable.add(()=>{this.gScene.changes.camera=true})}if(this.mode==="positions"){this.babylon.camera.rotationQuaternion=BABYLON.Quaternion.FromEulerVector(s.cameraRotationFromOriginAndTarget(this.position,this.target,this.roll*s.DEG_TO_RAD))}else if(this.mode==="firstPersonQuaternion"){this.babylon.camera.rotationQuaternion=new BABYLON.Quaternion(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w)}else{this.babylon.camera.rotationQuaternion=BABYLON.Quaternion.FromEulerAngles(this.pitch*s.DEG_TO_RAD,this.yaw*s.DEG_TO_RAD,this.roll*s.DEG_TO_RAD)}break;case"orbital":t=s.toCameraAlpha(this.yaw);i=s.toCameraBeta(this.pitch);if(this.babylon.type==="ArcRotateCamera"){this.babylon.camera.target=new BABYLON.Vector3(this.target.x,this.target.y,this.target.z);this.babylon.camera.alpha=t;this.babylon.camera.beta=i;this.babylon.camera.radius=this.distance}else{this.babylon.type="ArcRotateCamera";if(this.babylon.camera){this.babylon.camera.dispose()}this.babylon.camera=new BABYLON.ArcRotateCamera("Camera",t,i,this.distance,new BABYLON.Vector3(this.target.x,this.target.y,this.target.z),this.gScene.babylon.scene);this.babylon.camera.onViewMatrixChangedObservable.add(()=>{this.gScene.changes.camera=true})}break;default:return}console.warn("~~~~~~ Camera.setMode() done")};o.prototype.updateFree=function(e){e=!!e;if(e===this.free){return}this.free=e;if(!this.free){this.babylon.camera.detachControl();return true}this.babylon.camera.attachControl();return false};o.prototype.updateFirstPerson=function(e,t,i){var n,r,o=this.babylon.camera,a=this.gScene.babylon.scene;if(e.position){this.position=e.position}if(e.target){this.target=e.target}if(e.rotation){this.rotation=e.rotation}if(e.yaw!==undefined){this.yaw=e.yaw}if(e.pitch!==undefined){this.pitch=e.pitch}if(e.roll!==undefined){this.roll=e.roll}if(i){r=BABYLON.Quaternion.FromEulerVector(s.cameraRotationFromOriginAndTarget(this.position,this.target,this.roll*s.DEG_TO_RAD))}else if(t){if(e.rotation){r=new BABYLON.Quaternion(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w)}}else if(e.yaw!==undefined||e.pitch!==undefined||e.roll!==undefined){r=BABYLON.Quaternion.FromEulerAngles(this.pitch*s.DEG_TO_RAD,this.yaw*s.DEG_TO_RAD,this.roll*s.DEG_TO_RAD)}if(e.transition){n=o.rotationQuaternion?o.rotationQuaternion:BABYLON.Quaternion.FromEulerVector(o.rotation);console.warn("[!] camera transition:",o,n,r);if(e.position){e.transition.createAnimation(a,o,"position",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(this.position.x,this.position.y,this.position.z))}if(r){e.transition.createAnimation(a,o,"rotationQuaternion",BABYLON.Animation.ANIMATIONTYPE_QUATERNION,r,n)}}else{console.warn("[!] camera direct:",o,r);if(e.position){o.position=new BABYLON.Vector3(this.position.x,this.position.y,this.position.z)}if(r){o.rotationQuaternion=r}}};o.prototype.updateOrbital=function(e){var t,i,n=this.babylon.camera,r=this.gScene.babylon.scene;if(e.target){this.target=e.target}if(e.yaw){this.yaw=e.yaw;t=s.toCameraAlpha(this.yaw)}if(e.pitch){this.pitch=e.pitch;i=s.toCameraBeta(this.pitch)}if(e.distance){this.distance=e.distance}if(e.transition){console.warn("[!] camera transition:",n);if(e.target){e.transition.createAnimation(r,n,"target",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(this.target.x,this.target.y,this.target.z))}if(e.yaw){e.transition.createAnimation(r,n,"alpha",BABYLON.Animation.ANIMATIONTYPE_FLOAT,t)}if(e.pitch){e.transition.createAnimation(r,n,"beta",BABYLON.Animation.ANIMATIONTYPE_FLOAT,i)}if(e.distance){e.transition.createAnimation(r,n,"radius",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.distance)}}else{console.warn("[!] camera direct:",n);if(e.target){n.target=new BABYLON.Vector3(this.target.x,this.target.y,this.target.z)}if(e.yaw){n.alpha=t}if(e.pitch){n.beta=i}if(e.distance){n.radius=this.distance}}}},{"./GTransition.js":15,"./vectorUtils.js":19,seventh:41}],2:[function(e,t,i){"use strict";const n=e("./GTransition.js");const s=e("./Parametric.js");const r=e("nextgen-events/lib/browser.js");const o=e("seventh");function a(e,t,i){this.id=i.id||null;this.dom=e;this.gScene=t;this.usage=i.usage||"sprite";this.transient=i.transient||undefined;this.parent=undefined;this.show=false;this.persistent=true;this.button=null;this.theme=null;this.texturePack=null;this.variant="default";this.frame=0;this.opacity=1;this.location=null;this.origin={x:0,y:0,z:0};this.position={x:0,y:0,z:0};this.positionMode="default";this.size={x:1,y:1,z:1};this.sizeMode="default";this.rotation={x:0,y:0,z:0};this.rotationMode="default";this.direction={x:1,y:0,z:0};this.facing=0;this.opacity=1;this.special={};this.meta={};this.engine={};this.parametric=null;this.clientMods={variant:null,xFlipVariant:null,xFlip:false,origin:null,size:null};this.updateMeshNeeded=true;this.updateMaterialNeeded=true;this.createLightNeeded=false;this.texturePackObject=null;this.variantObject=null;this.frameObject=null;this.lightEmitting=false;this.textureCache={};this.textureAnimationTimer=null;this.children=new Set;if(i.parent){this.setParent(i.parent)}this.babylon={material:null,mesh:null,light:null};this.nextTextureFrame=this.nextTextureFrame.bind(this);this.defineStates("loaded","loading");if(this.transient){setTimeout(()=>this.destroy(),this.transient*1e3)}if(this.noLocalLighting){this.gScene.noLocalLightingGEntities.add(this);this.gScene.once("render",()=>this.gScene.updateLightExcludedMeshes(),{unique:true,id:"updateLightExcludedMeshes"})}}a.prototype=Object.create(r.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.localBBoxSize=1;a.prototype.noLocalLighting=false;a.prototype.isLocalLight=true;a.prototype.destroy=function(){if(this.noLocalLighting){this.gScene.noLocalLightingGEntities.remove(this);this.gScene.once("render",()=>this.gScene.updateLightExcludedMeshes(),{unique:true,id:"updateLightExcludedMeshes"})}if(this.children.size){for(let e of this.children){e.destroy()}}if(this.babylon.mesh){this.babylon.mesh.parent=null;this.babylon.mesh.dispose()}if(this.babylon.material){this.babylon.material.dispose(false,false,true)}this.gScene.removeGEntity(this.id);this.destroyed=true};a.prototype.setParent=function(e){var t=this.gScene.gEntities[e];if(!t){return}this.parent=t;t.addChild(this)};a.prototype.addChild=function(e){this.children.add(e)};a.prototype.update=async function(e,t=false,i=false){console.warn("3D GEntity.update()",e);if(e.transition){if(i){delete e.transition}else{e.transition=new n(e.transition)}}if(e.engine!==undefined){await this.updateEngine(e.engine)}if(e.special!==undefined){await this.updateSpecialStage1(e)}if(e.texturePack!==undefined||e.variant!==undefined||e.theme!==undefined){await this.updateTexture(e.texturePack,e.variant,e.theme)}if(this.updateMeshNeeded){await this.updateMesh()}if(this.updateMaterialNeeded){await this.updateMaterial()}if(this.createLightNeeded){this.createLightNeeded=false;this.lightEmitting=true;await this.createLight()}if(e.special!==undefined){await this.updateSpecialStage2(e)}if(typeof e.opacity==="number"){this.updateOpacity(e.opacity)}if(e.origin!==undefined){this.updateOrigin(e.origin)}if(e.direction!==undefined){this.updateDirection(e.direction)}if(e.facing!==undefined){this.updateFacing(e.facing)}if(e.position!==undefined||e.positionMode!==undefined){this.updatePosition(e)}if(e.rotation!==undefined||e.rotationMode!==undefined){this.updateRotation(e)}if(e.size!==undefined||e.sizeMode!==undefined){this.updateSize(e.size)}if(e.parametric!==undefined){if(!e.parametric){if(this.parametric){this.parametric=null;this.gScene.parametricGEntities.delete(this)}}else if(typeof e.parametric==="object"){if(!this.parametric){this.gScene.parametricGEntities.add(this);this.parametric=new s(e.parametric)}else{this.parametric.update(e.parametric)}}console.warn("@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 3D GEntity.update() parametric",e)}return t&&e.transition&&e.transition.promise||o.resolved};a.prototype.parametricUpdate=function(e){var t=this.parametric.compute(e,this);if(!t){this.parametric=null;this.gScene.parametricGEntities.delete(this);return}if(typeof t.opacity==="number"){this.updateOpacity(t.opacity,true)}if(t.position!==undefined||t.positionMode!==undefined){this.updatePosition(t,true)}if(t.rotation!==undefined||t.rotationMode!==undefined){this.updateRotation(t,true)}if(t.size!==undefined||t.sizeMode!==undefined){this.updateSize(t.size,true)}};a.prototype.updateEngine=function(e){};a.prototype.updateSpecialStage1=function(e){};a.prototype.updateSpecialStage2=function(e){if(e.special.light!==undefined){this.updateLight(e)}if(e.special&&e.special.material){this.updateMaterialParams(e.special.material)}};a.prototype.updateDirection=function(e){this.direction=e};a.prototype.updateFacing=function(e){this.facing=e};a.prototype.updateMesh=function(){this.updateMeshNeeded=false};a.prototype.refreshMaterial=async function(){this.updateTexture();if(this.updateMaterialNeeded){await this.updateMaterial()}};a.prototype.updateMaterial=function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;console.warn("3D GEntity.updateMaterial()",this.texturePackObject,this.variantObject);this.babylon.material=e=new BABYLON.StandardMaterial("basicMaterial",i);e.ambientColor=new BABYLON.Color3(1,1,1);e.diffuseColor=new BABYLON.Color3(0,0,0);e.specularColor=new BABYLON.Color3(0,0,0);e.emissiveColor=new BABYLON.Color3(0,0,0);e.backFaceCulling=true;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};a.prototype.updateMaterialParams=function(e,t=false){var i,n,s,r=this.babylon.material;console.warn("@@@@@@@@@@@@@@@@@@ updateMaterialParams()",e);if(e.ambient&&typeof e.ambient==="object"){if(!this.special.ambient){this.special.ambient={r:1,g:1,b:1}}i=e.ambient.r!==undefined?e.ambient.r:this.special.ambient.r,n=e.ambient.g!==undefined?e.ambient.g:this.special.ambient.g,s=e.ambient.b!==undefined?e.ambient.b:this.special.ambient.b;if(!t){this.special.ambient.r=i;this.special.ambient.g=n;this.special.ambient.b=s}r.ambientColor.set(i,n,s)}if(e.diffuse&&typeof e.diffuse==="object"){if(!this.special.diffuse){this.special.diffuse={r:0,g:0,b:0}}i=e.diffuse.r!==undefined?e.diffuse.r:this.special.diffuse.r,n=e.diffuse.g!==undefined?e.diffuse.g:this.special.diffuse.g,s=e.diffuse.b!==undefined?e.diffuse.b:this.special.diffuse.b;if(!t){this.special.diffuse.r=i;this.special.diffuse.g=n;this.special.diffuse.b=s}r.diffuseColor.set(i,n,s)}if(e.specular&&typeof e.specular==="object"){if(!this.special.specular){this.special.specular={r:0,g:0,b:0}}i=e.specular.r!==undefined?e.specular.r:this.special.specular.r,n=e.specular.g!==undefined?e.specular.g:this.special.specular.g,s=e.specular.b!==undefined?e.specular.b:this.special.specular.b;if(!t){this.special.specular.r=i;this.special.specular.g=n;this.special.specular.b=s}r.specularColor.set(i,n,s)}if(e.emissive&&typeof e.emissive==="object"){console.warn("@@@@@@@@@@@@@@@@@@ updateMaterialParams() emissive",e.emissive);if(!this.special.emissive){this.special.emissive={r:0,g:0,b:0}}i=e.emissive.r!==undefined?e.emissive.r:this.special.emissive.r,n=e.emissive.g!==undefined?e.emissive.g:this.special.emissive.g,s=e.emissive.b!==undefined?e.emissive.b:this.special.emissive.b;if(!t){this.special.emissive.r=i;this.special.emissive.g=n;this.special.emissive.b=s}r.emissiveColor.set(i,n,s)}};a.prototype.updateOpacity=function(e,t=false){var i=this.babylon.material;if(!i){return}if(e<0){e=0}else if(e>1){e=1}if(!t){this.opacity=e}i.alpha=e};a.prototype.updateTexture=function(e,t,i,n,s=false){var r,o,a;if(e!==undefined){this.texturePack=e||null}if(t!==undefined){this.variant=t||null}if(i!==undefined){this.theme=i||null}console.warn("3D GEntity.updateTexture()",e,t,i);r=this.gScene.texturePacks[this.texturePack+"/"+(this.theme||this.gScene.theme)];if(!r){console.warn("3D Texture pack",this.texturePack+"/"+(this.theme||this.gScene.theme),"not found");r=this.gScene.texturePacks[this.texturePack+"/default"];if(!r){console.warn("3D Texture pack fallback",this.texturePack+"/default","not found");return}}var l=this.clientMods.xFlip;this.clientMods.xFlip=false;if(this.clientMods.variant){o=r.variants[this.variant+"@"+this.clientMods.variant];if(!o){o=r.variants[this.variant+"@"+this.clientMods.xFlipVariant];if(o){this.clientMods.xFlip=true}else{o=r.variants[this.variant]||r.variants.default}}}else{o=r.variants[this.variant]||r.variants.default}if(!o){console.warn("3D Texture pack variant",this.variant,"not found, and default variant missing too");return}if(o===this.variantObject){if(n!==undefined){this.frame=o.frames[n]?+n:0}}else{this.frame=n!==undefined&&o.frames[n]?+n:0}a=o.frames[this.frame]||o.frames[0];if(r!==this.texturePackObject){this.whenTextureCacheReady().then(()=>{if(r===this.texturePackObject){this.preloadTexturePack()}})}if(r===this.texturePackObject&&o===this.variantObject&&a===this.frameObject&&l===this.clientMods.xFlip){return}this.texturePackObject=r;this.variantObject=o;this.frameObject=a;if(this.variantObject.animation){this.startTextureAnimation(!s)}else{this.stopTextureAnimation()}this.updateMaterialNeeded=true};a.prototype.startTextureAnimation=function(e=false){if(!this.variantObject.animation){if(this.textureAnimationTimer){clearTimeout(this.textureAnimationTimer);this.textureAnimationTimer=null}return}if(this.textureAnimationTimer){if(!e){return}clearTimeout(this.textureAnimationTimer);this.textureAnimationTimer=null}this.textureAnimationTimer=setTimeout(this.nextTextureFrame,1e3*this.frameObject.duration)};a.prototype.stopTextureAnimation=function(){if(this.textureAnimationTimer){clearTimeout(this.textureAnimationTimer);this.textureAnimationTimer=null}};a.prototype.nextTextureFrame=function(){if(this.frame>=this.variantObject.frames.length-1){if(this.variantObject.animation==="loop"){this.frame=0}else{this.stopTextureAnimation();return}}else{this.frame++}this.frameObject=this.variantObject.frames[this.frame];this.textureAnimationTimer=setTimeout(this.nextTextureFrame,1e3*this.frameObject.duration);this.updateMaterial()};a.prototype.updateOrigin=function(e,t=false){if(this.clientMods.origin&&!t){this.origin=e;return}var i=this.clientMods.origin||this.origin;if(i.x===e.x&&i.y===e.y&&i.z===e.z){return}var n=this.babylon.mesh,s=this.localBBoxSize/2;n.bakeTransformIntoVertices(BABYLON.Matrix.Translation((i.x-e.x)*s,(i.y-e.y)*s,(i.z-e.z)*s));if(t){this.clientMods.origin=e}else{this.origin=e}};a.prototype.updatePosition=function(e,t=false){var i=this.babylon.mesh,n=this.gScene.babylon.scene;if(!i){return}var s=e.position.x!==undefined?e.position.x:this.position.x,r=e.position.y!==undefined?e.position.y:this.position.y,o=e.position.z!==undefined?e.position.z:this.position.z;if(!t){this.position.x=s;this.position.y=r;this.position.z=o}if(e.transition){e.transition.createAnimation(n,i,"position",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(s,r,o))}else{i.position.set(s,r,o)}};a.prototype.updateRotation=function(e,t=false){console.warn("3D GEntity.updateRotation()",e);var i=this.babylon.mesh,n=this.gScene.babylon.scene;if(!i){return}var s=e.rotation.x!==undefined?e.rotation.x:this.rotation.x,r=e.rotation.y!==undefined?e.rotation.y:this.rotation.y,o=e.rotation.z!==undefined?e.rotation.z:this.rotation.z;if(!t){this.rotation.x=s;this.rotation.y=r;this.rotation.z=o}i.angle=o};a.prototype.updateSize=function(e,t=false,i=false){console.warn("3D GEntity.updateSize()",e);var n,s,r,o=this.babylon.mesh,a=this.gScene.babylon.scene;if(i){this.clientMods.size={x:e.x!==undefined?e.x:1,y:e.y!==undefined?e.y:1,z:e.z!==undefined?e.z:1};n=this.size.x;s=this.size.y;r=this.size.z}else if(t){n=e.x!==undefined?e.x:this.size.x;s=e.y!==undefined?e.y:this.size.y;r=e.z!==undefined?e.z:this.size.z}else{n=this.size.x=e.x!==undefined?e.x:this.size.x;s=this.size.y=e.y!==undefined?e.y:this.size.y;r=this.size.z=e.z!==undefined?e.z:this.size.z}if(!o){return}if(this.clientMods.size){n*=this.clientMods.size.x;s*=this.clientMods.size.y;r*=this.clientMods.size.z}o.scaling.x=n;o.scaling.y=s;o.scaling.z=r};a.prototype.updateLight=function(e,t=false){console.warn("3D GEntity.updateLight()",e);if(e.special.light===undefined){return}if(!e.special.light!==!this.lightEmitting){this.lightEmitting=!!e.special.light;if(!this.lightEmitting){this.destroyLight();return}this.createLight()}if(!e.special.light||typeof e.special.light!=="object"){return}var i=this.gScene.babylon.scene,n=this.babylon.light;if(e.special.light.diffuse&&typeof e.special.light.diffuse==="object"){this.special.light.diffuse=e.special.light.diffuse;if(e.transition){e.transition.createAnimation(i,n,"diffuse",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(this.special.light.diffuse.r,this.special.light.diffuse.g,this.special.light.diffuse.b))}else{n.diffuse.set(this.special.light.diffuse.r,this.special.light.diffuse.g,this.special.light.diffuse.b)}}if(e.special.light.specular&&typeof e.special.light.specular==="object"){this.special.light.specular=e.special.light.specular;if(e.transition){e.transition.createAnimation(i,n,"specular",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(this.special.light.specular.r,this.special.light.specular.g,this.special.light.specular.b))}else{n.specular.set(this.special.light.specular.r,this.special.light.specular.g,this.special.light.specular.b)}}if(e.special.light.intensity!==undefined){this.special.light.intensity=e.special.light.intensity;if(e.transition){e.transition.createAnimation(i,n,"intensity",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.light.intensity)}else{n.intensity=this.special.light.intensity}}};a.prototype.createLight=function(){console.warn("@@@@@@@@@@@@@@@@@@@@@@@@@ GEntity.createLight()");if(!this.babylon.mesh){throw new Error("Non pure light GEntity needs a mesh to be light-emitting")}var e=this.gScene.babylon.scene;if(!this.special.light){this.special.light={diffuse:new BABYLON.Color3(1,1,1),specular:new BABYLON.Color3(.5,.5,.5),intensity:1}}this.babylon.light=new BABYLON.PointLight("pointLight",new BABYLON.Vector3(0,0,0),e);this.babylon.light.parent=this.babylon.mesh;this.babylon.light.diffuse=this.special.light.diffuse;this.babylon.light.specular=this.special.light.specular;this.babylon.light.intensity=this.special.light.intensity;if(this.isLocalLight){this.registerLocalLight()}};a.prototype.destroyLight=function(){if(this.isLocalLight){this.unregisterLocalLight()}if(this.babylon.light){this.babylon.light.dispose()}this.special.light=null};a.prototype.registerLocalLight=function(){this.gScene.localLightGEntities.add(this);console.warn("&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&& Local light! entity count:",this.gScene.noLocalLightingGEntities.size);this.babylon.light.excludedMeshes=[...this.gScene.noLocalLightingGEntities].map(e=>e.babylon.mesh)};a.prototype.unregisterLocalLight=function(){this.gScene.localLightGEntities.delete(this)};a.prototype.getTexture=function(e){var t,i=this.gScene.babylon.scene;e=this.dom.cleanUrl(e);if(this.textureCache[e]){return this.textureCache[e]}t=this.textureCache[e]=new BABYLON.Texture(e,i);return t};a.prototype.preloadTexturePack=function(){var e,t,i,n,s=[];for(e in this.texturePackObject.variants){t=this.texturePackObject.variants[e];for(i of t.frames){if(i.url){s.push(this.getTexture(i.url))}if(i.maps){for(n in i.maps){s.push(this.getTexture(i.maps[n]))}}}}return new o(e=>BABYLON.Texture.WhenAllReady(s,()=>e()))};a.prototype.whenTextureCacheReady=function(){return new o(e=>BABYLON.Texture.WhenAllReady([...Object.values(this.textureCache)],()=>e()))};a.prototype.flipTexture=function(e,t,i){if(t){e.uScale=-1;e.uOffset=1}else{e.uScale=1;e.uOffset=0}if(i){e.vScale=-1;e.vOffset=1}else{e.vScale=1;e.vOffset=0}};a.prototype.updateSizeFromPixelDensity=function(e,t){var i;if(e.isReady()){i=e.getBaseSize();this.updateSize({x:i.width/t,y:i.height/t},false,true)}else{BABYLON.Texture.WhenAllReady([e],()=>{i=e.getBaseSize();this.updateSize({x:i.width/t,y:i.height/t},false,true)})}}},{"./GTransition.js":15,"./Parametric.js":16,"nextgen-events/lib/browser.js":29,seventh:41}],3:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("seventh");function o(e,t,i){n.call(this,e,t,i)}o.prototype=Object.create(n.prototype);o.prototype.constructor=o;t.exports=o;o.prototype.localBBoxSize=1e3;o.prototype.noLocalLighting=true;o.prototype.updateMaterial=function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;console.warn("3D GEntityBackground.updateMaterial()",this.texturePackObject,this.variantObject);var s=this.variantObject.frames[0].url;this.babylon.material=e=new BABYLON.StandardMaterial("simpleMaterial",i);e.backFaceCulling=true;e.diffuseTexture=new BABYLON.Texture(this.dom.cleanUrl(s),i);e.specularColor=new BABYLON.Color3(0,0,0);e.ambientColor=new BABYLON.Color3(1,1,1);e.backFaceCulling=false;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};o.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.MeshBuilder.CreateCylinder("background",{height:this.localBBoxSize,diameter:this.localBBoxSize,tessellation:24,cap:BABYLON.Mesh.NO_CAP,sideOrientation:BABYLON.Mesh.BACKSIDE},t);this.updateMeshNeeded=false;return e}},{"./GEntity.js":2,"./GTransition.js":15,seventh:41}],4:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");const a={sphere:"CreateSphere"};function l(e,t,i){n.call(this,e,t,i);this.shapeClass=null;this.shapeParams={}}l.prototype=Object.create(n.prototype);l.prototype.constructor=l;t.exports=l;l.prototype.updateSpecialStage1=function(e){n.prototype.updateSpecialStage1.call(this,e);if(e.special.shape&&typeof e.special.shape==="object"){if(e.special.shape&&a[e.special.shape.type]){this.shapeClass=a[e.special.shape.type]}Object.assign(this.shapeParams,e.special.shape);this.updateMeshNeeded=true}};l.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;console.warn("@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ GEntityBasicShape.updateMesh()",this.shapeClass);if(!this.shapeClass){return}if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.MeshBuilder[this.shapeClass]("basic-shape",this.shapeParams,t);e.scaling.x=this.size.x;e.scaling.y=this.size.y;e.scaling.z=this.size.z;console.warn("@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Mesh:",e);this.updateMeshNeeded=false;return e}},{"./GEntity.js":2,"./GTransition.js":15,"./vectorUtils.js":19,seventh:41}],5:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.updateMeshNeeded=this.updateMaterialNeeded=false}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.isLocalLight=false;a.prototype.updateLight=function(e){console.warn("3D GEntityDirectionalLight.updateLight()",e);n.prototype.updateLight.call(this,e);if(!e.special.light||typeof e.special.light!=="object"){return}var t=this.gScene.babylon.scene,i=this.babylon.light;if(e.special.light.direction&&typeof e.special.light.direction==="object"){this.special.light.direction=e.special.light.direction;if(e.transition){e.transition.createAnimation(t,i,"direction",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(this.special.light.direction.x,this.special.light.direction.y,this.special.light.direction.z))}else{i.direction.set(this.special.light.direction.x,this.special.light.direction.y,this.special.light.direction.z)}}};a.prototype.createLight=function(){var e=this.gScene.babylon.scene;if(this.babylon.light){console.warn("GEntityDirectionalLight.createLight(): light is already existing");return}if(!this.special.light){this.special.light={direction:new BABYLON.Vector3(0,-1,0),diffuse:new BABYLON.Color3(1,1,1),specular:new BABYLON.Color3(0,0,0),intensity:.2}}this.babylon.light=new BABYLON.DirectionalLight("directionalLight",this.special.light.direction,e);this.babylon.light.diffuse=this.special.light.diffuse;this.babylon.light.specular=this.special.light.specular;this.babylon.light.intensity=this.special.light.intensity;if(this.isLocalLight){this.registerLocalLight()}}},{"./GEntity.js":2,"./GTransition.js":15,"./vectorUtils.js":19,seventh:41}],6:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.special.content={text:"",textColor:"white"}}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.destroy=function(){if(this.babylon.advancedTexture){this.babylon.advancedTexture.parent=null;this.babylon.advancedTexture.dispose()}n.prototype.destroy.call(this)};a.prototype.updateTexture=function(){};a.prototype.updateMaterial=function(){var e,t,i,n=this.gScene.babylon.scene,s=this.babylon.mesh;console.warn("3D GEntityFloatingText.updateMaterial()");if(this.babylon.advancedTexture){e=this.babylon.advancedTexture}else{if(!s){s=this.updateMesh()}this.babylon.advancedTexture=e=BABYLON.GUI.AdvancedDynamicTexture.CreateForMesh(s,1024,64)}if(this.babylon.textBlock){t=this.babylon.textBlock}else{this.babylon.textBlock=t=new BABYLON.GUI.TextBlock;t.fontSizeInPixels=46;t.text=this.special.content.text;t.color=this.special.content.textColor;t.alpha=this.opacity;t.resizeToFit=true;e.addControl(t)}this.updateMaterialNeeded=false};const l=.7;a.prototype.updateContent=function(e){var t,i=this.babylon.advancedTexture,n=this.babylon.textBlock;if(!n){return}if(e.text!==undefined){n.text=this.special.content.text=""+e.text}if(typeof e.textColor==="string"){n.color=this.special.content.textColor=e.textColor}if(typeof e.outlineColor==="string"){n.outlineColor=this.special.content.outlineColor=e.outlineColor}if(typeof e.outlineWidth==="number"){n.outlineWidth=this.special.content.outlineWidth=e.outlineWidth}if(typeof e.shadowColor==="string"){n.shadowColor=this.special.content.shadowColor=e.shadowColor}if(typeof e.shadowBlur==="number"){n.shadowBlur=this.special.content.shadowBlur=e.shadowBlur}if(e.icon){if(this.babylon.icon){t=this.babylon.icon;t.source=this.dom.cleanUrl(e.icon);t.width=l*.0625;t.height=l}else{this.babylon.icon=t=new BABYLON.GUI.Image("icon",this.dom.cleanUrl(e.icon));t.width=l*.0625;t.height=l;i.addControl(t)}this.fixIcon()}};a.prototype.fixIcon=function(){if(this.babylon.textBlock._width.isPixel){this.babylon.icon.left=-32-this.babylon.textBlock.widthInPixels/2}else{setTimeout(()=>this.fixIcon(),10)}};a.prototype.updateMaterialParams=function(e,t=false){};a.prototype.updateOpacity=function(e,t=false){if(e<0){e=0}else if(e>1){e=1}if(!t){this.opacity=e}if(this.babylon.textBlock){this.babylon.textBlock.alpha=e}if(this.babylon.icon){this.babylon.icon.alpha=e}};a.prototype.updateMesh=function(){var e,t,i=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.PlaneBuilder.CreatePlane("floating-text",{width:80,height:5},i);e.billboardMode=BABYLON.AbstractMesh.BILLBOARDMODE_ALL;if(this.parent&&this.parent.babylon.mesh){e.parent=t=this.parent.babylon.mesh;e.scaling.x=1/t.scaling.x;e.scaling.y=1/t.scaling.y}console.warn("GEntityFloatingText .updateMesh() Mesh:",e);this.updateMeshNeeded=false;return e};a.prototype.updateSpecialStage2=function(e){if(e.special&&e.special.content){this.updateContent(e.special.content)}}},{"./GEntity.js":2,"./GTransition.js":15,"./vectorUtils.js":19,seventh:41}],7:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("seventh");function o(e,t,i){n.call(this,e,t,i)}o.prototype=Object.create(n.prototype);o.prototype.constructor=o;t.exports=o;o.prototype.updateMaterial=function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;console.warn("3D GEntityGround.updateMaterial()",this.texturePackObject,this.variantObject);var s=this.variantObject.frames[0].url;this.babylon.material=e=new BABYLON.StandardMaterial("simpleMaterial",i);e.backFaceCulling=true;e.diffuseTexture=new BABYLON.Texture(this.dom.cleanUrl(s),i);e.diffuseTexture.uScale=20;e.diffuseTexture.vScale=20;e.specularColor=new BABYLON.Color3(0,0,0);e.ambientColor=new BABYLON.Color3(1,1,1);e.backFaceCulling=false;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};o.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.MeshBuilder.CreateGround("ground",{height:1e3,width:1e3,subdivisions:4},t);this.updateMeshNeeded=false;return e}},{"./GEntity.js":2,"./GTransition.js":15,seventh:41}],8:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.updateMeshNeeded=this.updateMaterialNeeded=false;this.createLightNeeded=true}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.isLocalLight=false;a.prototype.updateLight=function(e){console.warn("3D GEntityHemisphericLight.updateLight()",e);n.prototype.updateLight.call(this,e);if(!e.special.light||typeof e.special.light!=="object"){return}var t=this.gScene.babylon.scene,i=this.babylon.light;if(e.special.light.ground&&typeof e.special.light.ground==="object"){this.special.light.ground=e.special.light.ground;if(e.transition){e.transition.createAnimation(t,i,"groundColor",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(this.special.light.ground.r,this.special.light.ground.g,this.special.light.ground.b))}else{i.groundColor.set(this.special.light.ground.r,this.special.light.ground.g,this.special.light.ground.b)}}if(e.special.light.up&&typeof e.special.light.up==="object"){this.special.light.up=e.special.light.up;if(e.transition){e.transition.createAnimation(t,i,"direction",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(this.special.light.up.x,this.special.light.up.y,this.special.light.up.z))}else{i.direction.set(this.special.light.up.x,this.special.light.up.y,this.special.light.up.z)}}};a.prototype.createLight=function(){var e=this.gScene.babylon.scene;if(this.babylon.light){console.warn("GEntityHemisphericLight.createLight(): light is already existing");return}if(!this.special.light){this.special.light={up:new BABYLON.Vector3(0,1,0),diffuse:new BABYLON.Color3(1,1,1),specular:new BABYLON.Color3(0,0,0),ground:new BABYLON.Color3(.2,.2,.2),intensity:.2}}this.babylon.light=new BABYLON.HemisphericLight("hemisphericLight",this.special.light.up,e);this.babylon.light.diffuse=this.special.light.diffuse;this.babylon.light.specular=this.special.light.specular;this.babylon.light.groundColor=this.special.light.ground;this.babylon.light.intensity=this.special.light.intensity;if(this.isLocalLight){this.registerLocalLight()}}},{"./GEntity.js":2,"./GTransition.js":15,"./vectorUtils.js":19,seventh:41}],9:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.updateMeshNeeded=this.updateMaterialNeeded=false}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.isLocalLight=true;a.prototype.updatePosition=function(e,t=false){var i=this.babylon.light,n=this.gScene.babylon.scene;if(!i){return}var s=e.position.x!==undefined?e.position.x:this.position.x,r=e.position.y!==undefined?e.position.y:this.position.y,o=e.position.z!==undefined?e.position.z:this.position.z;if(!t){this.position.x=s;this.position.y=r;this.position.z=o}if(e.transition){e.transition.createAnimation(n,i,"position",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,new BABYLON.Vector3(s,r,o))}else{i.position.set(s,r,o)}};a.prototype.updateMaterialParams=function(){};a.prototype.createLight=function(){var e=this.gScene.babylon.scene;if(this.babylon.light){console.warn("GEntityPointLight.createLight(): light is already existing");return}if(!this.special.light){this.special.light={diffuse:new BABYLON.Color3(1,1,1),specular:new BABYLON.Color3(.5,.5,.5),intensity:1}}this.babylon.light=new BABYLON.PointLight("pointLight",new BABYLON.Vector3(this.position.x,this.position.y,this.position.z),e);this.babylon.light.diffuse=this.special.light.diffuse;this.babylon.light.specular=this.special.light.specular;this.babylon.light.intensity=this.special.light.intensity;if(this.isLocalLight){this.registerLocalLight()}}},{"./GEntity.js":2,"./GTransition.js":15,"./vectorUtils.js":19,seventh:41}],10:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i)}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.updateMaterial=function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;this.babylon.material=e=new BABYLON.StandardMaterial("spriteMaterial",i);e.backFaceCulling=true;e.diffuseColor=new BABYLON.Color3(0,0,0);e.diffuseColor=new BABYLON.Color3(.5,.5,.5);e.disableLighting=true;e.opacityTexture=new BABYLON.Texture("/textures/shadow.png",i);e.opacityTexture.wrapU=e.opacityTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};a.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.Mesh.CreatePlane("shadow",undefined,t);e.rotation.x=Math.PI/2;e.bakeCurrentTransformIntoVertices();e.scaling.x=this.size.x;e.scaling.z=this.size.z;console.warn("Mesh:",e);this.updateMeshNeeded=false;return e}},{"./GEntity.js":2,"./GTransition.js":15,"./vectorUtils.js":19,seventh:41}],11:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.updateMeshNeeded=this.updateMaterialNeeded=false;console.error("Not supported ATM!")}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a},{"./GEntity.js":2,"./GTransition.js":15,"./vectorUtils.js":19,seventh:41}],12:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GTransition.js");const r=e("./vectorUtils.js");const o=e("seventh");function a(e,t,i){n.call(this,e,t,i);this.autoFacing=this.autoFacing.bind(this)}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.updateSpecialStage1=function(e){n.prototype.updateSpecialStage1.call(this,e);if(e.special.spriteAutoFacing!==undefined&&(e.special.spriteAutoFacing===false||r.degToSector[e.special.spriteAutoFacing])&&e.special.spriteAutoFacing!==this.special.spriteAutoFacing){this.special.spriteAutoFacing=e.special.spriteAutoFacing;if(this.special.spriteAutoFacing){this.gScene.on("render",this.autoFacing)}else{this.gScene.off("render",this.autoFacing)}}};a.prototype.updateFacing=function(e){this.facing=e;if(this.special.spriteAutoFacing){this.autoFacing()}};a.prototype.updateMaterial=async function(){var e,t=this.babylon.material,i=this.gScene.babylon.scene,n=this.babylon.mesh;console.warn("3D GEntitySprite.updateMaterial()",this.texturePackObject,this.variantObject);this.babylon.material=e=new BABYLON.StandardMaterial("spriteMaterial",i);e.backFaceCulling=true;e.ambientColor=new BABYLON.Color3(1,1,1);var s=this.frameObject.maps&&(this.frameObject.maps.diffuse||this.frameObject.maps.albedo)||this.frameObject.url;e.diffuseTexture=this.getTexture(s);e.diffuseTexture.hasAlpha=true;e.diffuseTexture.wrapU=e.diffuseTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;var r=this.frameObject.maps&&(this.frameObject.maps.normal||this.frameObject.maps.bump);if(r){e.bumpTexture=this.getTexture(r);e.bumpTexture.wrapU=e.bumpTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;e.invertNormalMapX=true;e.invertNormalMapY=true}var o=this.frameObject.maps&&this.frameObject.maps.specular;if(o){e.specularTexture=this.getTexture(o);e.specularTexture.wrapU=e.specularTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;e.useGlossinessFromSpecularMapAlpha=true}else{e.specularColor=new BABYLON.Color3(0,0,0)}var a=!this.frameObject.xFlip!==!this.clientMods.xFlip,l=this.frameObject.yFlip;this.flipTexture(e.diffuseTexture,a,l);if(e.bumpTexture){this.flipTexture(e.bumpTexture,a,l)}if(e.specularTexture){this.flipTexture(e.specularTexture,a,l)}if(this.frameObject.origin){let e;if(!a&&!l){e=this.frameObject.origin}else{e={x:(a?-this.frameObject.origin.x:this.frameObject.origin.x)||0,y:(l?-this.frameObject.origin.y:this.frameObject.origin.y)||0,z:this.frameObject.origin.z||0}}this.updateOrigin(e,true)}if(this.texturePackObject.pixelDensity){this.updateSizeFromPixelDensity(e.diffuseTexture,this.texturePackObject.pixelDensity)}else if(this.frameObject.relSize){this.updateSize(this.frameObject.relSize,false,true)}e.backFaceCulling=false;if(!n){n=this.updateMesh()}n.material=e;if(t){t.dispose(false,false,true)}this.updateMaterialNeeded=false};a.prototype.updateMesh=function(){var e,t=this.gScene.babylon.scene;if(this.babylon.mesh){this.babylon.mesh.dispose()}this.babylon.mesh=e=BABYLON.Mesh.CreatePlane("sprite",undefined,t);e.billboardMode=BABYLON.AbstractMesh.BILLBOARDMODE_X|BABYLON.AbstractMesh.BILLBOARDMODE_Y;e.scaling.x=this.size.x;e.scaling.y=this.size.y;console.warn("Mesh:",e);this.updateMeshNeeded=false;return e};a.prototype.updateRotation=function(e,t=false){var i=this.babylon.mesh,n=this.gScene.babylon.scene;var s=e.rotation.x!==undefined?e.rotation.x:this.rotation.x,r=e.rotation.y!==undefined?e.rotation.y:this.rotation.y,o=e.rotation.z!==undefined?e.rotation.z:this.rotation.z;if(!t){this.rotation.x=s;this.rotation.y=r;this.rotation.z=o}i.rotation.z=o};a.prototype.autoFacing=function(e=null){if(e){if(!e.camera&&!this.parametric){return}}var t=r.facingAngleDeg(this.gScene.globalCamera.babylon.camera.position,this.babylon.mesh.position,this.facing);var i=r.degToSector[this.special.spriteAutoFacing](t);if(this.clientMods.variant===i){return}this.clientMods.variant=i;this.clientMods.xFlipVariant=r.xFlipSector[i];this.refreshMaterial()}},{"./GEntity.js":2,"./GTransition.js":15,"./vectorUtils.js":19,seventh:41}],13:[function(e,t,i){"use strict";const n=e("./GEntity.js");const s=e("./GEntityFloatingText.js");function r(e,t,i){s.call(this,e,t,i);this.special.content.textSize=.05;this.iconOffset=0;this.safeIconOffset=false;this.blinkSafe=false}r.prototype=Object.create(s.prototype);r.prototype.constructor=r;t.exports=r;r.prototype.destroy=function(){if(this.babylon.textBlock){this.babylon.textBlock.dispose()}if(this.babylon.icon){this.babylon.icon.dispose()}n.prototype.destroy.call(this)};r.prototype.updateMaterial=function(){var e,t;console.warn("3D GEntityUiFloatingText.updateMaterial()");if(this.gScene.babylon.ui){e=this.gScene.babylon.ui}else{this.gScene.babylon.ui=e=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("ui")}if(this.babylon.textBlock){t=this.babylon.textBlock}else{this.babylon.textBlock=t=new BABYLON.GUI.TextBlock;t.text=this.special.content.text;t.color=this.special.content.textColor;t.alpha=this.opacity;t.resizeToFit=true;e.addControl(t);if(this.parent){t.linkWithMesh(this.parent.babylon.mesh);if(!this.blinkSafe){t.alpha=0;setTimeout(()=>{this.blinkSafe=true;t.alpha=this.opacity},20)}}}this.updateMaterialNeeded=false};r.prototype.updateOpacity=function(e,t=false){if(!this.blinkSafe){setTimeout(()=>{this.blinkSafe=true;this.updateOpacity(e,t)},20);return}s.prototype.updateOpacity.call(this,e,t)};const o=.8;r.prototype.updateContent=function(e){var t=this.gScene.babylon.ui,i=t.getSize(),n=this.babylon.textBlock;if(!n){return}if(e.text!==undefined){this.safeIconOffset=false;n.text=this.special.content.text=""+e.text}if(typeof e.textSize==="number"){this.safeIconOffset=false;this.special.content.textSize=e.textSize;n.fontSizeInPixels=Math.round(e.textSize*i.height)}if(typeof e.textColor==="string"){n.color=this.special.content.textColor=e.textColor}if(typeof e.outlineColor==="string"){n.outlineColor=this.special.content.outlineColor=e.outlineColor}if(typeof e.outlineWidth==="number"){this.special.content.outlineWidth=e.outlineWidth;n.outlineWidth=Math.round(e.outlineWidth*i.height)}if(typeof e.shadowColor==="string"){n.shadowColor=this.special.content.shadowColor=e.shadowColor}if(typeof e.shadowBlur==="number"){this.special.content.shadowBlur=e.shadowBlur;n.shadowBlur=Math.round(e.shadowBlur*i.height)}if(e.icon){this.updateContentIcon(e)}};r.prototype.updateContentIcon=function(e){var t,i=this.gScene.babylon.ui,n=this.babylon.textBlock;if(this.babylon.icon){t=this.babylon.icon;t.source=this.dom.cleanUrl(e.icon);t.width=n.fontSizeInPixels*o;t.height=n.fontSizeInPixels*o}else{this.babylon.icon=t=new BABYLON.GUI.Image("icon",this.dom.cleanUrl(e.icon));t.widthInPixels=n.fontSizeInPixels*o;t.heightInPixels=n.fontSizeInPixels*o;i.addControl(t);if(this.parent){t.linkWithMesh(this.parent.babylon.mesh);if(!this.blinkSafe){t.alpha=0;setTimeout(()=>{this.blinkSafe=true;t.alpha=this.opacity},20)}}}this.updateContentIconOffset(()=>{if(this.parent){t.linkOffsetXInPixels=n.linkOffsetXInPixels-this.iconOffset}else{t.leftInPixels=n.leftInPixels-this.iconOffset}})};r.prototype.updateContentIconOffset=function(e=null,t=false){var i=this.babylon.icon,n=this.babylon.textBlock;if(t){this.safeIconOffset=true}if(!this.safeIconOffset||!n._width.isPixel&&!t){setTimeout(()=>this.updateContentIconOffset(e,true),20);return}this.iconOffset=Math.round(i.widthInPixels/2+n.fontSizeInPixels/4+(n._width.isPixel?n.widthInPixels/2:n.fontSizeInPixels));if(e){e()}};r.prototype.updateMesh=function(){this.updateMeshNeeded=false;return};r.prototype.updateSpecialStage2=function(e){if(e.special&&e.special.content){this.updateContent(e.special.content)}};r.prototype.updatePosition=function(e,t=false){var i=this.babylon.textBlock,n=this.babylon.icon;if(n&&!this.safeIconOffset){this.updateContentIconOffset(()=>this.updatePosition(e,t));return}var s=this.gScene.babylon.ui,r=s.getSize(),o=this.gScene.babylon.scene;var a,l=e.position.x!==undefined?e.position.x:this.position.x,c=e.position.y!==undefined?e.position.y:this.position.y;if(!t){this.position.x=l;this.position.y=c}l=-l*r.width/2;c=-c*r.height/2;a=l-this.iconOffset;if(this.parent){if(e.transition){e.transition.createAnimation(o,i,"linkOffsetXInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,l);e.transition.createAnimation(o,i,"linkOffsetYInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,c);if(n){e.transition.createAnimation(o,n,"linkOffsetXInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,a);e.transition.createAnimation(o,n,"linkOffsetYInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,c)}}else{i.linkOffsetXInPixels=l;i.linkOffsetYInPixels=c;if(n){n.linkOffsetXInPixels=a;n.linkOffsetYInPixels=c}}}else if(e.transition){e.transition.createAnimation(o,i,"leftInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,l);e.transition.createAnimation(o,i,"topInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,c);if(n){e.transition.createAnimation(o,n,"leftInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,a);e.transition.createAnimation(o,n,"topInPixels",BABYLON.Animation.ANIMATIONTYPE_FLOAT,c)}}else{i.leftInPixels=l;i.topInPixels=c;if(n){n.leftInPixels=a;n.topInPixels=c}}}},{"./GEntity.js":2,"./GEntityFloatingText.js":6}],14:[function(e,t,i){"use strict";const n=e("./Camera.js");const s=e("./GTransition.js");const r=e("nextgen-events/lib/browser.js");const o=e("seventh");function a(e,t){this.dom=e;this.engineId=t.engineId;this.rightHanded=t.rightHanded!==undefined?!!t.rightHanded:true;this.active=false;this.paused=false;this.persistent=false;this.theme="default";this.special={};this.engine={};this.texturePacks={};this.gEntityLocations={};this.gEntities={};this.parametricGEntities=new Set;this.noLocalLightingGEntities=new Set;this.localLightGEntities=new Set;this.animationFunctions=new Set;this.globalCamera=null;this.roleCamera=null;this.$gscene=document.createElement("canvas");this.$gscene.classList.add("gscene");this.$gscene.style.visibility="hidden";this.dom.$gfx.append(this.$gscene);this.resizeObserver=null;this.changes={camera:false};this.babylon={engine:null,scene:null,ui:null};this.initScene()}a.prototype=Object.create(r.prototype);a.prototype.constructor=a;t.exports=a;a.prototype.initScene=function(){var e=this.babylon.engine=new BABYLON.Engine(this.$gscene,true);var t=this.babylon.scene=new BABYLON.Scene(e);t.autoClear=false;t.autoClearDepthAndStencil=false;this.globalCamera=new n(this);e.runRenderLoop(()=>{var e,i,n=Date.now()/1e3;if(this.parametricGEntities.size){for(e of this.parametricGEntities){e.parametricUpdate(n)}}if(this.animationFunctions.size){for(i of this.animationFunctions){i(n)}}this.emitIfListener("render",this.changes);this.changes.camera=false;t.render()});this.resizeObserver=new ResizeObserver(()=>e.resize());this.resizeObserver.observe(this.$gscene)};a.prototype.update=function(e,t=false,i=false){console.warn("3D GScene.update()",e);var n;if(e.transition){if(i){delete e.transition}else{e.transition=new s(e.transition)}}if(e.active!==undefined){this.active=!!e.active;this.$gscene.style.visibility=this.active?"visible":"hidden"}if(e.paused!==undefined){this.paused=!!e.paused}if(e.persistent!==undefined){this.persistent=!!e.persistent}if(e.theme!==undefined){this.theme=e.theme||"default"}if(e.special&&typeof e.special==="object"){if(e.special.ambient){this.updateAmbient(e)}if(typeof e.special.contrast==="number"){this.updateContrast(e)}if(typeof e.special.exposure==="number"){this.updateExposure(e)}if(e.special.colorGrading){this.updateColorGrading(e)}if(e.special.colorCurves){this.updateColorCurves(e)}if(e.special.vignette){this.updateVignette(e)}}if(e.engine&&typeof e.engine==="object"){Object.assign(this.engine,e.engine)}if(e.globalCamera!==undefined){this.globalCamera.update(e.globalCamera)}return t&&e.transition&&e.transition.promise||o.resolved};a.prototype.updateAmbient=function(e){console.warn(".updateAmbient()",this.special.ambient);var t=this.babylon.scene;if(!e.special.ambient||typeof e.special.ambient!=="object"){return}if(!this.special.ambient){this.special.ambient=new BABYLON.Color3(0,0,0)}Object.assign(this.special.ambient,e.special.ambient);if(e.transition){e.transition.createAnimation(t,t,"ambientColor",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(this.special.ambient.r,this.special.ambient.g,this.special.ambient.b))}else{t.ambientColor.set(this.special.ambient.r,this.special.ambient.g,this.special.ambient.b)}};a.prototype.updateContrast=function(e){console.warn(".updateContrast()",this.special.contrast);var t=this.babylon.scene;this.special.contrast=e.special.contrast;if(e.transition){e.transition.createAnimationFn(this,t.imageProcessingConfiguration,"contrast",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.contrast)}else{t.imageProcessingConfiguration.contrast=this.special.contrast}};a.prototype.updateExposure=function(e){console.warn(".updateExposure()",this.special.exposure);var t=this.babylon.scene;this.special.exposure=e.special.exposure;if(e.transition){e.transition.createAnimationFn(this,t.imageProcessingConfiguration,"exposure",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.exposure)}else{t.imageProcessingConfiguration.exposure=this.special.exposure}};const l=new Set(["globalHue","globalDensity","globalSaturation","highlightsHue","highlightsDensity","highlightsSaturation","shadowsHue","shadowsDensity","shadowsSaturation"]);a.prototype.updateColorCurves=function(e){console.warn(".updateColorCurves()",this.special.colorCurves);var t,i=e.special.colorCurves,n=this.babylon.scene;if(!i){if(this.special.colorCurves){this.special.colorCurves=null}n.imageProcessingConfiguration.colorCurvesEnabled=false;return}if(typeof i!=="object"){return}n.imageProcessingConfiguration.colorCurvesEnabled=true;if(!this.special.colorCurves){this.special.colorCurves={}}if(!n.imageProcessingConfiguration.colorCurves){n.imageProcessingConfiguration.colorCurves={globalHue:0,globalDensity:0,globalSaturation:0,highlightsHue:0,highlightsDensity:0,highlightsSaturation:0,shadowsHue:0,shadowsDensity:0,shadowsSaturation:0}}for(t in i){if(!l.has(t)&&typeof i[t]!=="number"){continue}this.special.colorCurves[t]=i[t];if(e.transition){e.transition.createAnimationFn(this,n.imageProcessingConfiguration.colorCurves,t,BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.colorCurves[t])}else{n.imageProcessingConfiguration.colorCurves[t]=this.special.colorCurves[t]}}};const c={stretch:"vignetteStretch",centerX:"vignetteCentreX",centerY:"vignetteCentreY",weight:"vignetteWeight"};a.prototype.updateVignette=function(e){console.warn(".updateVignette()",this.special.vignette);var t,i,n=e.special.vignette,s=this.babylon.scene;if(!n){if(this.special.vignette){this.special.vignette=null}s.imageProcessingConfiguration.vignetteEnabled=false;return}if(typeof n!=="object"){return}s.imageProcessingConfiguration.vignetteEnabled=true;if(!this.special.vignette){this.special.vignette={}}if(!s.imageProcessingConfiguration.vignette){}for(t in n){i=c[t];if(!i){continue}this.special.vignette[t]=n[t];if(e.transition){e.transition.createAnimationFn(this,s.imageProcessingConfiguration,i,BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.vignette[t])}else{s.imageProcessingConfiguration[i]=this.special.vignette[t]}}if(n.color){this.special.vignette.color=n.color;if(e.transition){e.transition.createAnimationFn(this,s.imageProcessingConfiguration,"vignetteColor",BABYLON.Animation.ANIMATIONTYPE_COLOR3,new BABYLON.Color3(n.color.r,n.color.g,n.color.b))}else{s.imageProcessingConfiguration.vignetteColor.set(n.color.r,n.color.g,n.color.b)}}if(n.blendMode){switch(n.blendMode){case"multiply":this.special.vignette.blendMode=0;break;case"opaque":default:this.special.vignette.blendMode=1;break}s.imageProcessingConfiguration.vignetteBlendMode=this.special.vignette.blendMode}};a.prototype.updateColorGrading=function(e){console.warn(".updateColorGrading()",this.special.colorGrading);var t=this.babylon.scene,i=e.special.colorGrading,n,s,r=false,o;if(!i){if(this.special.colorGrading){this.special.colorGrading=null}t.imageProcessingConfiguration.colorGradingEnabled=false;if(t.imageProcessingConfiguration.colorGradingTexture){t.imageProcessingConfiguration.colorGradingTexture.dispose()}return}if(typeof i!=="object"){return}if(i.url&&typeof i.url==="string"){n=this.dom.cleanUrl(i.url)}if(!this.special.colorGrading){if(!n){return}this.special.colorGrading={url:n,level:typeof i.level==="number"?i.level:1};o=new BABYLON.Texture(this.special.colorGrading.url,t,true,false);o.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE;o.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;t.imageProcessingConfiguration.colorGradingEnabled=true;t.imageProcessingConfiguration.colorGradingTexture=o;t.imageProcessingConfiguration.colorGradingWithGreenDepth=false;s=0;r=true}else{if(n&&n!==this.special.colorGrading.url){this.special.colorGrading.url=n;o=new BABYLON.Texture(this.special.colorGrading.url,t,true,false);o.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE;o.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;t.imageProcessingConfiguration.colorGradingTexture=o}else{o=t.imageProcessingConfiguration.colorGradingTexture}if(typeof i.level==="number"){s=this.special.colorGrading.level;r=true;this.special.colorGrading.level=i.level}}if(r){console.warn("level",s,this.special.colorGrading.level,e.transition);if(e.transition){e.transition.createAnimation(t,o,"level",BABYLON.Animation.ANIMATIONTYPE_FLOAT,this.special.colorGrading.level,s)}else{o.level=this.special.colorGrading.level}}};a.prototype.updateLightExcludedMeshes=function(){var e,t=[...this.noLocalLightingGEntities].map(e=>e.babylon.mesh);for(e of this.localLightGEntities){e.babylon.light.excludedMeshes=t}};a.prototype.hasGEntity=function(e){return e in this.gEntities};a.prototype.getGEntity=function(e){return this.gEntities[e]};a.prototype.addGEntity=function(e,t){this.gEntities[e]=t};a.prototype.removeGEntity=function(e){var t=this.gEntities[e];if(!t){return false}delete this.gEntities[e];return true}},{"./Camera.js":1,"./GTransition.js":15,"nextgen-events/lib/browser.js":29,seventh:41}],15:[function(e,t,i){"use strict";const n=e("seventh");const s=e("array-kit");function r(e){this.duration=.2;this.easing="linear";this.running=0;this.promise=null;if(e){this.update(e)}}t.exports=r;r.prototype.update=function(e){if(!e||typeof e!=="object"){return}if(e.duration!==undefined){this.duration=+e.duration||0}if(e.easing!==undefined){this.easing=e.easing||"linear"}return this};r.prototype.toString=function(e){return e+" "+this.duration+"s"+(" "+this.easing||"")};const o={circle:BABYLON.CircleEase,back:BABYLON.BackEase,bounce:BABYLON.BounceEase,cubic:BABYLON.CubicEase,elastic:BABYLON.ElasticEase,exponential:BABYLON.ExponentialEase,power:BABYLON.PowerEase,quadratic:BABYLON.QuadraticEase,quartic:BABYLON.QuarticEase,quintic:BABYLON.QuinticEase,sine:BABYLON.SineEase,bezier:BABYLON.BezierCurveEase};r.prototype.createAnimation=function(e,t,i,r,a,l=null){var c,h,u,f=30,p=Math.round(this.duration*f);h=new BABYLON.Animation("transition",i,f,r,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT,false);if(l===null){l=t[i];if(l&&typeof l==="object"&&l.clone){l=l.clone()}}u=[{frame:0,value:l},{frame:p,value:a}];h.setKeys(u);if(this.easing&&o[this.easing]){c=new o[this.easing];c.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT);h.setEasingFunction(c)}t.animations.push(h);if(!this.promise){this.promise=new n;this.promise.resolveTimeout(1e3*this.duration+20)}this.running++;e.beginAnimation(t,0,p,false,1,()=>{this.running--;e.removeAnimation(h);s.deleteValue(t.animations,h);if(this.running<=0){this.promise.resolve()}},undefined,false)};const a=[];a[BABYLON.Animation.ANIMATIONTYPE_COLOR3]=BABYLON.Animation.prototype.color3InterpolateFunction;a[BABYLON.Animation.ANIMATIONTYPE_COLOR4]=BABYLON.Animation.prototype.color4InterpolateFunction;a[BABYLON.Animation.ANIMATIONTYPE_FLOAT]=((e,t,i)=>e+i*(t-e));a[BABYLON.Animation.ANIMATIONTYPE_MATRIX]=BABYLON.Animation.prototype.matrixInterpolateFunction;a[BABYLON.Animation.ANIMATIONTYPE_QUATERNION]=BABYLON.Animation.prototype.quaternionInterpolateFunction;a[BABYLON.Animation.ANIMATIONTYPE_SIZE]=BABYLON.Animation.prototype.sizeInterpolateFunction;a[BABYLON.Animation.ANIMATIONTYPE_VECTOR2]=BABYLON.Animation.prototype.vector2InterpolateFunction;a[BABYLON.Animation.ANIMATIONTYPE_VECTOR3]=BABYLON.Animation.prototype.vector3InterpolateFunction;r.prototype.createAnimationFn=function(e,t,i,s,r,o=null){if(o===null){o=t[i];if(o&&typeof o==="object"&&o.clone){o=o.clone()}}var l=Date.now()/1e3;if(!this.promise){this.promise=new n;this.promise.resolveTimeout(1e3*this.duration+20)}this.running++;var c=n=>{var h,u=n-l;if(u>=this.duration){h=1;this.running--;e.animationFunctions.delete(c);if(this.running<=0){this.promise.resolve()}}else{h=u/this.duration}t[i]=a[s](o,r,h)};e.animationFunctions.add(c);return c}},{"array-kit":20,seventh:41}],16:[function(e,t,i){"use strict";const n=e("./browser-extension.js");const s=n.host.exports.expressionOperators;function r(e){this.var={};this.formula={};this.ctx={t:0,rt:0,tOffset:-Date.now()/1e3};this.computed={};this.stopAt=Infinity;this.cleanStop=false;this.update(e)}t.exports=r;function o(e){var t;for(t in e){delete e[t]}}r.prototype.update=function(e){if(e.reset){o(this.var);o(this.formula);o(this.ctx);o(this.computed);this.ctx.t=this.ctx.rt=0;this.ctx.tOffset=-Date.now()/1e3}else if(e.resetT){this.ctx.tOffset=-Date.now()/1e3}if(typeof e.stopAt==="number"){this.stopAt=e.stopAt}if(e.var){this.recursiveUpdate(this.var,e.var)}if(e.formula){this.recursiveUpdate(this.formula,e.formula,this.computed)}};r.prototype.recursiveUpdate=function(e,t,i){var n,s;for(n in t){s=t[n];if(s===null){delete e[n];if(i&&typeof i[n]==="object"){delete i[n]}}else if(typeof s==="boolean"||typeof s==="number"){e[n]=s}else if(typeof s==="string"){e[n]=new Function("op","ctx","return ( "+s+" ) ;")}else if(typeof s==="object"){e[n]={};this.recursiveUpdate(e[n],s,i&&typeof i[n]==="object"?i[n]:null)}console.warn("########## k/v/V",n,s,e[n])}};r.prototype.compute=function(e,t){this.ctx.t=e+this.ctx.tOffset;if(this.ctx.t>this.stopAt){if(this.cleanStop){return null}this.ctx.t=this.stopAt;this.cleanStop=true}else if(this.ctx.t===this.stopAt){this.cleanStop=true}this.ctx.rt=this.ctx.t/this.stopAt;this.recursiveCompute(this.var,this.ctx);this.recursiveCompute(this.formula,this.computed,t);return this.computed};r.prototype.recursiveCompute=function(e,t,i){var n,r,o;for(n in e){r=e[n];o=i&&typeof i==="object"?i[n]:undefined;if(typeof r==="boolean"||typeof r==="number"){t[n]=r}else if(typeof r==="function"){this.ctx.base=o;t[n]=r(s,this.ctx)}else if(r&&typeof r==="object"){t[n]={};this.recursiveCompute(r,t[n],o)}}}},{"./browser-extension.js":17}],17:[function(e,t,i){"use strict";const n=e("exm/lib/BrowserExm.js");const s=e("path");const r=n.registerExtension({module:t,ns:"spellcast.web-client",id:"3dgws",exports:{},hooks:{init:async()=>{console.warn("Extension 3DGWS: starting init");await import(r.dirPath+"/babylonjs.js");await import(r.dirPath+"/babylonjs.gui.js");r.host.api.addEngine("3dgws",e("./engine.js"));console.warn("Extension 3DGWS fully loaded")}}});t.exports=r},{"./engine.js":18,"exm/lib/BrowserExm.js":26,path:31}],18:[function(e,t,i){"use strict";const n={};t.exports=n;n.GScene=e("./GScene.js");n.Camera=e("./Camera.js");n.GEntity=e("./GEntity.js");n.perUsageGEntity={hemisphericLight:e("./GEntityHemisphericLight.js"),directionalLight:e("./GEntityDirectionalLight.js"),pointLight:e("./GEntityPointLight.js"),spotLight:e("./GEntitySpotLight.js"),background:e("./GEntityBackground.js"),sprite:e("./GEntitySprite.js"),shadow:e("./GEntityShadow.js"),floatingText:e("./GEntityFloatingText.js"),uiFloatingText:e("./GEntityUiFloatingText.js"),basicShape:e("./GEntityBasicShape.js"),ground:e("./GEntityGround.js")}},{"./Camera.js":1,"./GEntity.js":2,"./GEntityBackground.js":3,"./GEntityBasicShape.js":4,"./GEntityDirectionalLight.js":5,"./GEntityFloatingText.js":6,"./GEntityGround.js":7,"./GEntityHemisphericLight.js":8,"./GEntityPointLight.js":9,"./GEntityShadow.js":10,"./GEntitySpotLight.js":11,"./GEntitySprite.js":12,"./GEntityUiFloatingText.js":13,"./GScene.js":14}],19:[function(e,t,i){"use strict";const n={};t.exports=n;n.flatVectorsAngleDeg=((e,t)=>n.normalizeAngleDeg((Math.atan2(-t.x,t.z)-Math.atan2(-e.x,e.z))*n.RAD_TO_DEG));n.facingAngleDeg=((e,t,i)=>n.normalizeAngleDeg(i-Math.atan2(-(t.x-e.x),t.z-e.z)*n.RAD_TO_DEG));n.degToSector={};n.degToSector["ns"]=(e=>e<=90||e>=270?"n":"s");n.degToSector["we"]=(e=>e<=180?"w":"e");const s=["n","nw","w","sw","s","se","e","ne","n"];n.degToSector["8"]=(e=>s[Math.floor((e+22.5)/45)]);const r=["n","w","s","e","n"];n.degToSector["4"]=(e=>r[Math.floor((e+45)/90)]);const o=["nw","sw","se","ne"];n.degToSector["4-diag"]=(e=>o[Math.floor(e/90)]);n.xFlipSector={n:"n",ne:"nw",e:"w",se:"sw",s:"s",sw:"se",w:"e",nw:"ne"};n.cameraRotationFromOriginAndTarget=((e,t,i=0)=>{var s=t.x-e.x,r=t.y-e.y,o=t.z-e.z,a=Math.atan2(s,o),l=-n.epsilonAsin(r/Math.hypot(s,r,o));console.warn("[!] .rotationFromOriginAndTarget()",e,t,s,r,o,a);return new BABYLON.Vector3(l,a,i)});n.toCameraAlpha=(e=>-n.PI_2-e*n.DEG_TO_RAD);n.toCameraBeta=(e=>n.PI_2-e*n.DEG_TO_RAD);n.RAD_TO_DEG=180/Math.PI;n.DEG_TO_RAD=Math.PI/180;n.PI_2=Math.PI/2;n.normalizeAngleDeg=(e=>e>=0?e%360:360+e%360);var a=1e-10;var l=Math.round(1/a);n.setEpsilon=(e=>{a=e;l=Math.round(1/e)});n.getEpsilon=(()=>a);n.epsilonAcos=n.eacos=(e=>{if(e>=-1&&e<=1){return Math.acos(e)}if(e>0){if(e<1+a){return 0}}else if(e>-1-a){return Math.PI}return NaN});n.epsilonAsin=n.easin=(e=>{if(e>=-1&&e<=1){return Math.asin(e)}if(e>0){if(e<1+a){return Math.PI/2}}else if(e>-1-a){return Math.PI/2}return NaN})},{}],20:[function(e,t,i){"use strict";const n={range:e("./range.js"),sample:e("./sample.js"),inPlaceFilter:e("./inPlaceFilter.js"),delete:e("./delete.js"),deleteValue:e("./deleteValue.js")};t.exports=n;n.shuffle=(e=>n.sample(e,e.length,true))},{"./delete.js":21,"./deleteValue.js":22,"./inPlaceFilter.js":23,"./range.js":24,"./sample.js":25}],21:[function(e,t,i){"use strict";t.exports=((e,t)=>{if(t>=e.length){return}var i=e.length-2;while(t<=i){e[t]=e[t+1];t++}e.length--})},{}],22:[function(e,t,i){"use strict";t.exports=((e,t)=>{var i,n,s=0,r=0;while(s<e.length){i=e[s];if(t!==i&&(t||!Number.isNaN(t)||!Number.isNaN(i))){e[r]=i;r++}s++}n=e.length-r;e.length=r;return n})},{}],23:[function(e,t,i){"use strict";t.exports=((e,t,i,n)=>{var s=arguments.length>=4,r,o=0,a=0;while(o<e.length){r=e[o];if(t.call(i,r,s?n:o,e)){e[a]=r;a++}o++}e.length=a;return e})},{}],24:[function(e,t,i){"use strict";t.exports=function(e,t,i){if(!arguments.length){return[]}if(arguments.length===1){t=e;e=0}if(!i){i=e<=t?1:-1}if(i>0&&e>=t||i<0&&e<=t){return[]}var n=0,s=e,r=[];if(i>0){for(;s<t;n++,s+=i){r[n]=s}}else{for(;s>t;n++,s+=i){r[n]=s}}return r}},{}],25:[function(e,t,i){"use strict";t.exports=((e,t=Infinity,i=false)=>{var n,s,r,o=i?e:[...e];t=Math.max(Math.min(t,e.length),0);for(n=0;n<t;n++){s=n+Math.floor((o.length-n)*Math.random());r=o[n];o[n]=o[s];o[s]=r}o.length=t;return o})},{}],26:[function(e,t,i){(function(e){(function(){"use strict";function i(e={}){if(!e.ns){throw new Error("EXM: namespace ('ns') is required!")}this.ns=e.ns;this.extensionPath=e.extensionPath||"/ext";this.suffix=e.suffix||"/extension.js";this.api=e.api||{};this.exports=e.exports||{};this.extensions=new Map}t.exports=i;i.prototype.__prototypeUID__="exm/browser/Exm";i.prototype.__prototypeVersion__="0.5";i.registerNs=function(t={}){if(!t.ns||typeof t.ns!=="string"){throw new Error("EXM: namespace ('ns' property) is required!")}if(e.EXM.ns[t.ns]){throw new Error("EXM: namespace '"+t.ns+"' is already registered!")}var n=new i(t);e.EXM.ns[t.ns]=n;return n};i.prototype.requireExtension=async function(t){if(this.extensions.has(t)){return this.extensions.get(t)}var i,n=this.ns+"."+t,s=this.extensionPath+"/"+n,r=s+this.suffix;try{console.warn("Trying EXM extension: ",r);i=await import(r)}catch(e){throw new Error("Required extension '"+t+"' not found.")}if(!i||typeof i!=="object"){throw new Error("EXM: this is not an EXM Extension (not an object)")}if(i.extension){i=i.extension}else{i=e.EXM.extensions[n];if(!i||typeof i!=="object"){throw new Error("EXM: this is not an EXM Extension (not an ES6 module extension and not registered)")}}if(i.__prototypeUID__!=="exm/Extension"&&i.__prototypeUID__!=="exm/browser/Extension"){throw new Error("EXM: this is not an EXM Extension (no prototype UID found)")}if(i.id!==t){throw new Error("EXM: Extension ID mismatch (wanted '"+t+"' but got "+i.id+"'.")}try{await i.init(this,r,s);console.log("Extension '"+i.id+"'"+(i.version?" (v"+i.version+") ":"")+"is loaded.")}catch(e){let i=new Error("EXM: Failed to init extension '"+t+"': "+e);i.from=e;throw e}this.extensions.set(t,i);return i};i.Extension=function(e={}){this.isInit=false;this.id=e.id;this.ns=e.ns;this.uid=e.ns+"."+e.id;this.version=e.version||null;this.host=null;this.path=null;this.dirPath=null;this.fromModule=e.module;this.hooks=e.hooks||{};this.api=e.api||{};this.exports=e.exports||{}};i.Extension.prototype.__prototypeUID__="exm/browser/Extension";i.Extension.prototype.__prototypeVersion__=i.prototype.__prototypeVersion__;i.registerExtension=i.Extension.register=function(t={}){if(!t.id||typeof t.id!=="string"){throw new Error("EXM Extension: ID ('id' property) is required!")}if(!t.ns||typeof t.ns!=="string"){throw new Error("EXM Extension: namespace ('ns' property) is required!")}var n=new i.Extension(t);if(e.EXM.extensions[n.uid]){throw new Error("EXM Extension: ID '"+n.id+"' is already registered for namespace '"+n.ns+"'!")}e.EXM.extensions[n.uid]=n;return n};i.Extension.prototype.init=async function(e,t,i){if(this.isInit){return}if(e.ns!==this.ns){throw new Error("EXM Extension's namespace mismatches the Host!")}if(t){this.path=t}if(i){this.dirPath=i}this.host=e;if(typeof this.hooks.init==="function"){await this.hooks.init()}this.isInit=true};if(!e.EXM){e.EXM={master:null,ns:{},extensions:{}}}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],27:[function(e,t,i){(function(i,n,s){(function(){"use strict";const r=i.browser?window.setImmediate:i.nextTick;if(!n.__NEXTGEN_EVENTS__){n.__NEXTGEN_EVENTS__={recursions:0}}var o=n.__NEXTGEN_EVENTS__;function a(){}t.exports=a;a.prototype.__prototypeUID__="nextgen-events/NextGenEvents";a.prototype.__prototypeVersion__=e("../package.json").version;a.SYNC=-Infinity;a.DESYNC=-1;a.defaultMaxListeners=Infinity;a.init=function(){Object.defineProperty(this,"__ngev",{configurable:true,value:new a.Internal})};a.Internal=function(e){this.nice=a.SYNC;this.interruptible=false;this.contexts={};this.desync=s;this.depth=0;this.states={};this.stateGroups={};this.listeners={error:[],interrupt:[],newListener:[],removeListener:[]};this.hasListenerPriority=false;this.maxListeners=a.defaultMaxListeners;if(e){this.nice=e.nice;this.interruptible=e.interruptible;Object.assign(this.states,e.states),Object.assign(this.stateGroups,e.stateGroups),Object.keys(e.listeners).forEach(t=>{this.listeners[t]=e.listeners[t].slice()});Object.keys(e.contexts).forEach(t=>{var i=e.contexts[t];this.contexts[t]={nice:i.nice,ready:true,status:i.status,serial:i.serial,scopes:{}}})}};a.initFrom=function(e){if(!e.__ngev){a.init.call(e)}Object.defineProperty(this,"__ngev",{configurable:true,value:new a.Internal(e.__ngev)})};a.mergeListeners=function(e){if(!this.__ngev){a.init.call(this)}var t=this.__ngev.listeners;this.__ngev.listeners={};Object.keys(t).forEach(e=>{this.__ngev.listeners[e]=[]});e.forEach(e=>{if(!e.__ngev){a.init.call(e)}Object.keys(e.__ngev.listeners).forEach(e=>{if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}})});Object.keys(this.__ngev.listeners).forEach(i=>{var n,s,r=[];if(t[i]){t[i].forEach(t=>{for(n=0,s=e.length;n<s;n++){if(!e[n].__ngev.listeners[i]||e[n].__ngev.listeners[i].indexOf(t)===-1){r.push(t);break}}})}e.forEach(e=>{e.__ngev.listeners[i].forEach(e=>{if(this.__ngev.listeners[i].indexOf(e)===-1&&r.indexOf(e)===-1){this.__ngev.listeners[i].push(e)}})})})};a.filterOutCallback=function(e,t){return e!==t};a.prototype.addListener=function(e,t,n){var s,r;if(!this.__ngev){a.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}if(!e||typeof e!=="string"){throw new TypeError(".addListener(): argument #0 should be a non-empty string")}if(typeof t==="function"){s={};if(!n||typeof n!=="object"){n={}}}else if(n===true&&t&&typeof t==="object"){n=s=t;t=undefined}else{n=t;if(!n||typeof n!=="object"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}t=undefined;s={}}s.fn=t||n.fn;s.id=n.id!==undefined?n.id:s.fn;if(n.unique){if(this.__ngev.listeners[e].find(e=>e.id===s.id)){return}}s.once=!!n.once;s.async=!!n.async;s.eventObject=!!n.eventObject;s.nice=n.nice!==undefined?Math.floor(n.nice):a.SYNC;s.priority=+n.priority||0;s.context=n.context&&(typeof n.context==="string"||typeof n.context==="object")?n.context:null;if(typeof s.fn!=="function"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}if(typeof s.context==="string"){s.context=this.__ngev.contexts[s.context]||this.addListenerContext(s.context)}s.event=e;if(this.__ngev.listeners.newListener.length){r=this.__ngev.listeners.newListener.slice();this.__ngev.listeners[e].push(s);a.emitEvent({emitter:this,name:"newListener",args:[[s]],listeners:r});if(this.__ngev.states[e]){a.emitToOneListener(this.__ngev.states[e],s)}return this}this.__ngev.listeners[e].push(s);if(this.__ngev.hasListenerPriority){this.__ngev.listeners[e].sort((e,t)=>t.priority-e.priority)}if(this.__ngev.listeners[e].length===this.__ngev.maxListeners+1){i.emitWarning("Possible NextGenEvents memory leak detected. "+this.__ngev.listeners[e].length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit",{type:"MaxListenersExceededWarning"})}if(this.__ngev.states[e]){a.emitToOneListener(this.__ngev.states[e],s)}return this};a.prototype.on=a.prototype.addListener;a.prototype.once=function(e,t,i){if(t&&typeof t==="object"){t.once=true}else if(i&&typeof i==="object"){i.once=true}else{i={once:true}}return this.addListener(e,t,i)};a.prototype.waitFor=function(e){return new Promise(t=>{this.addListener(e,e=>t(e),{once:true})})};a.prototype.waitForAll=function(e){return new Promise(t=>{this.addListener(e,(...e)=>t(e),{once:true})})};a.prototype.removeListener=function(e,t){if(!e||typeof e!=="string"){throw new TypeError(".removeListener(): argument #0 should be a non-empty string")}if(!this.__ngev){a.init.call(this)}var i=this.__ngev.listeners[e];if(!i||!i.length){return this}var n,s,r=0,o=i.length,l=this.__ngev.listeners.removeListener.length;if(l){s=[]}for(n=0;n<o;n++){if(i[n].id===t){r++;if(l){s.push(i[n])}}else if(r){i[n-r]=i[n]}}if(r){i.length-=r}if(l&&s.length){this.emit("removeListener",s)}return this};a.prototype.off=a.prototype.removeListener;a.prototype.removeAllListeners=function(e){var t;if(!this.__ngev){a.init.call(this)}if(e){if(!e||typeof e!=="string"){throw new TypeError(".removeAllListeners(): argument #0 should be undefined or a non-empty string")}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}t=this.__ngev.listeners[e];this.__ngev.listeners[e]=[];if(t.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",t)}}else{this.__ngev.listeners={error:[],interrupt:[],newListener:[],removeListener:[]}}return this};a.listenerWrapper=function(e,t,i,n,s){var r,l,c=t.master||t,h=!!t.master||t.emitter.__ngev.interruptible;if(c.interrupt){return}if(e.async){if(i){i.ready=!n}if(s<0){if(o.recursions>=-s){t.emitter.__ngev.desync(a.listenerWrapper.bind(undefined,e,t,i,n,a.SYNC));return}}else{setTimeout(a.listenerWrapper.bind(undefined,e,t,i,n,a.SYNC),s);return}l=(e=>{c.listenersDone++;if(e&&h&&!c.interrupt&&t.name!=="interrupt"){c.interrupt=e;if(c.callback){a.emitCallback(t)}t.emitter.emit("interrupt",c.interrupt)}else if(c.listenersDone>=c.listeners.length&&c.callback){a.emitCallback(t)}if(n){a.processScopeQueue(i,true,true)}});if(e.eventObject){e.fn(t,l)}else{r=e.fn(...t.args,l)}}else{if(s<0){if(o.recursions>=-s){t.emitter.__ngev.desync(a.listenerWrapper.bind(undefined,e,t,i,n,a.SYNC));return}}else{setTimeout(a.listenerWrapper.bind(undefined,e,t,i,n,a.SYNC),s);return}if(e.eventObject){e.fn(t)}else{r=e.fn(...t.args)}c.listenersDone++}if(r&&h&&!c.interrupt&&t.name!=="interrupt"){c.interrupt=r;if(c.callback){a.emitCallback(t)}t.emitter.emit("interrupt",c.interrupt)}else if(c.listenersDone>=c.listeners.length&&c.callback){a.emitCallback(t)}};var l=0;a.prototype.emit=function(...e){var t=a.createEvent(this,...e);return a.emitEvent(t)};a.prototype.emitIfListener=function(...e){var t=typeof e[0]==="number"?e[1]:e[0];if(!this.__ngev||!this.__ngev.listeners[t]||!this.__ngev.listeners[t].length){return null}var i=a.createEvent(this,...e);return a.emitEvent(i)};a.prototype.waitForEmit=function(...e){return new Promise(t=>{this.emit(...e,e=>t(e))})};a.createEvent=function(e,...t){var i={emitter:e,interrupt:null,master:null,sync:true};if(typeof t[0]==="number"){i.nice=Math.floor(t[0]);i.name=t[1];if(!i.name||typeof i.name!=="string"){throw new TypeError(".emit(): when argument #0 is a number, argument #1 should be a non-empty string")}if(typeof t[t.length-1]==="function"){i.callback=t[t.length-1];i.args=t.slice(2,-1)}else{i.args=t.slice(2)}}else{i.name=t[0];if(!i.name||typeof i.name!=="string"){throw new TypeError(".emit(): argument #0 should be an number or a non-empty string")}if(typeof t[t.length-1]==="function"){i.callback=t[t.length-1];i.args=t.slice(1,-1)}else{i.args=t.slice(1)}}return i};a.emitEvent=function(e){var t=e.emitter,i,n,s=0,r,c;if(!t.__ngev){a.init.call(t)}r=t.__ngev.states[e.name];if(r!==undefined){if(r&&e.args.length===r.args.length&&e.args.every((e,t)=>e===r.args[t])){return}t.__ngev.stateGroups[e.name].forEach(e=>{t.__ngev.states[e]=null});t.__ngev.states[e.name]=e}if(!t.__ngev.listeners[e.name]){t.__ngev.listeners[e.name]=[]}e.id=l++;e.listenersDone=0;if(e.nice===undefined||e.nice===null){e.nice=t.__ngev.nice}if(!e.listeners){e.listeners=t.__ngev.listeners[e.name].slice()}o.recursions++;e.depth=t.__ngev.depth++;c=[];try{for(i=0,n=e.listeners.length;i<n;i++){s++;a.emitToOneListener(e,e.listeners[i],c)}}catch(e){o.recursions--;t.__ngev.depth--;throw e}o.recursions--;if(!e.callback){t.__ngev.depth--}if(c.length&&t.__ngev.listeners.removeListener.length){t.emit("removeListener",c)}if(!s){if(e.name==="error"){if(e.args[0]){throw e.args[0]}else{throw Error("Uncaught, unspecified 'error' event.")}}if(e.callback){a.emitCallback(e)}}e.sync=false;return e};a.emitIntricatedEvents=function(e,t){var i,n,s=0,r;if(!Array.isArray(e)){throw new TypeError(".emitCorrelatedEvents() argument should be an array")}var c=[],h={nice:a.DESYNC,ready:true,status:a.CONTEXT_ENABLED,serial:true,scopes:{}},u={sync:false,nice:a.DESYNC,context:h,interrupt:null,listeners:c,listenersDone:0,depth:0,callback:t};e.forEach(e=>{var t=a.createEvent(...e);t.master=u;if(!t.emitter.__ngev){a.init.call(t.emitter)}if(!t.emitter.__ngev.listeners[t.name]){t.emitter.__ngev.listeners[t.name]=[]}t.listeners=t.emitter.__ngev.listeners[t.name].slice();t.id=l++;t.listeners.forEach(e=>c.push({event:t,listener:e}))});c.sort((e,t)=>t.listener.priority-e.listener.priority);o.recursions++;r=[];try{for(i=0,n=c.length;i<n;i++){s++;a.emitToOneListener(c[i].event,c[i].listener,r)}}catch(e){o.recursions--;throw e}o.recursions--;if(!s&&u.callback){a.emitCallback(event)}u.sync=false};a.emitToOneListener=function(e,t,i){var n=e.emitter,s=e.master||e,r=e.master?e.master.context:t.context,o,l,c,h=false;if(r){if(r.status===a.CONTEXT_DISABLED){return}c=Math.max(s.nice,t.nice,r.nice);l=r.serial;o=a.getContextScope(r,s.depth)}else{c=Math.max(s.nice,t.nice)}if(t.once){n.__ngev.listeners[e.name]=n.__ngev.listeners[e.name].filter(a.filterOutCallback.bind(undefined,t));if(i){i.push(t)}else{h=true}}if(r&&(r.status===a.CONTEXT_QUEUED||!o.ready)){o.queue.push({event:e,listener:t,nice:c})}else{a.listenerWrapper(t,e,o,l,c)}if(h&&n.__ngev.listeners.removeListener.length){n.emit("removeListener",[t])}};a.emitCallback=function(e){var t;if(e.master){t=e.master.callback;delete e.master.callback;if(e.master.sync){r(()=>t(e.master.interrupt,e))}else{t(e.master.interrupt,e)}return}t=e.callback;delete e.callback;if(e.sync&&e.emitter.__ngev.nice!==a.SYNC){e.emitter.__ngev.desync(()=>{e.emitter.__ngev.depth--;t(e.interrupt,e)})}else{e.emitter.__ngev.depth--;t(e.interrupt,e)}};a.prototype.listeners=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listeners(): argument #0 should be a non-empty string")}if(!this.__ngev){a.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}return this.__ngev.listeners[e].slice()};a.listenerCount=function(e,t){if(!e||!(e instanceof a)){throw new TypeError(".listenerCount(): argument #0 should be an instance of NextGenEvents")}return e.listenerCount(t)};a.prototype.listenerCount=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listenerCount(): argument #1 should be a non-empty string")}if(!this.__ngev||!this.__ngev.listeners[e]){return 0}return this.__ngev.listeners[e].length};a.prototype.setNice=function(e){if(!this.__ngev){a.init.call(this)}this.__ngev.nice=Math.floor(+e||0)};a.prototype.desyncUseNextTick=function(e){if(!this.__ngev){a.init.call(this)}this.__ngev.desync=e?r:s};a.prototype.setInterruptible=function(e){if(!this.__ngev){a.init.call(this)}this.__ngev.interruptible=!!e};a.prototype.setListenerPriority=function(e){if(!this.__ngev){a.init.call(this)}this.__ngev.hasListenerPriority=!!e};a.share=function(e,t){if(!(e instanceof a)||!(t instanceof a)){throw new TypeError("NextGenEvents.share() arguments should be instances of NextGenEvents")}if(!e.__ngev){a.init.call(e)}Object.defineProperty(t,"__ngev",{configurable:true,value:e.__ngev})};a.reset=function(e){Object.defineProperty(e,"__ngev",{configurable:true,value:null})};a.prototype.getMaxListeners=function(){if(!this.__ngev){a.init.call(this)}return this.__ngev.maxListeners};a.prototype.setMaxListeners=function(e){if(!this.__ngev){a.init.call(this)}this.__ngev.maxListeners=typeof e==="number"&&!Number.isNaN(e)?Math.floor(e):a.defaultMaxListeners;return this};a.noop=(()=>undefined);a.prototype.defineStates=function(...e){if(!this.__ngev){a.init.call(this)}e.forEach(t=>{this.__ngev.states[t]=null;this.__ngev.stateGroups[t]=e})};a.prototype.hasState=function(e){if(!this.__ngev){a.init.call(this)}return!!this.__ngev.states[e]};a.prototype.getAllStates=function(){if(!this.__ngev){a.init.call(this)}return Object.keys(this.__ngev.states).filter(e=>this.__ngev.states[e])};a.groupAddListener=function(e,t,i,n){if(typeof i!=="function"){n=i;i=undefined}if(!n||typeof n!=="object"){n={}}i=i||n.fn;delete n.fn;n.id=n.id||i;e.forEach(e=>{e.addListener(t,i.bind(undefined,e),n)})};a.groupOn=a.groupAddListener;a.groupOnce=function(e,t,i,n){if(i&&typeof i==="object"){i.once=true}else if(n&&typeof n==="object"){n.once=true}else{n={once:true}}return this.groupAddListener(e,t,i,n)};a.groupWaitFor=function(e,t){return Promise.all(e.map(e=>e.waitFor(t)))};a.groupWaitForAll=function(e,t){return Promise.all(e.map(e=>e.waitForAll(t)))};a.groupOnceFirst=function(e,t,i,n){var s,r=false;if(typeof i!=="function"){n=i;i=undefined}if(!n||typeof n!=="object"){n={}}i=i||n.fn;delete n.fn;n.id=n.id||i;s=((...s)=>{if(r){return}r=true;a.groupRemoveListener(e,t,n.id);i(...s)});e.forEach(e=>{e.once(t,s.bind(undefined,e),n)})};a.groupWaitForFirst=function(e,t){return new Promise(i=>{a.groupOnceFirst(e,t,e=>i(e))})};a.groupWaitForFirstAll=function(e,t){return new Promise(i=>{a.groupOnceFirst(e,t,(...e)=>i(e))})};a.groupOnceLast=function(e,t,i,n){var s,r=false,o=e.length;if(typeof i!=="function"){n=i;i=undefined}if(!n||typeof n!=="object"){n={}}i=i||n.fn;delete n.fn;n.id=n.id||i;s=((...e)=>{if(r){return}if(--o){return}r=true;i(...e)});e.forEach(e=>{e.once(t,s.bind(undefined,e),n)})};a.groupWaitForLast=function(e,t){return new Promise(i=>{a.groupOnceLast(e,t,e=>i(e))})};a.groupWaitForLastAll=function(e,t){return new Promise(i=>{a.groupOnceLast(e,t,(...e)=>i(e))})};a.groupRemoveListener=function(e,t,i){e.forEach(e=>{e.removeListener(t,i)})};a.groupOff=a.groupRemoveListener;a.groupRemoveAllListeners=function(e,t){e.forEach(e=>{e.removeAllListeners(t)})};a.groupEmit=function(e,...t){var i,n,s=1,r,o=e.length,l,c,h=false;if(typeof t[t.length-1]==="function"){r=-1;l=t[t.length-1];c=(e=>{if(h){return}if(e){h=true;l(e)}else if(!--o){h=true;l()}})}if(typeof t[0]==="number"){s=2;n=typeof t[0]}i=t[s-1];t=t.slice(s,r);e.forEach(e=>{a.emitEvent({emitter:e,name:i,args:t,nice:n,callback:c})})};a.groupWaitForEmit=function(e,...t){return new Promise(i=>{a.groupEmit(e,...t,e=>i(e))})};a.groupDefineStates=function(e,...t){e.forEach(e=>{e.defineStates(...t)})};a.groupGlobalOnce=a.groupOnceFirst;a.groupGlobalOnceAll=a.groupOnceLast;a.CONTEXT_ENABLED=0;a.CONTEXT_DISABLED=1;a.CONTEXT_QUEUED=2;a.prototype.addListenerContext=function(e,t){if(!this.__ngev){a.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".addListenerContext(): argument #0 should be a non-empty string")}if(!t||typeof t!=="object"){t={}}var i=this.__ngev.contexts[e];if(!i){i=this.__ngev.contexts[e]={nice:a.SYNC,ready:true,status:a.CONTEXT_ENABLED,serial:false,scopes:{}}}if(t.nice!==undefined){i.nice=Math.floor(t.nice)}if(t.status!==undefined){i.status=t.status}if(t.serial!==undefined){i.serial=!!t.serial}return i};a.prototype.getListenerContext=function(e){return this.__ngev.contexts[e]};a.getContextScope=function(e,t){var i=e.scopes[t];if(!i){i=e.scopes[t]={ready:true,queue:[]}}return i};a.prototype.disableListenerContext=function(e){if(!this.__ngev){a.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].status=a.CONTEXT_DISABLED;return this};a.prototype.enableListenerContext=function(e){if(!this.__ngev){a.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".enableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}var t=this.__ngev.contexts[e];t.status=a.CONTEXT_ENABLED;Object.values(t.scopes).forEach(e=>{if(e.queue.length>0){a.processScopeQueue(e,t.serial)}});return this};a.prototype.queueListenerContext=function(e){if(!this.__ngev){a.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".queueListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].status=a.CONTEXT_QUEUED;return this};a.prototype.serializeListenerContext=function(e,t){if(!this.__ngev){a.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".serializeListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].serial=t===undefined?true:!!t;return this};a.prototype.setListenerContextNice=function(e,t){if(!this.__ngev){a.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".setListenerContextNice(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].nice=Math.floor(t);return this};a.prototype.destroyListenerContext=function(e){var t,i,n,s,r,o=[];if(!e||typeof e!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev){a.init.call(this)}n=this.__ngev.contexts[e];if(!n){return}for(s in this.__ngev.listeners){r=null;i=this.__ngev.listeners[s].length;for(t=0;t<i;t++){if(this.__ngev.listeners[s][t].context===n){r=[];o.push(this.__ngev.listeners[s][t])}else if(r){r.push(this.__ngev.listeners[s][t])}}if(r){this.__ngev.listeners[s]=r}}delete this.__ngev.contexts[e];if(o.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",o)}return this};a.processScopeQueue=function(e,t,i){var n,s,r,l;if(i){e.ready=true}o.recursions++;while(e.ready&&e.queue.length){n=e.queue.shift();s=n.event;r=s.master||s;l=s.emitter;if(r.interrupt){continue}a.listenerWrapper(n.listener,s,e,t,n.nice)}o.recursions--};a.on=a.prototype.on;a.once=a.prototype.once;a.off=a.prototype.off;if(n.AsyncTryCatch){a.prototype.asyncTryCatchId=n.AsyncTryCatch.NextGenEvents.length;n.AsyncTryCatch.NextGenEvents.push(a);if(n.AsyncTryCatch.substituted){n.AsyncTryCatch.substitute()}}a.Proxy=e("./Proxy.js")}).call(this)}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},e("timers").setImmediate)},{"../package.json":30,"./Proxy.js":28,_process:32,timers:43}],28:[function(e,t,i){"use strict";function n(){this.localServices={};this.remoteServices={};this.nextAckId=1}t.exports=n;var s=e("./NextGenEvents.js");var r="NextGenEvents/message";function o(){}n.create=((...e)=>new n(...e));n.prototype.addLocalService=function(e,t,i){this.localServices[e]=a.create(this,e,t,i);return this.localServices[e]};n.prototype.addRemoteService=function(e){this.remoteServices[e]=l.create(this,e);return this.remoteServices[e]};n.prototype.destroy=function(){Object.keys(this.localServices).forEach(e=>{this.localServices[e].destroy();delete this.localServices[e]});Object.keys(this.remoteServices).forEach(e=>{this.remoteServices[e].destroy();delete this.remoteServices[e]});this.receive=this.send=o};n.prototype.push=function(e){if(e.__type!==r||!e.service||typeof e.service!=="string"||!e.event||typeof e.event!=="string"||!e.method){return}switch(e.method){case"event":return this.remoteServices[e.service]&&this.remoteServices[e.service].receiveEvent(e);case"ackEmit":return this.remoteServices[e.service]&&this.remoteServices[e.service].receiveAckEmit(e);case"emit":return this.localServices[e.service]&&this.localServices[e.service].receiveEmit(e);case"listen":return this.localServices[e.service]&&this.localServices[e.service].receiveListen(e);case"ignore":return this.localServices[e.service]&&this.localServices[e.service].receiveIgnore(e);case"ackEvent":return this.localServices[e.service]&&this.localServices[e.service].receiveAckEvent(e);default:return}};n.prototype.receive=function(e){this.push(e)};n.prototype.send=function(){throw new Error("The send() method of the Proxy MUST be extended/overwritten")};function a(e,t,i,n){return a.create(e,t,i,n)}n.LocalService=a;a.create=function(e,t,i,n){var r=Object.create(a.prototype,{proxy:{value:e,enumerable:true},id:{value:t,enumerable:true},emitter:{value:i,writable:true,enumerable:true},internalEvents:{value:Object.create(s.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},canListen:{value:!!n.listen,writable:true,enumerable:true},canEmit:{value:!!n.emit,writable:true,enumerable:true},canAck:{value:!!n.ack,writable:true,enumerable:true},canRpc:{value:!!n.rpc,writable:true,enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return r};a.prototype.destroy=function(){Object.keys(this.events).forEach(e=>{this.emitter.off(e,this.events[e]);delete this.events[e]});this.emitter=null;this.destroyed=true};a.prototype.receiveEmit=function(e){if(this.destroyed||!this.canEmit||e.ack&&!this.canAck){return}var t={emitter:this.emitter,name:e.event,args:e.args||[]};if(e.ack){t.callback=(t=>{this.proxy.send({__type:r,service:this.id,method:"ackEmit",ack:e.ack,event:e.event,interruption:t})})}s.emitEvent(t)};a.prototype.receiveListen=function(e){if(this.destroyed||!this.canListen||e.ack&&!this.canAck){return}if(e.ack){if(this.events[e.event]){if(this.events[e.event].ack){return}this.emitter.off(e.event,this.events[e.event])}this.events[e.event]=a.forwardWithAck.bind(this);this.events[e.event].ack=true;this.emitter.on(e.event,this.events[e.event],{eventObject:true,async:true})}else{if(this.events[e.event]){if(!this.events[e.event].ack){return}this.emitter.off(e.event,this.events[e.event])}this.events[e.event]=a.forward.bind(this);this.events[e.event].ack=false;this.emitter.on(e.event,this.events[e.event],{eventObject:true})}};a.prototype.receiveIgnore=function(e){if(this.destroyed||!this.canListen){return}if(!this.events[e.event]){return}this.emitter.off(e.event,this.events[e.event]);this.events[e.event]=null};a.prototype.receiveAckEvent=function(e){if(this.destroyed||!this.canListen||!this.canAck||!e.ack||!this.events[e.event]||!this.events[e.event].ack){return}this.internalEvents.emit("ack",e)};a.forward=function(e){if(this.destroyed){return}this.proxy.send({__type:r,service:this.id,method:"event",event:e.name,args:e.args})};a.forward.ack=false;a.forwardWithAck=function(e,t){if(this.destroyed){return}if(!e.callback){this.proxy.send({__type:r,service:this.id,method:"event",event:e.name,args:e.args});t();return}var i=false;var n=this.proxy.nextAckId++;var s=e=>{if(i||e.ack!==n){return}i=true;this.internalEvents.off("ack",s);t()};this.internalEvents.on("ack",s);this.proxy.send({__type:r,service:this.id,method:"event",event:e.name,ack:n,args:e.args})};a.forwardWithAck.ack=true;function l(e,t){return l.create(e,t)}n.RemoteService=l;var c=1;var h=2;l.create=function(e,t){var i=Object.create(l.prototype,{proxy:{value:e,enumerable:true},id:{value:t,enumerable:true},emitter:{value:Object.create(s.prototype),writable:true,enumerable:true},internalEvents:{value:Object.create(s.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return i};l.prototype.destroy=function(){this.emitter.removeAllListeners();this.emitter=null;Object.keys(this.events).forEach(e=>{delete this.events[e]});this.destroyed=true};l.prototype.emit=function(e,...t){if(this.destroyed){return}var i,n,s;if(typeof e==="number"){throw new TypeError("Cannot emit with a nice value on a remote service")}if(typeof t[t.length-1]!=="function"){this.proxy.send({__type:r,service:this.id,method:"emit",event:e,args:t});return}i=t.pop();n=this.proxy.nextAckId++;s=false;var o=e=>{if(s||e.ack!==n){return}s=true;this.internalEvents.off("ack",o);i(e.interruption)};this.internalEvents.on("ack",o);this.proxy.send({__type:r,service:this.id,method:"emit",ack:n,event:e,args:t})};l.prototype.addListener=function(e,t,i){if(this.destroyed){return}if(typeof t!=="function"){i=t;t=undefined}if(!i||typeof i!=="object"){i={}}i.fn=t||i.fn;this.emitter.addListener(e,i);if(!this.emitter.__ngev.listeners[e]||!this.emitter.__ngev.listeners[e].length){return}if(i.async&&this.events[e]!==h){this.events[e]=h;this.proxy.send({__type:r,service:this.id,method:"listen",ack:true,event:e})}else if(!i.async&&!this.events[e]){this.events[e]=c;this.proxy.send({__type:r,service:this.id,method:"listen",event:e})}};l.prototype.on=l.prototype.addListener;l.prototype.once=s.prototype.once;l.prototype.removeListener=function(e,t){if(this.destroyed){return}this.emitter.removeListener(e,t);if((!this.emitter.__ngev.listeners[e]||!this.emitter.__ngev.listeners[e].length)&&this.events[e]){this.events[e]=0;this.proxy.send({__type:r,service:this.id,method:"ignore",event:e})}};l.prototype.off=l.prototype.removeListener;l.prototype.receiveEvent=function(e){if(this.destroyed||!this.events[e.event]){return}var t={emitter:this.emitter,name:e.event,args:e.args||[]};if(e.ack){t.callback=(()=>{this.proxy.send({__type:r,service:this.id,method:"ackEvent",ack:e.ack,event:e.event})})}s.emitEvent(t);var i=t.name;if(!this.emitter.__ngev.listeners[i]||!this.emitter.__ngev.listeners[i].length){this.events[i]=0;this.proxy.send({__type:r,service:this.id,method:"ignore",event:i})}};l.prototype.receiveAckEmit=function(e){if(this.destroyed||!e.ack||this.events[e.event]!==h){return}this.internalEvents.emit("ack",e)}},{"./NextGenEvents.js":27}],29:[function(e,t,i){(function(i){(function(){"use strict";if(typeof window.setImmediate!=="function"){window.setImmediate=(e=>setTimeout(e,0))}if(!i.emitWarning){i.emitWarning=(()=>undefined)}t.exports=e("./NextGenEvents.js");t.exports.isBrowser=true}).call(this)}).call(this,e("_process"))},{"./NextGenEvents.js":27,_process:32}],30:[function(e,t,i){t.exports={name:"nextgen-events",version:"1.4.0",description:"The next generation of events handling for javascript! New: abstract away the network!",main:"lib/NextGenEvents.js",engines:{node:">=6.0.0"},directories:{test:"test"},dependencies:{},devDependencies:{browserify:"^16.2.2","uglify-js-es6":"^2.8.9",ws:"^5.1.1"},scripts:{test:"tea-time -R dot"},repository:{type:"git",url:"https://github.com/cronvel/nextgen-events.git"},keywords:["events","async","emit","listener","context","series","serialize","namespace","proxy","network"],author:"Cédric Ronvel",license:"MIT",bugs:{url:"https://github.com/cronvel/nextgen-events/issues"},config:{"tea-time":{coverDir:["lib"]}},copyright:{title:"Next-Gen Events",years:[2015,2019],owner:"Cédric Ronvel"}}},{}],31:[function(e,t,i){(function(e){(function(){function t(e,t){var i=0;for(var n=e.length-1;n>=0;n--){var s=e[n];if(s==="."){e.splice(n,1)}else if(s===".."){e.splice(n,1);i++}else if(i){e.splice(n,1);i--}}if(t){for(;i--;i){e.unshift("..")}}return e}i.resolve=function(){var i="",n=false;for(var r=arguments.length-1;r>=-1&&!n;r--){var o=r>=0?arguments[r]:e.cwd();if(typeof o!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!o){continue}i=o+"/"+i;n=o.charAt(0)==="/"}i=t(s(i.split("/"),function(e){return!!e}),!n).join("/");return(n?"/":"")+i||"."};i.normalize=function(e){var n=i.isAbsolute(e),o=r(e,-1)==="/";e=t(s(e.split("/"),function(e){return!!e}),!n).join("/");if(!e&&!n){e="."}if(e&&o){e+="/"}return(n?"/":"")+e};i.isAbsolute=function(e){return e.charAt(0)==="/"};i.join=function(){var e=Array.prototype.slice.call(arguments,0);return i.normalize(s(e,function(e,t){if(typeof e!=="string"){throw new TypeError("Arguments to path.join must be strings")}return e}).join("/"))};i.relative=function(e,t){e=i.resolve(e).substr(1);t=i.resolve(t).substr(1);function n(e){var t=0;for(;t<e.length;t++){if(e[t]!=="")break}var i=e.length-1;for(;i>=0;i--){if(e[i]!=="")break}if(t>i)return[];return e.slice(t,i-t+1)}var s=n(e.split("/"));var r=n(t.split("/"));var o=Math.min(s.length,r.length);var a=o;for(var l=0;l<o;l++){if(s[l]!==r[l]){a=l;break}}var c=[];for(var l=a;l<s.length;l++){c.push("..")}c=c.concat(r.slice(a));return c.join("/")};i.sep="/";i.delimiter=":";i.dirname=function(e){if(typeof e!=="string")e=e+"";if(e.length===0)return".";var t=e.charCodeAt(0);var i=t===47;var n=-1;var s=true;for(var r=e.length-1;r>=1;--r){t=e.charCodeAt(r);if(t===47){if(!s){n=r;break}}else{s=false}}if(n===-1)return i?"/":".";if(i&&n===1){return"/"}return e.slice(0,n)};function n(e){if(typeof e!=="string")e=e+"";var t=0;var i=-1;var n=true;var s;for(s=e.length-1;s>=0;--s){if(e.charCodeAt(s)===47){if(!n){t=s+1;break}}else if(i===-1){n=false;i=s+1}}if(i===-1)return"";return e.slice(t,i)}i.basename=function(e,t){var i=n(e);if(t&&i.substr(-1*t.length)===t){i=i.substr(0,i.length-t.length)}return i};i.extname=function(e){if(typeof e!=="string")e=e+"";var t=-1;var i=0;var n=-1;var s=true;var r=0;for(var o=e.length-1;o>=0;--o){var a=e.charCodeAt(o);if(a===47){if(!s){i=o+1;break}continue}if(n===-1){s=false;n=o+1}if(a===46){if(t===-1)t=o;else if(r!==1)r=1}else if(t!==-1){r=-1}}if(t===-1||n===-1||r===0||r===1&&t===n-1&&t===i+1){return""}return e.slice(t,n)};function s(e,t){if(e.filter)return e.filter(t);var i=[];for(var n=0;n<e.length;n++){if(t(e[n],n,e))i.push(e[n])}return i}var r="ab".substr(-1)==="b"?function(e,t,i){return e.substr(t,i)}:function(e,t,i){if(t<0)t=e.length+t;return e.substr(t,i)}}).call(this)}).call(this,e("_process"))},{_process:32}],32:[function(e,t,i){var n=t.exports={};var s;var r;function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){s=setTimeout}else{s=o}}catch(e){s=o}try{if(typeof clearTimeout==="function"){r=clearTimeout}else{r=a}}catch(e){r=a}})();function l(e){if(s===setTimeout){return setTimeout(e,0)}if((s===o||!s)&&setTimeout){s=setTimeout;return setTimeout(e,0)}try{return s(e,0)}catch(t){try{return s.call(null,e,0)}catch(t){return s.call(this,e,0)}}}function c(e){if(r===clearTimeout){return clearTimeout(e)}if((r===a||!r)&&clearTimeout){r=clearTimeout;return clearTimeout(e)}try{return r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}var h=[];var u=false;var f;var p=-1;function d(){if(!u||!f){return}u=false;if(f.length){h=f.concat(h)}else{p=-1}if(h.length){g()}}function g(){if(u){return}var e=l(d);u=true;var t=h.length;while(t){f=h;h=[];while(++p<t){if(f){f[p].run()}}p=-1;t=h.length}f=null;u=false;c(e)}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){t[i-1]=arguments[i]}}h.push(new y(e,t));if(h.length===1&&!u){l(g)}};function y(e,t){this.fun=e;this.array=t}y.prototype.run=function(){this.fun.apply(null,this.array)};n.title="browser";n.browser=true;n.env={};n.argv=[];n.version="";n.versions={};function m(){}n.on=m;n.addListener=m;n.once=m;n.off=m;n.removeListener=m;n.removeAllListeners=m;n.emit=m;n.prependListener=m;n.prependOnceListener=m;n.listeners=function(e){return[]};n.binding=function(e){throw new Error("process.binding is not supported")};n.cwd=function(){return"/"};n.chdir=function(e){throw new Error("process.chdir is not supported")};n.umask=function(){return 0}},{}],33:[function(e,t,i){(function(e,t){(function(){(function(t,i){"use strict";if(t.setImmediate){return}var n=1;var s={};var r=false;var o=t.document;var a;function l(e){if(typeof e!=="function"){e=new Function(""+e)}var t=new Array(arguments.length-1);for(var i=0;i<t.length;i++){t[i]=arguments[i+1]}var r={callback:e,args:t};s[n]=r;a(n);return n++}function c(e){delete s[e]}function h(e){var t=e.callback;var n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(i,n);break}}function u(e){if(r){setTimeout(u,0,e)}else{var t=s[e];if(t){r=true;try{h(t)}finally{c(e);r=false}}}}function f(){a=function(t){e.nextTick(function(){u(t)})}}function p(){if(t.postMessage&&!t.importScripts){var e=true;var i=t.onmessage;t.onmessage=function(){e=false};t.postMessage("","*");t.onmessage=i;return e}}function d(){var e="setImmediate$"+Math.random()+"$";var i=function(i){if(i.source===t&&typeof i.data==="string"&&i.data.indexOf(e)===0){u(+i.data.slice(e.length))}};if(t.addEventListener){t.addEventListener("message",i,false)}else{t.attachEvent("onmessage",i)}a=function(i){t.postMessage(e+i,"*")}}function g(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;u(t)};a=function(t){e.port2.postMessage(t)}}function y(){var e=o.documentElement;a=function(t){var i=o.createElement("script");i.onreadystatechange=function(){u(t);i.onreadystatechange=null;e.removeChild(i);i=null};e.appendChild(i)}}function m(){a=function(e){setTimeout(u,0,e)}}var v=Object.getPrototypeOf&&Object.getPrototypeOf(t);v=v&&v.setTimeout?v:t;if({}.toString.call(t.process)==="[object process]"){f()}else if(p()){d()}else if(t.MessageChannel){g()}else if(o&&"onreadystatechange"in o.createElement("script")){y()}else{m()}v.setImmediate=l;v.clearImmediate=c})(typeof self==="undefined"?typeof t==="undefined"?this:t:self)}).call(this)}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:32}],34:[function(e,t,i){"use strict";const n=e("./seventh.js");function s(e,t=4){this.jobRunner=e;this.jobs=new Map;this.pendingJobs=new Map;this.runningJobs=new Map;this.errorJobs=new Map;this.jobsDone=new Map;this.concurrency=+t||1;this.isQueueRunning=true;this.isLoopRunning=false;this.canLoopAgain=false;this.ready=n.resolved;this.startTime=null;this.endTime=null;this.drained=n.resolved;this.idle=n.resolved}n.Queue=s;function r(e,t=null,i=undefined){this.id=e;this.dependencies=t===null?null:[...t];this.data=i===undefined?e:i;this.error=null;this.startTime=null;this.endTime=null}s.Job=r;s.prototype.setConcurrency=function(e){this.concurrency=+e||1};s.prototype.stop=s.prototype.pause=function(){this.isQueueRunning=false};s.prototype.has=function(e){return this.jobs.has(e)};s.prototype.add=s.prototype.addJob=function(e,t,i=null){if(this.jobs.has(e)){return false}var s=new r(e,i,t);this.jobs.set(e,s);this.pendingJobs.set(e,s);this.canLoopAgain=true;if(this.isQueueRunning&&!this.isLoopRunning){this.run()}if(this.drained.isSettled()){this.drained=new n}return s};s.prototype.addBatch=s.prototype.addJobBatch=function(e){var t,i;for(t of e){if(this.jobs.has(t)){return false}i=new r(t);this.jobs.set(t,i);this.pendingJobs.set(t,i)}this.canLoopAgain=true;if(this.isQueueRunning&&!this.isLoopRunning){this.run()}if(this.drained.isSettled()){this.drained=new n}};s.prototype.run=s.prototype.resume=async function(){var e;this.isQueueRunning=true;if(this.isLoopRunning){return}this.isLoopRunning=true;if(!this.startTime){this.startTime=Date.now()}do{this.canLoopAgain=false;for(e of this.pendingJobs.values()){if(e.dependencies&&e.dependencies.some(e=>!this.jobsDone.has(e))){continue}if(this.idle.isSettled()){this.idle=new n}this.canLoopAgain=true;await this.ready;if(!this.isQueueRunning){this.finishRun();return}this.runJob(e)}}while(this.canLoopAgain);this.finishRun()};s.prototype.finishRun=function(){this.isLoopRunning=false;if(!this.pendingJobs.size){this.drained.resolve()}if(!this.runningJobs.size){this.endTime=Date.now();this.idle.resolve()}};s.prototype.runJob=async function(e){this.pendingJobs.delete(e.id);this.runningJobs.set(e.id,e);if(this.runningJobs.size>=this.concurrency){this.ready=new n}try{e.startTime=Date.now();await this.jobRunner(e.data);e.endTime=Date.now();this.jobsDone.set(e.id,e);this.canLoopAgain=true}catch(t){e.endTime=Date.now();e.error=t;this.errorJobs.set(e.id,e)}this.runningJobs.delete(e.id);if(this.runningJobs.size<this.concurrency){this.ready.resolve()}if(!this.isLoopRunning){if(this.isQueueRunning&&this.pendingJobs.size){this.run()}else{this.finishRun()}}};s.prototype.getJobTimes=function(){var e,t={};for(e of this.jobsDone.values()){t[e.id]=e.endTime-e.startTime}return t};s.prototype.getStats=function(){var e,t=0,i={pending:this.pendingJobs.size,running:this.runningJobs.size,failed:this.errorJobs.size,done:this.jobsDone.size,averageJobTime:null,queueTime:null};if(this.jobsDone.size){for(e of this.jobsDone.values()){t+=e.endTime-e.startTime}i.averageJobTime=t/this.jobsDone.size}if(this.endTime){i.queueTime=this.endTime-this.startTime}return i}},{"./seventh.js":41}],35:[function(e,t,i){"use strict";const n=e("./seventh.js");n.promisifyNodeApi=((e,t,i,s,r)=>{var o;t=t||"Async";i=i||"AsyncAll";s=s||(e=>e[0]!=="_"&&!e.endsWith("Sync"));if(r){o=[];for(let t in e){if(typeof e[t]==="function"){o.push(t)}}}else{o=Object.keys(e)}o.filter(t=>{if(typeof e[t]!=="function"){return false}for(let i in e[t].prototype){return false}return s(t,e)}).forEach(s=>{const r=s+t;const o=s+i;if(!e[r]){e[r]=n.promisify(e[s],e)}if(!e[o]){e[o]=n.promisifyAll(e[s],e)}})});n.promisifyAnyNodeApi=((e,t,i,s)=>{n.promisifyNodeApi(e,t,i,s,true)})},{"./seventh.js":41}],36:[function(e,t,i){"use strict";const n=e("./seventh.js");const s={};function r(){}n.all=(e=>{var t=-1,i=false,s=0,r=Infinity,o,a=[],l=new n;for(o of e){if(i){break}t++;(()=>{const e=t;n.resolve(o).then(t=>{if(i){return}a[e]=t;s++;if(s>=r){i=true;l._resolveValue(a)}},e=>{if(i){return}i=true;l.reject(e)})})()}r=t+1;if(!r){l._resolveValue(a)}return l});n._allArray=(e=>{var t=e.length;if(!t){n._resolveValue([])}var i,s={settled:false,count:0,length:t,values:[],allPromise:new n};for(i=0;!s.settled&&i<t;i++){n._allArrayOne(e[i],i,s)}return s.allPromise});n._allArrayOne=((e,t,i)=>{n._bareThen(e,e=>{if(i.settled){return}i.values[t]=e;i.count++;if(i.count>=i.length){i.settled=true;i.allPromise._resolveValue(i.values)}},e=>{if(i.settled){return}i.settled=true;i.allPromise.reject(e)})});n.every=n.map=((e,t)=>{var i=-1,s=false,r=0,o=Infinity,a,l=[],c=new n;for(a of e){if(s){break}i++;(()=>{const e=i;n.resolve(a).then(i=>{if(s){return}return t(i,e)}).then(t=>{if(s){return}l[e]=t;r++;if(r>=o){s=true;c._resolveValue(l)}},e=>{if(s){return}s=true;c.reject(e)})})()}o=i+1;if(!o){c._resolveValue(l)}return c});n.any=(e=>{var t=-1,i=false,s=0,r=Infinity,o,a=[],l=new n;for(o of e){if(i){break}t++;(()=>{const e=t;n.resolve(o).then(e=>{if(i){return}i=true;l._resolveValue(e)},t=>{if(i){return}a[e]=t;s++;if(s>=r){i=true;l.reject(a)}})})()}r=t+1;if(!r){l.reject(new RangeError("Promise.any(): empty array"))}return l});n.some=((e,t)=>{var i=-1,s=false,r=0,o=Infinity,a,l=[],c=new n;for(a of e){if(s){break}i++;(()=>{const e=i;n.resolve(a).then(i=>{if(s){return}return t(i,e)}).then(e=>{if(s){return}s=true;c._resolveValue(e)},t=>{if(s){return}l[e]=t;r++;if(r>=o){s=true;c.reject(l)}})})()}o=i+1;if(!o){c.reject(new RangeError("Promise.any(): empty array"))}return c});n.filter=((e,t)=>{var i=-1,r=false,o=0,a=Infinity,l,c=[],h=new n;for(l of e){if(r){break}i++;(()=>{const e=i;n.resolve(l).then(i=>{if(r){return}c[e]=i;return t(i,e)}).then(t=>{if(r){return}o++;if(!t){c[e]=s}if(o>=a){r=true;c=c.filter(e=>e!==s);h._resolveValue(c)}},e=>{if(r){return}r=true;h.reject(e)})})()}a=i+1;if(!a){h._resolveValue(c)}else if(o>=a){r=true;c=c.filter(e=>e!==s);h._resolveValue(c)}return h});n.foreach=n.forEach=function(e,t,i){var s=-1,o=arguments.length>=3,a=e[Symbol.iterator](),l=new n,c=n.resolve(i);if(n.warnUnhandledRejection){n._handleAll(e)}var h=()=>{c.then(e=>{let{value:i,done:r}=a.next();s++;if(r){l.resolve(e)}else{c=n.resolve(i).then(o?i=>t(e,i,s):e=>t(e,s));h()}},e=>{l.reject(e);for(;;){let{value:e,done:t}=a.next();if(t){break}if(n.isThenable(e)){e.then(r,r)}}})};h();return l};n.reduce=((e,t,i)=>{return n.forEach(e,t,i)});n.mapObject=((e,t)=>{var i=false,s=0,r,o,a=Object.keys(e),l=a.length,c,h={},u=new n;for(r=0;!i&&r<l;r++){o=a[r];c=e[o];(()=>{const e=o;n.resolve(c).then(n=>{if(i){return}return t(n,e)}).then(t=>{if(i){return}h[e]=t;s++;if(s>=l){i=true;u._resolveValue(h)}},e=>{if(i){return}i=true;u.reject(e)})})()}if(!l){u._resolveValue(h)}return u});n.concurrent=((e,t,i)=>{var s=-1,r=false,o=0,a=0,l=Infinity,c,h=false,u=[],f=t[Symbol.iterator](),p=new n;if(n.warnUnhandledRejection){n._handleAll(t)}e=+e||1;const d=()=>{while(!h&&o<e){({value:c,done:h}=f.next());if(h){l=s+1;if(a>=l){r=true;p._resolveValue(u);return}break}if(r){break}s++;(()=>{const t=s;o++;n.resolve(c).then(e=>{if(r){return}return i(e,t)}).then(i=>{if(r){return}u[t]=i;a++;o--;if(a>=l){r=true;p._resolveValue(u);return}if(o<e){d();return}},e=>{if(r){return}r=true;p.reject(e)})})()}};d();if(s<0){p._resolveValue(u)}return p});n.race=(e=>{var t=false,i,s=new n;for(i of e){if(t){break}n.resolve(i).then(e=>{if(t){return}t=true;s._resolveValue(e)},e=>{if(t){return}t=true;s.reject(e)})}return s})},{"./seventh.js":41}],37:[function(e,t,i){(function(i,n,s){(function(){"use strict";const r=n.Promise;var o;if(!i.browser){o=i.nextTick}else{e("setimmediate");o=s}function a(e){this.fn=e;this._then=a._dormantThen;this.value=null;this.thenHandlers=null;this.handledRejection=null;if(this.fn){this._exec()}}t.exports=a;a.Native=r;a.warnUnhandledRejection=true;a.prototype._exec=function(){this._then=a._pendingThen;try{this.fn(e=>{this.resolve(e)},e=>{this.reject(e)})}catch(e){this.reject(e)}};a.prototype.resolve=a.prototype.fulfill=function(e){if(this._then.settled){return this}if(a.isThenable(e)){this._execThenPromise(e);return this}return this._resolveValue(e)};a.prototype._resolveValue=function(e){this._then=a._fulfilledThen;this.value=e;if(this.thenHandlers&&this.thenHandlers.length){this._execFulfillHandlers()}return this};a.prototype._execThenPromise=function(e){try{e.then(e=>{this.resolve(e)},e=>{this.reject(e)})}catch(e){this.reject(e)}};a.prototype.reject=function(e){if(this._then.settled){return this}this._then=a._rejectedThen;this.value=e;if(this.thenHandlers&&this.thenHandlers.length){this._execRejectionHandlers()}else if(a.warnUnhandledRejection&&!this.handledRejection){this._unhandledRejection()}return this};a.prototype._execFulfillHandlers=function(){var e,t=this.thenHandlers.length;for(e=0;e<t;e+=3){if(this.thenHandlers[e+1]){this._execOneFulfillHandler(this.thenHandlers[e],this.thenHandlers[e+1])}else{this.thenHandlers[e].resolve(this.value)}}};a.prototype._execOneFulfillHandler=function(e,t){try{e.resolve(t(this.value))}catch(t){e.reject(t)}};a.prototype._execRejectionHandlers=function(){var e,t=this.thenHandlers.length;for(e=0;e<t;e+=3){if(this.thenHandlers[e+2]){this._execOneRejectHandler(this.thenHandlers[e],this.thenHandlers[e+2])}else{this.thenHandlers[e].reject(this.value)}}};a.prototype._execOneRejectHandler=function(e,t){try{e.resolve(t(this.value))}catch(t){e.reject(t)}};a.prototype.resolveTimeout=a.prototype.fulfillTimeout=function(e,t){setTimeout(()=>this.resolve(t),e)};a.prototype.rejectTimeout=function(e,t){setTimeout(()=>this.reject(t),e)};a._dormantThen=function(e,t){if(this.fn){this._exec();return this._then(e,t)}var i=new a;if(!this.thenHandlers){this.thenHandlers=[i,e,t]}else{this.thenHandlers[this.thenHandlers.length]=i;this.thenHandlers[this.thenHandlers.length]=e;this.thenHandlers[this.thenHandlers.length]=t}return i};a._dormantThen.settled=false;a._pendingThen=function(e,t){var i=new a;if(!this.thenHandlers){this.thenHandlers=[i,e,t]}else{this.thenHandlers[this.thenHandlers.length]=i;this.thenHandlers[this.thenHandlers.length]=e;this.thenHandlers[this.thenHandlers.length]=t}return i};a._pendingThen.settled=false;a._fulfilledThen=function(e){if(!e){return this}var t=new a;o(()=>{try{t.resolve(e(this.value))}catch(e){t.reject(e)}});return t};a._fulfilledThen.settled=true;a._rejectedThen=function(e,t){if(!t){return this}this.handledRejection=true;var i=new a;o(()=>{try{i.resolve(t(this.value))}catch(e){i.reject(e)}});return i};a._rejectedThen.settled=true;a.prototype.then=function(e,t){return this._then(e,t)};a.prototype.catch=function(e=(()=>undefined)){return this._then(undefined,e)};a.prototype.finally=function(e){return this._then(e,e)};a.prototype.tap=a.prototype.tapThen=function(e){this._then(e,undefined);return this};a.prototype.tapCatch=function(e){this._then(undefined,e);return this};a.prototype.tapFinally=function(e){this._then(e,e);return this};a.prototype.fatal=function(){this._then(undefined,e=>{o(()=>{throw e})})};a.prototype.done=function(e,t){this._then(e,t).fatal();return this};a.prototype.callback=function(e){this._then(t=>{e(undefined,t)},t=>{e(t)}).fatal();return this};a.prototype.callbackAll=function(e){this._then(t=>{if(Array.isArray(t)){e(undefined,...t)}else{e(undefined,t)}},t=>{e(t)}).fatal();return this};a.callback=function(e){return new a((t,i)=>{e((e,n)=>{if(e){i(e)}else{t(n)}})})};a.callbackAll=function(e){return new a((t,i)=>{e((e,...n)=>{if(e){i(e)}else{t(n)}})})};a.prototype.toPromise=a.prototype.propagate=function(e){this._then(t=>{e.resolve(t)},t=>{e.reject(t)});return this};a.propagate=function(e,t){e.then(e=>{t.resolve(e)},e=>{t.reject(e)});return e};a.finally=function(e,t){return e.then(t,t)};a.resolve=a.fulfill=function(e){if(a.isThenable(e)){return a.fromThenable(e)}return a._resolveValue(e)};a._resolveValue=function(e){var t=new a;t._then=a._fulfilledThen;t.value=e;return t};a.reject=function(e){var t=new a;t._then=a._rejectedThen;t.value=e;return t};a.resolveTimeout=a.fulfillTimeout=function(e,t){return new a(i=>setTimeout(()=>i(t),e))};a.rejectTimeout=function(e,t){return new a((i,n)=>setTimeout(()=>n(t),e))};a.resolveNextTick=a.fulfillNextTick=function(e){return new a(t=>o(()=>t(e)))};a.rejectNextTick=function(e){return new a((t,i)=>o(()=>i(e)))};a.dormant=function(e){var t=new a;t.fn=e;return t};a.try=function(e){try{return a.resolve(e())}catch(e){return a.reject(e)}};a.isThenable=function(e){return e&&typeof e==="object"&&typeof e.then==="function"};a.fromThenable=function(e){if(e instanceof a){return e}return new a((t,i)=>{e.then(e=>{t(e)},e=>{i(e)})})};a._bareThen=function(e,t,i){if(e&&typeof e==="object"){if(e instanceof a){if(e._then===a._fulfilledThen){t(e.value)}else if(e._then===a._rejectedThen){i(e.value)}else{e._then(t,i)}}else if(typeof e.then==="function"){e.then(t,i)}else{t(e)}}else{t(e)}};a._handleAll=function(e){var t;for(t of e){if(a.isThenable(t)){t.handledRejection=true}}};a.prototype._unhandledRejection=function(){this.handledRejection=false;const e=e=>setTimeout(e,0);if(this.value instanceof Error){e(()=>{if(this.handledRejection===false){this.value.message="Unhandled promise rejection: "+this.value.message;console.error(this.value)}})}else{let t=new Error("Unhandled promise rejection");e(()=>{if(this.handledRejection===false){console.error(t);console.error("Rejection reason:",this.value)}})}};a.prototype.isSettled=function(){return this._then.settled};a.prototype.getStatus=function(){switch(this._then){case a._dormantThen:return"dormant";case a._pendingThen:return"pending";case a._fulfilledThen:return"fulfilled";case a._rejectedThen:return"rejected"}};a.prototype.inspect=function(){switch(this._then){case a._dormantThen:return"Promise { <DORMANT> }";case a._pendingThen:return"Promise { <PENDING> }";case a._fulfilledThen:return"Promise { <FULFILLED> "+this.value+" }";case a._rejectedThen:return"Promise { <REJECTED> "+this.value+" }"}};a.resolved=a.dummy=a.resolve();if(i.browser){a.prototype.resolveAtAnimationFrame=function(e){window.requestAnimationFrame(()=>this.resolve(e))};a.prototype.rejectAtAnimationFrame=function(e){window.requestAnimationFrame(()=>this.reject(e))};a.resolveAtAnimationFrame=function(e){return new a(t=>window.requestAnimationFrame(()=>t(e)))};a.rejectAtAnimationFrame=function(e){return new a((t,i)=>window.requestAnimationFrame(()=>i(e)))}}}).call(this)}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},e("timers").setImmediate)},{_process:32,setimmediate:33,timers:43}],38:[function(e,t,i){"use strict";const n=e("./seventh.js");n.promisifyAll=((e,t)=>{if(t){return(...i)=>{return new n((n,s)=>{e.call(t,...i,(e,...t)=>{if(e){if(t.length&&e instanceof Error){e.args=t}s(e)}else{n(t)}})})}}return function(...t){return new n((i,n)=>{e.call(this,...t,(e,...t)=>{if(e){if(t.length&&e instanceof Error){e.args=t}n(e)}else{i(t)}})})}});n.promisify=((e,t)=>{if(t){return(...i)=>{return new n((n,s)=>{e.call(t,...i,(e,t)=>{if(e){if(t!==undefined&&e instanceof Error){e.arg=t}s(e)}else{n(t)}})})}}return function(...t){return new n((i,n)=>{e.call(this,...t,(e,t)=>{if(e){if(t!==undefined&&e instanceof Error){e.arg=t}n(e)}else{i(t)}})})}});n.returnValueInterceptor=((e,t,i)=>{return function(...n){var s=t.call(i||this,...n);e(s);return s}});n.once=((e,t)=>{var i=false;var n;return function(...s){if(!i){i=true;n=e.call(t||this,...s)}return n}});n.serialize=((e,t)=>{var i=new n.resolve;return function(...s){var r=new n;i.finally(()=>{n.propagate(e.call(t||this,...s),r)});i=r;return r}});n.debounce=((e,t)=>{var i=null;const s=()=>{i=null};return function(...r){if(i){return i}i=e.call(t||this,...r);n.finally(i,s);return i}});n.debounceDelay=((e,t,i)=>{var s=null;const r=()=>{setTimeout(()=>s=null,e)};return function(...e){if(s){return s}s=t.call(i||this,...e);n.finally(s,r);return s}});n.debounceUpdate=((e,t)=>{var i=null;var s=null;var r=null;const o=()=>{var t,a;i=null;if(s){t=s;s=null;a=r;r=null;i=e.call(...t);n.propagate(i,a);n.finally(i,o);return i}};return function(...a){var l=t||this;if(i){if(!r){r=new n}s=[l,...a];return r}i=e.call(l,...a);n.finally(i,o);return i}});n.NO_DELAY={};n.BATCH_NO_DELAY={};n.debounceSync=((e,t)=>{var i=new Map;const s=e=>{var t=i.get(e);if(!t){t={inProgress:null,inProgressIsFull:null,last:null,lastTime:null,lastFullSync:null,lastFullSyncTime:null,nextFullSyncPromise:null,nextFullSyncWith:null,noDelayBatches:new Set};i.set(e,t)}return t};const r=(e,i)=>{var s,o,a,l=new Date;e.inProgress=null;if(i>=2){e.lastFullSyncTime=e.lastTime=l}else if(i>=1){e.lastTime=l}if(e.nextFullSyncWith){if(t.delay&&e.lastFullSyncTime&&(s=l-e.lastFullSyncTime-t.delay)<0){e.inProgress=n.resolveTimeout(-s+1);e.inProgress.finally(()=>r(e,0));return e.nextFullSyncPromise}o=e.nextFullSyncWith;e.nextFullSyncWith=null;a=e.nextFullSyncPromise;e.nextFullSyncPromise=null;e.lastFullSync=e.last=e.inProgress=t.fn.call(...o);n.propagate(e.inProgress,a);n.finally(e.inProgress,()=>r(e,2));return e.inProgress}};const o=function(t,...i){var o=false,a=e.thisBinding||this,l=s(t);if(i[0]===n.NO_DELAY){o=true;i.shift()}else if(i[0]===n.BATCH_NO_DELAY){i.shift();let e=i.shift();if(!l.noDelayBatches.has(e)){l.noDelayBatches.add(e);o=true}}if(l.inProgress){return l.inProgress}if(!o&&e.delay&&l.lastTime&&new Date-l.lastTime<e.delay){if(typeof e.onDebounce==="function"){e.onDebounce(t,...i)}return l.last}l.last=l.inProgress=e.fn.call(a,t,...i);l.inProgressIsFull=false;n.finally(l.inProgress,()=>r(l,1));return l.inProgress};const a=function(e,...i){var o,a=false,l=t.thisBinding||this,c=s(e);if(i[0]===n.NO_DELAY){a=true;i.shift()}else if(i[0]===n.BATCH_NO_DELAY){i.shift();let e=i.shift();if(!c.noDelayBatches.has(e)){c.noDelayBatches.add(e);a=true}}if(!c.inProgress&&!a&&t.delay&&c.lastFullSyncTime&&(o=new Date-c.lastFullSyncTime-t.delay)<0){c.inProgress=n.resolveTimeout(-o+1);n.finally(c.inProgress,()=>r(c,0))}if(c.inProgress){if(!c.nextFullSyncPromise){c.nextFullSyncPromise=new n}c.nextFullSyncWith=[l,e,...i];return c.nextFullSyncPromise}c.lastFullSync=c.last=c.inProgress=t.fn.call(l,e,...i);n.finally(c.inProgress,()=>r(c,2));return c.inProgress};return[o,a]});n.timeout=((e,t,i)=>{return function(...n){var s=t.call(i||this,...n);setTimeout(()=>s.reject(new Error("Timeout")),e);return s}});n.variableTimeout=((e,t)=>{return function(i,...n){var s=e.call(t||this,...n);setTimeout(()=>s.reject(new Error("Timeout")),i);return s}})},{"./seventh.js":41}],39:[function(e,t,i){(function(t){(function(){"use strict";const i=e("./seventh.js");var n=false;i.asyncExit=function(e,s){if(n){return}n=true;var r=t.listeners("asyncExit");if(!r.length){t.exit(e);return}if(s===undefined){s=1e3}const o=t=>{if(t.length<3){t(e,s);return i.dummy}return new i(i=>{t(e,s,()=>{i()})})};i.map(r,o).finally(()=>t.exit(e));setTimeout(()=>t.exit(e),s)};i.resolveSafeTimeout=function(e,t){return new i(i=>{setTimeout(()=>{setTimeout(()=>{setTimeout(()=>{setTimeout(()=>i(t),0)},e/2)},e/2)},0)})}}).call(this)}).call(this,e("_process"))},{"./seventh.js":41,_process:32}],40:[function(e,t,i){"use strict";const n=e("./seventh.js");n.parasite=(()=>{var e=["tap","tapCatch","finally","fatal","done","callback","callbackAll"];e.forEach(e=>n.Native.prototype[e]=n.prototype[e]);n.Native.prototype._then=n.Native.prototype.then})},{"./seventh.js":41}],41:[function(e,t,i){"use strict";const n=e("./core.js");t.exports=n;e("./batch.js");e("./wrapper.js");e("./decorators.js");e("./Queue.js");e("./api.js");e("./parasite.js");e("./misc.js")},{"./Queue.js":34,"./api.js":35,"./batch.js":36,"./core.js":37,"./decorators.js":38,"./misc.js":39,"./parasite.js":40,"./wrapper.js":42}],42:[function(e,t,i){"use strict";const n=e("./seventh.js");n.timeLimit=((e,t)=>{return new n((i,s)=>{if(typeof t==="function"){t=t()}n.resolve(t).then(i,s);setTimeout(()=>s(new Error("Timeout")),e)})});n.retry=((e,t)=>{var i=e.retries||1,s=e.coolDown||0,r=e.raiseFactor||1,o=e.maxCoolDown||Infinity,a=e.timeout||0,l=e.catch||null;const c=()=>{return(a?n.timeLimit(a,t):t()).catch(e=>{if(!i--){throw e}var t=s;s=Math.min(s*r,o);if(l){return n.resolve(l(e)).then(()=>n.resolveTimeout(t).then(c))}return n.resolveTimeout(t).then(c)})};return c()});n.onceEvent=((e,t)=>{return new n(i=>e.once(t,i))});n.onceEventAll=((e,t)=>{return new n(i=>e.once(t,(...e)=>i(e)))});n.onceEventOrError=((e,t,i,s=false)=>{return new n((n,r)=>{var o;var a=(...t)=>{e.removeListener("error",l);if(o){for(let t in o){e.removeListener(t,o[t])}}n(s?t:t[0])};var l=i=>{e.removeListener(t,a);if(o){for(let t in o){e.removeListener(t,o[t])}}r(i)};e.once(t,a);e.once("error",l);if(i){if(!Array.isArray(i)){i=[i]}o={};i.forEach(i=>{var n=(...n)=>{e.removeListener("error",l);e.removeListener(t,a);var s=new Error("Received an excluded event: "+i);s.event=i;s.eventArgs=n;r(s)};e.once(i,n);o[i]=n})}})});n.onceEventAllOrError=((e,t,i)=>{return n.onceEventOrError(e,t,i,true)})},{"./seventh.js":41}],43:[function(e,t,i){(function(t,n){(function(){var s=e("process/browser.js").nextTick;var r=Function.prototype.apply;var o=Array.prototype.slice;var a={};var l=0;i.setTimeout=function(){return new c(r.call(setTimeout,window,arguments),clearTimeout)};i.setInterval=function(){return new c(r.call(setInterval,window,arguments),clearInterval)};i.clearTimeout=i.clearInterval=function(e){e.close()};function c(e,t){this._id=e;this._clearFn=t}c.prototype.unref=c.prototype.ref=function(){};c.prototype.close=function(){this._clearFn.call(window,this._id)};i.enroll=function(e,t){clearTimeout(e._idleTimeoutId);e._idleTimeout=t};i.unenroll=function(e){clearTimeout(e._idleTimeoutId);e._idleTimeout=-1};i._unrefActive=i.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;if(t>=0){e._idleTimeoutId=setTimeout(function t(){if(e._onTimeout)e._onTimeout()},t)}};i.setImmediate=typeof t==="function"?t:function(e){var t=l++;var n=arguments.length<2?false:o.call(arguments,1);a[t]=true;s(function s(){if(a[t]){if(n){e.apply(null,n)}else{e.call(null)}i.clearImmediate(t)}});return t};i.clearImmediate=typeof n==="function"?n:function(e){delete a[e]}}).call(this)}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":32,timers:43}]},{},[17]);